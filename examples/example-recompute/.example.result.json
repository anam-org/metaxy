{
  "runbook_name": "Recompute Example",
  "package_name": "example_recompute",
  "description": "Demonstrates automatic recomputation when upstream dependencies change",
  "execution_state": {
    "events": [
      {
        "type": "graph_pushed",
        "snapshot_version": "d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82",
        "graph": {
          "examples/parent": {
            "metaxy_feature_version": "0aad9b8a2ea055cde3c4149fc4cde576e6478a982cea75b45c3cd012db43a5e8",
            "fields": {
              "embeddings": "05e66510da58ef37168095b60188849cd6b1f0a4b539d0ac29ffd1e15b756459"
            },
            "feature_spec": {
              "key": "examples/parent",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "embeddings",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "examples/child": {
            "metaxy_feature_version": "440ffb028aaa5cb21b155c4ef21debd81f283f99aa91ef58cbe541d71164b44f",
            "fields": {
              "predictions": "1905d9e85ceb58b0361e863c7fbfbf5843582f8ed135ea5ce6c24ee2c68c6bb4"
            },
            "feature_spec": {
              "key": "examples/child",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [
                {
                  "feature": "examples/parent",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "1:1"
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "predictions",
                  "code_version": "1",
                  "deps": [
                    {
                      "feature": "examples/parent",
                      "fields": [
                        "embeddings"
                      ]
                    }
                  ]
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-08T13:31:13.125179",
        "scenario_name": "Setup upstream data",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python -m example_recompute.setup_data",
        "returncode": 0,
        "stdout": "",
        "stderr": "",
        "timestamp": "2026-01-08T13:31:13.163212",
        "scenario_name": "Setup upstream data",
        "step_name": "setup_data"
      },
      {
        "type": "command_executed",
        "command": "python -m example_recompute.pipeline",
        "returncode": 0,
        "stdout": "Graph snapshot_version: d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82\nWritten 3 rows for feature examples/parent\nPipeline\n============================================================\n\n[1/2] Computing parent feature...\n\n[2/2] Computing child feature...\nGraph snapshot_version: d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82\n\nðŸ“Š Computing examples/child...\n  feature_version: 440ffb028aaa5cb21b155c4ef21debd81f283f99aa91ef58cbe541d71164b44f\nIdentified: 3 new samples, 0 samples with new provenance_by_field\nâœ“ Materialized 3 new samples\n\nðŸ“‹ Child provenance_by_field:\n  sample_uid=1: {'predictions': '55e4ad342b7f3a680eb3093b18394e05'}\n  sample_uid=2: {'predictions': '722b2b91a6e10ddaab5ab3115efcee45'}\n  sample_uid=3: {'predictions': '07f06ce7547de41903dfe1b3239acd04'}\n\n\nâœ… Pipeline complete!\n",
        "stderr": "sys:1: UserWarning: AUTO_CREATE_TABLES is enabled - automatically creating table 'examples__parent'. Do not use in production! Use proper database migration tools like Alembic for production deployments.\n",
        "timestamp": "2026-01-08T13:31:15.821045",
        "scenario_name": "Initial pipeline run",
        "step_name": "initial_run"
      },
      {
        "type": "command_executed",
        "command": "python -m example_recompute.pipeline",
        "returncode": 0,
        "stdout": "Graph snapshot_version: d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82\nMetadata already exists for feature examples/parent (feature_version: 0aad9b8a2ea055cd...)\nSkipping write to avoid duplicates\nPipeline\n============================================================\n\n[1/2] Computing parent feature...\n\n[2/2] Computing child feature...\nGraph snapshot_version: d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82\n\nðŸ“Š Computing examples/child...\n  feature_version: 440ffb028aaa5cb21b155c4ef21debd81f283f99aa91ef58cbe541d71164b44f\nIdentified: 0 new samples, 0 samples with new provenance_by_field\n\nðŸ“‹ Child provenance_by_field:\n  sample_uid=1: {'predictions': '55e4ad342b7f3a680eb3093b18394e05'}\n  sample_uid=2: {'predictions': '722b2b91a6e10ddaab5ab3115efcee45'}\n  sample_uid=3: {'predictions': '07f06ce7547de41903dfe1b3239acd04'}\n\nNo changes detected (idempotent)\n\nâœ… Pipeline complete!\n",
        "stderr": "",
        "timestamp": "2026-01-08T13:31:18.414527",
        "scenario_name": "Idempotent rerun",
        "step_name": "idempotent_run"
      },
      {
        "type": "graph_pushed",
        "snapshot_version": "31195f21044a744b4ea70c1ffe6432182e989ede74ed92a8c99e8cd269f14477",
        "graph": {
          "examples/parent": {
            "metaxy_feature_version": "a007f308d0a852e3fbf80a442bd0089e29eed94efefe85231ef4fc927aa7d737",
            "fields": {
              "embeddings": "3c8d3e9ba031ab3613eb4db0877d3959fce76d94d625335b89bae7fbd4f27add"
            },
            "feature_spec": {
              "key": "examples/parent",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "embeddings",
                  "code_version": "2",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "examples/child": {
            "metaxy_feature_version": "7251e21c32d2d8e35a8ba389a8ce1b597663f206dee0ff55e542a3af1f1665cd",
            "fields": {
              "predictions": "bcb950543ea50ba3e19aef4846cbc3d36725e2548040c4327219eb2e75e6d997"
            },
            "feature_spec": {
              "key": "examples/child",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [
                {
                  "feature": "examples/parent",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "1:1"
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "predictions",
                  "code_version": "1",
                  "deps": [
                    {
                      "feature": "examples/parent",
                      "fields": [
                        "embeddings"
                      ]
                    }
                  ]
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-08T13:31:19.709197",
        "scenario_name": "Code evolution",
        "step_name": "update_parent_version"
      },
      {
        "type": "patch_applied",
        "patch_path": "patches/01_update_parent_algorithm.patch",
        "before_snapshot": "d49e39c7ad7523cd9d25e26f9f350b73c66c979abccf2f0caee84e489035ce82",
        "after_snapshot": "31195f21044a744b4ea70c1ffe6432182e989ede74ed92a8c99e8cd269f14477",
        "before_graph": {
          "examples/parent": {
            "metaxy_feature_version": "0aad9b8a2ea055cde3c4149fc4cde576e6478a982cea75b45c3cd012db43a5e8",
            "fields": {
              "embeddings": "05e66510da58ef37168095b60188849cd6b1f0a4b539d0ac29ffd1e15b756459"
            },
            "feature_spec": {
              "key": "examples/parent",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "embeddings",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "examples/child": {
            "metaxy_feature_version": "440ffb028aaa5cb21b155c4ef21debd81f283f99aa91ef58cbe541d71164b44f",
            "fields": {
              "predictions": "1905d9e85ceb58b0361e863c7fbfbf5843582f8ed135ea5ce6c24ee2c68c6bb4"
            },
            "feature_spec": {
              "key": "examples/child",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [
                {
                  "feature": "examples/parent",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "1:1"
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "predictions",
                  "code_version": "1",
                  "deps": [
                    {
                      "feature": "examples/parent",
                      "fields": [
                        "embeddings"
                      ]
                    }
                  ]
                }
              ],
              "metadata": {}
            }
          }
        },
        "after_graph": {
          "examples/parent": {
            "metaxy_feature_version": "a007f308d0a852e3fbf80a442bd0089e29eed94efefe85231ef4fc927aa7d737",
            "fields": {
              "embeddings": "3c8d3e9ba031ab3613eb4db0877d3959fce76d94d625335b89bae7fbd4f27add"
            },
            "feature_spec": {
              "key": "examples/parent",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "embeddings",
                  "code_version": "2",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "examples/child": {
            "metaxy_feature_version": "7251e21c32d2d8e35a8ba389a8ce1b597663f206dee0ff55e542a3af1f1665cd",
            "fields": {
              "predictions": "bcb950543ea50ba3e19aef4846cbc3d36725e2548040c4327219eb2e75e6d997"
            },
            "feature_spec": {
              "key": "examples/child",
              "id_columns": [
                "sample_uid"
              ],
              "deps": [
                {
                  "feature": "examples/parent",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "1:1"
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "predictions",
                  "code_version": "1",
                  "deps": [
                    {
                      "feature": "examples/parent",
                      "fields": [
                        "embeddings"
                      ]
                    }
                  ]
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-08T13:31:19.716275",
        "scenario_name": "Code evolution",
        "step_name": "update_parent_version"
      },
      {
        "type": "command_executed",
        "command": "python -m example_recompute.pipeline",
        "returncode": 0,
        "stdout": "Graph snapshot_version: 31195f21044a744b4ea70c1ffe6432182e989ede74ed92a8c99e8cd269f14477\nWritten 3 rows for feature examples/parent\nPipeline\n============================================================\n\n[1/2] Computing parent feature...\n\n[2/2] Computing child feature...\nGraph snapshot_version: 31195f21044a744b4ea70c1ffe6432182e989ede74ed92a8c99e8cd269f14477\n\nðŸ“Š Computing examples/child...\n  feature_version: 7251e21c32d2d8e35a8ba389a8ce1b597663f206dee0ff55e542a3af1f1665cd\nIdentified: 3 new samples, 0 samples with new provenance_by_field\nâœ“ Materialized 3 new samples\n\nðŸ“‹ Child provenance_by_field:\n  sample_uid=1: {'predictions': '55e4ad342b7f3a680eb3093b18394e05'}\n  sample_uid=2: {'predictions': '722b2b91a6e10ddaab5ab3115efcee45'}\n  sample_uid=3: {'predictions': '07f06ce7547de41903dfe1b3239acd04'}\n\n\nâœ… Pipeline complete!\n",
        "stderr": "",
        "timestamp": "2026-01-08T13:31:22.381187",
        "scenario_name": "Code evolution",
        "step_name": "recompute_after_change"
      }
    ]
  }
}
