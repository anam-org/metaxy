{
  "runbook_name": "N:1 Aggregation Example",
  "package_name": "example_aggregation",
  "description": "Demonstrates N:1 aggregation relationships where audio recordings for multiple speakers are aggregated into speaker embeddings",
  "execution_state": {
    "events": [
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "timestamp": "2026-01-08T08:53:38.502205",
        "scenario_name": "Initial pipeline run",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 4 new audio recordings\nFound 2 speakers that need embedding computation\n  Computing embedding for speaker s2 from 2 audio recordings\n  Computing embedding for speaker s1 from 2 audio recordings\nWriting embeddings for 2 speakers\n",
        "stderr": "/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:58: PolarsMaterializationWarning: Narwhals implementation mismatch: native is ibis, got polars. This will lead to materialization into an eager Polars frame. Provided `samples` have implementation polars. Using Polars for resolving the increment instead.\n  diff = store.resolve_update(Audio, samples=AUDIO_SAMPLES)\n/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:119: UserWarning: AUTO_CREATE_TABLES is enabled - automatically creating table 'audio'. Do not use in production! Use proper database migration tools like Alembic for production deployments.\n  main()\n/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:119: UserWarning: AUTO_CREATE_TABLES is enabled - automatically creating table 'speaker__embedding'. Do not use in production! Use proper database migration tools like Alembic for production deployments.\n  main()\n",
        "timestamp": "2026-01-08T08:53:39.973919",
        "scenario_name": "Initial pipeline run",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "No new or changed audio recordings\nFound 0 speakers that need embedding computation\n",
        "stderr": "/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:58: PolarsMaterializationWarning: Narwhals implementation mismatch: native is ibis, got polars. This will lead to materialization into an eager Polars frame. Provided `samples` have implementation polars. Using Polars for resolving the increment instead.\n  diff = store.resolve_update(Audio, samples=AUDIO_SAMPLES)\n",
        "timestamp": "2026-01-08T08:53:41.405972",
        "scenario_name": "Idempotent rerun",
        "step_name": null
      },
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "timestamp": "2026-01-08T08:53:42.630744",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "patch_applied",
        "patch_path": "patches/01_update_audio_provenance.patch",
        "before_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "after_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "timestamp": "2026-01-08T08:53:42.630766",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 1 changed audio recordings\nFound 1 speakers that need embedding computation\n  Computing embedding for speaker s1 from 2 audio recordings\nWriting embeddings for 1 speakers\n",
        "stderr": "/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:58: PolarsMaterializationWarning: Narwhals implementation mismatch: native is ibis, got polars. This will lead to materialization into an eager Polars frame. Provided `samples` have implementation polars. Using Polars for resolving the increment instead.\n  diff = store.resolve_update(Audio, samples=AUDIO_SAMPLES)\n",
        "timestamp": "2026-01-08T08:53:44.192603",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "timestamp": "2026-01-08T08:53:45.401939",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "patch_applied",
        "patch_path": "patches/02_add_audio.patch",
        "before_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "after_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "timestamp": "2026-01-08T08:53:45.401962",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 1 new audio recordings\nFound 1 speakers that need embedding computation\n  Computing embedding for speaker s1 from 3 audio recordings\nWriting embeddings for 1 speakers\n",
        "stderr": "/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:65: PolarsMaterializationWarning: Narwhals implementation mismatch: native is ibis, got polars. This will lead to materialization into an eager Polars frame. Provided `samples` have implementation polars. Using Polars for resolving the increment instead.\n  diff = store.resolve_update(Audio, samples=AUDIO_SAMPLES)\n",
        "timestamp": "2026-01-08T08:53:46.942875",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "No new or changed audio recordings\nFound 0 speakers that need embedding computation\n",
        "stderr": "/tmp/nix-shell.D1X7TE/tmpvwohu0kd/example-aggregation/pipeline.py:65: PolarsMaterializationWarning: Narwhals implementation mismatch: native is ibis, got polars. This will lead to materialization into an eager Polars frame. Provided `samples` have implementation polars. Using Polars for resolving the increment instead.\n  diff = store.resolve_update(Audio, samples=AUDIO_SAMPLES)\n",
        "timestamp": "2026-01-08T08:53:48.369456",
        "scenario_name": "Final idempotent check",
        "step_name": null
      }
    ]
  }
}
