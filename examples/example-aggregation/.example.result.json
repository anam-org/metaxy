{
  "runbook_name": "N:1 Aggregation Example",
  "package_name": "example_aggregation",
  "description": "Demonstrates N:1 aggregation relationships where audio recordings for multiple speakers are aggregated into speaker embeddings",
  "execution_state": {
    "events": [
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-28T15:03:57.823397",
        "scenario_name": "Initial pipeline run",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 4 new audio recordings\nFound 2 speakers that need embedding computation\n  Computing embedding for speaker s1 from 2 audio recordings\n  Computing embedding for speaker s2 from 2 audio recordings\nWriting embeddings for 2 speakers\n",
        "stderr": "",
        "timestamp": "2026-01-28T15:03:58.363696",
        "scenario_name": "Initial pipeline run",
        "step_name": "run_pipeline"
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "No new or changed audio recordings\nFound 0 speakers that need embedding computation\n",
        "stderr": "",
        "timestamp": "2026-01-28T15:03:58.962775",
        "scenario_name": "Idempotent rerun",
        "step_name": null
      },
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-28T15:03:59.617589",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "patch_applied",
        "patch_path": "patches/01_update_audio_provenance.patch",
        "before_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "after_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "before_graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "after_graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-28T15:03:59.624764",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 1 changed audio recordings\nFound 1 speakers that need embedding computation\n  Computing embedding for speaker s1 from 2 audio recordings\nWriting embeddings for 1 speakers\n",
        "stderr": "",
        "timestamp": "2026-01-28T15:04:00.202920",
        "scenario_name": "Update one audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "graph_pushed",
        "snapshot_version": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-28T15:04:00.832235",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "patch_applied",
        "patch_path": "patches/02_add_audio.patch",
        "before_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "after_snapshot": "d20c6813866c39ff989eee8e5d45f93f061943fe13f5a65311ff987fc7f1d7cc",
        "before_graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "after_graph": {
          "audio": {
            "metaxy_feature_version": "c97627054100197ec6c746b0305a630569f2f13968aa53b610100a01f0991908",
            "fields": {
              "default": "80200592cc6accc65ee0b09a7fcf4082c729a0b919cd9c3edf088eb94f27a60c"
            },
            "feature_spec": {
              "key": "audio",
              "id_columns": [
                "audio_id"
              ],
              "deps": [],
              "fields": [
                {
                  "key": "default",
                  "code_version": "__metaxy_initial__",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          },
          "speaker/embedding": {
            "metaxy_feature_version": "83296faf60084eb70f7d1976367ffcc541f1149195b79bebe46dbb98a50f3bdd",
            "fields": {
              "embedding": "8b5b20fb5aab8799f1fbf969e97e71540801d94cae081a6dbef6acbf941fd71a"
            },
            "feature_spec": {
              "key": "speaker/embedding",
              "id_columns": [
                "speaker_id"
              ],
              "deps": [
                {
                  "feature": "audio",
                  "columns": null,
                  "rename": null,
                  "fields_mapping": {
                    "mapping": {
                      "type": "default",
                      "match_suffix": false,
                      "exclude_fields": []
                    }
                  },
                  "sql_filters": null,
                  "lineage": {
                    "relationship": {
                      "type": "N:1",
                      "on": [
                        "speaker_id"
                      ]
                    }
                  },
                  "optional": false
                }
              ],
              "fields": [
                {
                  "key": "embedding",
                  "code_version": "1",
                  "deps": []
                }
              ],
              "metadata": {}
            }
          }
        },
        "timestamp": "2026-01-28T15:04:00.839007",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "Found 1 new audio recordings\nFound 1 speakers that need embedding computation\n  Computing embedding for speaker s1 from 3 audio recordings\nWriting embeddings for 1 speakers\n",
        "stderr": "",
        "timestamp": "2026-01-28T15:04:01.427615",
        "scenario_name": "Add new audio - only affected speaker recomputed",
        "step_name": null
      },
      {
        "type": "command_executed",
        "command": "python pipeline.py",
        "returncode": 0,
        "stdout": "No new or changed audio recordings\nFound 0 speakers that need embedding computation\n",
        "stderr": "",
        "timestamp": "2026-01-28T15:04:02.010363",
        "scenario_name": "Final idempotent check",
        "step_name": null
      }
    ]
  }
}
