
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="API reference for the MetadataStore interface.">
      
      
      
        <link rel="canonical" href="https://docs.metaxy.io/main/reference/api/metadata-stores/base/">
      
      
        <link rel="prev" href="../../definitions/filters/">
      
      
        <link rel="next" href="../exceptions/">
      
      
        
      
      
      <link rel="icon" href="../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Metadata Stores API - Metaxy</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22m263.4-27%2014.8%2036.8L315%2024.6c3%201.2%205%204.2%205%207.4s-2%206.2-5%207.4l-36.8%2014.8L263.4%2091c-1.2%203-4.2%205-7.4%205s-6.2-2-7.4-5l-14.8-36.8L197%2039.4c-3-1.2-5-4.2-5-7.4s2-6.2%205-7.4l36.8-14.8L248.6-27c1.2-3%204.2-5%207.4-5s6.2%202%207.4%205M110.7%2041.7l21.5%2050.1%2050.1%2021.5c5.9%202.5%209.7%208.3%209.7%2014.7s-3.8%2012.2-9.7%2014.7l-50.1%2021.5-21.5%2050.1c-2.5%205.9-8.3%209.7-14.7%209.7s-12.2-3.8-14.7-9.7l-21.5-50.1-50.1-21.5C3.8%20140.2%200%20134.4%200%20128s3.8-12.2%209.7-14.7l50.1-21.5%2021.5-50.1C83.8%2035.8%2089.6%2032%2096%2032s12.2%203.8%2014.7%209.7M464%20304c6.4%200%2012.2%203.8%2014.7%209.7l21.5%2050.1%2050.1%2021.5c5.9%202.5%209.7%208.3%209.7%2014.7s-3.8%2012.2-9.7%2014.7l-50.1%2021.5-21.5%2050.1c-2.5%205.9-8.3%209.7-14.7%209.7s-12.2-3.8-14.7-9.7l-21.5-50.1-50.1-21.5c-5.9-2.5-9.7-8.3-9.7-14.7s3.8-12.2%209.7-14.7l50.1-21.5%2021.5-50.1c2.5-5.9%208.3-9.7%2014.7-9.7M460%200c11%200%2021.6%204.4%2029.5%2012.2l42.3%2042.3C539.6%2062.4%20544%2073%20544%2084s-4.4%2021.6-12.2%2029.5l-88.2%2088.2-101.3-101.3%2088.2-88.2C438.4%204.4%20449%200%20460%200M44.2%20398.5l264.2-264.2%20101.3%20101.3-264.2%20264.2C137.6%20507.6%20127%20512%20116%20512s-21.6-4.4-29.5-12.2l-42.3-42.3C36.4%20449.6%2032%20439%2032%20428s4.4-21.6%2012.2-29.5%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/code_select.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="Metadata Stores API - Metaxy" />
<meta property="og:description" content="API reference for the MetadataStore interface." />
<meta property="og:image" content="https://docs.metaxy.io/main/assets/images/social/reference/api/metadata-stores/base.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://docs.metaxy.io/main/reference/api/metadata-stores/base/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="Metadata Stores API - Metaxy" />
<meta property="twitter:description" content="API reference for the MetadataStore interface." />
<meta property="twitter:image" content="https://docs.metaxy.io/main/assets/images/social/reference/api/metadata-stores/base.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#metadata-stores" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Metaxy" class="md-header__button md-logo" aria-label="Metaxy" data-md-component="logo">
      
  <img src="../../../../assets/metaxy.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metaxy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metadata Stores API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/anam-org/metaxy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anam-org/metaxy
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../guide/" class="md-tabs__link">
        
  
  
    
  
  üìñ User Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../integrations/" class="md-tabs__link">
        
  
  
    
  
  üß© Integrations

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../examples/" class="md-tabs__link">
        
  
  
    
  
  üíª Examples

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../" class="md-tabs__link">
        
  
  
    
  
  üìö Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Metaxy" class="md-nav__button md-logo" aria-label="Metaxy" data-md-component="logo">
      
  <img src="../../../../assets/metaxy.svg" alt="logo">

    </a>
    Metaxy
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/anam-org/metaxy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anam-org/metaxy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üìñ User Guide
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    üìñ User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üéØ Overview
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    üéØ Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../metaxy/pitch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pitch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../metaxy/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Choices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/quickstart/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üöÄ Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../guide/concepts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üí° Concepts
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    üí° Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" >
        
          
          <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Metadata Stores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Metadata Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/metadata-stores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metadata Stores
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/deletions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deletions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3_3" id="__nav_1_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Definitions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Definitions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/definitions/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/definitions/optional-dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optional Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/definitions/relationship/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lineage Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/data-versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/feature-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Discovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/syntactic-sugar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Syntactic Sugar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ‚öôÔ∏è Application Lifecycle
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    ‚öôÔ∏è Application Lifecycle
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/lifecycle/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/lifecycle/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/lifecycle/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/qa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚ùì Q&A
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üß© Integrations
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    üß© Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/orchestration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Orchestration
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Orchestration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/orchestration/dagster/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Dagster
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Dagster
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/orchestration/dagster/metaxify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    @metaxify
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/orchestration/dagster/api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/metadata-stores/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Metadata Stores
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Metadata Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/metadata-stores/databases/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Databases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/databases/bigquery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BigQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/databases/clickhouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ClickHouse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/databases/duckdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DuckDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/databases/lancedb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LanceDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/databases/ibis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ibis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/metadata-stores/storage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Storage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/metadata-stores/storage/delta/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Delta Lake
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Compute
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Compute
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/compute/ray/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/plugins/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Plugins
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plugins
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/plugins/sqlmodel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQLModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/plugins/sqlalchemy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQLAlchemy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/ai/claude/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/ai/mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../examples/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üíª Examples
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    üíª Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/expansion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Expansion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    üìö Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    üìö Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../initialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Initialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../definitions/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Definitions
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Definitions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/feature-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Spec
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/field/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/fields-mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fields Mapping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/relationship/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lineage Relationship
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graph
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MetadataStore
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    MetadataStore
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Databases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-store-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Store Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.MetadataStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MetadataStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="¬†MetadataStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.materialization_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;materialization_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.qualified_class_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;qualified_class_name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.resolve_update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.compute_provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_provenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.read" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.write_multi" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write_multi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.config_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;config_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.native_implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;native_implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.create_versioning_engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_versioning_engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.open" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;open
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.validate_hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate_hash_algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.drop_feature_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;drop_feature_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.read_feature_schema_from_store" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_feature_schema_from_store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.has_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;has_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.display" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;display
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.find_store_for_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_store_for_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.get_store_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_store_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.get_store_info" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_store_info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.calculate_input_progress" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_input_progress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.copy_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;copy_metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.types.AccessMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;AccessMode
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.base.VersioningEngineOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;VersioningEngineOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-configuration-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Configuration Class
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.base.MetadataStoreConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MetadataStoreConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fallback_stores" class="md-nav__link">
    <span class="md-ellipsis">
      
        fallback_stores
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        hash_algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning_engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        versioning_engine
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" >
        
          
          <label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscellaneous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Constants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MetaxyConfig
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guide/concepts/system-columns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage Layout
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Databases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-store-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Store Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.MetadataStore" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MetadataStore
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="¬†MetadataStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.materialization_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;materialization_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.qualified_class_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;qualified_class_name
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.resolve_update" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_update
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.compute_provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_provenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.read" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.write" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.write_multi" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write_multi
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.config_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;config_model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.native_implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;native_implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.create_versioning_engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_versioning_engine
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.open" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;open
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.validate_hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate_hash_algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.drop_feature_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;drop_feature_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;delete
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.read_feature_schema_from_store" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_feature_schema_from_store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.has_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;has_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.display" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;display
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.find_store_for_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;find_store_for_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.get_store_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_store_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.get_store_info" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_store_info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.calculate_input_progress" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calculate_input_progress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.MetadataStore.copy_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;copy_metadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.types.AccessMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;AccessMode
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.base.VersioningEngineOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;VersioningEngineOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#base-configuration-class" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Configuration Class
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaxy.metadata_store.base.MetadataStoreConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;MetadataStoreConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fallback_stores" class="md-nav__link">
    <span class="md-ellipsis">
      
        fallback_stores
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        hash_algorithm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning_engine" class="md-nav__link">
    <span class="md-ellipsis">
      
        versioning_engine
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
      
        
  
  
    
    
      
  
  
    
    
      <li class="md-path__item">
        <a href="../../initialization/" class="md-path__link">
          
  <span class="md-ellipsis">
    üìö Reference
  </span>

        </a>
      </li>
    
  

    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../initialization/" class="md-path__link">
          
  <span class="md-ellipsis">
    API
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="./" class="md-path__link">
          
  <span class="md-ellipsis">
    MetadataStore
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="metadata-stores">Metadata Stores<a class="headerlink" href="#metadata-stores" title="Permanent link">&para;</a></h1>
<p>Metaxy abstracts interactions with metadata behind an interface called <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt;" href="#metaxy.MetadataStore"><code>MetadataStore</code></a>.</p>
<p>Users can extend this class to implement support for arbitrary metadata storage such as databases, lakehouse formats, or really any kind of external system.</p>
<p>Learn how to use metadata stores <a href="../../../../guide/concepts/metadata-stores/">here</a>.</p>
<p class="annotate">Here are some of the built-in metadata store types (1):</p>
<ol>
<li>the full list can be found <a href="../../../../integrations/metadata-stores/">here</a></li>
</ol>
<h2 id="databases">Databases<a class="headerlink" href="#databases" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/bigquery/">BigQuery</a></p>
</li>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/clickhouse/">ClickHouse</a></p>
</li>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/duckdb/">DuckDB</a> - if used with Motherduck</p>
</li>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/lancedb/">LanceDB</a> - if used with LanceDB Cloud</p>
</li>
</ul>
<h2 id="storage">Storage<a class="headerlink" href="#storage" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="../../../../integrations/metadata-stores/storage/delta/">DeltaMetadataStore</a></p>
</li>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/duckdb/">DuckDB</a> - if used with a local file</p>
</li>
<li>
<p><a href="../../../../integrations/metadata-stores/databases/lancedb/">LanceDB</a> - if used with a local file</p>
</li>
</ul>
<hr />
<h2 id="metadata-store-interface">Metadata Store Interface<a class="headerlink" href="#metadata-store-interface" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="metaxy.MetadataStore" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">metaxy.MetadataStore</span>


<a href="#metaxy.MetadataStore" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">MetadataStore</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">hash_algorithm</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.HashAlgorithm&lt;/span&gt; (&lt;code&gt;metaxy.versioning.types.HashAlgorithm&lt;/code&gt;)" href="../../types/#metaxy.HashAlgorithm">HashAlgorithm</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">versioning_engine</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.metadata_store.base.VersioningEngineOptions&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="#metaxy.metadata_store.base.VersioningEngineOptions">VersioningEngineOptions</a></span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">fallback_stores</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">auto_create_tables</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="&lt;code&gt;abc.ABC&lt;/code&gt;" href="https://docs.python.org/3/library/abc.html#abc.ABC">ABC</a></code></p>



        <p>Abstract base class for metadata storage backends.</p>



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>name</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Optional name for this store. For representation purposes only.
Is typically included into <code>.display()</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>hash_algorithm</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.HashAlgorithm&lt;/span&gt; (&lt;code&gt;metaxy.versioning.types.HashAlgorithm&lt;/code&gt;)" href="../../types/#metaxy.HashAlgorithm">HashAlgorithm</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Hash algorithm to use for the versioning engine.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>versioning_engine</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.metadata_store.base.VersioningEngineOptions&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="#metaxy.metadata_store.base.VersioningEngineOptions">VersioningEngineOptions</a></code>, default:
                  <code>&#39;auto&#39;</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Which versioning engine to use.</p>
<ul>
<li>
<p>"auto": Prefer the store's native engine and fall back to Polars if needed</p>
</li>
<li>
<p>"native": Always use the store's native engine, raise <code>VersioningEngineMismatchError</code>
    if at some point the metadata store has to switch to Polars</p>
</li>
<li>
<p>"polars": Always use the Polars engine</p>
</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>fallback_stores</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Ordered list of read-only fallback stores.
Used when upstream features are not in this store.
<code>VersioningEngineMismatchError</code> is not raised when reading from fallback stores.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>auto_create_tables</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to automatically create tables when writing new features.
If not provided, the global <abbr title="Settings via metaxy.toml, pyproject.toml, or environment variables. | /reference/configuration/">Metaxy configuration</abbr> <code>auto_created_tables</code> option will
be used (which can be set via <code>METAXY_AUTO_CREATE_TABLES</code> env var).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is intended for development/testing purposes.
Use proper database migration tools like Alembic to manage table infrastructure in production.</p>
</div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>materialization_id</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Optional external orchestration ID.
If provided, all metadata writes will include this ID in the <code>metaxy_materialization_id</code> column.
Can be overridden per <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;metaxy.MetadataStore.write&lt;/span&gt;" href="#metaxy.MetadataStore.write"><code>MetadataStore.write</code></a> call.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If fallback stores use different hash algorithms or truncation lengths</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.VersioningEngineMismatchError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.VersioningEngineMismatchError">VersioningEngineMismatchError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If the versioning engine is attempted to be switched
to Polars and <code>versioning_engine</code> is set to <code>native</code>.</p>
          </div>
        </li>
    </ul>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
                    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><a href="#__codelineno-0-167"><span class="linenos" data-linenos="167 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><a href="#__codelineno-0-168"><span class="linenos" data-linenos="168 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><a href="#__codelineno-0-169"><span class="linenos" data-linenos="169 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><a href="#__codelineno-0-170"><span class="linenos" data-linenos="170 "></span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><a href="#__codelineno-0-171"><span class="linenos" data-linenos="171 "></span></a>    <span class="n">hash_algorithm</span><span class="p">:</span> <span class="n">HashAlgorithm</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><a href="#__codelineno-0-172"><span class="linenos" data-linenos="172 "></span></a>    <span class="n">versioning_engine</span><span class="p">:</span> <span class="n">VersioningEngineOptions</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><a href="#__codelineno-0-173"><span class="linenos" data-linenos="173 "></span></a>    <span class="n">fallback_stores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MetadataStore</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><a href="#__codelineno-0-174"><span class="linenos" data-linenos="174 "></span></a>    <span class="n">auto_create_tables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><a href="#__codelineno-0-175"><span class="linenos" data-linenos="175 "></span></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><a href="#__codelineno-0-176"><span class="linenos" data-linenos="176 "></span></a><span class="p">):</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><a href="#__codelineno-0-177"><span class="linenos" data-linenos="177 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><a href="#__codelineno-0-178"><span class="linenos" data-linenos="178 "></span></a><span class="sd">    Initialize the metadata store.</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><a href="#__codelineno-0-179"><span class="linenos" data-linenos="179 "></span></a>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><a href="#__codelineno-0-180"><span class="linenos" data-linenos="180 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><a href="#__codelineno-0-181"><span class="linenos" data-linenos="181 "></span></a><span class="sd">        name: Optional name for this store. For representation purposes only.</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><a href="#__codelineno-0-182"><span class="linenos" data-linenos="182 "></span></a><span class="sd">            Is typically included into `.display()`.</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><a href="#__codelineno-0-183"><span class="linenos" data-linenos="183 "></span></a><span class="sd">        hash_algorithm: Hash algorithm to use for the versioning engine.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><a href="#__codelineno-0-184"><span class="linenos" data-linenos="184 "></span></a><span class="sd">        versioning_engine: Which versioning engine to use.</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><a href="#__codelineno-0-185"><span class="linenos" data-linenos="185 "></span></a>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><a href="#__codelineno-0-186"><span class="linenos" data-linenos="186 "></span></a><span class="sd">            - &quot;auto&quot;: Prefer the store&#39;s native engine and fall back to Polars if needed</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><a href="#__codelineno-0-187"><span class="linenos" data-linenos="187 "></span></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><a href="#__codelineno-0-188"><span class="linenos" data-linenos="188 "></span></a><span class="sd">            - &quot;native&quot;: Always use the store&#39;s native engine, raise `VersioningEngineMismatchError`</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><a href="#__codelineno-0-189"><span class="linenos" data-linenos="189 "></span></a><span class="sd">                if at some point the metadata store has to switch to Polars</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><a href="#__codelineno-0-190"><span class="linenos" data-linenos="190 "></span></a>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><a href="#__codelineno-0-191"><span class="linenos" data-linenos="191 "></span></a><span class="sd">            - &quot;polars&quot;: Always use the Polars engine</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><a href="#__codelineno-0-192"><span class="linenos" data-linenos="192 "></span></a>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><a href="#__codelineno-0-193"><span class="linenos" data-linenos="193 "></span></a><span class="sd">        fallback_stores: Ordered list of read-only fallback stores.</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><a href="#__codelineno-0-194"><span class="linenos" data-linenos="194 "></span></a><span class="sd">            Used when upstream features are not in this store.</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><a href="#__codelineno-0-195"><span class="linenos" data-linenos="195 "></span></a><span class="sd">            `VersioningEngineMismatchError` is not raised when reading from fallback stores.</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><a href="#__codelineno-0-196"><span class="linenos" data-linenos="196 "></span></a><span class="sd">        auto_create_tables: Whether to automatically create tables when writing new features.</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><a href="#__codelineno-0-197"><span class="linenos" data-linenos="197 "></span></a><span class="sd">            If not provided, the global Metaxy configuration `auto_created_tables` option will</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><a href="#__codelineno-0-198"><span class="linenos" data-linenos="198 "></span></a><span class="sd">            be used (which can be set via `METAXY_AUTO_CREATE_TABLES` env var).</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><a href="#__codelineno-0-199"><span class="linenos" data-linenos="199 "></span></a>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><a href="#__codelineno-0-200"><span class="linenos" data-linenos="200 "></span></a><span class="sd">            !!! warning</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><a href="#__codelineno-0-201"><span class="linenos" data-linenos="201 "></span></a><span class="sd">                This is intended for development/testing purposes.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><a href="#__codelineno-0-202"><span class="linenos" data-linenos="202 "></span></a><span class="sd">                Use proper database migration tools like Alembic to manage table infrastructure in production.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><a href="#__codelineno-0-203"><span class="linenos" data-linenos="203 "></span></a>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><a href="#__codelineno-0-204"><span class="linenos" data-linenos="204 "></span></a><span class="sd">        materialization_id: Optional external orchestration ID.</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><a href="#__codelineno-0-205"><span class="linenos" data-linenos="205 "></span></a><span class="sd">            If provided, all metadata writes will include this ID in the `metaxy_materialization_id` column.</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><a href="#__codelineno-0-206"><span class="linenos" data-linenos="206 "></span></a><span class="sd">            Can be overridden per [`MetadataStore.write`][metaxy.MetadataStore.write] call.</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><a href="#__codelineno-0-207"><span class="linenos" data-linenos="207 "></span></a>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><a href="#__codelineno-0-208"><span class="linenos" data-linenos="208 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><a href="#__codelineno-0-209"><span class="linenos" data-linenos="209 "></span></a><span class="sd">        ValueError: If fallback stores use different hash algorithms or truncation lengths</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><a href="#__codelineno-0-210"><span class="linenos" data-linenos="210 "></span></a><span class="sd">        VersioningEngineMismatchError: If the versioning engine is attempted to be switched</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><a href="#__codelineno-0-211"><span class="linenos" data-linenos="211 "></span></a><span class="sd">            to Polars and `versioning_engine` is set to `native`.</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><a href="#__codelineno-0-212"><span class="linenos" data-linenos="212 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><a href="#__codelineno-0-213"><span class="linenos" data-linenos="213 "></span></a>    <span class="c1"># Initialize state early so properties can check it</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><a href="#__codelineno-0-214"><span class="linenos" data-linenos="214 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><a href="#__codelineno-0-215"><span class="linenos" data-linenos="215 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><a href="#__codelineno-0-216"><span class="linenos" data-linenos="216 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_context_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><a href="#__codelineno-0-217"><span class="linenos" data-linenos="217 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_versioning_engine</span> <span class="o">=</span> <span class="n">versioning_engine</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><a href="#__codelineno-0-218"><span class="linenos" data-linenos="218 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_materialization_id</span> <span class="o">=</span> <span class="n">materialization_id</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><a href="#__codelineno-0-219"><span class="linenos" data-linenos="219 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_open_cm</span><span class="p">:</span> <span class="n">AbstractContextManager</span><span class="p">[</span><span class="n">Self</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Track the open() context manager</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><a href="#__codelineno-0-220"><span class="linenos" data-linenos="220 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_transaction_timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Shared timestamp for write operations</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><a href="#__codelineno-0-221"><span class="linenos" data-linenos="221 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_soft_delete_in_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Track if we&#39;re inside a soft delete operation</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><a href="#__codelineno-0-222"><span class="linenos" data-linenos="222 "></span></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><a href="#__codelineno-0-223"><span class="linenos" data-linenos="223 "></span></a>    <span class="c1"># Resolve auto_create_tables from global config if not explicitly provided</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><a href="#__codelineno-0-224"><span class="linenos" data-linenos="224 "></span></a>    <span class="k">if</span> <span class="n">auto_create_tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a><a href="#__codelineno-0-225"><span class="linenos" data-linenos="225 "></span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetaxyConfig</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><a href="#__codelineno-0-226"><span class="linenos" data-linenos="226 "></span></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><a href="#__codelineno-0-227"><span class="linenos" data-linenos="227 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_create_tables</span> <span class="o">=</span> <span class="n">MetaxyConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">auto_create_tables</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><a href="#__codelineno-0-228"><span class="linenos" data-linenos="228 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><a href="#__codelineno-0-229"><span class="linenos" data-linenos="229 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auto_create_tables</span> <span class="o">=</span> <span class="n">auto_create_tables</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><a href="#__codelineno-0-230"><span class="linenos" data-linenos="230 "></span></a>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><a href="#__codelineno-0-231"><span class="linenos" data-linenos="231 "></span></a>    <span class="c1"># Use store&#39;s default algorithm if not specified</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><a href="#__codelineno-0-232"><span class="linenos" data-linenos="232 "></span></a>    <span class="k">if</span> <span class="n">hash_algorithm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><a href="#__codelineno-0-233"><span class="linenos" data-linenos="233 "></span></a>        <span class="n">hash_algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_hash_algorithm</span><span class="p">()</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><a href="#__codelineno-0-234"><span class="linenos" data-linenos="234 "></span></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><a href="#__codelineno-0-235"><span class="linenos" data-linenos="235 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span> <span class="o">=</span> <span class="n">hash_algorithm</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><a href="#__codelineno-0-236"><span class="linenos" data-linenos="236 "></span></a>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><a href="#__codelineno-0-237"><span class="linenos" data-linenos="237 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span> <span class="o">=</span> <span class="n">fallback_stores</span> <span class="ow">or</span> <span class="p">[]</span>
</span></code></pre></div>
                  </details>



<div class="doc doc-children">





<h3 id="metaxy.MetadataStore-attributes">Attributes<a href="#metaxy.MetadataStore-attributes" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-attribute">



<h4 id="metaxy.MetadataStore.materialization_id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metaxy.MetadataStore.materialization_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#metaxy.MetadataStore.materialization_id" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">materialization_id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The external orchestration ID for this store instance.</p>
<p>If set, all metadata writes include this ID in the <code>metaxy_materialization_id</code> column,
allowing filtering of rows written during a specific materialization run.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="metaxy.MetadataStore.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metaxy.MetadataStore.name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#metaxy.MetadataStore.name" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The configured name of this store, if any.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="metaxy.MetadataStore.qualified_class_name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metaxy.MetadataStore.qualified_class_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#metaxy.MetadataStore.qualified_class_name" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">qualified_class_name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The fully qualified class name (module.classname).</p>

    </div>

</div>


<h3 id="metaxy.MetadataStore-functions">Functions<a href="#metaxy.MetadataStore-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.resolve_update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.resolve_update</span>


<a href="#metaxy.MetadataStore.resolve_update" class="headerlink" title="Permanent link">&para;</a></h4>
          <div class="doc-overloads">
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">resolve_update</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.Frame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.Frame">Frame</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">global_filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">target_filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">lazy</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">versioning_engine</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;native&quot;</span><span class="p">,</span> <span class="s2">&quot;polars&quot;</span><span class="p">]</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">skip_comparison</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.Increment&lt;/span&gt;" href="../../types/#metaxy.versioning.types.Increment">Increment</a></span>
</span></code></pre></div><div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">resolve_update</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.Frame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.Frame">Frame</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">global_filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">target_filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">lazy</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">versioning_engine</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;native&quot;</span><span class="p">,</span> <span class="s2">&quot;polars&quot;</span><span class="p">]</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">skip_comparison</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.LazyIncrement&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="../../types/#metaxy.versioning.types.LazyIncrement">LazyIncrement</a></span>
</span></code></pre></div>          </div>


    <div class="doc doc-contents ">

        <p>Calculate an incremental update for a feature.</p>
<p>This is the main workhorse in Metaxy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature class to resolve updates for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>samples</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a> | <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.Frame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.Frame">Frame</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>A dataframe with joined upstream metadata and <code>"metaxy_provenance_by_field"</code> column set.
When provided, <code>MetadataStore</code> skips loading upstream feature metadata and provenance calculations.</p>
<div class="admonition info">
<p class="admonition-title">Required for root features</p>
<p>Metaxy doesn't know how to populate input metadata for root features,
so <code>samples</code> argument for <strong>must</strong> be provided for them.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For non-root features, use <code>samples</code> to customize the automatic upstream loading and field provenance calculation.
For example, it can be used to requires processing for specific sample IDs.</p>
</div>
<p>Setting this parameter during normal operations is not required.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>]] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>A mapping from feature keys to lists of Narwhals filter expressions.
Keys can be feature classes, FeatureKey objects, or string paths.
Applied at read-time. May filter the current feature,
in this case it will also be applied to <code>samples</code> (if provided).
Example: <code>{UpstreamFeature: [nw.col("x") &gt; 10], ...}</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>global_filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>A list of Narwhals filter expressions applied to all features
(both upstream and target). These filters are combined with any feature-specific
filters from <code>filters</code>. Must reference columns that exist in ALL features.
Useful for filtering by common columns like <code>sample_uid</code> across all features.
Example: <code>[nw.col("sample_uid").is_in(["s1", "s2"])]</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>A list of Narwhals filter expressions applied ONLY to the target
feature (not to upstream features). Use this when filtering by columns that
only exist in the target feature.
Example: <code>[nw.col("height").is_null()]</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>lazy</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to return a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.LazyIncrement&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="../../types/#metaxy.versioning.types.LazyIncrement">metaxy.versioning.types.LazyIncrement</a> or a <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.Increment&lt;/span&gt;" href="../../types/#metaxy.versioning.types.Increment">metaxy.versioning.types.Increment</a>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>versioning_engine</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a>[&#39;auto&#39;, &#39;native&#39;, &#39;polars&#39;] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Override the store's versioning engine for this operation.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>skip_comparison</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, skip the increment comparison logic and return all
upstream samples in <code>increment.new</code>. The <code>changed</code> and <code>removed</code> frames will
be empty.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If no <code>samples</code> dataframe has been provided when resolving an update for a <abbr title="A feature without any upstream (parent) features.">root feature</abbr>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.VersioningEngineMismatchError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.VersioningEngineMismatchError">VersioningEngineMismatchError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If <code>versioning_engine</code> has been set to <code>"native"</code>
and a dataframe of a different implementation has been encountered during <code>resolve_update</code>.</p>
          </div>
        </li>
    </ul>
        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method automatically loads feature definitions from the metadata store
before computing the update. This ensures that any <abbr title="Feature definition referencing an Metaxy feature defined in other Metaxy projects, typically not available in the current Python environment. | /guide/concepts/definitions/features/#external-features">external feature</abbr> dependencies
are resolved with their actual definitions from the store, preventing incorrect
version calculations from stale <abbr title="Feature definitions referencing Metaxy features defined in other Metaxy projects, typically not available in the current Python environment. | /guide/concepts/definitions/features/#external-features">external feature definitions</abbr>.</p>
</div>
<div class="admonition example">
<p class="admonition-title">With a <abbr title="A feature without any upstream (parent) features.">root feature</abbr></p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">narwhals</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nw</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">samples</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;metaxy_provenance_by_field&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>            <span class="p">{</span><span class="s2">&quot;part_1&quot;</span><span class="p">:</span> <span class="s2">&quot;h1&quot;</span><span class="p">,</span> <span class="s2">&quot;part_2&quot;</span><span class="p">:</span> <span class="s2">&quot;h2&quot;</span><span class="p">},</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>            <span class="p">{</span><span class="s2">&quot;part_1&quot;</span><span class="p">:</span> <span class="s2">&quot;h3&quot;</span><span class="p">,</span> <span class="s2">&quot;part_2&quot;</span><span class="p">:</span> <span class="s2">&quot;h4&quot;</span><span class="p">},</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>            <span class="p">{</span><span class="s2">&quot;part_1&quot;</span><span class="p">:</span> <span class="s2">&quot;h5&quot;</span><span class="p">,</span> <span class="s2">&quot;part_2&quot;</span><span class="p">:</span> <span class="s2">&quot;h6&quot;</span><span class="p">},</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="p">],</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="k">with</span> <span class="n">store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">resolve_update</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
</span></code></pre></div>
</div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><a href="#__codelineno-0-269"><span class="linenos" data-linenos="269 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">resolve_update</span><span class="p">(</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a><a href="#__codelineno-0-270"><span class="linenos" data-linenos="270 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a><a href="#__codelineno-0-271"><span class="linenos" data-linenos="271 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a><a href="#__codelineno-0-272"><span class="linenos" data-linenos="272 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a><a href="#__codelineno-0-273"><span class="linenos" data-linenos="273 "></span></a>    <span class="n">samples</span><span class="p">:</span> <span class="n">IntoFrame</span> <span class="o">|</span> <span class="n">Frame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a><a href="#__codelineno-0-274"><span class="linenos" data-linenos="274 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">CoercibleToFeatureKey</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a><a href="#__codelineno-0-275"><span class="linenos" data-linenos="275 "></span></a>    <span class="n">global_filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a><a href="#__codelineno-0-276"><span class="linenos" data-linenos="276 "></span></a>    <span class="n">target_filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><a href="#__codelineno-0-277"><span class="linenos" data-linenos="277 "></span></a>    <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><a href="#__codelineno-0-278"><span class="linenos" data-linenos="278 "></span></a>    <span class="n">versioning_engine</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;native&quot;</span><span class="p">,</span> <span class="s2">&quot;polars&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><a href="#__codelineno-0-279"><span class="linenos" data-linenos="279 "></span></a>    <span class="n">skip_comparison</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><a href="#__codelineno-0-280"><span class="linenos" data-linenos="280 "></span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><a href="#__codelineno-0-281"><span class="linenos" data-linenos="281 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Increment</span> <span class="o">|</span> <span class="n">LazyIncrement</span><span class="p">:</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a><a href="#__codelineno-0-282"><span class="linenos" data-linenos="282 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate an incremental update for a feature.</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><a href="#__codelineno-0-283"><span class="linenos" data-linenos="283 "></span></a>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><a href="#__codelineno-0-284"><span class="linenos" data-linenos="284 "></span></a><span class="sd">    This is the main workhorse in Metaxy.</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><a href="#__codelineno-0-285"><span class="linenos" data-linenos="285 "></span></a>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><a href="#__codelineno-0-286"><span class="linenos" data-linenos="286 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a><a href="#__codelineno-0-287"><span class="linenos" data-linenos="287 "></span></a><span class="sd">        feature: Feature class to resolve updates for</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a><a href="#__codelineno-0-288"><span class="linenos" data-linenos="288 "></span></a><span class="sd">        samples: A dataframe with joined upstream metadata and `&quot;metaxy_provenance_by_field&quot;` column set.</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><a href="#__codelineno-0-289"><span class="linenos" data-linenos="289 "></span></a><span class="sd">            When provided, `MetadataStore` skips loading upstream feature metadata and provenance calculations.</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><a href="#__codelineno-0-290"><span class="linenos" data-linenos="290 "></span></a>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><a href="#__codelineno-0-291"><span class="linenos" data-linenos="291 "></span></a><span class="sd">            !!! info &quot;Required for root features&quot;</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><a href="#__codelineno-0-292"><span class="linenos" data-linenos="292 "></span></a><span class="sd">                Metaxy doesn&#39;t know how to populate input metadata for root features,</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><a href="#__codelineno-0-293"><span class="linenos" data-linenos="293 "></span></a><span class="sd">                so `samples` argument for **must** be provided for them.</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><a href="#__codelineno-0-294"><span class="linenos" data-linenos="294 "></span></a>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a><a href="#__codelineno-0-295"><span class="linenos" data-linenos="295 "></span></a><span class="sd">            !!! tip</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><a href="#__codelineno-0-296"><span class="linenos" data-linenos="296 "></span></a><span class="sd">                For non-root features, use `samples` to customize the automatic upstream loading and field provenance calculation.</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><a href="#__codelineno-0-297"><span class="linenos" data-linenos="297 "></span></a><span class="sd">                For example, it can be used to requires processing for specific sample IDs.</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><a href="#__codelineno-0-298"><span class="linenos" data-linenos="298 "></span></a>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><a href="#__codelineno-0-299"><span class="linenos" data-linenos="299 "></span></a><span class="sd">            Setting this parameter during normal operations is not required.</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><a href="#__codelineno-0-300"><span class="linenos" data-linenos="300 "></span></a>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><a href="#__codelineno-0-301"><span class="linenos" data-linenos="301 "></span></a><span class="sd">        filters: A mapping from feature keys to lists of Narwhals filter expressions.</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><a href="#__codelineno-0-302"><span class="linenos" data-linenos="302 "></span></a><span class="sd">            Keys can be feature classes, FeatureKey objects, or string paths.</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><a href="#__codelineno-0-303"><span class="linenos" data-linenos="303 "></span></a><span class="sd">            Applied at read-time. May filter the current feature,</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><a href="#__codelineno-0-304"><span class="linenos" data-linenos="304 "></span></a><span class="sd">            in this case it will also be applied to `samples` (if provided).</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><a href="#__codelineno-0-305"><span class="linenos" data-linenos="305 "></span></a><span class="sd">            Example: `{UpstreamFeature: [nw.col(&quot;x&quot;) &gt; 10], ...}`</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><a href="#__codelineno-0-306"><span class="linenos" data-linenos="306 "></span></a><span class="sd">        global_filters: A list of Narwhals filter expressions applied to all features</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><a href="#__codelineno-0-307"><span class="linenos" data-linenos="307 "></span></a><span class="sd">            (both upstream and target). These filters are combined with any feature-specific</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><a href="#__codelineno-0-308"><span class="linenos" data-linenos="308 "></span></a><span class="sd">            filters from `filters`. Must reference columns that exist in ALL features.</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a><a href="#__codelineno-0-309"><span class="linenos" data-linenos="309 "></span></a><span class="sd">            Useful for filtering by common columns like `sample_uid` across all features.</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><a href="#__codelineno-0-310"><span class="linenos" data-linenos="310 "></span></a><span class="sd">            Example: `[nw.col(&quot;sample_uid&quot;).is_in([&quot;s1&quot;, &quot;s2&quot;])]`</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><a href="#__codelineno-0-311"><span class="linenos" data-linenos="311 "></span></a><span class="sd">        target_filters: A list of Narwhals filter expressions applied ONLY to the target</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><a href="#__codelineno-0-312"><span class="linenos" data-linenos="312 "></span></a><span class="sd">            feature (not to upstream features). Use this when filtering by columns that</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><a href="#__codelineno-0-313"><span class="linenos" data-linenos="313 "></span></a><span class="sd">            only exist in the target feature.</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><a href="#__codelineno-0-314"><span class="linenos" data-linenos="314 "></span></a><span class="sd">            Example: `[nw.col(&quot;height&quot;).is_null()]`</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a><a href="#__codelineno-0-315"><span class="linenos" data-linenos="315 "></span></a><span class="sd">        lazy: Whether to return a [metaxy.versioning.types.LazyIncrement][] or a [metaxy.versioning.types.Increment][].</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a><a href="#__codelineno-0-316"><span class="linenos" data-linenos="316 "></span></a><span class="sd">        versioning_engine: Override the store&#39;s versioning engine for this operation.</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><a href="#__codelineno-0-317"><span class="linenos" data-linenos="317 "></span></a><span class="sd">        skip_comparison: If True, skip the increment comparison logic and return all</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a><a href="#__codelineno-0-318"><span class="linenos" data-linenos="318 "></span></a><span class="sd">            upstream samples in `increment.new`. The `changed` and `removed` frames will</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a><a href="#__codelineno-0-319"><span class="linenos" data-linenos="319 "></span></a><span class="sd">            be empty.</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a><a href="#__codelineno-0-320"><span class="linenos" data-linenos="320 "></span></a>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a><a href="#__codelineno-0-321"><span class="linenos" data-linenos="321 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a><a href="#__codelineno-0-322"><span class="linenos" data-linenos="322 "></span></a><span class="sd">        ValueError: If no `samples` dataframe has been provided when resolving an update for a root feature.</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a><a href="#__codelineno-0-323"><span class="linenos" data-linenos="323 "></span></a><span class="sd">        VersioningEngineMismatchError: If `versioning_engine` has been set to `&quot;native&quot;`</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><a href="#__codelineno-0-324"><span class="linenos" data-linenos="324 "></span></a><span class="sd">            and a dataframe of a different implementation has been encountered during `resolve_update`.</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><a href="#__codelineno-0-325"><span class="linenos" data-linenos="325 "></span></a>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><a href="#__codelineno-0-326"><span class="linenos" data-linenos="326 "></span></a><span class="sd">    !!! note</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><a href="#__codelineno-0-327"><span class="linenos" data-linenos="327 "></span></a><span class="sd">        This method automatically loads feature definitions from the metadata store</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a><a href="#__codelineno-0-328"><span class="linenos" data-linenos="328 "></span></a><span class="sd">        before computing the update. This ensures that any external feature dependencies</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><a href="#__codelineno-0-329"><span class="linenos" data-linenos="329 "></span></a><span class="sd">        are resolved with their actual definitions from the store, preventing incorrect</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><a href="#__codelineno-0-330"><span class="linenos" data-linenos="330 "></span></a><span class="sd">        version calculations from stale external feature definitions.</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><a href="#__codelineno-0-331"><span class="linenos" data-linenos="331 "></span></a>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><a href="#__codelineno-0-332"><span class="linenos" data-linenos="332 "></span></a><span class="sd">    !!! example &quot;With a root feature&quot;</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a><a href="#__codelineno-0-333"><span class="linenos" data-linenos="333 "></span></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><a href="#__codelineno-0-334"><span class="linenos" data-linenos="334 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><a href="#__codelineno-0-335"><span class="linenos" data-linenos="335 "></span></a><span class="sd">        import narwhals as nw</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><a href="#__codelineno-0-336"><span class="linenos" data-linenos="336 "></span></a><span class="sd">        import polars as pl</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><a href="#__codelineno-0-337"><span class="linenos" data-linenos="337 "></span></a>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a><a href="#__codelineno-0-338"><span class="linenos" data-linenos="338 "></span></a><span class="sd">        samples = pl.DataFrame(</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><a href="#__codelineno-0-339"><span class="linenos" data-linenos="339 "></span></a><span class="sd">            {</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a><a href="#__codelineno-0-340"><span class="linenos" data-linenos="340 "></span></a><span class="sd">                &quot;id&quot;: [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;],</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a><a href="#__codelineno-0-341"><span class="linenos" data-linenos="341 "></span></a><span class="sd">                &quot;metaxy_provenance_by_field&quot;: [</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a><a href="#__codelineno-0-342"><span class="linenos" data-linenos="342 "></span></a><span class="sd">                    {&quot;part_1&quot;: &quot;h1&quot;, &quot;part_2&quot;: &quot;h2&quot;},</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a><a href="#__codelineno-0-343"><span class="linenos" data-linenos="343 "></span></a><span class="sd">                    {&quot;part_1&quot;: &quot;h3&quot;, &quot;part_2&quot;: &quot;h4&quot;},</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a><a href="#__codelineno-0-344"><span class="linenos" data-linenos="344 "></span></a><span class="sd">                    {&quot;part_1&quot;: &quot;h5&quot;, &quot;part_2&quot;: &quot;h6&quot;},</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a><a href="#__codelineno-0-345"><span class="linenos" data-linenos="345 "></span></a><span class="sd">                ],</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a><a href="#__codelineno-0-346"><span class="linenos" data-linenos="346 "></span></a><span class="sd">            }</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a><a href="#__codelineno-0-347"><span class="linenos" data-linenos="347 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><a href="#__codelineno-0-348"><span class="linenos" data-linenos="348 "></span></a><span class="sd">        with store.open(mode=&quot;w&quot;):</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><a href="#__codelineno-0-349"><span class="linenos" data-linenos="349 "></span></a><span class="sd">            result = store.resolve_update(MyFeature, samples=nw.from_native(samples))</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><a href="#__codelineno-0-350"><span class="linenos" data-linenos="350 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><a href="#__codelineno-0-351"><span class="linenos" data-linenos="351 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><a href="#__codelineno-0-352"><span class="linenos" data-linenos="352 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">narwhals</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nw</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><a href="#__codelineno-0-353"><span class="linenos" data-linenos="353 "></span></a>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><a href="#__codelineno-0-354"><span class="linenos" data-linenos="354 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">metaxy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mx</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a><a href="#__codelineno-0-355"><span class="linenos" data-linenos="355 "></span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetaxyConfig</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><a href="#__codelineno-0-356"><span class="linenos" data-linenos="356 "></span></a>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><a href="#__codelineno-0-357"><span class="linenos" data-linenos="357 "></span></a>    <span class="c1"># Sync external feature definitions from the store to replace any external feature placeholders.</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a><a href="#__codelineno-0-358"><span class="linenos" data-linenos="358 "></span></a>    <span class="c1"># This ensures version hashes are computed correctly against actual stored definitions.</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><a href="#__codelineno-0-359"><span class="linenos" data-linenos="359 "></span></a>    <span class="c1"># it is acceptable to call this here automatically for three reasons:</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><a href="#__codelineno-0-360"><span class="linenos" data-linenos="360 "></span></a>    <span class="c1"># 1. `resolve_update` is typically only called once at the start of the workflow</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><a href="#__codelineno-0-361"><span class="linenos" data-linenos="361 "></span></a>    <span class="c1"># 2. `resolve_update` is already doing heavy computations so an extra little call won&#39;t hurt performance</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><a href="#__codelineno-0-362"><span class="linenos" data-linenos="362 "></span></a>    <span class="c1"># 3. it is extremely important to get the result right</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><a href="#__codelineno-0-363"><span class="linenos" data-linenos="363 "></span></a>    <span class="k">if</span> <span class="n">MetaxyConfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_allow_default_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sync</span><span class="p">:</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><a href="#__codelineno-0-364"><span class="linenos" data-linenos="364 "></span></a>        <span class="n">mx</span><span class="o">.</span><span class="n">sync_external_features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><a href="#__codelineno-0-365"><span class="linenos" data-linenos="365 "></span></a>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><a href="#__codelineno-0-366"><span class="linenos" data-linenos="366 "></span></a>    <span class="c1"># Convert samples to Narwhals frame if not already</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a><a href="#__codelineno-0-367"><span class="linenos" data-linenos="367 "></span></a>    <span class="n">samples_nw</span><span class="p">:</span> <span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><a href="#__codelineno-0-368"><span class="linenos" data-linenos="368 "></span></a>    <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><a href="#__codelineno-0-369"><span class="linenos" data-linenos="369 "></span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)):</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><a href="#__codelineno-0-370"><span class="linenos" data-linenos="370 "></span></a>            <span class="n">samples_nw</span> <span class="o">=</span> <span class="n">samples</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a><a href="#__codelineno-0-371"><span class="linenos" data-linenos="371 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a><a href="#__codelineno-0-372"><span class="linenos" data-linenos="372 "></span></a>            <span class="n">samples_nw</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>  <span class="c1"># ty: ignore[invalid-assignment]</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a><a href="#__codelineno-0-373"><span class="linenos" data-linenos="373 "></span></a>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a><a href="#__codelineno-0-374"><span class="linenos" data-linenos="374 "></span></a>    <span class="c1"># Normalize filter keys to FeatureKey</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a><a href="#__codelineno-0-375"><span class="linenos" data-linenos="375 "></span></a>    <span class="n">normalized_filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">FeatureKey</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a><a href="#__codelineno-0-376"><span class="linenos" data-linenos="376 "></span></a>    <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a><a href="#__codelineno-0-377"><span class="linenos" data-linenos="377 "></span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">exprs</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a><a href="#__codelineno-0-378"><span class="linenos" data-linenos="378 "></span></a>            <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a><a href="#__codelineno-0-379"><span class="linenos" data-linenos="379 "></span></a>            <span class="n">normalized_filters</span><span class="p">[</span><span class="n">feature_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exprs</span><span class="p">)</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a><a href="#__codelineno-0-380"><span class="linenos" data-linenos="380 "></span></a>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a><a href="#__codelineno-0-381"><span class="linenos" data-linenos="381 "></span></a>    <span class="c1"># Convert global_filters and target_filters to lists for easy concatenation</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a><a href="#__codelineno-0-382"><span class="linenos" data-linenos="382 "></span></a>    <span class="n">global_filter_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">global_filters</span><span class="p">)</span> <span class="k">if</span> <span class="n">global_filters</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a><a href="#__codelineno-0-383"><span class="linenos" data-linenos="383 "></span></a>    <span class="n">target_filter_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_filters</span><span class="p">)</span> <span class="k">if</span> <span class="n">target_filters</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><a href="#__codelineno-0-384"><span class="linenos" data-linenos="384 "></span></a>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a><a href="#__codelineno-0-385"><span class="linenos" data-linenos="385 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a><a href="#__codelineno-0-386"><span class="linenos" data-linenos="386 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">):</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a><a href="#__codelineno-0-387"><span class="linenos" data-linenos="387 "></span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Delete operations are not yet supported for system tables.&quot;</span><span class="p">)</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a><a href="#__codelineno-0-388"><span class="linenos" data-linenos="388 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">current_graph</span><span class="p">()</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a><a href="#__codelineno-0-389"><span class="linenos" data-linenos="389 "></span></a>    <span class="n">plan</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_feature_plan</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a><a href="#__codelineno-0-390"><span class="linenos" data-linenos="390 "></span></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><a href="#__codelineno-0-391"><span class="linenos" data-linenos="391 "></span></a>    <span class="c1"># Root features without samples: error (samples required)</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><a href="#__codelineno-0-392"><span class="linenos" data-linenos="392 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">plan</span><span class="o">.</span><span class="n">deps</span> <span class="ow">and</span> <span class="n">samples_nw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><a href="#__codelineno-0-393"><span class="linenos" data-linenos="393 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><a href="#__codelineno-0-394"><span class="linenos" data-linenos="394 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_key</span><span class="si">}</span><span class="s2"> has no upstream dependencies (root feature). &quot;</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a><a href="#__codelineno-0-395"><span class="linenos" data-linenos="395 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Must provide &#39;samples&#39; parameter with sample_uid and </span><span class="si">{</span><span class="n">METAXY_PROVENANCE_BY_FIELD</span><span class="si">}</span><span class="s2"> columns. &quot;</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><a href="#__codelineno-0-396"><span class="linenos" data-linenos="396 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Root features require manual </span><span class="si">{</span><span class="n">METAXY_PROVENANCE_BY_FIELD</span><span class="si">}</span><span class="s2"> computation.&quot;</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><a href="#__codelineno-0-397"><span class="linenos" data-linenos="397 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><a href="#__codelineno-0-398"><span class="linenos" data-linenos="398 "></span></a>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a><a href="#__codelineno-0-399"><span class="linenos" data-linenos="399 "></span></a>    <span class="c1"># Combine feature-specific filters, global filters, and target filters for current feature</span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><a href="#__codelineno-0-400"><span class="linenos" data-linenos="400 "></span></a>    <span class="c1"># target_filters are ONLY applied to the current feature, not to upstream features</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><a href="#__codelineno-0-401"><span class="linenos" data-linenos="401 "></span></a>    <span class="n">current_feature_filters</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><a href="#__codelineno-0-402"><span class="linenos" data-linenos="402 "></span></a>        <span class="o">*</span><span class="n">normalized_filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><a href="#__codelineno-0-403"><span class="linenos" data-linenos="403 "></span></a>        <span class="o">*</span><span class="n">global_filter_list</span><span class="p">,</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><a href="#__codelineno-0-404"><span class="linenos" data-linenos="404 "></span></a>        <span class="o">*</span><span class="n">target_filter_list</span><span class="p">,</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><a href="#__codelineno-0-405"><span class="linenos" data-linenos="405 "></span></a>    <span class="p">]</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a><a href="#__codelineno-0-406"><span class="linenos" data-linenos="406 "></span></a>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><a href="#__codelineno-0-407"><span class="linenos" data-linenos="407 "></span></a>    <span class="c1"># Read current metadata with deduplication (with_sample_history=False by default)</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a><a href="#__codelineno-0-408"><span class="linenos" data-linenos="408 "></span></a>    <span class="c1"># Use allow_fallback=False since we only want metadata from THIS store</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><a href="#__codelineno-0-409"><span class="linenos" data-linenos="409 "></span></a>    <span class="c1"># to determine what needs to be updated locally</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><a href="#__codelineno-0-410"><span class="linenos" data-linenos="410 "></span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><a href="#__codelineno-0-411"><span class="linenos" data-linenos="411 "></span></a>        <span class="n">current_metadata</span><span class="p">:</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a><a href="#__codelineno-0-412"><span class="linenos" data-linenos="412 "></span></a>            <span class="n">feature_key</span><span class="p">,</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a><a href="#__codelineno-0-413"><span class="linenos" data-linenos="413 "></span></a>            <span class="n">filters</span><span class="o">=</span><span class="n">current_feature_filters</span> <span class="k">if</span> <span class="n">current_feature_filters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a><a href="#__codelineno-0-414"><span class="linenos" data-linenos="414 "></span></a>            <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a><a href="#__codelineno-0-415"><span class="linenos" data-linenos="415 "></span></a>            <span class="n">with_feature_history</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># filters by current feature_version</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a><a href="#__codelineno-0-416"><span class="linenos" data-linenos="416 "></span></a>            <span class="n">with_sample_history</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># deduplicates by id_columns, keeping latest</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a><a href="#__codelineno-0-417"><span class="linenos" data-linenos="417 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a><a href="#__codelineno-0-418"><span class="linenos" data-linenos="418 "></span></a>    <span class="k">except</span> <span class="n">FeatureNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a><a href="#__codelineno-0-419"><span class="linenos" data-linenos="419 "></span></a>        <span class="n">current_metadata</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a><a href="#__codelineno-0-420"><span class="linenos" data-linenos="420 "></span></a>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a><a href="#__codelineno-0-421"><span class="linenos" data-linenos="421 "></span></a>    <span class="n">upstream_by_key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">FeatureKey</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a><a href="#__codelineno-0-422"><span class="linenos" data-linenos="422 "></span></a>    <span class="n">filters_by_key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">FeatureKey</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a><a href="#__codelineno-0-423"><span class="linenos" data-linenos="423 "></span></a>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a><a href="#__codelineno-0-424"><span class="linenos" data-linenos="424 "></span></a>    <span class="c1"># if samples are provided, use them as source of truth for upstream data</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><a href="#__codelineno-0-425"><span class="linenos" data-linenos="425 "></span></a>    <span class="k">if</span> <span class="n">samples_nw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a><a href="#__codelineno-0-426"><span class="linenos" data-linenos="426 "></span></a>        <span class="c1"># Apply filters to samples if any</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><a href="#__codelineno-0-427"><span class="linenos" data-linenos="427 "></span></a>        <span class="n">filtered_samples</span> <span class="o">=</span> <span class="n">samples_nw</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a><a href="#__codelineno-0-428"><span class="linenos" data-linenos="428 "></span></a>        <span class="k">if</span> <span class="n">current_feature_filters</span><span class="p">:</span>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a><a href="#__codelineno-0-429"><span class="linenos" data-linenos="429 "></span></a>            <span class="n">filtered_samples</span> <span class="o">=</span> <span class="n">samples_nw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">current_feature_filters</span><span class="p">)</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><a href="#__codelineno-0-430"><span class="linenos" data-linenos="430 "></span></a>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a><a href="#__codelineno-0-431"><span class="linenos" data-linenos="431 "></span></a>        <span class="c1"># fill in METAXY_PROVENANCE column if it&#39;s missing (e.g. for root features)</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a><a href="#__codelineno-0-432"><span class="linenos" data-linenos="432 "></span></a>        <span class="n">samples_nw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_struct_version_column</span><span class="p">(</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a><a href="#__codelineno-0-433"><span class="linenos" data-linenos="433 "></span></a>            <span class="n">plan</span><span class="p">,</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a><a href="#__codelineno-0-434"><span class="linenos" data-linenos="434 "></span></a>            <span class="n">df</span><span class="o">=</span><span class="n">filtered_samples</span><span class="p">,</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a><a href="#__codelineno-0-435"><span class="linenos" data-linenos="435 "></span></a>            <span class="n">struct_column</span><span class="o">=</span><span class="n">METAXY_PROVENANCE_BY_FIELD</span><span class="p">,</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a><a href="#__codelineno-0-436"><span class="linenos" data-linenos="436 "></span></a>            <span class="n">hash_column</span><span class="o">=</span><span class="n">METAXY_PROVENANCE</span><span class="p">,</span>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a><a href="#__codelineno-0-437"><span class="linenos" data-linenos="437 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a><a href="#__codelineno-0-438"><span class="linenos" data-linenos="438 "></span></a>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><a href="#__codelineno-0-439"><span class="linenos" data-linenos="439 "></span></a>        <span class="c1"># For root features, add data_version columns if they don&#39;t exist</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a><a href="#__codelineno-0-440"><span class="linenos" data-linenos="440 "></span></a>        <span class="c1"># (root features have no computation, so data_version equals provenance)</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><a href="#__codelineno-0-441"><span class="linenos" data-linenos="441 "></span></a>        <span class="c1"># Use collect_schema().names() to avoid PerformanceWarning on lazy frames</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><a href="#__codelineno-0-442"><span class="linenos" data-linenos="442 "></span></a>        <span class="k">if</span> <span class="n">METAXY_DATA_VERSION_BY_FIELD</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samples_nw</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><a href="#__codelineno-0-443"><span class="linenos" data-linenos="443 "></span></a>            <span class="n">samples_nw</span> <span class="o">=</span> <span class="n">samples_nw</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><a href="#__codelineno-0-444"><span class="linenos" data-linenos="444 "></span></a>                <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">METAXY_PROVENANCE_BY_FIELD</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">METAXY_DATA_VERSION_BY_FIELD</span><span class="p">),</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><a href="#__codelineno-0-445"><span class="linenos" data-linenos="445 "></span></a>                <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">METAXY_PROVENANCE</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">METAXY_DATA_VERSION</span><span class="p">),</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a><a href="#__codelineno-0-446"><span class="linenos" data-linenos="446 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><a href="#__codelineno-0-447"><span class="linenos" data-linenos="447 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><a href="#__codelineno-0-448"><span class="linenos" data-linenos="448 "></span></a>        <span class="k">for</span> <span class="n">upstream_spec</span> <span class="ow">in</span> <span class="n">plan</span><span class="o">.</span><span class="n">deps</span> <span class="ow">or</span> <span class="p">[]:</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><a href="#__codelineno-0-449"><span class="linenos" data-linenos="449 "></span></a>            <span class="c1"># Combine feature-specific filters with global filters for upstream</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a><a href="#__codelineno-0-450"><span class="linenos" data-linenos="450 "></span></a>            <span class="n">upstream_filters</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><a href="#__codelineno-0-451"><span class="linenos" data-linenos="451 "></span></a>                <span class="o">*</span><span class="n">normalized_filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">upstream_spec</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a><a href="#__codelineno-0-452"><span class="linenos" data-linenos="452 "></span></a>                <span class="o">*</span><span class="n">global_filter_list</span><span class="p">,</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><a href="#__codelineno-0-453"><span class="linenos" data-linenos="453 "></span></a>            <span class="p">]</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><a href="#__codelineno-0-454"><span class="linenos" data-linenos="454 "></span></a>            <span class="n">upstream_feature_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><a href="#__codelineno-0-455"><span class="linenos" data-linenos="455 "></span></a>                <span class="n">upstream_spec</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a><a href="#__codelineno-0-456"><span class="linenos" data-linenos="456 "></span></a>                <span class="n">filters</span><span class="o">=</span><span class="n">upstream_filters</span> <span class="k">if</span> <span class="n">upstream_filters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a><a href="#__codelineno-0-457"><span class="linenos" data-linenos="457 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><a href="#__codelineno-0-458"><span class="linenos" data-linenos="458 "></span></a>            <span class="k">if</span> <span class="n">upstream_feature_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a><a href="#__codelineno-0-459"><span class="linenos" data-linenos="459 "></span></a>                <span class="n">upstream_by_key</span><span class="p">[</span><span class="n">upstream_spec</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">upstream_feature_metadata</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><a href="#__codelineno-0-460"><span class="linenos" data-linenos="460 "></span></a>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a><a href="#__codelineno-0-461"><span class="linenos" data-linenos="461 "></span></a>    <span class="c1"># determine which implementation to use for resolving the increment</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a><a href="#__codelineno-0-462"><span class="linenos" data-linenos="462 "></span></a>    <span class="c1"># consider (1) whether all upstream metadata has been loaded with the native implementation</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a><a href="#__codelineno-0-463"><span class="linenos" data-linenos="463 "></span></a>    <span class="c1"># (2) if samples have native implementation</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><a href="#__codelineno-0-464"><span class="linenos" data-linenos="464 "></span></a>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><a href="#__codelineno-0-465"><span class="linenos" data-linenos="465 "></span></a>    <span class="c1"># Use parameter if provided, otherwise use store default</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a><a href="#__codelineno-0-466"><span class="linenos" data-linenos="466 "></span></a>    <span class="n">engine_mode</span> <span class="o">=</span> <span class="n">versioning_engine</span> <span class="k">if</span> <span class="n">versioning_engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_versioning_engine</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a><a href="#__codelineno-0-467"><span class="linenos" data-linenos="467 "></span></a>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><a href="#__codelineno-0-468"><span class="linenos" data-linenos="468 "></span></a>    <span class="c1"># If &quot;polars&quot; mode, force Polars immediately</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a><a href="#__codelineno-0-469"><span class="linenos" data-linenos="469 "></span></a>    <span class="k">if</span> <span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;polars&quot;</span><span class="p">:</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a><a href="#__codelineno-0-470"><span class="linenos" data-linenos="470 "></span></a>        <span class="n">implementation</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a><a href="#__codelineno-0-471"><span class="linenos" data-linenos="471 "></span></a>        <span class="n">switched_to_polars</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a><a href="#__codelineno-0-472"><span class="linenos" data-linenos="472 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a><a href="#__codelineno-0-473"><span class="linenos" data-linenos="473 "></span></a>        <span class="n">implementation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">()</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a><a href="#__codelineno-0-474"><span class="linenos" data-linenos="474 "></span></a>        <span class="n">switched_to_polars</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><a href="#__codelineno-0-475"><span class="linenos" data-linenos="475 "></span></a>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><a href="#__codelineno-0-476"><span class="linenos" data-linenos="476 "></span></a>        <span class="k">for</span> <span class="n">upstream_key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">upstream_by_key</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a><a href="#__codelineno-0-477"><span class="linenos" data-linenos="477 "></span></a>            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">implementation</span> <span class="o">!=</span> <span class="n">implementation</span><span class="p">:</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a><a href="#__codelineno-0-478"><span class="linenos" data-linenos="478 "></span></a>                <span class="n">switched_to_polars</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><a href="#__codelineno-0-479"><span class="linenos" data-linenos="479 "></span></a>                <span class="c1"># Only raise error in &quot;native&quot; mode if no fallback stores configured.</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><a href="#__codelineno-0-480"><span class="linenos" data-linenos="480 "></span></a>                <span class="c1"># If fallback stores exist, the implementation mismatch indicates data came</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><a href="#__codelineno-0-481"><span class="linenos" data-linenos="481 "></span></a>                <span class="c1"># from fallback (different implementation), which is legitimate fallback access.</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><a href="#__codelineno-0-482"><span class="linenos" data-linenos="482 "></span></a>                <span class="c1"># If data were local, it would have the native implementation.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a><a href="#__codelineno-0-483"><span class="linenos" data-linenos="483 "></span></a>                <span class="k">if</span> <span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;native&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><a href="#__codelineno-0-484"><span class="linenos" data-linenos="484 "></span></a>                    <span class="k">raise</span> <span class="n">VersioningEngineMismatchError</span><span class="p">(</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><a href="#__codelineno-0-485"><span class="linenos" data-linenos="485 "></span></a>                        <span class="sa">f</span><span class="s2">&quot;versioning_engine=&#39;native&#39; but upstream feature `</span><span class="si">{</span><span class="n">upstream_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">` &quot;</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><a href="#__codelineno-0-486"><span class="linenos" data-linenos="486 "></span></a>                        <span class="sa">f</span><span class="s2">&quot;has implementation </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">implementation</span><span class="si">}</span><span class="s2">, expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><a href="#__codelineno-0-487"><span class="linenos" data-linenos="487 "></span></a>                    <span class="p">)</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><a href="#__codelineno-0-488"><span class="linenos" data-linenos="488 "></span></a>                <span class="k">elif</span> <span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;native&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">):</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a><a href="#__codelineno-0-489"><span class="linenos" data-linenos="489 "></span></a>                    <span class="n">PolarsMaterializationWarning</span><span class="o">.</span><span class="n">warn_on_implementation_mismatch</span><span class="p">(</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><a href="#__codelineno-0-490"><span class="linenos" data-linenos="490 "></span></a>                        <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">(),</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><a href="#__codelineno-0-491"><span class="linenos" data-linenos="491 "></span></a>                        <span class="n">actual</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><a href="#__codelineno-0-492"><span class="linenos" data-linenos="492 "></span></a>                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Using Polars for resolving the increment instead. This was caused by upstream feature `</span><span class="si">{</span><span class="n">upstream_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">`.&quot;</span><span class="p">,</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a><a href="#__codelineno-0-493"><span class="linenos" data-linenos="493 "></span></a>                    <span class="p">)</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a><a href="#__codelineno-0-494"><span class="linenos" data-linenos="494 "></span></a>                <span class="n">implementation</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a><a href="#__codelineno-0-495"><span class="linenos" data-linenos="495 "></span></a>                <span class="k">break</span>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a><a href="#__codelineno-0-496"><span class="linenos" data-linenos="496 "></span></a>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><a href="#__codelineno-0-497"><span class="linenos" data-linenos="497 "></span></a>        <span class="k">if</span> <span class="n">samples_nw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">samples_nw</span><span class="o">.</span><span class="n">implementation</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">():</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a><a href="#__codelineno-0-498"><span class="linenos" data-linenos="498 "></span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">switched_to_polars</span><span class="p">:</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a><a href="#__codelineno-0-499"><span class="linenos" data-linenos="499 "></span></a>                <span class="k">if</span> <span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;native&quot;</span><span class="p">:</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><a href="#__codelineno-0-500"><span class="linenos" data-linenos="500 "></span></a>                    <span class="c1"># Always raise error for samples with wrong implementation, regardless</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a><a href="#__codelineno-0-501"><span class="linenos" data-linenos="501 "></span></a>                    <span class="c1"># of fallback stores, because samples come from user argument, not from fallback</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><a href="#__codelineno-0-502"><span class="linenos" data-linenos="502 "></span></a>                    <span class="k">raise</span> <span class="n">VersioningEngineMismatchError</span><span class="p">(</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a><a href="#__codelineno-0-503"><span class="linenos" data-linenos="503 "></span></a>                        <span class="sa">f</span><span class="s2">&quot;versioning_engine=&#39;native&#39; but provided `samples` have implementation </span><span class="si">{</span><span class="n">samples_nw</span><span class="o">.</span><span class="n">implementation</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a><a href="#__codelineno-0-504"><span class="linenos" data-linenos="504 "></span></a>                        <span class="sa">f</span><span class="s2">&quot;expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><a href="#__codelineno-0-505"><span class="linenos" data-linenos="505 "></span></a>                    <span class="p">)</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a><a href="#__codelineno-0-506"><span class="linenos" data-linenos="506 "></span></a>                <span class="k">elif</span> <span class="n">engine_mode</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><a href="#__codelineno-0-507"><span class="linenos" data-linenos="507 "></span></a>                    <span class="n">PolarsMaterializationWarning</span><span class="o">.</span><span class="n">warn_on_implementation_mismatch</span><span class="p">(</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a><a href="#__codelineno-0-508"><span class="linenos" data-linenos="508 "></span></a>                        <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">(),</span>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a><a href="#__codelineno-0-509"><span class="linenos" data-linenos="509 "></span></a>                        <span class="n">actual</span><span class="o">=</span><span class="n">samples_nw</span><span class="o">.</span><span class="n">implementation</span><span class="p">,</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a><a href="#__codelineno-0-510"><span class="linenos" data-linenos="510 "></span></a>                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Provided `samples` have implementation </span><span class="si">{</span><span class="n">samples_nw</span><span class="o">.</span><span class="n">implementation</span><span class="si">}</span><span class="s2">. Using Polars for resolving the increment instead.&quot;</span><span class="p">,</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><a href="#__codelineno-0-511"><span class="linenos" data-linenos="511 "></span></a>                    <span class="p">)</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a><a href="#__codelineno-0-512"><span class="linenos" data-linenos="512 "></span></a>            <span class="n">implementation</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><a href="#__codelineno-0-513"><span class="linenos" data-linenos="513 "></span></a>            <span class="n">switched_to_polars</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><a href="#__codelineno-0-514"><span class="linenos" data-linenos="514 "></span></a>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><a href="#__codelineno-0-515"><span class="linenos" data-linenos="515 "></span></a>    <span class="k">if</span> <span class="n">switched_to_polars</span><span class="p">:</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><a href="#__codelineno-0-516"><span class="linenos" data-linenos="516 "></span></a>        <span class="k">if</span> <span class="n">current_metadata</span><span class="p">:</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><a href="#__codelineno-0-517"><span class="linenos" data-linenos="517 "></span></a>            <span class="n">current_metadata</span> <span class="o">=</span> <span class="n">switch_implementation_to_polars</span><span class="p">(</span><span class="n">current_metadata</span><span class="p">)</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a><a href="#__codelineno-0-518"><span class="linenos" data-linenos="518 "></span></a>        <span class="k">if</span> <span class="n">samples_nw</span><span class="p">:</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><a href="#__codelineno-0-519"><span class="linenos" data-linenos="519 "></span></a>            <span class="n">samples_nw</span> <span class="o">=</span> <span class="n">switch_implementation_to_polars</span><span class="p">(</span><span class="n">samples_nw</span><span class="p">)</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><a href="#__codelineno-0-520"><span class="linenos" data-linenos="520 "></span></a>        <span class="k">for</span> <span class="n">upstream_key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">upstream_by_key</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a><a href="#__codelineno-0-521"><span class="linenos" data-linenos="521 "></span></a>            <span class="n">upstream_by_key</span><span class="p">[</span><span class="n">upstream_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">switch_implementation_to_polars</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><a href="#__codelineno-0-522"><span class="linenos" data-linenos="522 "></span></a>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><a href="#__codelineno-0-523"><span class="linenos" data-linenos="523 "></span></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_versioning_engine</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span> <span class="n">implementation</span><span class="o">=</span><span class="n">implementation</span><span class="p">)</span> <span class="k">as</span> <span class="n">engine</span><span class="p">:</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><a href="#__codelineno-0-524"><span class="linenos" data-linenos="524 "></span></a>        <span class="k">if</span> <span class="n">skip_comparison</span><span class="p">:</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a><a href="#__codelineno-0-525"><span class="linenos" data-linenos="525 "></span></a>            <span class="c1"># Skip comparison: return all upstream samples as added</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a><a href="#__codelineno-0-526"><span class="linenos" data-linenos="526 "></span></a>            <span class="k">if</span> <span class="n">samples_nw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a><a href="#__codelineno-0-527"><span class="linenos" data-linenos="527 "></span></a>                <span class="c1"># Root features or user-provided samples: use samples directly</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><a href="#__codelineno-0-528"><span class="linenos" data-linenos="528 "></span></a>                <span class="c1"># Note: samples already has metaxy_provenance computed</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a><a href="#__codelineno-0-529"><span class="linenos" data-linenos="529 "></span></a>                <span class="n">added</span> <span class="o">=</span> <span class="n">samples_nw</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a><a href="#__codelineno-0-530"><span class="linenos" data-linenos="530 "></span></a>                <span class="n">input_df</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Root features have no upstream input</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a><a href="#__codelineno-0-531"><span class="linenos" data-linenos="531 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a><a href="#__codelineno-0-532"><span class="linenos" data-linenos="532 "></span></a>                <span class="c1"># Non-root features: load all upstream with provenance</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a><a href="#__codelineno-0-533"><span class="linenos" data-linenos="533 "></span></a>                <span class="n">added</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">load_upstream_with_provenance</span><span class="p">(</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a><a href="#__codelineno-0-534"><span class="linenos" data-linenos="534 "></span></a>                    <span class="n">upstream</span><span class="o">=</span><span class="n">upstream_by_key</span><span class="p">,</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a><a href="#__codelineno-0-535"><span class="linenos" data-linenos="535 "></span></a>                    <span class="n">hash_algo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span><span class="p">,</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><a href="#__codelineno-0-536"><span class="linenos" data-linenos="536 "></span></a>                    <span class="n">filters</span><span class="o">=</span><span class="n">filters_by_key</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a><a href="#__codelineno-0-537"><span class="linenos" data-linenos="537 "></span></a>                <span class="p">)</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a><a href="#__codelineno-0-538"><span class="linenos" data-linenos="538 "></span></a>                <span class="n">input_df</span> <span class="o">=</span> <span class="n">added</span>  <span class="c1"># Input is the same as added when skipping comparison</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a><a href="#__codelineno-0-539"><span class="linenos" data-linenos="539 "></span></a>            <span class="n">changed</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><a href="#__codelineno-0-540"><span class="linenos" data-linenos="540 "></span></a>            <span class="n">removed</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a><a href="#__codelineno-0-541"><span class="linenos" data-linenos="541 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a><a href="#__codelineno-0-542"><span class="linenos" data-linenos="542 "></span></a>            <span class="n">added</span><span class="p">,</span> <span class="n">changed</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span> <span class="n">input_df</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">resolve_increment_with_provenance</span><span class="p">(</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><a href="#__codelineno-0-543"><span class="linenos" data-linenos="543 "></span></a>                <span class="n">current</span><span class="o">=</span><span class="n">current_metadata</span><span class="p">,</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><a href="#__codelineno-0-544"><span class="linenos" data-linenos="544 "></span></a>                <span class="n">upstream</span><span class="o">=</span><span class="n">upstream_by_key</span><span class="p">,</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a><a href="#__codelineno-0-545"><span class="linenos" data-linenos="545 "></span></a>                <span class="n">hash_algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span><span class="p">,</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a><a href="#__codelineno-0-546"><span class="linenos" data-linenos="546 "></span></a>                <span class="n">filters</span><span class="o">=</span><span class="n">filters_by_key</span><span class="p">,</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a><a href="#__codelineno-0-547"><span class="linenos" data-linenos="547 "></span></a>                <span class="n">sample</span><span class="o">=</span><span class="n">samples_nw</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span> <span class="k">if</span> <span class="n">samples_nw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a><a href="#__codelineno-0-548"><span class="linenos" data-linenos="548 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a><a href="#__codelineno-0-549"><span class="linenos" data-linenos="549 "></span></a>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a><a href="#__codelineno-0-550"><span class="linenos" data-linenos="550 "></span></a>    <span class="c1"># Convert None to empty DataFrames</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a><a href="#__codelineno-0-551"><span class="linenos" data-linenos="551 "></span></a>    <span class="k">if</span> <span class="n">changed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a><a href="#__codelineno-0-552"><span class="linenos" data-linenos="552 "></span></a>        <span class="n">changed</span> <span class="o">=</span> <span class="n">empty_frame_like</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a><a href="#__codelineno-0-553"><span class="linenos" data-linenos="553 "></span></a>    <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a><a href="#__codelineno-0-554"><span class="linenos" data-linenos="554 "></span></a>        <span class="n">removed</span> <span class="o">=</span> <span class="n">empty_frame_like</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a><a href="#__codelineno-0-555"><span class="linenos" data-linenos="555 "></span></a>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a><a href="#__codelineno-0-556"><span class="linenos" data-linenos="556 "></span></a>    <span class="k">if</span> <span class="n">lazy</span><span class="p">:</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a><a href="#__codelineno-0-557"><span class="linenos" data-linenos="557 "></span></a>        <span class="k">return</span> <span class="n">LazyIncrement</span><span class="p">(</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a><a href="#__codelineno-0-558"><span class="linenos" data-linenos="558 "></span></a>            <span class="n">new</span><span class="o">=</span><span class="n">added</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">added</span><span class="p">),</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a><a href="#__codelineno-0-559"><span class="linenos" data-linenos="559 "></span></a>            <span class="n">stale</span><span class="o">=</span><span class="n">changed</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">changed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">changed</span><span class="p">),</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a><a href="#__codelineno-0-560"><span class="linenos" data-linenos="560 "></span></a>            <span class="n">orphaned</span><span class="o">=</span><span class="n">removed</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">removed</span><span class="p">),</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a><a href="#__codelineno-0-561"><span class="linenos" data-linenos="561 "></span></a>            <span class="nb">input</span><span class="o">=</span><span class="n">input_df</span> <span class="k">if</span> <span class="n">input_df</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">input_df</span><span class="p">),</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a><a href="#__codelineno-0-562"><span class="linenos" data-linenos="562 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a><a href="#__codelineno-0-563"><span class="linenos" data-linenos="563 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a><a href="#__codelineno-0-564"><span class="linenos" data-linenos="564 "></span></a>        <span class="k">return</span> <span class="n">Increment</span><span class="p">(</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a><a href="#__codelineno-0-565"><span class="linenos" data-linenos="565 "></span></a>            <span class="n">new</span><span class="o">=</span><span class="n">added</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">added</span><span class="p">,</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a><a href="#__codelineno-0-566"><span class="linenos" data-linenos="566 "></span></a>            <span class="n">stale</span><span class="o">=</span><span class="n">changed</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">changed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">changed</span><span class="p">,</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a><a href="#__codelineno-0-567"><span class="linenos" data-linenos="567 "></span></a>            <span class="n">orphaned</span><span class="o">=</span><span class="n">removed</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">removed</span><span class="p">,</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a><a href="#__codelineno-0-568"><span class="linenos" data-linenos="568 "></span></a>        <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.compute_provenance" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.compute_provenance</span>


<a href="#metaxy.MetadataStore.compute_provenance" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">compute_provenance</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.FrameT&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.FrameT">FrameT</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.FrameT&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.FrameT">FrameT</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute provenance columns for a DataFrame with pre-joined upstream data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method may be useful in very rare cases.
Rely on <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;metaxy.MetadataStore.resolve_update&lt;/span&gt;" href="#metaxy.MetadataStore.resolve_update"><code>MetadataStore.resolve_update</code></a> instead.</p>
</div>
<p>Use this method when you perform custom joins outside of Metaxy's auto-join
system but still want Metaxy to compute provenance. The method computes
metaxy_provenance_by_field, metaxy_provenance, metaxy_data_version_by_field,
and metaxy_data_version columns based on the upstream metadata.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The input DataFrame must contain the renamed metaxy_data_version_by_field
columns from each upstream feature. The naming convention follows the pattern
<code>metaxy_data_version_by_field__&lt;feature_key.to_column_suffix()&gt;</code>. For example, for an
upstream feature with key <code>["video", "raw"]</code>, the column should be named
<code>metaxy_data_version_by_field__video_raw</code>.</p>
</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>The feature to compute provenance for.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>df</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.FrameT&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.FrameT">FrameT</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>A DataFrame containing pre-joined upstream data with renamed
metaxy_data_version_by_field columns from each upstream feature.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.FrameT&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.FrameT">FrameT</a></code>
          ‚Äì
          <div class="doc-md-description">
            <p>The input DataFrame with provenance columns added. Returns the same</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.FrameT&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.FrameT">FrameT</a></code>
          ‚Äì
          <div class="doc-md-description">
            <p>frame type as the input, either an eager DataFrame or a LazyFrame.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.StoreNotOpenError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If the store is not open.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If required upstream <code>metaxy_data_version_by_field</code> columns
are missing from the DataFrame.</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>    <span class="c1"># Read upstream metadata</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">video_df</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">VideoFeature</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">audio_df</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">AudioFeature</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="c1"># Rename data_version_by_field columns to the expected convention</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">video_df</span> <span class="o">=</span> <span class="n">video_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;metaxy_data_version_by_field&quot;</span><span class="p">:</span> <span class="s2">&quot;metaxy_data_version_by_field__video_raw&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="p">})</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">audio_df</span> <span class="o">=</span> <span class="n">audio_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        <span class="s2">&quot;metaxy_data_version_by_field&quot;</span><span class="p">:</span> <span class="s2">&quot;metaxy_data_version_by_field__audio_raw&quot;</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="p">})</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="c1"># Perform custom join</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">joined</span> <span class="o">=</span> <span class="n">video_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">audio_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;sample_uid&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="c1"># Compute provenance</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">with_provenance</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">compute_provenance</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">,</span> <span class="n">joined</span><span class="p">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="c1"># Pass to resolve_update</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">increment</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">resolve_update</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">with_provenance</span><span class="p">)</span>
</span></code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a><a href="#__codelineno-0-570"><span class="linenos" data-linenos="570 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_provenance</span><span class="p">(</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a><a href="#__codelineno-0-571"><span class="linenos" data-linenos="571 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a><a href="#__codelineno-0-572"><span class="linenos" data-linenos="572 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a><a href="#__codelineno-0-573"><span class="linenos" data-linenos="573 "></span></a>    <span class="n">df</span><span class="p">:</span> <span class="n">FrameT</span><span class="p">,</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a><a href="#__codelineno-0-574"><span class="linenos" data-linenos="574 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameT</span><span class="p">:</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575"></a><a href="#__codelineno-0-575"><span class="linenos" data-linenos="575 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute provenance columns for a DataFrame with pre-joined upstream data.</span>
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576"></a><a href="#__codelineno-0-576"><span class="linenos" data-linenos="576 "></span></a>
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a><a href="#__codelineno-0-577"><span class="linenos" data-linenos="577 "></span></a><span class="sd">    !!! note</span>
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a><a href="#__codelineno-0-578"><span class="linenos" data-linenos="578 "></span></a><span class="sd">        This method may be useful in very rare cases.</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a><a href="#__codelineno-0-579"><span class="linenos" data-linenos="579 "></span></a><span class="sd">        Rely on [`MetadataStore.resolve_update`][metaxy.metadata_store.base.MetadataStore.resolve_update] instead.</span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a><a href="#__codelineno-0-580"><span class="linenos" data-linenos="580 "></span></a>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a><a href="#__codelineno-0-581"><span class="linenos" data-linenos="581 "></span></a><span class="sd">    Use this method when you perform custom joins outside of Metaxy&#39;s auto-join</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a><a href="#__codelineno-0-582"><span class="linenos" data-linenos="582 "></span></a><span class="sd">    system but still want Metaxy to compute provenance. The method computes</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a><a href="#__codelineno-0-583"><span class="linenos" data-linenos="583 "></span></a><span class="sd">    metaxy_provenance_by_field, metaxy_provenance, metaxy_data_version_by_field,</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a><a href="#__codelineno-0-584"><span class="linenos" data-linenos="584 "></span></a><span class="sd">    and metaxy_data_version columns based on the upstream metadata.</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a><a href="#__codelineno-0-585"><span class="linenos" data-linenos="585 "></span></a>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a><a href="#__codelineno-0-586"><span class="linenos" data-linenos="586 "></span></a><span class="sd">    !!! info</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><a href="#__codelineno-0-587"><span class="linenos" data-linenos="587 "></span></a><span class="sd">        The input DataFrame must contain the renamed metaxy_data_version_by_field</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><a href="#__codelineno-0-588"><span class="linenos" data-linenos="588 "></span></a><span class="sd">        columns from each upstream feature. The naming convention follows the pattern</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a><a href="#__codelineno-0-589"><span class="linenos" data-linenos="589 "></span></a><span class="sd">        `metaxy_data_version_by_field__&lt;feature_key.to_column_suffix()&gt;`. For example, for an</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a><a href="#__codelineno-0-590"><span class="linenos" data-linenos="590 "></span></a><span class="sd">        upstream feature with key `[&quot;video&quot;, &quot;raw&quot;]`, the column should be named</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a><a href="#__codelineno-0-591"><span class="linenos" data-linenos="591 "></span></a><span class="sd">        `metaxy_data_version_by_field__video_raw`.</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a><a href="#__codelineno-0-592"><span class="linenos" data-linenos="592 "></span></a>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a><a href="#__codelineno-0-593"><span class="linenos" data-linenos="593 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a><a href="#__codelineno-0-594"><span class="linenos" data-linenos="594 "></span></a><span class="sd">        feature: The feature to compute provenance for.</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a><a href="#__codelineno-0-595"><span class="linenos" data-linenos="595 "></span></a><span class="sd">        df: A DataFrame containing pre-joined upstream data with renamed</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a><a href="#__codelineno-0-596"><span class="linenos" data-linenos="596 "></span></a><span class="sd">            metaxy_data_version_by_field columns from each upstream feature.</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a><a href="#__codelineno-0-597"><span class="linenos" data-linenos="597 "></span></a>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a><a href="#__codelineno-0-598"><span class="linenos" data-linenos="598 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a><a href="#__codelineno-0-599"><span class="linenos" data-linenos="599 "></span></a><span class="sd">        The input DataFrame with provenance columns added. Returns the same</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a><a href="#__codelineno-0-600"><span class="linenos" data-linenos="600 "></span></a><span class="sd">        frame type as the input, either an eager DataFrame or a LazyFrame.</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a><a href="#__codelineno-0-601"><span class="linenos" data-linenos="601 "></span></a>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a><a href="#__codelineno-0-602"><span class="linenos" data-linenos="602 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><a href="#__codelineno-0-603"><span class="linenos" data-linenos="603 "></span></a><span class="sd">        StoreNotOpenError: If the store is not open.</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a><a href="#__codelineno-0-604"><span class="linenos" data-linenos="604 "></span></a><span class="sd">        ValueError: If required upstream `metaxy_data_version_by_field` columns</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><a href="#__codelineno-0-605"><span class="linenos" data-linenos="605 "></span></a><span class="sd">            are missing from the DataFrame.</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><a href="#__codelineno-0-606"><span class="linenos" data-linenos="606 "></span></a>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><a href="#__codelineno-0-607"><span class="linenos" data-linenos="607 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a><a href="#__codelineno-0-608"><span class="linenos" data-linenos="608 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a><a href="#__codelineno-0-609"><span class="linenos" data-linenos="609 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a><a href="#__codelineno-0-610"><span class="linenos" data-linenos="610 "></span></a>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a><a href="#__codelineno-0-611"><span class="linenos" data-linenos="611 "></span></a><span class="sd">            # Read upstream metadata</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><a href="#__codelineno-0-612"><span class="linenos" data-linenos="612 "></span></a><span class="sd">            video_df = store.read(VideoFeature).collect()</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a><a href="#__codelineno-0-613"><span class="linenos" data-linenos="613 "></span></a><span class="sd">            audio_df = store.read(AudioFeature).collect()</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a><a href="#__codelineno-0-614"><span class="linenos" data-linenos="614 "></span></a>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a><a href="#__codelineno-0-615"><span class="linenos" data-linenos="615 "></span></a><span class="sd">            # Rename data_version_by_field columns to the expected convention</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><a href="#__codelineno-0-616"><span class="linenos" data-linenos="616 "></span></a><span class="sd">            video_df = video_df.rename({</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><a href="#__codelineno-0-617"><span class="linenos" data-linenos="617 "></span></a><span class="sd">                &quot;metaxy_data_version_by_field&quot;: &quot;metaxy_data_version_by_field__video_raw&quot;</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a><a href="#__codelineno-0-618"><span class="linenos" data-linenos="618 "></span></a><span class="sd">            })</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><a href="#__codelineno-0-619"><span class="linenos" data-linenos="619 "></span></a><span class="sd">            audio_df = audio_df.rename({</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><a href="#__codelineno-0-620"><span class="linenos" data-linenos="620 "></span></a><span class="sd">                &quot;metaxy_data_version_by_field&quot;: &quot;metaxy_data_version_by_field__audio_raw&quot;</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><a href="#__codelineno-0-621"><span class="linenos" data-linenos="621 "></span></a><span class="sd">            })</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a><a href="#__codelineno-0-622"><span class="linenos" data-linenos="622 "></span></a>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a><a href="#__codelineno-0-623"><span class="linenos" data-linenos="623 "></span></a><span class="sd">            # Perform custom join</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a><a href="#__codelineno-0-624"><span class="linenos" data-linenos="624 "></span></a><span class="sd">            joined = video_df.join(audio_df, on=&quot;sample_uid&quot;, how=&quot;inner&quot;)</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a><a href="#__codelineno-0-625"><span class="linenos" data-linenos="625 "></span></a>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a><a href="#__codelineno-0-626"><span class="linenos" data-linenos="626 "></span></a><span class="sd">            # Compute provenance</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a><a href="#__codelineno-0-627"><span class="linenos" data-linenos="627 "></span></a><span class="sd">            with_provenance = store.compute_provenance(MyFeature, joined)</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a><a href="#__codelineno-0-628"><span class="linenos" data-linenos="628 "></span></a>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a><a href="#__codelineno-0-629"><span class="linenos" data-linenos="629 "></span></a><span class="sd">            # Pass to resolve_update</span>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a><a href="#__codelineno-0-630"><span class="linenos" data-linenos="630 "></span></a><span class="sd">            increment = store.resolve_update(MyFeature, samples=with_provenance)</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a><a href="#__codelineno-0-631"><span class="linenos" data-linenos="631 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a><a href="#__codelineno-0-632"><span class="linenos" data-linenos="632 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a><a href="#__codelineno-0-633"><span class="linenos" data-linenos="633 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><a href="#__codelineno-0-634"><span class="linenos" data-linenos="634 "></span></a>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><a href="#__codelineno-0-635"><span class="linenos" data-linenos="635 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a><a href="#__codelineno-0-636"><span class="linenos" data-linenos="636 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">current_graph</span><span class="p">()</span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a><a href="#__codelineno-0-637"><span class="linenos" data-linenos="637 "></span></a>    <span class="n">plan</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_feature_plan</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a><a href="#__codelineno-0-638"><span class="linenos" data-linenos="638 "></span></a>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a><a href="#__codelineno-0-639"><span class="linenos" data-linenos="639 "></span></a>    <span class="c1"># Use native implementation if DataFrame matches, otherwise fall back to Polars</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a><a href="#__codelineno-0-640"><span class="linenos" data-linenos="640 "></span></a>    <span class="n">implementation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">()</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><a href="#__codelineno-0-641"><span class="linenos" data-linenos="641 "></span></a>    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">implementation</span> <span class="o">!=</span> <span class="n">implementation</span><span class="p">:</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a><a href="#__codelineno-0-642"><span class="linenos" data-linenos="642 "></span></a>        <span class="n">implementation</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><a href="#__codelineno-0-643"><span class="linenos" data-linenos="643 "></span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">switch_implementation_to_polars</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># ty: ignore[no-matching-overload]</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><a href="#__codelineno-0-644"><span class="linenos" data-linenos="644 "></span></a>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><a href="#__codelineno-0-645"><span class="linenos" data-linenos="645 "></span></a>    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_versioning_engine</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">,</span> <span class="n">implementation</span><span class="o">=</span><span class="n">implementation</span><span class="p">)</span> <span class="k">as</span> <span class="n">engine</span><span class="p">:</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><a href="#__codelineno-0-646"><span class="linenos" data-linenos="646 "></span></a>        <span class="c1"># Validate required upstream columns exist</span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a><a href="#__codelineno-0-647"><span class="linenos" data-linenos="647 "></span></a>        <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a><a href="#__codelineno-0-648"><span class="linenos" data-linenos="648 "></span></a>            <span class="n">dep</span><span class="o">.</span><span class="n">feature</span><span class="p">:</span> <span class="n">engine</span><span class="o">.</span><span class="n">get_renamed_data_version_by_field_col</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a><a href="#__codelineno-0-649"><span class="linenos" data-linenos="649 "></span></a>            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="p">(</span><span class="n">plan</span><span class="o">.</span><span class="n">feature_deps</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a><a href="#__codelineno-0-650"><span class="linenos" data-linenos="650 "></span></a>        <span class="p">}</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a><a href="#__codelineno-0-651"><span class="linenos" data-linenos="651 "></span></a>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a><a href="#__codelineno-0-652"><span class="linenos" data-linenos="652 "></span></a>        <span class="n">df_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">())</span>  <span class="c1"># ty: ignore[invalid-argument-type]</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a><a href="#__codelineno-0-653"><span class="linenos" data-linenos="653 "></span></a>        <span class="n">missing_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a><a href="#__codelineno-0-654"><span class="linenos" data-linenos="654 "></span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> (from upstream feature </span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a><a href="#__codelineno-0-655"><span class="linenos" data-linenos="655 "></span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">expected_columns</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a><a href="#__codelineno-0-656"><span class="linenos" data-linenos="656 "></span></a>            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_columns</span>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a><a href="#__codelineno-0-657"><span class="linenos" data-linenos="657 "></span></a>        <span class="p">]</span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a><a href="#__codelineno-0-658"><span class="linenos" data-linenos="658 "></span></a>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a><a href="#__codelineno-0-659"><span class="linenos" data-linenos="659 "></span></a>        <span class="k">if</span> <span class="n">missing_columns</span><span class="p">:</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a><a href="#__codelineno-0-660"><span class="linenos" data-linenos="660 "></span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a><a href="#__codelineno-0-661"><span class="linenos" data-linenos="661 "></span></a>                <span class="sa">f</span><span class="s2">&quot;DataFrame is missing required upstream columns for computing &quot;</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a><a href="#__codelineno-0-662"><span class="linenos" data-linenos="662 "></span></a>                <span class="sa">f</span><span class="s2">&quot;provenance of feature </span><span class="si">{</span><span class="n">feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a><a href="#__codelineno-0-663"><span class="linenos" data-linenos="663 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Missing columns: </span><span class="si">{</span><span class="n">missing_columns</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a><a href="#__codelineno-0-664"><span class="linenos" data-linenos="664 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Make sure to rename metaxy_data_version_by_field columns from &quot;</span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a><a href="#__codelineno-0-665"><span class="linenos" data-linenos="665 "></span></a>                <span class="sa">f</span><span class="s2">&quot;each upstream feature using the pattern &quot;</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a><a href="#__codelineno-0-666"><span class="linenos" data-linenos="666 "></span></a>                <span class="sa">f</span><span class="s2">&quot;metaxy_data_version_by_field__&lt;feature_key.table_name&gt;.&quot;</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a><a href="#__codelineno-0-667"><span class="linenos" data-linenos="667 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a><a href="#__codelineno-0-668"><span class="linenos" data-linenos="668 "></span></a>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a><a href="#__codelineno-0-669"><span class="linenos" data-linenos="669 "></span></a>        <span class="k">return</span> <span class="n">engine</span><span class="o">.</span><span class="n">compute_provenance_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hash_algo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span><span class="p">)</span>  <span class="c1"># ty: ignore[invalid-argument-type]</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.read" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.read</span>


<a href="#metaxy.MetadataStore.read" class="headerlink" title="Permanent link">&para;</a></h4>
          <div class="doc-overloads">
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">feature_version</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">allow_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">include_soft_deleted</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">with_store_info</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</span></code></pre></div><div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">feature_version</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">columns</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">allow_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">include_soft_deleted</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">with_store_info</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">True</span><span class="p">],</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a></span><span class="p">]</span>
</span></code></pre></div>          </div>


    <div class="doc doc-contents ">

        <p>Read metadata with optional fallback to upstream stores.</p>
<p>By default, does not include:
   - rows from historical feature versions (configured via <code>with_feature_history=False</code>)
   - rows that have been overwritten by subsequent writes with the same feature version (configured via <code>with_sample_history=False</code>)
   - soft-deleted with <code>metaxy_deleted_at</code> set to a non-null value (configured via <code>include_soft_deleted=False</code>)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to read metadata for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>feature_version</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Explicit feature_version to filter by (mutually exclusive with with_feature_history=False)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Sequence of Narwhals filter expressions to apply to this feature.
Example: <code>[nw.col("x") &gt; 10, nw.col("y") &lt; 5]</code></p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>columns</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Subset of columns to include. Metaxy's system columns are always included.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>allow_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to allow fallback to upstream stores if the requested feature is not found in the current store.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_feature_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, include rows from all historical feature versions.
By default (False), only returns rows with the currently registered feature version.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_sample_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, include all historical materializations per sample.
By default (False), deduplicates samples within <code>id_columns</code> groups ordered by <code>metaxy_created_at</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>include_soft_deleted</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If <code>True</code>, include soft-deleted rows in the result. Previous historical materializations of the same feature version will be effectively removed from the output otherwise.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_store_info</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If <code>True</code>, return a tuple of (LazyFrame, MetadataStore) where
the MetadataStore is the store that actually contained the feature (which
may be a fallback store if allow_fallback=True).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>] | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>], <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>Narwhals <code>LazyFrame</code> with metadata, or, if <code>with_store_info=True</code>, a tuple of (<code>LazyFrame</code>, <code>MetadataStore</code>) containing the metadata store which has been actually used to retrieve the feature (may be a fallback store).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.FeatureNotFoundError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.FeatureNotFoundError">FeatureNotFoundError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If feature not found in any store</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.SystemDataNotFoundError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.SystemDataNotFoundError">SystemDataNotFoundError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>When attempting to read non-existent Metaxy system data</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If both feature_version and with_feature_history=False are provided</p>
          </div>
        </li>
    </ul>
        <div class="admonition info">
<p class="admonition-title">Info</p>
<p>When this method is called with default arguments, it will return the latest (by <code>metaxy_created_at</code>)
metadata for the current feature version excluding soft-deleted rows. Therefore, it's perfectly suitable
for most use cases.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The order of rows is not guaranteed.</p>
</div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><a href="#__codelineno-0-701"><span class="linenos" data-linenos="701 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a><a href="#__codelineno-0-702"><span class="linenos" data-linenos="702 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a><a href="#__codelineno-0-703"><span class="linenos" data-linenos="703 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a><a href="#__codelineno-0-704"><span class="linenos" data-linenos="704 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a><a href="#__codelineno-0-705"><span class="linenos" data-linenos="705 "></span></a>    <span class="n">feature_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a><a href="#__codelineno-0-706"><span class="linenos" data-linenos="706 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a><a href="#__codelineno-0-707"><span class="linenos" data-linenos="707 "></span></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a><a href="#__codelineno-0-708"><span class="linenos" data-linenos="708 "></span></a>    <span class="n">allow_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a><a href="#__codelineno-0-709"><span class="linenos" data-linenos="709 "></span></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a><a href="#__codelineno-0-710"><span class="linenos" data-linenos="710 "></span></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a><a href="#__codelineno-0-711"><span class="linenos" data-linenos="711 "></span></a>    <span class="n">include_soft_deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a><a href="#__codelineno-0-712"><span class="linenos" data-linenos="712 "></span></a>    <span class="n">with_store_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a><a href="#__codelineno-0-713"><span class="linenos" data-linenos="713 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">MetadataStore</span><span class="p">]:</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a><a href="#__codelineno-0-714"><span class="linenos" data-linenos="714 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a><a href="#__codelineno-0-715"><span class="linenos" data-linenos="715 "></span></a><span class="sd">    Read metadata with optional fallback to upstream stores.</span>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a><a href="#__codelineno-0-716"><span class="linenos" data-linenos="716 "></span></a>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a><a href="#__codelineno-0-717"><span class="linenos" data-linenos="717 "></span></a><span class="sd">    By default, does not include:</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a><a href="#__codelineno-0-718"><span class="linenos" data-linenos="718 "></span></a><span class="sd">       - rows from historical feature versions (configured via `with_feature_history=False`)</span>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a><a href="#__codelineno-0-719"><span class="linenos" data-linenos="719 "></span></a><span class="sd">       - rows that have been overwritten by subsequent writes with the same feature version (configured via `with_sample_history=False`)</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a><a href="#__codelineno-0-720"><span class="linenos" data-linenos="720 "></span></a><span class="sd">       - soft-deleted with `metaxy_deleted_at` set to a non-null value (configured via `include_soft_deleted=False`)</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a><a href="#__codelineno-0-721"><span class="linenos" data-linenos="721 "></span></a>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722"></a><a href="#__codelineno-0-722"><span class="linenos" data-linenos="722 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723"></a><a href="#__codelineno-0-723"><span class="linenos" data-linenos="723 "></span></a><span class="sd">        feature: Feature to read metadata for</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724"></a><a href="#__codelineno-0-724"><span class="linenos" data-linenos="724 "></span></a><span class="sd">        feature_version: Explicit feature_version to filter by (mutually exclusive with with_feature_history=False)</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725"></a><a href="#__codelineno-0-725"><span class="linenos" data-linenos="725 "></span></a><span class="sd">        filters: Sequence of Narwhals filter expressions to apply to this feature.</span>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726"></a><a href="#__codelineno-0-726"><span class="linenos" data-linenos="726 "></span></a><span class="sd">            Example: `[nw.col(&quot;x&quot;) &gt; 10, nw.col(&quot;y&quot;) &lt; 5]`</span>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727"></a><a href="#__codelineno-0-727"><span class="linenos" data-linenos="727 "></span></a><span class="sd">        columns: Subset of columns to include. Metaxy&#39;s system columns are always included.</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728"></a><a href="#__codelineno-0-728"><span class="linenos" data-linenos="728 "></span></a><span class="sd">        allow_fallback: Whether to allow fallback to upstream stores if the requested feature is not found in the current store.</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729"></a><a href="#__codelineno-0-729"><span class="linenos" data-linenos="729 "></span></a><span class="sd">        with_feature_history: If True, include rows from all historical feature versions.</span>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730"></a><a href="#__codelineno-0-730"><span class="linenos" data-linenos="730 "></span></a><span class="sd">            By default (False), only returns rows with the currently registered feature version.</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731"></a><a href="#__codelineno-0-731"><span class="linenos" data-linenos="731 "></span></a><span class="sd">        with_sample_history: If True, include all historical materializations per sample.</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732"></a><a href="#__codelineno-0-732"><span class="linenos" data-linenos="732 "></span></a><span class="sd">            By default (False), deduplicates samples within `id_columns` groups ordered by `metaxy_created_at`.</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733"></a><a href="#__codelineno-0-733"><span class="linenos" data-linenos="733 "></span></a><span class="sd">        include_soft_deleted: If `True`, include soft-deleted rows in the result. Previous historical materializations of the same feature version will be effectively removed from the output otherwise.</span>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734"></a><a href="#__codelineno-0-734"><span class="linenos" data-linenos="734 "></span></a><span class="sd">        with_store_info: If `True`, return a tuple of (LazyFrame, MetadataStore) where</span>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735"></a><a href="#__codelineno-0-735"><span class="linenos" data-linenos="735 "></span></a><span class="sd">            the MetadataStore is the store that actually contained the feature (which</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736"></a><a href="#__codelineno-0-736"><span class="linenos" data-linenos="736 "></span></a><span class="sd">            may be a fallback store if allow_fallback=True).</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737"></a><a href="#__codelineno-0-737"><span class="linenos" data-linenos="737 "></span></a>
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738"></a><a href="#__codelineno-0-738"><span class="linenos" data-linenos="738 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739"></a><a href="#__codelineno-0-739"><span class="linenos" data-linenos="739 "></span></a><span class="sd">        Narwhals `LazyFrame` with metadata, or, if `with_store_info=True`, a tuple of (`LazyFrame`, `MetadataStore`) containing the metadata store which has been actually used to retrieve the feature (may be a fallback store).</span>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740"></a><a href="#__codelineno-0-740"><span class="linenos" data-linenos="740 "></span></a>
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741"></a><a href="#__codelineno-0-741"><span class="linenos" data-linenos="741 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742"></a><a href="#__codelineno-0-742"><span class="linenos" data-linenos="742 "></span></a><span class="sd">        FeatureNotFoundError: If feature not found in any store</span>
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743"></a><a href="#__codelineno-0-743"><span class="linenos" data-linenos="743 "></span></a><span class="sd">        SystemDataNotFoundError: When attempting to read non-existent Metaxy system data</span>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744"></a><a href="#__codelineno-0-744"><span class="linenos" data-linenos="744 "></span></a><span class="sd">        ValueError: If both feature_version and with_feature_history=False are provided</span>
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745"></a><a href="#__codelineno-0-745"><span class="linenos" data-linenos="745 "></span></a>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746"></a><a href="#__codelineno-0-746"><span class="linenos" data-linenos="746 "></span></a><span class="sd">    !!! info</span>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747"></a><a href="#__codelineno-0-747"><span class="linenos" data-linenos="747 "></span></a><span class="sd">        When this method is called with default arguments, it will return the latest (by `metaxy_created_at`)</span>
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748"></a><a href="#__codelineno-0-748"><span class="linenos" data-linenos="748 "></span></a><span class="sd">        metadata for the current feature version excluding soft-deleted rows. Therefore, it&#39;s perfectly suitable</span>
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749"></a><a href="#__codelineno-0-749"><span class="linenos" data-linenos="749 "></span></a><span class="sd">        for most use cases.</span>
</span><span id="__span-0-750"><a id="__codelineno-0-750" name="__codelineno-0-750"></a><a href="#__codelineno-0-750"><span class="linenos" data-linenos="750 "></span></a>
</span><span id="__span-0-751"><a id="__codelineno-0-751" name="__codelineno-0-751"></a><a href="#__codelineno-0-751"><span class="linenos" data-linenos="751 "></span></a><span class="sd">    !!! warning</span>
</span><span id="__span-0-752"><a id="__codelineno-0-752" name="__codelineno-0-752"></a><a href="#__codelineno-0-752"><span class="linenos" data-linenos="752 "></span></a><span class="sd">        The order of rows is not guaranteed.</span>
</span><span id="__span-0-753"><a id="__codelineno-0-753" name="__codelineno-0-753"></a><a href="#__codelineno-0-753"><span class="linenos" data-linenos="753 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-754"><a id="__codelineno-0-754" name="__codelineno-0-754"></a><a href="#__codelineno-0-754"><span class="linenos" data-linenos="754 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">metaxy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mx</span>
</span><span id="__span-0-755"><a id="__codelineno-0-755" name="__codelineno-0-755"></a><a href="#__codelineno-0-755"><span class="linenos" data-linenos="755 "></span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetaxyConfig</span>
</span><span id="__span-0-756"><a id="__codelineno-0-756" name="__codelineno-0-756"></a><a href="#__codelineno-0-756"><span class="linenos" data-linenos="756 "></span></a>
</span><span id="__span-0-757"><a id="__codelineno-0-757" name="__codelineno-0-757"></a><a href="#__codelineno-0-757"><span class="linenos" data-linenos="757 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-758"><a id="__codelineno-0-758" name="__codelineno-0-758"></a><a href="#__codelineno-0-758"><span class="linenos" data-linenos="758 "></span></a>
</span><span id="__span-0-759"><a id="__codelineno-0-759" name="__codelineno-0-759"></a><a href="#__codelineno-0-759"><span class="linenos" data-linenos="759 "></span></a>    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="__span-0-760"><a id="__codelineno-0-760" name="__codelineno-0-760"></a><a href="#__codelineno-0-760"><span class="linenos" data-linenos="760 "></span></a>    <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="__span-0-761"><a id="__codelineno-0-761" name="__codelineno-0-761"></a><a href="#__codelineno-0-761"><span class="linenos" data-linenos="761 "></span></a>
</span><span id="__span-0-762"><a id="__codelineno-0-762" name="__codelineno-0-762"></a><a href="#__codelineno-0-762"><span class="linenos" data-linenos="762 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-763"><a id="__codelineno-0-763" name="__codelineno-0-763"></a><a href="#__codelineno-0-763"><span class="linenos" data-linenos="763 "></span></a>    <span class="n">is_system_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-764"><a id="__codelineno-0-764" name="__codelineno-0-764"></a><a href="#__codelineno-0-764"><span class="linenos" data-linenos="764 "></span></a>
</span><span id="__span-0-765"><a id="__codelineno-0-765" name="__codelineno-0-765"></a><a href="#__codelineno-0-765"><span class="linenos" data-linenos="765 "></span></a>    <span class="c1"># Sync external features if auto-sync is enabled (default)</span>
</span><span id="__span-0-766"><a id="__codelineno-0-766" name="__codelineno-0-766"></a><a href="#__codelineno-0-766"><span class="linenos" data-linenos="766 "></span></a>    <span class="c1"># This call is a no-op most of the time and is very lightweight when it&#39;s not</span>
</span><span id="__span-0-767"><a id="__codelineno-0-767" name="__codelineno-0-767"></a><a href="#__codelineno-0-767"><span class="linenos" data-linenos="767 "></span></a>    <span class="c1"># Skip for system tables to avoid infinite recursion (sync_external_features reads system tables)</span>
</span><span id="__span-0-768"><a id="__codelineno-0-768" name="__codelineno-0-768"></a><a href="#__codelineno-0-768"><span class="linenos" data-linenos="768 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_system_table</span> <span class="ow">and</span> <span class="n">MetaxyConfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_allow_default_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sync</span><span class="p">:</span>
</span><span id="__span-0-769"><a id="__codelineno-0-769" name="__codelineno-0-769"></a><a href="#__codelineno-0-769"><span class="linenos" data-linenos="769 "></span></a>        <span class="n">mx</span><span class="o">.</span><span class="n">sync_external_features</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-0-770"><a id="__codelineno-0-770" name="__codelineno-0-770"></a><a href="#__codelineno-0-770"><span class="linenos" data-linenos="770 "></span></a>
</span><span id="__span-0-771"><a id="__codelineno-0-771" name="__codelineno-0-771"></a><a href="#__codelineno-0-771"><span class="linenos" data-linenos="771 "></span></a>    <span class="c1"># If caller wants soft-deleted records, do not filter them out later</span>
</span><span id="__span-0-772"><a id="__codelineno-0-772" name="__codelineno-0-772"></a><a href="#__codelineno-0-772"><span class="linenos" data-linenos="772 "></span></a>    <span class="n">filter_deleted</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">include_soft_deleted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_system_table</span>
</span><span id="__span-0-773"><a id="__codelineno-0-773" name="__codelineno-0-773"></a><a href="#__codelineno-0-773"><span class="linenos" data-linenos="773 "></span></a>
</span><span id="__span-0-774"><a id="__codelineno-0-774" name="__codelineno-0-774"></a><a href="#__codelineno-0-774"><span class="linenos" data-linenos="774 "></span></a>    <span class="c1"># Validate mutually exclusive parameters</span>
</span><span id="__span-0-775"><a id="__codelineno-0-775" name="__codelineno-0-775"></a><a href="#__codelineno-0-775"><span class="linenos" data-linenos="775 "></span></a>    <span class="k">if</span> <span class="n">feature_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_feature_history</span><span class="p">:</span>
</span><span id="__span-0-776"><a id="__codelineno-0-776" name="__codelineno-0-776"></a><a href="#__codelineno-0-776"><span class="linenos" data-linenos="776 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-777"><a id="__codelineno-0-777" name="__codelineno-0-777"></a><a href="#__codelineno-0-777"><span class="linenos" data-linenos="777 "></span></a>            <span class="s2">&quot;Cannot specify both feature_version and with_feature_history=False. &quot;</span>
</span><span id="__span-0-778"><a id="__codelineno-0-778" name="__codelineno-0-778"></a><a href="#__codelineno-0-778"><span class="linenos" data-linenos="778 "></span></a>            <span class="s2">&quot;Use with_feature_history=True with feature_version parameter.&quot;</span>
</span><span id="__span-0-779"><a id="__codelineno-0-779" name="__codelineno-0-779"></a><a href="#__codelineno-0-779"><span class="linenos" data-linenos="779 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-780"><a id="__codelineno-0-780" name="__codelineno-0-780"></a><a href="#__codelineno-0-780"><span class="linenos" data-linenos="780 "></span></a>
</span><span id="__span-0-781"><a id="__codelineno-0-781" name="__codelineno-0-781"></a><a href="#__codelineno-0-781"><span class="linenos" data-linenos="781 "></span></a>    <span class="c1"># Separate system filters (applied before dedup) from user filters (applied after dedup)</span>
</span><span id="__span-0-782"><a id="__codelineno-0-782" name="__codelineno-0-782"></a><a href="#__codelineno-0-782"><span class="linenos" data-linenos="782 "></span></a>    <span class="c1"># System filters like feature_version need to be applied early to reduce data volume</span>
</span><span id="__span-0-783"><a id="__codelineno-0-783" name="__codelineno-0-783"></a><a href="#__codelineno-0-783"><span class="linenos" data-linenos="783 "></span></a>    <span class="c1"># User filters should see the deduplicated view of the data</span>
</span><span id="__span-0-784"><a id="__codelineno-0-784" name="__codelineno-0-784"></a><a href="#__codelineno-0-784"><span class="linenos" data-linenos="784 "></span></a>    <span class="n">system_filters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-785"><a id="__codelineno-0-785" name="__codelineno-0-785"></a><a href="#__codelineno-0-785"><span class="linenos" data-linenos="785 "></span></a>    <span class="n">user_filters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="k">if</span> <span class="n">filters</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="__span-0-786"><a id="__codelineno-0-786" name="__codelineno-0-786"></a><a href="#__codelineno-0-786"><span class="linenos" data-linenos="786 "></span></a>
</span><span id="__span-0-787"><a id="__codelineno-0-787" name="__codelineno-0-787"></a><a href="#__codelineno-0-787"><span class="linenos" data-linenos="787 "></span></a>    <span class="c1"># Add feature_version filter only when needed (this is a system filter)</span>
</span><span id="__span-0-788"><a id="__codelineno-0-788" name="__codelineno-0-788"></a><a href="#__codelineno-0-788"><span class="linenos" data-linenos="788 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">with_feature_history</span> <span class="ow">or</span> <span class="n">feature_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-789"><a id="__codelineno-0-789" name="__codelineno-0-789"></a><a href="#__codelineno-0-789"><span class="linenos" data-linenos="789 "></span></a>        <span class="n">version_filter</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">METAXY_FEATURE_VERSION</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-0-790"><a id="__codelineno-0-790" name="__codelineno-0-790"></a><a href="#__codelineno-0-790"><span class="linenos" data-linenos="790 "></span></a>            <span class="n">current_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_feature_version</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">with_feature_history</span> <span class="k">else</span> <span class="n">feature_version</span>
</span><span id="__span-0-791"><a id="__codelineno-0-791" name="__codelineno-0-791"></a><a href="#__codelineno-0-791"><span class="linenos" data-linenos="791 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-792"><a id="__codelineno-0-792" name="__codelineno-0-792"></a><a href="#__codelineno-0-792"><span class="linenos" data-linenos="792 "></span></a>        <span class="n">system_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version_filter</span><span class="p">)</span>
</span><span id="__span-0-793"><a id="__codelineno-0-793" name="__codelineno-0-793"></a><a href="#__codelineno-0-793"><span class="linenos" data-linenos="793 "></span></a>
</span><span id="__span-0-794"><a id="__codelineno-0-794" name="__codelineno-0-794"></a><a href="#__codelineno-0-794"><span class="linenos" data-linenos="794 "></span></a>    <span class="c1"># If user filters are provided, we need to read all columns since filters may</span>
</span><span id="__span-0-795"><a id="__codelineno-0-795" name="__codelineno-0-795"></a><a href="#__codelineno-0-795"><span class="linenos" data-linenos="795 "></span></a>    <span class="c1"># reference columns not in the requested columns list. Column selection happens</span>
</span><span id="__span-0-796"><a id="__codelineno-0-796" name="__codelineno-0-796"></a><a href="#__codelineno-0-796"><span class="linenos" data-linenos="796 "></span></a>    <span class="c1"># after filtering</span>
</span><span id="__span-0-797"><a id="__codelineno-0-797" name="__codelineno-0-797"></a><a href="#__codelineno-0-797"><span class="linenos" data-linenos="797 "></span></a>    <span class="k">if</span> <span class="n">user_filters</span><span class="p">:</span>
</span><span id="__span-0-798"><a id="__codelineno-0-798" name="__codelineno-0-798"></a><a href="#__codelineno-0-798"><span class="linenos" data-linenos="798 "></span></a>        <span class="n">read_columns</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-799"><a id="__codelineno-0-799" name="__codelineno-0-799"></a><a href="#__codelineno-0-799"><span class="linenos" data-linenos="799 "></span></a>    <span class="k">elif</span> <span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-800"><a id="__codelineno-0-800" name="__codelineno-0-800"></a><a href="#__codelineno-0-800"><span class="linenos" data-linenos="800 "></span></a>        <span class="c1"># Add only system columns that aren&#39;t already in the user&#39;s columns list</span>
</span><span id="__span-0-801"><a id="__codelineno-0-801" name="__codelineno-0-801"></a><a href="#__codelineno-0-801"><span class="linenos" data-linenos="801 "></span></a>        <span class="n">columns_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-802"><a id="__codelineno-0-802" name="__codelineno-0-802"></a><a href="#__codelineno-0-802"><span class="linenos" data-linenos="802 "></span></a>        <span class="n">missing_system_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ALL_SYSTEM_COLUMNS</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_set</span><span class="p">]</span>
</span><span id="__span-0-803"><a id="__codelineno-0-803" name="__codelineno-0-803"></a><a href="#__codelineno-0-803"><span class="linenos" data-linenos="803 "></span></a>        <span class="n">read_columns</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="o">*</span><span class="n">missing_system_cols</span><span class="p">]</span>
</span><span id="__span-0-804"><a id="__codelineno-0-804" name="__codelineno-0-804"></a><a href="#__codelineno-0-804"><span class="linenos" data-linenos="804 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-805"><a id="__codelineno-0-805" name="__codelineno-0-805"></a><a href="#__codelineno-0-805"><span class="linenos" data-linenos="805 "></span></a>        <span class="n">read_columns</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-806"><a id="__codelineno-0-806" name="__codelineno-0-806"></a><a href="#__codelineno-0-806"><span class="linenos" data-linenos="806 "></span></a>
</span><span id="__span-0-807"><a id="__codelineno-0-807" name="__codelineno-0-807"></a><a href="#__codelineno-0-807"><span class="linenos" data-linenos="807 "></span></a>    <span class="n">lazy_frame</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-808"><a id="__codelineno-0-808" name="__codelineno-0-808"></a><a href="#__codelineno-0-808"><span class="linenos" data-linenos="808 "></span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-809"><a id="__codelineno-0-809" name="__codelineno-0-809"></a><a href="#__codelineno-0-809"><span class="linenos" data-linenos="809 "></span></a>        <span class="c1"># Only pass system filters to _read_feature</span>
</span><span id="__span-0-810"><a id="__codelineno-0-810" name="__codelineno-0-810"></a><a href="#__codelineno-0-810"><span class="linenos" data-linenos="810 "></span></a>        <span class="c1"># User filters will be applied after deduplication</span>
</span><span id="__span-0-811"><a id="__codelineno-0-811" name="__codelineno-0-811"></a><a href="#__codelineno-0-811"><span class="linenos" data-linenos="811 "></span></a>        <span class="n">lazy_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_feature</span><span class="p">(</span>
</span><span id="__span-0-812"><a id="__codelineno-0-812" name="__codelineno-0-812"></a><a href="#__codelineno-0-812"><span class="linenos" data-linenos="812 "></span></a>            <span class="n">feature</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">system_filters</span> <span class="k">if</span> <span class="n">system_filters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">read_columns</span>
</span><span id="__span-0-813"><a id="__codelineno-0-813" name="__codelineno-0-813"></a><a href="#__codelineno-0-813"><span class="linenos" data-linenos="813 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-814"><a id="__codelineno-0-814" name="__codelineno-0-814"></a><a href="#__codelineno-0-814"><span class="linenos" data-linenos="814 "></span></a>    <span class="k">except</span> <span class="n">FeatureNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-815"><a id="__codelineno-0-815" name="__codelineno-0-815"></a><a href="#__codelineno-0-815"><span class="linenos" data-linenos="815 "></span></a>        <span class="c1"># do not read system features from fallback stores</span>
</span><span id="__span-0-816"><a id="__codelineno-0-816" name="__codelineno-0-816"></a><a href="#__codelineno-0-816"><span class="linenos" data-linenos="816 "></span></a>        <span class="k">if</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-817"><a id="__codelineno-0-817" name="__codelineno-0-817"></a><a href="#__codelineno-0-817"><span class="linenos" data-linenos="817 "></span></a>            <span class="k">raise</span> <span class="n">SystemDataNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-818"><a id="__codelineno-0-818" name="__codelineno-0-818"></a><a href="#__codelineno-0-818"><span class="linenos" data-linenos="818 "></span></a>                <span class="sa">f</span><span class="s2">&quot;System Metaxy data with key </span><span class="si">{</span><span class="n">feature_key</span><span class="si">}</span><span class="s2"> is missing in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Invoke `metaxy push` before attempting to read system data.&quot;</span>
</span><span id="__span-0-819"><a id="__codelineno-0-819" name="__codelineno-0-819"></a><a href="#__codelineno-0-819"><span class="linenos" data-linenos="819 "></span></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="__span-0-820"><a id="__codelineno-0-820" name="__codelineno-0-820"></a><a href="#__codelineno-0-820"><span class="linenos" data-linenos="820 "></span></a>
</span><span id="__span-0-821"><a id="__codelineno-0-821" name="__codelineno-0-821"></a><a href="#__codelineno-0-821"><span class="linenos" data-linenos="821 "></span></a>    <span class="c1"># Handle case where _read_feature returns None (no exception raised)</span>
</span><span id="__span-0-822"><a id="__codelineno-0-822" name="__codelineno-0-822"></a><a href="#__codelineno-0-822"><span class="linenos" data-linenos="822 "></span></a>    <span class="k">if</span> <span class="n">lazy_frame</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-823"><a id="__codelineno-0-823" name="__codelineno-0-823"></a><a href="#__codelineno-0-823"><span class="linenos" data-linenos="823 "></span></a>        <span class="k">raise</span> <span class="n">SystemDataNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-824"><a id="__codelineno-0-824" name="__codelineno-0-824"></a><a href="#__codelineno-0-824"><span class="linenos" data-linenos="824 "></span></a>            <span class="sa">f</span><span class="s2">&quot;System Metaxy data with key </span><span class="si">{</span><span class="n">feature_key</span><span class="si">}</span><span class="s2"> is missing in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Invoke `metaxy push` before attempting to read system data.&quot;</span>
</span><span id="__span-0-825"><a id="__codelineno-0-825" name="__codelineno-0-825"></a><a href="#__codelineno-0-825"><span class="linenos" data-linenos="825 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-826"><a id="__codelineno-0-826" name="__codelineno-0-826"></a><a href="#__codelineno-0-826"><span class="linenos" data-linenos="826 "></span></a>
</span><span id="__span-0-827"><a id="__codelineno-0-827" name="__codelineno-0-827"></a><a href="#__codelineno-0-827"><span class="linenos" data-linenos="827 "></span></a>    <span class="k">if</span> <span class="n">lazy_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-828"><a id="__codelineno-0-828" name="__codelineno-0-828"></a><a href="#__codelineno-0-828"><span class="linenos" data-linenos="828 "></span></a>        <span class="c1"># Deduplicate first, then filter soft-deleted rows</span>
</span><span id="__span-0-829"><a id="__codelineno-0-829" name="__codelineno-0-829"></a><a href="#__codelineno-0-829"><span class="linenos" data-linenos="829 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">with_sample_history</span><span class="p">:</span>
</span><span id="__span-0-830"><a id="__codelineno-0-830" name="__codelineno-0-830"></a><a href="#__codelineno-0-830"><span class="linenos" data-linenos="830 "></span></a>            <span class="n">id_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_plan</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">id_columns</span><span class="p">)</span>
</span><span id="__span-0-831"><a id="__codelineno-0-831" name="__codelineno-0-831"></a><a href="#__codelineno-0-831"><span class="linenos" data-linenos="831 "></span></a>            <span class="c1"># Treat soft-deletes like hard deletes by ordering on the</span>
</span><span id="__span-0-832"><a id="__codelineno-0-832" name="__codelineno-0-832"></a><a href="#__codelineno-0-832"><span class="linenos" data-linenos="832 "></span></a>            <span class="c1"># most recent lifecycle timestamp.</span>
</span><span id="__span-0-833"><a id="__codelineno-0-833" name="__codelineno-0-833"></a><a href="#__codelineno-0-833"><span class="linenos" data-linenos="833 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">versioning_engine_cls</span><span class="o">.</span><span class="n">keep_latest_by_group</span><span class="p">(</span>
</span><span id="__span-0-834"><a id="__codelineno-0-834" name="__codelineno-0-834"></a><a href="#__codelineno-0-834"><span class="linenos" data-linenos="834 "></span></a>                <span class="n">df</span><span class="o">=</span><span class="n">lazy_frame</span><span class="p">,</span>
</span><span id="__span-0-835"><a id="__codelineno-0-835" name="__codelineno-0-835"></a><a href="#__codelineno-0-835"><span class="linenos" data-linenos="835 "></span></a>                <span class="n">group_columns</span><span class="o">=</span><span class="n">id_cols</span><span class="p">,</span>
</span><span id="__span-0-836"><a id="__codelineno-0-836" name="__codelineno-0-836"></a><a href="#__codelineno-0-836"><span class="linenos" data-linenos="836 "></span></a>                <span class="n">timestamp_columns</span><span class="o">=</span><span class="p">[</span><span class="n">METAXY_DELETED_AT</span><span class="p">,</span> <span class="n">METAXY_UPDATED_AT</span><span class="p">],</span>
</span><span id="__span-0-837"><a id="__codelineno-0-837" name="__codelineno-0-837"></a><a href="#__codelineno-0-837"><span class="linenos" data-linenos="837 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-838"><a id="__codelineno-0-838" name="__codelineno-0-838"></a><a href="#__codelineno-0-838"><span class="linenos" data-linenos="838 "></span></a>
</span><span id="__span-0-839"><a id="__codelineno-0-839" name="__codelineno-0-839"></a><a href="#__codelineno-0-839"><span class="linenos" data-linenos="839 "></span></a>        <span class="k">if</span> <span class="n">filter_deleted</span><span class="p">:</span>
</span><span id="__span-0-840"><a id="__codelineno-0-840" name="__codelineno-0-840"></a><a href="#__codelineno-0-840"><span class="linenos" data-linenos="840 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="n">lazy_frame</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">METAXY_DELETED_AT</span><span class="p">)</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>
</span><span id="__span-0-841"><a id="__codelineno-0-841" name="__codelineno-0-841"></a><a href="#__codelineno-0-841"><span class="linenos" data-linenos="841 "></span></a>
</span><span id="__span-0-842"><a id="__codelineno-0-842" name="__codelineno-0-842"></a><a href="#__codelineno-0-842"><span class="linenos" data-linenos="842 "></span></a>        <span class="c1"># Apply user filters AFTER deduplication so they see the latest version of each row</span>
</span><span id="__span-0-843"><a id="__codelineno-0-843" name="__codelineno-0-843"></a><a href="#__codelineno-0-843"><span class="linenos" data-linenos="843 "></span></a>        <span class="k">for</span> <span class="n">user_filter</span> <span class="ow">in</span> <span class="n">user_filters</span><span class="p">:</span>
</span><span id="__span-0-844"><a id="__codelineno-0-844" name="__codelineno-0-844"></a><a href="#__codelineno-0-844"><span class="linenos" data-linenos="844 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="n">lazy_frame</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_filter</span><span class="p">)</span>
</span><span id="__span-0-845"><a id="__codelineno-0-845" name="__codelineno-0-845"></a><a href="#__codelineno-0-845"><span class="linenos" data-linenos="845 "></span></a>
</span><span id="__span-0-846"><a id="__codelineno-0-846" name="__codelineno-0-846"></a><a href="#__codelineno-0-846"><span class="linenos" data-linenos="846 "></span></a>    <span class="c1"># For system tables, apply user filters directly (no dedup needed)</span>
</span><span id="__span-0-847"><a id="__codelineno-0-847" name="__codelineno-0-847"></a><a href="#__codelineno-0-847"><span class="linenos" data-linenos="847 "></span></a>    <span class="k">if</span> <span class="n">lazy_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-848"><a id="__codelineno-0-848" name="__codelineno-0-848"></a><a href="#__codelineno-0-848"><span class="linenos" data-linenos="848 "></span></a>        <span class="k">for</span> <span class="n">user_filter</span> <span class="ow">in</span> <span class="n">user_filters</span><span class="p">:</span>
</span><span id="__span-0-849"><a id="__codelineno-0-849" name="__codelineno-0-849"></a><a href="#__codelineno-0-849"><span class="linenos" data-linenos="849 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="n">lazy_frame</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user_filter</span><span class="p">)</span>
</span><span id="__span-0-850"><a id="__codelineno-0-850" name="__codelineno-0-850"></a><a href="#__codelineno-0-850"><span class="linenos" data-linenos="850 "></span></a>
</span><span id="__span-0-851"><a id="__codelineno-0-851" name="__codelineno-0-851"></a><a href="#__codelineno-0-851"><span class="linenos" data-linenos="851 "></span></a>    <span class="k">if</span> <span class="n">lazy_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-852"><a id="__codelineno-0-852" name="__codelineno-0-852"></a><a href="#__codelineno-0-852"><span class="linenos" data-linenos="852 "></span></a>        <span class="c1"># After dedup and user filters, filter to requested columns if specified</span>
</span><span id="__span-0-853"><a id="__codelineno-0-853" name="__codelineno-0-853"></a><a href="#__codelineno-0-853"><span class="linenos" data-linenos="853 "></span></a>        <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="__span-0-854"><a id="__codelineno-0-854" name="__codelineno-0-854"></a><a href="#__codelineno-0-854"><span class="linenos" data-linenos="854 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="n">lazy_frame</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-855"><a id="__codelineno-0-855" name="__codelineno-0-855"></a><a href="#__codelineno-0-855"><span class="linenos" data-linenos="855 "></span></a>
</span><span id="__span-0-856"><a id="__codelineno-0-856" name="__codelineno-0-856"></a><a href="#__codelineno-0-856"><span class="linenos" data-linenos="856 "></span></a>        <span class="k">if</span> <span class="n">with_store_info</span><span class="p">:</span>
</span><span id="__span-0-857"><a id="__codelineno-0-857" name="__codelineno-0-857"></a><a href="#__codelineno-0-857"><span class="linenos" data-linenos="857 "></span></a>            <span class="k">return</span> <span class="n">lazy_frame</span><span class="p">,</span> <span class="bp">self</span>
</span><span id="__span-0-858"><a id="__codelineno-0-858" name="__codelineno-0-858"></a><a href="#__codelineno-0-858"><span class="linenos" data-linenos="858 "></span></a>        <span class="k">return</span> <span class="n">lazy_frame</span>
</span><span id="__span-0-859"><a id="__codelineno-0-859" name="__codelineno-0-859"></a><a href="#__codelineno-0-859"><span class="linenos" data-linenos="859 "></span></a>
</span><span id="__span-0-860"><a id="__codelineno-0-860" name="__codelineno-0-860"></a><a href="#__codelineno-0-860"><span class="linenos" data-linenos="860 "></span></a>    <span class="c1"># Try fallback stores (opened on demand)</span>
</span><span id="__span-0-861"><a id="__codelineno-0-861" name="__codelineno-0-861"></a><a href="#__codelineno-0-861"><span class="linenos" data-linenos="861 "></span></a>    <span class="k">if</span> <span class="n">allow_fallback</span><span class="p">:</span>
</span><span id="__span-0-862"><a id="__codelineno-0-862" name="__codelineno-0-862"></a><a href="#__codelineno-0-862"><span class="linenos" data-linenos="862 "></span></a>        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-863"><a id="__codelineno-0-863" name="__codelineno-0-863"></a><a href="#__codelineno-0-863"><span class="linenos" data-linenos="863 "></span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-864"><a id="__codelineno-0-864" name="__codelineno-0-864"></a><a href="#__codelineno-0-864"><span class="linenos" data-linenos="864 "></span></a>                <span class="c1"># Open fallback store on demand for reading</span>
</span><span id="__span-0-865"><a id="__codelineno-0-865" name="__codelineno-0-865"></a><a href="#__codelineno-0-865"><span class="linenos" data-linenos="865 "></span></a>                <span class="k">with</span> <span class="n">store</span><span class="p">:</span>
</span><span id="__span-0-866"><a id="__codelineno-0-866" name="__codelineno-0-866"></a><a href="#__codelineno-0-866"><span class="linenos" data-linenos="866 "></span></a>                    <span class="c1"># Use full read to handle nested fallback chains</span>
</span><span id="__span-0-867"><a id="__codelineno-0-867" name="__codelineno-0-867"></a><a href="#__codelineno-0-867"><span class="linenos" data-linenos="867 "></span></a>                    <span class="k">if</span> <span class="n">with_store_info</span><span class="p">:</span>
</span><span id="__span-0-868"><a id="__codelineno-0-868" name="__codelineno-0-868"></a><a href="#__codelineno-0-868"><span class="linenos" data-linenos="868 "></span></a>                        <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-869"><a id="__codelineno-0-869" name="__codelineno-0-869"></a><a href="#__codelineno-0-869"><span class="linenos" data-linenos="869 "></span></a>                            <span class="n">feature</span><span class="p">,</span>
</span><span id="__span-0-870"><a id="__codelineno-0-870" name="__codelineno-0-870"></a><a href="#__codelineno-0-870"><span class="linenos" data-linenos="870 "></span></a>                            <span class="n">feature_version</span><span class="o">=</span><span class="n">feature_version</span><span class="p">,</span>
</span><span id="__span-0-871"><a id="__codelineno-0-871" name="__codelineno-0-871"></a><a href="#__codelineno-0-871"><span class="linenos" data-linenos="871 "></span></a>                            <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
</span><span id="__span-0-872"><a id="__codelineno-0-872" name="__codelineno-0-872"></a><a href="#__codelineno-0-872"><span class="linenos" data-linenos="872 "></span></a>                            <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
</span><span id="__span-0-873"><a id="__codelineno-0-873" name="__codelineno-0-873"></a><a href="#__codelineno-0-873"><span class="linenos" data-linenos="873 "></span></a>                            <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-874"><a id="__codelineno-0-874" name="__codelineno-0-874"></a><a href="#__codelineno-0-874"><span class="linenos" data-linenos="874 "></span></a>                            <span class="n">with_feature_history</span><span class="o">=</span><span class="n">with_feature_history</span><span class="p">,</span>
</span><span id="__span-0-875"><a id="__codelineno-0-875" name="__codelineno-0-875"></a><a href="#__codelineno-0-875"><span class="linenos" data-linenos="875 "></span></a>                            <span class="n">with_sample_history</span><span class="o">=</span><span class="n">with_sample_history</span><span class="p">,</span>
</span><span id="__span-0-876"><a id="__codelineno-0-876" name="__codelineno-0-876"></a><a href="#__codelineno-0-876"><span class="linenos" data-linenos="876 "></span></a>                            <span class="n">include_soft_deleted</span><span class="o">=</span><span class="n">include_soft_deleted</span><span class="p">,</span>
</span><span id="__span-0-877"><a id="__codelineno-0-877" name="__codelineno-0-877"></a><a href="#__codelineno-0-877"><span class="linenos" data-linenos="877 "></span></a>                            <span class="n">with_store_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-878"><a id="__codelineno-0-878" name="__codelineno-0-878"></a><a href="#__codelineno-0-878"><span class="linenos" data-linenos="878 "></span></a>                        <span class="p">)</span>
</span><span id="__span-0-879"><a id="__codelineno-0-879" name="__codelineno-0-879"></a><a href="#__codelineno-0-879"><span class="linenos" data-linenos="879 "></span></a>                    <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-880"><a id="__codelineno-0-880" name="__codelineno-0-880"></a><a href="#__codelineno-0-880"><span class="linenos" data-linenos="880 "></span></a>                        <span class="n">feature</span><span class="p">,</span>
</span><span id="__span-0-881"><a id="__codelineno-0-881" name="__codelineno-0-881"></a><a href="#__codelineno-0-881"><span class="linenos" data-linenos="881 "></span></a>                        <span class="n">feature_version</span><span class="o">=</span><span class="n">feature_version</span><span class="p">,</span>
</span><span id="__span-0-882"><a id="__codelineno-0-882" name="__codelineno-0-882"></a><a href="#__codelineno-0-882"><span class="linenos" data-linenos="882 "></span></a>                        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
</span><span id="__span-0-883"><a id="__codelineno-0-883" name="__codelineno-0-883"></a><a href="#__codelineno-0-883"><span class="linenos" data-linenos="883 "></span></a>                        <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
</span><span id="__span-0-884"><a id="__codelineno-0-884" name="__codelineno-0-884"></a><a href="#__codelineno-0-884"><span class="linenos" data-linenos="884 "></span></a>                        <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-885"><a id="__codelineno-0-885" name="__codelineno-0-885"></a><a href="#__codelineno-0-885"><span class="linenos" data-linenos="885 "></span></a>                        <span class="n">with_feature_history</span><span class="o">=</span><span class="n">with_feature_history</span><span class="p">,</span>
</span><span id="__span-0-886"><a id="__codelineno-0-886" name="__codelineno-0-886"></a><a href="#__codelineno-0-886"><span class="linenos" data-linenos="886 "></span></a>                        <span class="n">with_sample_history</span><span class="o">=</span><span class="n">with_sample_history</span><span class="p">,</span>
</span><span id="__span-0-887"><a id="__codelineno-0-887" name="__codelineno-0-887"></a><a href="#__codelineno-0-887"><span class="linenos" data-linenos="887 "></span></a>                        <span class="n">include_soft_deleted</span><span class="o">=</span><span class="n">include_soft_deleted</span><span class="p">,</span>
</span><span id="__span-0-888"><a id="__codelineno-0-888" name="__codelineno-0-888"></a><a href="#__codelineno-0-888"><span class="linenos" data-linenos="888 "></span></a>                    <span class="p">)</span>
</span><span id="__span-0-889"><a id="__codelineno-0-889" name="__codelineno-0-889"></a><a href="#__codelineno-0-889"><span class="linenos" data-linenos="889 "></span></a>            <span class="k">except</span> <span class="n">FeatureNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-890"><a id="__codelineno-0-890" name="__codelineno-0-890"></a><a href="#__codelineno-0-890"><span class="linenos" data-linenos="890 "></span></a>                <span class="c1"># Try next fallback store</span>
</span><span id="__span-0-891"><a id="__codelineno-0-891" name="__codelineno-0-891"></a><a href="#__codelineno-0-891"><span class="linenos" data-linenos="891 "></span></a>                <span class="k">continue</span>
</span><span id="__span-0-892"><a id="__codelineno-0-892" name="__codelineno-0-892"></a><a href="#__codelineno-0-892"><span class="linenos" data-linenos="892 "></span></a>
</span><span id="__span-0-893"><a id="__codelineno-0-893" name="__codelineno-0-893"></a><a href="#__codelineno-0-893"><span class="linenos" data-linenos="893 "></span></a>    <span class="c1"># Not found anywhere</span>
</span><span id="__span-0-894"><a id="__codelineno-0-894" name="__codelineno-0-894"></a><a href="#__codelineno-0-894"><span class="linenos" data-linenos="894 "></span></a>    <span class="k">raise</span> <span class="n">FeatureNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-895"><a id="__codelineno-0-895" name="__codelineno-0-895"></a><a href="#__codelineno-0-895"><span class="linenos" data-linenos="895 "></span></a>        <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2"> not found in store&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; or fallback stores&quot;</span> <span class="k">if</span> <span class="n">allow_fallback</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-0-896"><a id="__codelineno-0-896" name="__codelineno-0-896"></a><a href="#__codelineno-0-896"><span class="linenos" data-linenos="896 "></span></a>    <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.write" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.write</span>


<a href="#metaxy.MetadataStore.write" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">write</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">df</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Write metadata for a feature (append-only by design).</p>
<p>Automatically adds the Metaxy system columns, unless they already exist in the DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to write metadata for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>df</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Metadata DataFrame of any type supported by <a href="https://narwhals-dev.github.io/narwhals/">Narwhals</a>.
Must have <code>metaxy_provenance_by_field</code> column of type Struct with fields matching feature's fields.
Optionally, may also contain <code>metaxy_data_version_by_field</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>materialization_id</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Optional external orchestration ID for this write.
Overrides the store's default <code>materialization_id</code> if provided.
Useful for tracking which orchestration run produced this metadata.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.MetadataSchemaError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.MetadataSchemaError">MetadataSchemaError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If DataFrame schema is invalid</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.StoreNotOpenError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
    </ul>
        <p>Note:
    - Must be called within a <code>MetadataStore.open(mode="w")</code> context manager.</p>
<div class="language-python highlight"><pre><span></span><code><span class="o">-</span> <span class="n">Metaxy</span> <span class="n">always</span> <span class="n">performs</span> <span class="n">an</span> <span class="s2">&quot;append&quot;</span> <span class="n">operation</span><span class="o">.</span> <span class="n">Metadata</span> <span class="ow">is</span> <span class="n">never</span> <span class="n">deleted</span> <span class="ow">or</span> <span class="n">mutated</span><span class="o">.</span>

<span class="o">-</span> <span class="n">Fallback</span> <span class="n">stores</span> <span class="n">are</span> <span class="n">never</span> <span class="n">used</span> <span class="k">for</span> <span class="n">writes</span><span class="o">.</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-898"><a id="__codelineno-0-898" name="__codelineno-0-898"></a><a href="#__codelineno-0-898"><span class="linenos" data-linenos="898 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span>
</span><span id="__span-0-899"><a id="__codelineno-0-899" name="__codelineno-0-899"></a><a href="#__codelineno-0-899"><span class="linenos" data-linenos="899 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-900"><a id="__codelineno-0-900" name="__codelineno-0-900"></a><a href="#__codelineno-0-900"><span class="linenos" data-linenos="900 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-901"><a id="__codelineno-0-901" name="__codelineno-0-901"></a><a href="#__codelineno-0-901"><span class="linenos" data-linenos="901 "></span></a>    <span class="n">df</span><span class="p">:</span> <span class="n">IntoFrame</span><span class="p">,</span>
</span><span id="__span-0-902"><a id="__codelineno-0-902" name="__codelineno-0-902"></a><a href="#__codelineno-0-902"><span class="linenos" data-linenos="902 "></span></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-903"><a id="__codelineno-0-903" name="__codelineno-0-903"></a><a href="#__codelineno-0-903"><span class="linenos" data-linenos="903 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-904"><a id="__codelineno-0-904" name="__codelineno-0-904"></a><a href="#__codelineno-0-904"><span class="linenos" data-linenos="904 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-905"><a id="__codelineno-0-905" name="__codelineno-0-905"></a><a href="#__codelineno-0-905"><span class="linenos" data-linenos="905 "></span></a><span class="sd">    Write metadata for a feature (append-only by design).</span>
</span><span id="__span-0-906"><a id="__codelineno-0-906" name="__codelineno-0-906"></a><a href="#__codelineno-0-906"><span class="linenos" data-linenos="906 "></span></a>
</span><span id="__span-0-907"><a id="__codelineno-0-907" name="__codelineno-0-907"></a><a href="#__codelineno-0-907"><span class="linenos" data-linenos="907 "></span></a><span class="sd">    Automatically adds the Metaxy system columns, unless they already exist in the DataFrame.</span>
</span><span id="__span-0-908"><a id="__codelineno-0-908" name="__codelineno-0-908"></a><a href="#__codelineno-0-908"><span class="linenos" data-linenos="908 "></span></a>
</span><span id="__span-0-909"><a id="__codelineno-0-909" name="__codelineno-0-909"></a><a href="#__codelineno-0-909"><span class="linenos" data-linenos="909 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-910"><a id="__codelineno-0-910" name="__codelineno-0-910"></a><a href="#__codelineno-0-910"><span class="linenos" data-linenos="910 "></span></a><span class="sd">        feature: Feature to write metadata for</span>
</span><span id="__span-0-911"><a id="__codelineno-0-911" name="__codelineno-0-911"></a><a href="#__codelineno-0-911"><span class="linenos" data-linenos="911 "></span></a><span class="sd">        df: Metadata DataFrame of any type supported by [Narwhals](https://narwhals-dev.github.io/narwhals/).</span>
</span><span id="__span-0-912"><a id="__codelineno-0-912" name="__codelineno-0-912"></a><a href="#__codelineno-0-912"><span class="linenos" data-linenos="912 "></span></a><span class="sd">            Must have `metaxy_provenance_by_field` column of type Struct with fields matching feature&#39;s fields.</span>
</span><span id="__span-0-913"><a id="__codelineno-0-913" name="__codelineno-0-913"></a><a href="#__codelineno-0-913"><span class="linenos" data-linenos="913 "></span></a><span class="sd">            Optionally, may also contain `metaxy_data_version_by_field`.</span>
</span><span id="__span-0-914"><a id="__codelineno-0-914" name="__codelineno-0-914"></a><a href="#__codelineno-0-914"><span class="linenos" data-linenos="914 "></span></a><span class="sd">        materialization_id: Optional external orchestration ID for this write.</span>
</span><span id="__span-0-915"><a id="__codelineno-0-915" name="__codelineno-0-915"></a><a href="#__codelineno-0-915"><span class="linenos" data-linenos="915 "></span></a><span class="sd">            Overrides the store&#39;s default `materialization_id` if provided.</span>
</span><span id="__span-0-916"><a id="__codelineno-0-916" name="__codelineno-0-916"></a><a href="#__codelineno-0-916"><span class="linenos" data-linenos="916 "></span></a><span class="sd">            Useful for tracking which orchestration run produced this metadata.</span>
</span><span id="__span-0-917"><a id="__codelineno-0-917" name="__codelineno-0-917"></a><a href="#__codelineno-0-917"><span class="linenos" data-linenos="917 "></span></a>
</span><span id="__span-0-918"><a id="__codelineno-0-918" name="__codelineno-0-918"></a><a href="#__codelineno-0-918"><span class="linenos" data-linenos="918 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-919"><a id="__codelineno-0-919" name="__codelineno-0-919"></a><a href="#__codelineno-0-919"><span class="linenos" data-linenos="919 "></span></a><span class="sd">        MetadataSchemaError: If DataFrame schema is invalid</span>
</span><span id="__span-0-920"><a id="__codelineno-0-920" name="__codelineno-0-920"></a><a href="#__codelineno-0-920"><span class="linenos" data-linenos="920 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-921"><a id="__codelineno-0-921" name="__codelineno-0-921"></a><a href="#__codelineno-0-921"><span class="linenos" data-linenos="921 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-922"><a id="__codelineno-0-922" name="__codelineno-0-922"></a><a href="#__codelineno-0-922"><span class="linenos" data-linenos="922 "></span></a><span class="sd">        - Must be called within a `MetadataStore.open(mode=&quot;w&quot;)` context manager.</span>
</span><span id="__span-0-923"><a id="__codelineno-0-923" name="__codelineno-0-923"></a><a href="#__codelineno-0-923"><span class="linenos" data-linenos="923 "></span></a>
</span><span id="__span-0-924"><a id="__codelineno-0-924" name="__codelineno-0-924"></a><a href="#__codelineno-0-924"><span class="linenos" data-linenos="924 "></span></a><span class="sd">        - Metaxy always performs an &quot;append&quot; operation. Metadata is never deleted or mutated.</span>
</span><span id="__span-0-925"><a id="__codelineno-0-925" name="__codelineno-0-925"></a><a href="#__codelineno-0-925"><span class="linenos" data-linenos="925 "></span></a>
</span><span id="__span-0-926"><a id="__codelineno-0-926" name="__codelineno-0-926"></a><a href="#__codelineno-0-926"><span class="linenos" data-linenos="926 "></span></a><span class="sd">        - Fallback stores are never used for writes.</span>
</span><span id="__span-0-927"><a id="__codelineno-0-927" name="__codelineno-0-927"></a><a href="#__codelineno-0-927"><span class="linenos" data-linenos="927 "></span></a>
</span><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a><a href="#__codelineno-0-928"><span class="linenos" data-linenos="928 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-929"><a id="__codelineno-0-929" name="__codelineno-0-929"></a><a href="#__codelineno-0-929"><span class="linenos" data-linenos="929 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-930"><a id="__codelineno-0-930" name="__codelineno-0-930"></a><a href="#__codelineno-0-930"><span class="linenos" data-linenos="930 "></span></a>
</span><span id="__span-0-931"><a id="__codelineno-0-931" name="__codelineno-0-931"></a><a href="#__codelineno-0-931"><span class="linenos" data-linenos="931 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a><a href="#__codelineno-0-932"><span class="linenos" data-linenos="932 "></span></a>    <span class="n">is_system_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a><a href="#__codelineno-0-933"><span class="linenos" data-linenos="933 "></span></a>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a><a href="#__codelineno-0-934"><span class="linenos" data-linenos="934 "></span></a>    <span class="c1"># Convert Polars to Narwhals to Polars if needed</span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a><a href="#__codelineno-0-935"><span class="linenos" data-linenos="935 "></span></a>    <span class="c1"># if isinstance(df_nw, (pl.DataFrame, pl.LazyFrame)):</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a><a href="#__codelineno-0-936"><span class="linenos" data-linenos="936 "></span></a>    <span class="n">df_nw</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a><a href="#__codelineno-0-937"><span class="linenos" data-linenos="937 "></span></a>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a><a href="#__codelineno-0-938"><span class="linenos" data-linenos="938 "></span></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_nw</span><span class="p">,</span> <span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)),</span> <span class="sa">f</span><span class="s2">&quot;df must be a Narwhals DataFrame, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df_nw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a><a href="#__codelineno-0-939"><span class="linenos" data-linenos="939 "></span></a>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a><a href="#__codelineno-0-940"><span class="linenos" data-linenos="940 "></span></a>    <span class="c1"># For system tables, write directly without feature_version tracking</span>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a><a href="#__codelineno-0-941"><span class="linenos" data-linenos="941 "></span></a>    <span class="k">if</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a><a href="#__codelineno-0-942"><span class="linenos" data-linenos="942 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_schema_system_table</span><span class="p">(</span><span class="n">df_nw</span><span class="p">)</span>
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a><a href="#__codelineno-0-943"><span class="linenos" data-linenos="943 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">df_nw</span><span class="p">)</span>
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a><a href="#__codelineno-0-944"><span class="linenos" data-linenos="944 "></span></a>        <span class="k">return</span>
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a><a href="#__codelineno-0-945"><span class="linenos" data-linenos="945 "></span></a>
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a><a href="#__codelineno-0-946"><span class="linenos" data-linenos="946 "></span></a>    <span class="c1"># Use collect_schema().names() to avoid PerformanceWarning on lazy frames</span>
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a><a href="#__codelineno-0-947"><span class="linenos" data-linenos="947 "></span></a>    <span class="k">if</span> <span class="n">METAXY_PROVENANCE_BY_FIELD</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_nw</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span><span class="o">.</span><span class="n">names</span><span class="p">():</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a><a href="#__codelineno-0-948"><span class="linenos" data-linenos="948 "></span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.metadata_store.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetadataSchemaError</span>
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a><a href="#__codelineno-0-949"><span class="linenos" data-linenos="949 "></span></a>
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a><a href="#__codelineno-0-950"><span class="linenos" data-linenos="950 "></span></a>        <span class="k">raise</span> <span class="n">MetadataSchemaError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame must have &#39;</span><span class="si">{</span><span class="n">METAXY_PROVENANCE_BY_FIELD</span><span class="si">}</span><span class="s2">&#39; column&quot;</span><span class="p">)</span>
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a><a href="#__codelineno-0-951"><span class="linenos" data-linenos="951 "></span></a>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a><a href="#__codelineno-0-952"><span class="linenos" data-linenos="952 "></span></a>    <span class="c1"># Add all required system columns</span>
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a><a href="#__codelineno-0-953"><span class="linenos" data-linenos="953 "></span></a>    <span class="c1"># warning: for dataframes that do not match the native MetadataStore implementation</span>
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a><a href="#__codelineno-0-954"><span class="linenos" data-linenos="954 "></span></a>    <span class="c1"># and are missing the METAXY_DATA_VERSION column, this call will lead to materializing the equivalent Polars DataFrame</span>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a><a href="#__codelineno-0-955"><span class="linenos" data-linenos="955 "></span></a>    <span class="c1"># while calculating the missing METAXY_DATA_VERSION column</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a><a href="#__codelineno-0-956"><span class="linenos" data-linenos="956 "></span></a>    <span class="n">df_nw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_system_columns</span><span class="p">(</span><span class="n">df_nw</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">materialization_id</span><span class="o">=</span><span class="n">materialization_id</span><span class="p">)</span>
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a><a href="#__codelineno-0-957"><span class="linenos" data-linenos="957 "></span></a>
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a><a href="#__codelineno-0-958"><span class="linenos" data-linenos="958 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_schema</span><span class="p">(</span><span class="n">df_nw</span><span class="p">)</span>
</span><span id="__span-0-959"><a id="__codelineno-0-959" name="__codelineno-0-959"></a><a href="#__codelineno-0-959"><span class="linenos" data-linenos="959 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_write_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">df_nw</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.write_multi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.write_multi</span>


<a href="#metaxy.MetadataStore.write_multi" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">write_multi</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a></span><span class="p">],</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Write metadata for multiple features in reverse topological order.</p>
<p>Processes features so that dependents are written before their dependencies.
This ordering ensures that downstream features are written first, which can
be useful for certain data consistency requirements or when features need
to be processed in a specific order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>metadata</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.typing.IntoFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/typing/#narwhals.typing.IntoFrame">IntoFrame</a>]</code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Mapping from feature keys to metadata DataFrames.
Keys can be any type coercible to FeatureKey (string, sequence,
FeatureKey, or BaseFeature class). Values must be DataFrames
compatible with Narwhals, containing required system columns.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>materialization_id</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Optional external orchestration ID for all writes.
Overrides the store's default <code>materialization_id</code> if provided.
Applied to all feature writes in this batch.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.MetadataSchemaError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.MetadataSchemaError">MetadataSchemaError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If any DataFrame schema is invalid</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.StoreNotOpenError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If writing to a feature from a different project than expected</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Must be called within a <code>MetadataStore.open(mode="w")</code> context manager.</li>
<li>Empty mappings are handled gracefully (no-op).</li>
<li>Each feature's metadata is written via <code>write</code>, so all
  validation and system column handling from that method applies.</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">with</span> <span class="n">store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">store</span><span class="o">.</span><span class="n">write_multi</span><span class="p">(</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        <span class="p">{</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>            <span class="n">ChildFeature</span><span class="p">:</span> <span class="n">child_df</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>            <span class="n">ParentFeature</span><span class="p">:</span> <span class="n">parent_df</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        <span class="p">}</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Features are written in reverse topological order:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1"># ChildFeature first, then ParentFeature</span>
</span></code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-961"><a id="__codelineno-0-961" name="__codelineno-0-961"></a><a href="#__codelineno-0-961"><span class="linenos" data-linenos=" 961 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">write_multi</span><span class="p">(</span>
</span><span id="__span-0-962"><a id="__codelineno-0-962" name="__codelineno-0-962"></a><a href="#__codelineno-0-962"><span class="linenos" data-linenos=" 962 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-963"><a id="__codelineno-0-963" name="__codelineno-0-963"></a><a href="#__codelineno-0-963"><span class="linenos" data-linenos=" 963 "></span></a>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">IntoFrame</span><span class="p">],</span>
</span><span id="__span-0-964"><a id="__codelineno-0-964" name="__codelineno-0-964"></a><a href="#__codelineno-0-964"><span class="linenos" data-linenos=" 964 "></span></a>    <span class="n">materialization_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-965"><a id="__codelineno-0-965" name="__codelineno-0-965"></a><a href="#__codelineno-0-965"><span class="linenos" data-linenos=" 965 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-966"><a id="__codelineno-0-966" name="__codelineno-0-966"></a><a href="#__codelineno-0-966"><span class="linenos" data-linenos=" 966 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-967"><a id="__codelineno-0-967" name="__codelineno-0-967"></a><a href="#__codelineno-0-967"><span class="linenos" data-linenos=" 967 "></span></a><span class="sd">    Write metadata for multiple features in reverse topological order.</span>
</span><span id="__span-0-968"><a id="__codelineno-0-968" name="__codelineno-0-968"></a><a href="#__codelineno-0-968"><span class="linenos" data-linenos=" 968 "></span></a>
</span><span id="__span-0-969"><a id="__codelineno-0-969" name="__codelineno-0-969"></a><a href="#__codelineno-0-969"><span class="linenos" data-linenos=" 969 "></span></a><span class="sd">    Processes features so that dependents are written before their dependencies.</span>
</span><span id="__span-0-970"><a id="__codelineno-0-970" name="__codelineno-0-970"></a><a href="#__codelineno-0-970"><span class="linenos" data-linenos=" 970 "></span></a><span class="sd">    This ordering ensures that downstream features are written first, which can</span>
</span><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a><a href="#__codelineno-0-971"><span class="linenos" data-linenos=" 971 "></span></a><span class="sd">    be useful for certain data consistency requirements or when features need</span>
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a><a href="#__codelineno-0-972"><span class="linenos" data-linenos=" 972 "></span></a><span class="sd">    to be processed in a specific order.</span>
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a><a href="#__codelineno-0-973"><span class="linenos" data-linenos=" 973 "></span></a>
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a><a href="#__codelineno-0-974"><span class="linenos" data-linenos=" 974 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a><a href="#__codelineno-0-975"><span class="linenos" data-linenos=" 975 "></span></a><span class="sd">        metadata: Mapping from feature keys to metadata DataFrames.</span>
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a><a href="#__codelineno-0-976"><span class="linenos" data-linenos=" 976 "></span></a><span class="sd">            Keys can be any type coercible to FeatureKey (string, sequence,</span>
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a><a href="#__codelineno-0-977"><span class="linenos" data-linenos=" 977 "></span></a><span class="sd">            FeatureKey, or BaseFeature class). Values must be DataFrames</span>
</span><span id="__span-0-978"><a id="__codelineno-0-978" name="__codelineno-0-978"></a><a href="#__codelineno-0-978"><span class="linenos" data-linenos=" 978 "></span></a><span class="sd">            compatible with Narwhals, containing required system columns.</span>
</span><span id="__span-0-979"><a id="__codelineno-0-979" name="__codelineno-0-979"></a><a href="#__codelineno-0-979"><span class="linenos" data-linenos=" 979 "></span></a><span class="sd">        materialization_id: Optional external orchestration ID for all writes.</span>
</span><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a><a href="#__codelineno-0-980"><span class="linenos" data-linenos=" 980 "></span></a><span class="sd">            Overrides the store&#39;s default `materialization_id` if provided.</span>
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a><a href="#__codelineno-0-981"><span class="linenos" data-linenos=" 981 "></span></a><span class="sd">            Applied to all feature writes in this batch.</span>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a><a href="#__codelineno-0-982"><span class="linenos" data-linenos=" 982 "></span></a>
</span><span id="__span-0-983"><a id="__codelineno-0-983" name="__codelineno-0-983"></a><a href="#__codelineno-0-983"><span class="linenos" data-linenos=" 983 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a><a href="#__codelineno-0-984"><span class="linenos" data-linenos=" 984 "></span></a><span class="sd">        MetadataSchemaError: If any DataFrame schema is invalid</span>
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a><a href="#__codelineno-0-985"><span class="linenos" data-linenos=" 985 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a><a href="#__codelineno-0-986"><span class="linenos" data-linenos=" 986 "></span></a><span class="sd">        ValueError: If writing to a feature from a different project than expected</span>
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a><a href="#__codelineno-0-987"><span class="linenos" data-linenos=" 987 "></span></a>
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a><a href="#__codelineno-0-988"><span class="linenos" data-linenos=" 988 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a><a href="#__codelineno-0-989"><span class="linenos" data-linenos=" 989 "></span></a><span class="sd">        - Must be called within a `MetadataStore.open(mode=&quot;w&quot;)` context manager.</span>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a><a href="#__codelineno-0-990"><span class="linenos" data-linenos=" 990 "></span></a><span class="sd">        - Empty mappings are handled gracefully (no-op).</span>
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a><a href="#__codelineno-0-991"><span class="linenos" data-linenos=" 991 "></span></a><span class="sd">        - Each feature&#39;s metadata is written via `write`, so all</span>
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a><a href="#__codelineno-0-992"><span class="linenos" data-linenos=" 992 "></span></a><span class="sd">          validation and system column handling from that method applies.</span>
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a><a href="#__codelineno-0-993"><span class="linenos" data-linenos=" 993 "></span></a>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a><a href="#__codelineno-0-994"><span class="linenos" data-linenos=" 994 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a><a href="#__codelineno-0-995"><span class="linenos" data-linenos=" 995 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a><a href="#__codelineno-0-996"><span class="linenos" data-linenos=" 996 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a><a href="#__codelineno-0-997"><span class="linenos" data-linenos=" 997 "></span></a><span class="sd">        with store.open(mode=&quot;w&quot;):</span>
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a><a href="#__codelineno-0-998"><span class="linenos" data-linenos=" 998 "></span></a><span class="sd">            store.write_multi(</span>
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a><a href="#__codelineno-0-999"><span class="linenos" data-linenos=" 999 "></span></a><span class="sd">                {</span>
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><a href="#__codelineno-0-1000"><span class="linenos" data-linenos="1000 "></span></a><span class="sd">                    ChildFeature: child_df,</span>
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><a href="#__codelineno-0-1001"><span class="linenos" data-linenos="1001 "></span></a><span class="sd">                    ParentFeature: parent_df,</span>
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><a href="#__codelineno-0-1002"><span class="linenos" data-linenos="1002 "></span></a><span class="sd">                }</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><a href="#__codelineno-0-1003"><span class="linenos" data-linenos="1003 "></span></a><span class="sd">            )</span>
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><a href="#__codelineno-0-1004"><span class="linenos" data-linenos="1004 "></span></a><span class="sd">        # Features are written in reverse topological order:</span>
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><a href="#__codelineno-0-1005"><span class="linenos" data-linenos="1005 "></span></a><span class="sd">        # ChildFeature first, then ParentFeature</span>
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><a href="#__codelineno-0-1006"><span class="linenos" data-linenos="1006 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><a href="#__codelineno-0-1007"><span class="linenos" data-linenos="1007 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><a href="#__codelineno-0-1008"><span class="linenos" data-linenos="1008 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata</span><span class="p">:</span>
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><a href="#__codelineno-0-1009"><span class="linenos" data-linenos="1009 "></span></a>        <span class="k">return</span>
</span><span id="__span-0-1010"><a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><a href="#__codelineno-0-1010"><span class="linenos" data-linenos="1010 "></span></a>
</span><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><a href="#__codelineno-0-1011"><span class="linenos" data-linenos="1011 "></span></a>    <span class="c1"># Build mapping from resolved keys to dataframes in one pass</span>
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><a href="#__codelineno-0-1012"><span class="linenos" data-linenos="1012 "></span></a>    <span class="n">resolved_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">df</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><a href="#__codelineno-0-1013"><span class="linenos" data-linenos="1013 "></span></a>
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><a href="#__codelineno-0-1014"><span class="linenos" data-linenos="1014 "></span></a>    <span class="c1"># Get reverse topological order (dependents first)</span>
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><a href="#__codelineno-0-1015"><span class="linenos" data-linenos="1015 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">current_graph</span><span class="p">()</span>
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><a href="#__codelineno-0-1016"><span class="linenos" data-linenos="1016 "></span></a>    <span class="n">sorted_keys</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">topological_sort_features</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">resolved_metadata</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><a href="#__codelineno-0-1017"><span class="linenos" data-linenos="1017 "></span></a>
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><a href="#__codelineno-0-1018"><span class="linenos" data-linenos="1018 "></span></a>    <span class="c1"># Write metadata in reverse topological order</span>
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><a href="#__codelineno-0-1019"><span class="linenos" data-linenos="1019 "></span></a>    <span class="k">for</span> <span class="n">feature_key</span> <span class="ow">in</span> <span class="n">sorted_keys</span><span class="p">:</span>
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><a href="#__codelineno-0-1020"><span class="linenos" data-linenos="1020 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><a href="#__codelineno-0-1021"><span class="linenos" data-linenos="1021 "></span></a>            <span class="n">feature_key</span><span class="p">,</span>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><a href="#__codelineno-0-1022"><span class="linenos" data-linenos="1022 "></span></a>            <span class="n">resolved_metadata</span><span class="p">[</span><span class="n">feature_key</span><span class="p">],</span>
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><a href="#__codelineno-0-1023"><span class="linenos" data-linenos="1023 "></span></a>            <span class="n">materialization_id</span><span class="o">=</span><span class="n">materialization_id</span><span class="p">,</span>
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><a href="#__codelineno-0-1024"><span class="linenos" data-linenos="1024 "></span></a>        <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.config_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.config_model</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#metaxy.MetadataStore.config_model" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">config_model</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.base.MetadataStoreConfig&lt;/span&gt;" href="#metaxy.metadata_store.base.MetadataStoreConfig">MetadataStoreConfig</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the configuration model class for this store type.</p>
<p>Subclasses must override this to return their specific config class.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.base.MetadataStoreConfig&lt;/span&gt;" href="#metaxy.metadata_store.base.MetadataStoreConfig">MetadataStoreConfig</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>The config class type (e.g., DuckDBMetadataStoreConfig)</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <p>Subclasses override this with a more specific return type.
Type checkers may show a warning about incompatible override,
but this is intentional - each store returns its own config type.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><a href="#__codelineno-0-1026"><span class="linenos" data-linenos="1026 "></span></a><span class="nd">@classmethod</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><a href="#__codelineno-0-1027"><span class="linenos" data-linenos="1027 "></span></a><span class="nd">@abstractmethod</span>
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><a href="#__codelineno-0-1028"><span class="linenos" data-linenos="1028 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">config_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">MetadataStoreConfig</span><span class="p">]:</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><a href="#__codelineno-0-1029"><span class="linenos" data-linenos="1029 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the configuration model class for this store type.</span>
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><a href="#__codelineno-0-1030"><span class="linenos" data-linenos="1030 "></span></a>
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><a href="#__codelineno-0-1031"><span class="linenos" data-linenos="1031 "></span></a><span class="sd">    Subclasses must override this to return their specific config class.</span>
</span><span id="__span-0-1032"><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><a href="#__codelineno-0-1032"><span class="linenos" data-linenos="1032 "></span></a>
</span><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><a href="#__codelineno-0-1033"><span class="linenos" data-linenos="1033 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><a href="#__codelineno-0-1034"><span class="linenos" data-linenos="1034 "></span></a><span class="sd">        The config class type (e.g., DuckDBMetadataStoreConfig)</span>
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><a href="#__codelineno-0-1035"><span class="linenos" data-linenos="1035 "></span></a>
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><a href="#__codelineno-0-1036"><span class="linenos" data-linenos="1036 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-1037"><a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><a href="#__codelineno-0-1037"><span class="linenos" data-linenos="1037 "></span></a><span class="sd">        Subclasses override this with a more specific return type.</span>
</span><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><a href="#__codelineno-0-1038"><span class="linenos" data-linenos="1038 "></span></a><span class="sd">        Type checkers may show a warning about incompatible override,</span>
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><a href="#__codelineno-0-1039"><span class="linenos" data-linenos="1039 "></span></a><span class="sd">        but this is intentional - each store returns its own config type.</span>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><a href="#__codelineno-0-1040"><span class="linenos" data-linenos="1040 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><a href="#__codelineno-0-1041"><span class="linenos" data-linenos="1041 "></span></a>    <span class="o">...</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.from_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.from_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#metaxy.MetadataStore.from_config" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">from_config</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">config</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.base.MetadataStoreConfig&lt;/span&gt;" href="#metaxy.metadata_store.base.MetadataStoreConfig">MetadataStoreConfig</a></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing_extensions.Self">Self</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a store instance from a configuration object.</p>
<p>This method creates a store by:
1. Converting the config to a dict
2. Resolving fallback store names to actual store instances
3. Calling the store's <strong>init</strong> with the config parameters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>config</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.base.MetadataStoreConfig&lt;/span&gt;" href="#metaxy.metadata_store.base.MetadataStoreConfig">MetadataStoreConfig</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Configuration object (should be the type returned by config_model())</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>**kwargs</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code>, default:
                  <code>{}</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Additional arguments passed directly to the store constructor
(e.g., materialization_id for runtime parameters not in config)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="typing_extensions.Self">Self</span></code>
          ‚Äì
          <div class="doc-md-description">
            <p>A new store instance configured according to the config object</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <!-- skip next -->
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.ext.metadata_stores.duckdb</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">DuckDBMetadataStore</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">DuckDBMetadataStoreConfig</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">config</span> <span class="o">=</span> <span class="n">DuckDBMetadataStoreConfig</span><span class="p">(</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;metadata.db&quot;</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">fallback_stores</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prod&quot;</span><span class="p">],</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">store</span> <span class="o">=</span> <span class="n">DuckDBMetadataStore</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><a href="#__codelineno-0-1043"><span class="linenos" data-linenos="1043 "></span></a><span class="nd">@classmethod</span>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><a href="#__codelineno-0-1044"><span class="linenos" data-linenos="1044 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">MetadataStoreConfig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="__span-0-1045"><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><a href="#__codelineno-0-1045"><span class="linenos" data-linenos="1045 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a store instance from a configuration object.</span>
</span><span id="__span-0-1046"><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><a href="#__codelineno-0-1046"><span class="linenos" data-linenos="1046 "></span></a>
</span><span id="__span-0-1047"><a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><a href="#__codelineno-0-1047"><span class="linenos" data-linenos="1047 "></span></a><span class="sd">    This method creates a store by:</span>
</span><span id="__span-0-1048"><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><a href="#__codelineno-0-1048"><span class="linenos" data-linenos="1048 "></span></a><span class="sd">    1. Converting the config to a dict</span>
</span><span id="__span-0-1049"><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><a href="#__codelineno-0-1049"><span class="linenos" data-linenos="1049 "></span></a><span class="sd">    2. Resolving fallback store names to actual store instances</span>
</span><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><a href="#__codelineno-0-1050"><span class="linenos" data-linenos="1050 "></span></a><span class="sd">    3. Calling the store&#39;s __init__ with the config parameters</span>
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><a href="#__codelineno-0-1051"><span class="linenos" data-linenos="1051 "></span></a>
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><a href="#__codelineno-0-1052"><span class="linenos" data-linenos="1052 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><a href="#__codelineno-0-1053"><span class="linenos" data-linenos="1053 "></span></a><span class="sd">        config: Configuration object (should be the type returned by config_model())</span>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><a href="#__codelineno-0-1054"><span class="linenos" data-linenos="1054 "></span></a><span class="sd">        **kwargs: Additional arguments passed directly to the store constructor</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><a href="#__codelineno-0-1055"><span class="linenos" data-linenos="1055 "></span></a><span class="sd">            (e.g., materialization_id for runtime parameters not in config)</span>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><a href="#__codelineno-0-1056"><span class="linenos" data-linenos="1056 "></span></a>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><a href="#__codelineno-0-1057"><span class="linenos" data-linenos="1057 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><a href="#__codelineno-0-1058"><span class="linenos" data-linenos="1058 "></span></a><span class="sd">        A new store instance configured according to the config object</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><a href="#__codelineno-0-1059"><span class="linenos" data-linenos="1059 "></span></a>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><a href="#__codelineno-0-1060"><span class="linenos" data-linenos="1060 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><a href="#__codelineno-0-1061"><span class="linenos" data-linenos="1061 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><a href="#__codelineno-0-1062"><span class="linenos" data-linenos="1062 "></span></a><span class="sd">        ```python</span>
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><a href="#__codelineno-0-1063"><span class="linenos" data-linenos="1063 "></span></a><span class="sd">        from metaxy.ext.metadata_stores.duckdb import (</span>
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><a href="#__codelineno-0-1064"><span class="linenos" data-linenos="1064 "></span></a><span class="sd">            DuckDBMetadataStore,</span>
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><a href="#__codelineno-0-1065"><span class="linenos" data-linenos="1065 "></span></a><span class="sd">            DuckDBMetadataStoreConfig,</span>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><a href="#__codelineno-0-1066"><span class="linenos" data-linenos="1066 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><a href="#__codelineno-0-1067"><span class="linenos" data-linenos="1067 "></span></a>
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><a href="#__codelineno-0-1068"><span class="linenos" data-linenos="1068 "></span></a><span class="sd">        config = DuckDBMetadataStoreConfig(</span>
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><a href="#__codelineno-0-1069"><span class="linenos" data-linenos="1069 "></span></a><span class="sd">            database=&quot;metadata.db&quot;,</span>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><a href="#__codelineno-0-1070"><span class="linenos" data-linenos="1070 "></span></a><span class="sd">            fallback_stores=[&quot;prod&quot;],</span>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><a href="#__codelineno-0-1071"><span class="linenos" data-linenos="1071 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><a href="#__codelineno-0-1072"><span class="linenos" data-linenos="1072 "></span></a>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><a href="#__codelineno-0-1073"><span class="linenos" data-linenos="1073 "></span></a><span class="sd">        store = DuckDBMetadataStore.from_config(config)</span>
</span><span id="__span-0-1074"><a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><a href="#__codelineno-0-1074"><span class="linenos" data-linenos="1074 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><a href="#__codelineno-0-1075"><span class="linenos" data-linenos="1075 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><a href="#__codelineno-0-1076"><span class="linenos" data-linenos="1076 "></span></a>    <span class="c1"># Convert config to dict, excluding unset values</span>
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><a href="#__codelineno-0-1077"><span class="linenos" data-linenos="1077 "></span></a>    <span class="n">config_dict</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><a href="#__codelineno-0-1078"><span class="linenos" data-linenos="1078 "></span></a>
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><a href="#__codelineno-0-1079"><span class="linenos" data-linenos="1079 "></span></a>    <span class="c1"># Pop and resolve fallback store names to actual store instances</span>
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><a href="#__codelineno-0-1080"><span class="linenos" data-linenos="1080 "></span></a>    <span class="n">fallback_store_names</span> <span class="o">=</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fallback_stores&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><a href="#__codelineno-0-1081"><span class="linenos" data-linenos="1081 "></span></a>    <span class="n">fallback_stores</span> <span class="o">=</span> <span class="p">[</span><span class="n">MetaxyConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">get_store</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fallback_store_names</span><span class="p">]</span>
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><a href="#__codelineno-0-1082"><span class="linenos" data-linenos="1082 "></span></a>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><a href="#__codelineno-0-1083"><span class="linenos" data-linenos="1083 "></span></a>    <span class="c1"># Create store with resolved fallback stores, config, and extra kwargs</span>
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><a href="#__codelineno-0-1084"><span class="linenos" data-linenos="1084 "></span></a>    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fallback_stores</span><span class="o">=</span><span class="n">fallback_stores</span><span class="p">,</span> <span class="o">**</span><span class="n">config_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.native_implementation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.native_implementation</span>


<a href="#metaxy.MetadataStore.native_implementation" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">native_implementation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Implementation&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/implementation/#narwhals.Implementation">Implementation</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the native Narwhals implementation for this store's backend.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><a href="#__codelineno-0-1125"><span class="linenos" data-linenos="1125 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">native_implementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="p">:</span>
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><a href="#__codelineno-0-1126"><span class="linenos" data-linenos="1126 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the native Narwhals implementation for this store&#39;s backend.&quot;&quot;&quot;</span>
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><a href="#__codelineno-0-1127"><span class="linenos" data-linenos="1127 "></span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">versioning_engine_cls</span><span class="o">.</span><span class="n">implementation</span><span class="p">()</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.create_versioning_engine" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.create_versioning_engine</span>


<a href="#metaxy.MetadataStore.create_versioning_engine" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_versioning_engine</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">plan</span><span class="p">:</span> <span class="n"><span title="metaxy.models.plan.FeaturePlan">FeaturePlan</span></span><span class="p">,</span> <span class="n">implementation</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Implementation&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/implementation/#narwhals.Implementation">Implementation</a></span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Iterator&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator">Iterator</a></span><span class="p">[</span><span class="n"><span title="metaxy.versioning.VersioningEngine">VersioningEngine</span></span> <span class="o">|</span> <span class="n"><span title="metaxy.versioning.polars.PolarsVersioningEngine">PolarsVersioningEngine</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates an appropriate provenance engine.</p>
<p>Falls back to Polars implementation if the required implementation differs from the store's native implementation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>plan</code></b>
              (<code><span title="metaxy.models.plan.FeaturePlan">FeaturePlan</span></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>The feature plan.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>implementation</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Implementation&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/implementation/#narwhals.Implementation">Implementation</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>The desired engine implementation.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Iterator&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator">Iterator</a>[<span title="metaxy.versioning.VersioningEngine">VersioningEngine</span> | <span title="metaxy.versioning.polars.PolarsVersioningEngine">PolarsVersioningEngine</span>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>An appropriate provenance engine.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1158"><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><a href="#__codelineno-0-1158"><span class="linenos" data-linenos="1158 "></span></a><span class="nd">@contextmanager</span>
</span><span id="__span-0-1159"><a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><a href="#__codelineno-0-1159"><span class="linenos" data-linenos="1159 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_versioning_engine</span><span class="p">(</span>
</span><span id="__span-0-1160"><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><a href="#__codelineno-0-1160"><span class="linenos" data-linenos="1160 "></span></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">plan</span><span class="p">:</span> <span class="n">FeaturePlan</span><span class="p">,</span> <span class="n">implementation</span><span class="p">:</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span>
</span><span id="__span-0-1161"><a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><a href="#__codelineno-0-1161"><span class="linenos" data-linenos="1161 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">VersioningEngine</span> <span class="o">|</span> <span class="n">PolarsVersioningEngine</span><span class="p">]:</span>
</span><span id="__span-0-1162"><a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><a href="#__codelineno-0-1162"><span class="linenos" data-linenos="1162 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1163"><a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><a href="#__codelineno-0-1163"><span class="linenos" data-linenos="1163 "></span></a><span class="sd">    Creates an appropriate provenance engine.</span>
</span><span id="__span-0-1164"><a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><a href="#__codelineno-0-1164"><span class="linenos" data-linenos="1164 "></span></a>
</span><span id="__span-0-1165"><a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><a href="#__codelineno-0-1165"><span class="linenos" data-linenos="1165 "></span></a><span class="sd">    Falls back to Polars implementation if the required implementation differs from the store&#39;s native implementation.</span>
</span><span id="__span-0-1166"><a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><a href="#__codelineno-0-1166"><span class="linenos" data-linenos="1166 "></span></a>
</span><span id="__span-0-1167"><a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><a href="#__codelineno-0-1167"><span class="linenos" data-linenos="1167 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1168"><a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><a href="#__codelineno-0-1168"><span class="linenos" data-linenos="1168 "></span></a><span class="sd">        plan: The feature plan.</span>
</span><span id="__span-0-1169"><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><a href="#__codelineno-0-1169"><span class="linenos" data-linenos="1169 "></span></a><span class="sd">        implementation: The desired engine implementation.</span>
</span><span id="__span-0-1170"><a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><a href="#__codelineno-0-1170"><span class="linenos" data-linenos="1170 "></span></a>
</span><span id="__span-0-1171"><a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><a href="#__codelineno-0-1171"><span class="linenos" data-linenos="1171 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1172"><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><a href="#__codelineno-0-1172"><span class="linenos" data-linenos="1172 "></span></a><span class="sd">        An appropriate provenance engine.</span>
</span><span id="__span-0-1173"><a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><a href="#__codelineno-0-1173"><span class="linenos" data-linenos="1173 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1174"><a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><a href="#__codelineno-0-1174"><span class="linenos" data-linenos="1174 "></span></a>
</span><span id="__span-0-1175"><a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><a href="#__codelineno-0-1175"><span class="linenos" data-linenos="1175 "></span></a>    <span class="k">if</span> <span class="n">implementation</span> <span class="o">==</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span><span class="p">:</span>
</span><span id="__span-0-1176"><a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><a href="#__codelineno-0-1176"><span class="linenos" data-linenos="1176 "></span></a>        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_polars_versioning_engine</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="__span-0-1177"><a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><a href="#__codelineno-0-1177"><span class="linenos" data-linenos="1177 "></span></a>    <span class="k">elif</span> <span class="n">implementation</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">native_implementation</span><span class="p">():</span>
</span><span id="__span-0-1178"><a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><a href="#__codelineno-0-1178"><span class="linenos" data-linenos="1178 "></span></a>        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_versioning_engine</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="__span-0-1179"><a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><a href="#__codelineno-0-1179"><span class="linenos" data-linenos="1179 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1180"><a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><a href="#__codelineno-0-1180"><span class="linenos" data-linenos="1180 "></span></a>        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_polars_versioning_engine</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="__span-0-1181"><a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><a href="#__codelineno-0-1181"><span class="linenos" data-linenos="1181 "></span></a>
</span><span id="__span-0-1182"><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><a href="#__codelineno-0-1182"><span class="linenos" data-linenos="1182 "></span></a>    <span class="k">with</span> <span class="n">cm</span> <span class="k">as</span> <span class="n">engine</span><span class="p">:</span>
</span><span id="__span-0-1183"><a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><a href="#__codelineno-0-1183"><span class="linenos" data-linenos="1183 "></span></a>        <span class="k">yield</span> <span class="n">engine</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.open" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.open</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#metaxy.MetadataStore.open" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">open</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.metadata_store.types.AccessMode&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="#metaxy.metadata_store.types.AccessMode">AccessMode</a></span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Iterator&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator">Iterator</a></span><span class="p">[</span><span class="n"><span title="typing_extensions.Self">Self</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Open/initialize the store for operations.</p>
<p>Context manager that opens the store with specified access mode.
Called internally by <code>__enter__</code>.
Child classes should implement backend-specific connection setup/teardown here.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.metadata_store.types.AccessMode&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="#metaxy.metadata_store.types.AccessMode">AccessMode</a></code>, default:
                  <code>&#39;r&#39;</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Access mode for this connection session.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><span title="typing_extensions.Self">Self</span></code>
)          ‚Äì
          <div class="doc-md-description">
            <p>The store instance with connection open</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <p>Users should prefer using <code>with store:</code> pattern except when write access mode is needed.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1211"><a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><a href="#__codelineno-0-1211"><span class="linenos" data-linenos="1211 "></span></a><span class="nd">@abstractmethod</span>
</span><span id="__span-0-1212"><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><a href="#__codelineno-0-1212"><span class="linenos" data-linenos="1212 "></span></a><span class="nd">@contextmanager</span>
</span><span id="__span-0-1213"><a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><a href="#__codelineno-0-1213"><span class="linenos" data-linenos="1213 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">AccessMode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
</span><span id="__span-0-1214"><a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><a href="#__codelineno-0-1214"><span class="linenos" data-linenos="1214 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open/initialize the store for operations.</span>
</span><span id="__span-0-1215"><a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><a href="#__codelineno-0-1215"><span class="linenos" data-linenos="1215 "></span></a>
</span><span id="__span-0-1216"><a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><a href="#__codelineno-0-1216"><span class="linenos" data-linenos="1216 "></span></a><span class="sd">    Context manager that opens the store with specified access mode.</span>
</span><span id="__span-0-1217"><a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><a href="#__codelineno-0-1217"><span class="linenos" data-linenos="1217 "></span></a><span class="sd">    Called internally by `__enter__`.</span>
</span><span id="__span-0-1218"><a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><a href="#__codelineno-0-1218"><span class="linenos" data-linenos="1218 "></span></a><span class="sd">    Child classes should implement backend-specific connection setup/teardown here.</span>
</span><span id="__span-0-1219"><a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><a href="#__codelineno-0-1219"><span class="linenos" data-linenos="1219 "></span></a>
</span><span id="__span-0-1220"><a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><a href="#__codelineno-0-1220"><span class="linenos" data-linenos="1220 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1221"><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><a href="#__codelineno-0-1221"><span class="linenos" data-linenos="1221 "></span></a><span class="sd">        mode: Access mode for this connection session.</span>
</span><span id="__span-0-1222"><a id="__codelineno-0-1222" name="__codelineno-0-1222"></a><a href="#__codelineno-0-1222"><span class="linenos" data-linenos="1222 "></span></a>
</span><span id="__span-0-1223"><a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><a href="#__codelineno-0-1223"><span class="linenos" data-linenos="1223 "></span></a><span class="sd">    Yields:</span>
</span><span id="__span-0-1224"><a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><a href="#__codelineno-0-1224"><span class="linenos" data-linenos="1224 "></span></a><span class="sd">        Self: The store instance with connection open</span>
</span><span id="__span-0-1225"><a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><a href="#__codelineno-0-1225"><span class="linenos" data-linenos="1225 "></span></a>
</span><span id="__span-0-1226"><a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><a href="#__codelineno-0-1226"><span class="linenos" data-linenos="1226 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-1227"><a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><a href="#__codelineno-0-1227"><span class="linenos" data-linenos="1227 "></span></a><span class="sd">        Users should prefer using `with store:` pattern except when write access mode is needed.</span>
</span><span id="__span-0-1228"><a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><a href="#__codelineno-0-1228"><span class="linenos" data-linenos="1228 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1229"><a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><a href="#__codelineno-0-1229"><span class="linenos" data-linenos="1229 "></span></a>    <span class="o">...</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.__enter__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.__enter__</span>


<a href="#metaxy.MetadataStore.__enter__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__enter__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="typing_extensions.Self">Self</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Enter context manager - opens store in READ mode by default.</p>
<p>Use <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-method&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-function-name&quot;&gt;metaxy.MetadataStore.open&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-abstractmethod&quot;&gt;&lt;code&gt;abstractmethod&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="#metaxy.MetadataStore.open"><code>MetadataStore.open</code></a> for write access mode instead.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><span title="typing_extensions.Self">Self</span></code>
)          ‚Äì
          <div class="doc-md-description">
            <p>The opened store instance</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1231"><a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><a href="#__codelineno-0-1231"><span class="linenos" data-linenos="1231 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="__span-0-1232"><a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><a href="#__codelineno-0-1232"><span class="linenos" data-linenos="1232 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Enter context manager - opens store in READ mode by default.</span>
</span><span id="__span-0-1233"><a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><a href="#__codelineno-0-1233"><span class="linenos" data-linenos="1233 "></span></a>
</span><span id="__span-0-1234"><a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><a href="#__codelineno-0-1234"><span class="linenos" data-linenos="1234 "></span></a><span class="sd">    Use [`MetadataStore.open`][metaxy.metadata_store.base.MetadataStore.open] for write access mode instead.</span>
</span><span id="__span-0-1235"><a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><a href="#__codelineno-0-1235"><span class="linenos" data-linenos="1235 "></span></a>
</span><span id="__span-0-1236"><a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><a href="#__codelineno-0-1236"><span class="linenos" data-linenos="1236 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1237"><a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><a href="#__codelineno-0-1237"><span class="linenos" data-linenos="1237 "></span></a><span class="sd">        Self: The opened store instance</span>
</span><span id="__span-0-1238"><a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><a href="#__codelineno-0-1238"><span class="linenos" data-linenos="1238 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1239"><a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><a href="#__codelineno-0-1239"><span class="linenos" data-linenos="1239 "></span></a>    <span class="c1"># Determine mode based on auto_create_tables</span>
</span><span id="__span-0-1240"><a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><a href="#__codelineno-0-1240"><span class="linenos" data-linenos="1240 "></span></a>    <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_create_tables</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
</span><span id="__span-0-1241"><a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><a href="#__codelineno-0-1241"><span class="linenos" data-linenos="1241 "></span></a>
</span><span id="__span-0-1242"><a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><a href="#__codelineno-0-1242"><span class="linenos" data-linenos="1242 "></span></a>    <span class="c1"># Open the store (open() manages _context_depth internally)</span>
</span><span id="__span-0-1243"><a id="__codelineno-0-1243" name="__codelineno-0-1243"></a><a href="#__codelineno-0-1243"><span class="linenos" data-linenos="1243 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_open_cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>  <span class="c1"># ty: ignore[invalid-assignment]</span>
</span><span id="__span-0-1244"><a id="__codelineno-0-1244" name="__codelineno-0-1244"></a><a href="#__codelineno-0-1244"><span class="linenos" data-linenos="1244 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_open_cm</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>  <span class="c1"># ty: ignore[possibly-missing-attribute]</span>
</span><span id="__span-0-1245"><a id="__codelineno-0-1245" name="__codelineno-0-1245"></a><a href="#__codelineno-0-1245"><span class="linenos" data-linenos="1245 "></span></a>
</span><span id="__span-0-1246"><a id="__codelineno-0-1246" name="__codelineno-0-1246"></a><a href="#__codelineno-0-1246"><span class="linenos" data-linenos="1246 "></span></a>    <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.validate_hash_algorithm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.validate_hash_algorithm</span>


<a href="#metaxy.MetadataStore.validate_hash_algorithm" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate_hash_algorithm</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">check_fallback_stores</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate that hash algorithm is supported by this store's components.</p>
<p>Public method - can be called to verify hash compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>check_fallback_stores</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, also validate hash is supported by
fallback stores (ensures compatibility for future cross-store operations)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If hash algorithm not supported by components or fallback stores</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1291"><a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><a href="#__codelineno-0-1291"><span class="linenos" data-linenos="1291 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_hash_algorithm</span><span class="p">(</span>
</span><span id="__span-0-1292"><a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><a href="#__codelineno-0-1292"><span class="linenos" data-linenos="1292 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1293"><a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><a href="#__codelineno-0-1293"><span class="linenos" data-linenos="1293 "></span></a>    <span class="n">check_fallback_stores</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1294"><a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><a href="#__codelineno-0-1294"><span class="linenos" data-linenos="1294 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1295"><a id="__codelineno-0-1295" name="__codelineno-0-1295"></a><a href="#__codelineno-0-1295"><span class="linenos" data-linenos="1295 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that hash algorithm is supported by this store&#39;s components.</span>
</span><span id="__span-0-1296"><a id="__codelineno-0-1296" name="__codelineno-0-1296"></a><a href="#__codelineno-0-1296"><span class="linenos" data-linenos="1296 "></span></a>
</span><span id="__span-0-1297"><a id="__codelineno-0-1297" name="__codelineno-0-1297"></a><a href="#__codelineno-0-1297"><span class="linenos" data-linenos="1297 "></span></a><span class="sd">    Public method - can be called to verify hash compatibility.</span>
</span><span id="__span-0-1298"><a id="__codelineno-0-1298" name="__codelineno-0-1298"></a><a href="#__codelineno-0-1298"><span class="linenos" data-linenos="1298 "></span></a>
</span><span id="__span-0-1299"><a id="__codelineno-0-1299" name="__codelineno-0-1299"></a><a href="#__codelineno-0-1299"><span class="linenos" data-linenos="1299 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1300"><a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><a href="#__codelineno-0-1300"><span class="linenos" data-linenos="1300 "></span></a><span class="sd">        check_fallback_stores: If True, also validate hash is supported by</span>
</span><span id="__span-0-1301"><a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><a href="#__codelineno-0-1301"><span class="linenos" data-linenos="1301 "></span></a><span class="sd">            fallback stores (ensures compatibility for future cross-store operations)</span>
</span><span id="__span-0-1302"><a id="__codelineno-0-1302" name="__codelineno-0-1302"></a><a href="#__codelineno-0-1302"><span class="linenos" data-linenos="1302 "></span></a>
</span><span id="__span-0-1303"><a id="__codelineno-0-1303" name="__codelineno-0-1303"></a><a href="#__codelineno-0-1303"><span class="linenos" data-linenos="1303 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1304"><a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><a href="#__codelineno-0-1304"><span class="linenos" data-linenos="1304 "></span></a><span class="sd">        ValueError: If hash algorithm not supported by components or fallback stores</span>
</span><span id="__span-0-1305"><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><a href="#__codelineno-0-1305"><span class="linenos" data-linenos="1305 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1306"><a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><a href="#__codelineno-0-1306"><span class="linenos" data-linenos="1306 "></span></a>    <span class="c1"># Validate hash algorithm support without creating a full engine</span>
</span><span id="__span-0-1307"><a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><a href="#__codelineno-0-1307"><span class="linenos" data-linenos="1307 "></span></a>    <span class="c1"># (engine creation requires a graph which isn&#39;t available during store init)</span>
</span><span id="__span-0-1308"><a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><a href="#__codelineno-0-1308"><span class="linenos" data-linenos="1308 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_hash_algorithm_support</span><span class="p">()</span>
</span><span id="__span-0-1309"><a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><a href="#__codelineno-0-1309"><span class="linenos" data-linenos="1309 "></span></a>
</span><span id="__span-0-1310"><a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><a href="#__codelineno-0-1310"><span class="linenos" data-linenos="1310 "></span></a>    <span class="c1"># Check fallback stores</span>
</span><span id="__span-0-1311"><a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><a href="#__codelineno-0-1311"><span class="linenos" data-linenos="1311 "></span></a>    <span class="k">if</span> <span class="n">check_fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-1312"><a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><a href="#__codelineno-0-1312"><span class="linenos" data-linenos="1312 "></span></a>        <span class="k">for</span> <span class="n">fallback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-1313"><a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><a href="#__codelineno-0-1313"><span class="linenos" data-linenos="1313 "></span></a>            <span class="n">fallback</span><span class="o">.</span><span class="n">validate_hash_algorithm</span><span class="p">(</span><span class="n">check_fallback_stores</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.drop_feature_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.drop_feature_metadata</span>


<a href="#metaxy.MetadataStore.drop_feature_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">drop_feature_metadata</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Drop all metadata for a feature.</p>
<p>This removes all stored metadata for the specified feature from the store.
Useful for cleanup in tests or when re-computing feature metadata from scratch.</p>


<details class="warning" open>
  <summary>Warning</summary>
  <p>This operation is irreversible and will <strong>permanently delete all metadata</strong> for the specified feature.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature class or key to drop metadata for</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">with</span> <span class="n">store_with_data</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="k">assert</span> <span class="n">store_with_data</span><span class="o">.</span><span class="n">has_feature</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">store_with_data</span><span class="o">.</span><span class="n">drop_feature_metadata</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">)</span>
</span></code></pre></div>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a><a href="#__codelineno-0-1616"><span class="linenos" data-linenos="1616 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">drop_feature_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a><a href="#__codelineno-0-1617"><span class="linenos" data-linenos="1617 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop all metadata for a feature.</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><a href="#__codelineno-0-1618"><span class="linenos" data-linenos="1618 "></span></a>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a><a href="#__codelineno-0-1619"><span class="linenos" data-linenos="1619 "></span></a><span class="sd">    This removes all stored metadata for the specified feature from the store.</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><a href="#__codelineno-0-1620"><span class="linenos" data-linenos="1620 "></span></a><span class="sd">    Useful for cleanup in tests or when re-computing feature metadata from scratch.</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a><a href="#__codelineno-0-1621"><span class="linenos" data-linenos="1621 "></span></a>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><a href="#__codelineno-0-1622"><span class="linenos" data-linenos="1622 "></span></a><span class="sd">    Warning:</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><a href="#__codelineno-0-1623"><span class="linenos" data-linenos="1623 "></span></a><span class="sd">        This operation is irreversible and will **permanently delete all metadata** for the specified feature.</span>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><a href="#__codelineno-0-1624"><span class="linenos" data-linenos="1624 "></span></a>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a><a href="#__codelineno-0-1625"><span class="linenos" data-linenos="1625 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a><a href="#__codelineno-0-1626"><span class="linenos" data-linenos="1626 "></span></a><span class="sd">        feature: Feature class or key to drop metadata for</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a><a href="#__codelineno-0-1627"><span class="linenos" data-linenos="1627 "></span></a>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a><a href="#__codelineno-0-1628"><span class="linenos" data-linenos="1628 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a><a href="#__codelineno-0-1629"><span class="linenos" data-linenos="1629 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a><a href="#__codelineno-0-1630"><span class="linenos" data-linenos="1630 "></span></a><span class="sd">        with store_with_data.open(mode=&quot;w&quot;):</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a><a href="#__codelineno-0-1631"><span class="linenos" data-linenos="1631 "></span></a><span class="sd">            assert store_with_data.has_feature(MyFeature)</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a><a href="#__codelineno-0-1632"><span class="linenos" data-linenos="1632 "></span></a><span class="sd">            store_with_data.drop_feature_metadata(MyFeature)</span>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><a href="#__codelineno-0-1633"><span class="linenos" data-linenos="1633 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a><a href="#__codelineno-0-1634"><span class="linenos" data-linenos="1634 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><a href="#__codelineno-0-1635"><span class="linenos" data-linenos="1635 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a><a href="#__codelineno-0-1636"><span class="linenos" data-linenos="1636 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a><a href="#__codelineno-0-1637"><span class="linenos" data-linenos="1637 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">):</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a><a href="#__codelineno-0-1638"><span class="linenos" data-linenos="1638 "></span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support deletes for system tables&quot;</span><span class="p">)</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a><a href="#__codelineno-0-1639"><span class="linenos" data-linenos="1639 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_drop_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.delete" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.delete</span>


<a href="#metaxy.MetadataStore.delete" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">delete</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">soft</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Delete records matching provided filters.</p>
<p>Performs a soft delete by default. This is achieved by setting metaxy_deleted_at to the current timestamp.
Subsequent [[MetadataStore.read]] calls would ignore these records by default.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to delete from.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a> | None</code>)
          ‚Äì
          <div class="doc-md-description">
            <p>One or more Narwhals expressions or a sequence of expressions that determine which records to delete.
If <code>None</code>, deletes all records (subject to <code>with_feature_history</code> and <code>with_sample_history</code> constraints).</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>soft</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to perform a soft delete.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_feature_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, delete across all historical feature versions. If False (default), only current version.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_sample_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, include all historical materializations. If False (default), deduplicate to latest rows.</p>
          </div>
        </li>
    </ul>
        <div class="admonition critical">
<p class="admonition-title">Critical</p>
<p>By default, deletions target historical records. Even when <code>with_feature_history</code> is <code>False</code>,
records with the same feature version but an older <code>metaxy_created_at</code> would be targeted as
well. Consider adding additional conditions to <code>filters</code> if you want to avoid that.</p>
</div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a><a href="#__codelineno-0-1641"><span class="linenos" data-linenos="1641 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a><a href="#__codelineno-0-1642"><span class="linenos" data-linenos="1642 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a><a href="#__codelineno-0-1643"><span class="linenos" data-linenos="1643 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><a href="#__codelineno-0-1644"><span class="linenos" data-linenos="1644 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="n">nw</span><span class="o">.</span><span class="n">Expr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><a href="#__codelineno-0-1645"><span class="linenos" data-linenos="1645 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a><a href="#__codelineno-0-1646"><span class="linenos" data-linenos="1646 "></span></a>    <span class="n">soft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><a href="#__codelineno-0-1647"><span class="linenos" data-linenos="1647 "></span></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><a href="#__codelineno-0-1648"><span class="linenos" data-linenos="1648 "></span></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><a href="#__codelineno-0-1649"><span class="linenos" data-linenos="1649 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><a href="#__codelineno-0-1650"><span class="linenos" data-linenos="1650 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete records matching provided filters.</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><a href="#__codelineno-0-1651"><span class="linenos" data-linenos="1651 "></span></a>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><a href="#__codelineno-0-1652"><span class="linenos" data-linenos="1652 "></span></a><span class="sd">    Performs a soft delete by default. This is achieved by setting metaxy_deleted_at to the current timestamp.</span>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a><a href="#__codelineno-0-1653"><span class="linenos" data-linenos="1653 "></span></a><span class="sd">    Subsequent [[MetadataStore.read]] calls would ignore these records by default.</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><a href="#__codelineno-0-1654"><span class="linenos" data-linenos="1654 "></span></a>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><a href="#__codelineno-0-1655"><span class="linenos" data-linenos="1655 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><a href="#__codelineno-0-1656"><span class="linenos" data-linenos="1656 "></span></a><span class="sd">        feature: Feature to delete from.</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><a href="#__codelineno-0-1657"><span class="linenos" data-linenos="1657 "></span></a><span class="sd">        filters: One or more Narwhals expressions or a sequence of expressions that determine which records to delete.</span>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><a href="#__codelineno-0-1658"><span class="linenos" data-linenos="1658 "></span></a><span class="sd">            If `None`, deletes all records (subject to `with_feature_history` and `with_sample_history` constraints).</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><a href="#__codelineno-0-1659"><span class="linenos" data-linenos="1659 "></span></a><span class="sd">        soft: Whether to perform a soft delete.</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><a href="#__codelineno-0-1660"><span class="linenos" data-linenos="1660 "></span></a><span class="sd">        with_feature_history: If True, delete across all historical feature versions. If False (default), only current version.</span>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><a href="#__codelineno-0-1661"><span class="linenos" data-linenos="1661 "></span></a><span class="sd">        with_sample_history: If True, include all historical materializations. If False (default), deduplicate to latest rows.</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><a href="#__codelineno-0-1662"><span class="linenos" data-linenos="1662 "></span></a>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><a href="#__codelineno-0-1663"><span class="linenos" data-linenos="1663 "></span></a><span class="sd">    !!! critical</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><a href="#__codelineno-0-1664"><span class="linenos" data-linenos="1664 "></span></a><span class="sd">        By default, deletions target historical records. Even when `with_feature_history` is `False`,</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><a href="#__codelineno-0-1665"><span class="linenos" data-linenos="1665 "></span></a><span class="sd">        records with the same feature version but an older `metaxy_created_at` would be targeted as</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><a href="#__codelineno-0-1666"><span class="linenos" data-linenos="1666 "></span></a><span class="sd">        well. Consider adding additional conditions to `filters` if you want to avoid that.</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><a href="#__codelineno-0-1667"><span class="linenos" data-linenos="1667 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><a href="#__codelineno-0-1668"><span class="linenos" data-linenos="1668 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><a href="#__codelineno-0-1669"><span class="linenos" data-linenos="1669 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><a href="#__codelineno-0-1670"><span class="linenos" data-linenos="1670 "></span></a>
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><a href="#__codelineno-0-1671"><span class="linenos" data-linenos="1671 "></span></a>    <span class="c1"># Normalize filters to list</span>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><a href="#__codelineno-0-1672"><span class="linenos" data-linenos="1672 "></span></a>    <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><a href="#__codelineno-0-1673"><span class="linenos" data-linenos="1673 "></span></a>        <span class="n">filter_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><a href="#__codelineno-0-1674"><span class="linenos" data-linenos="1674 "></span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><a href="#__codelineno-0-1675"><span class="linenos" data-linenos="1675 "></span></a>        <span class="n">filter_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="p">]</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><a href="#__codelineno-0-1676"><span class="linenos" data-linenos="1676 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a><a href="#__codelineno-0-1677"><span class="linenos" data-linenos="1677 "></span></a>        <span class="n">filter_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><a href="#__codelineno-0-1678"><span class="linenos" data-linenos="1678 "></span></a>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a><a href="#__codelineno-0-1679"><span class="linenos" data-linenos="1679 "></span></a>    <span class="k">if</span> <span class="n">soft</span><span class="p">:</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a><a href="#__codelineno-0-1680"><span class="linenos" data-linenos="1680 "></span></a>        <span class="c1"># Soft delete: mark records with deletion timestamp, preserving original updated_at</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><a href="#__codelineno-0-1681"><span class="linenos" data-linenos="1681 "></span></a>        <span class="n">lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><a href="#__codelineno-0-1682"><span class="linenos" data-linenos="1682 "></span></a>            <span class="n">feature_key</span><span class="p">,</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><a href="#__codelineno-0-1683"><span class="linenos" data-linenos="1683 "></span></a>            <span class="n">filters</span><span class="o">=</span><span class="n">filter_list</span><span class="p">,</span>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><a href="#__codelineno-0-1684"><span class="linenos" data-linenos="1684 "></span></a>            <span class="n">include_soft_deleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><a href="#__codelineno-0-1685"><span class="linenos" data-linenos="1685 "></span></a>            <span class="n">with_feature_history</span><span class="o">=</span><span class="n">with_feature_history</span><span class="p">,</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a><a href="#__codelineno-0-1686"><span class="linenos" data-linenos="1686 "></span></a>            <span class="n">with_sample_history</span><span class="o">=</span><span class="n">with_sample_history</span><span class="p">,</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><a href="#__codelineno-0-1687"><span class="linenos" data-linenos="1687 "></span></a>            <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><a href="#__codelineno-0-1688"><span class="linenos" data-linenos="1688 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><a href="#__codelineno-0-1689"><span class="linenos" data-linenos="1689 "></span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shared_transaction_timestamp</span><span class="p">(</span><span class="n">soft_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">ts</span><span class="p">:</span>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><a href="#__codelineno-0-1690"><span class="linenos" data-linenos="1690 "></span></a>            <span class="n">soft_deletion_marked</span> <span class="o">=</span> <span class="n">lazy</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="__span-0-1691"><a id="__codelineno-0-1691" name="__codelineno-0-1691"></a><a href="#__codelineno-0-1691"><span class="linenos" data-linenos="1691 "></span></a>                <span class="n">nw</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">METAXY_DELETED_AT</span><span class="p">),</span>
</span><span id="__span-0-1692"><a id="__codelineno-0-1692" name="__codelineno-0-1692"></a><a href="#__codelineno-0-1692"><span class="linenos" data-linenos="1692 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><a href="#__codelineno-0-1693"><span class="linenos" data-linenos="1693 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">soft_deletion_marked</span><span class="o">.</span><span class="n">to_native</span><span class="p">())</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a><a href="#__codelineno-0-1694"><span class="linenos" data-linenos="1694 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a><a href="#__codelineno-0-1695"><span class="linenos" data-linenos="1695 "></span></a>        <span class="c1"># Hard delete: add version filter if needed, then delegate to backend</span>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><a href="#__codelineno-0-1696"><span class="linenos" data-linenos="1696 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">with_feature_history</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">):</span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a><a href="#__codelineno-0-1697"><span class="linenos" data-linenos="1697 "></span></a>            <span class="n">version_filter</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">METAXY_FEATURE_VERSION</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_feature_version</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><a href="#__codelineno-0-1698"><span class="linenos" data-linenos="1698 "></span></a>            <span class="n">filter_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">version_filter</span><span class="p">,</span> <span class="o">*</span><span class="n">filter_list</span><span class="p">]</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><a href="#__codelineno-0-1699"><span class="linenos" data-linenos="1699 "></span></a>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><a href="#__codelineno-0-1700"><span class="linenos" data-linenos="1700 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">filter_list</span><span class="p">,</span> <span class="n">with_feature_history</span><span class="o">=</span><span class="n">with_feature_history</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.read_feature_schema_from_store" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.read_feature_schema_from_store</span>


<a href="#metaxy.MetadataStore.read_feature_schema_from_store" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_feature_schema_from_store</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Schema&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/schema/#narwhals.schema.Schema">Schema</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read the schema for a feature from the store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to read schema for</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Schema&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/schema/#narwhals.schema.Schema">Schema</a></code>
          ‚Äì
          <div class="doc-md-description">
            <p>Narwhals schema for the feature</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.FeatureNotFoundError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.FeatureNotFoundError">FeatureNotFoundError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If feature not found in the store</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a><a href="#__codelineno-0-1725"><span class="linenos" data-linenos="1725 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_feature_schema_from_store</span><span class="p">(</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><a href="#__codelineno-0-1726"><span class="linenos" data-linenos="1726 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><a href="#__codelineno-0-1727"><span class="linenos" data-linenos="1727 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a><a href="#__codelineno-0-1728"><span class="linenos" data-linenos="1728 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">Schema</span><span class="p">:</span>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><a href="#__codelineno-0-1729"><span class="linenos" data-linenos="1729 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the schema for a feature from the store.</span>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><a href="#__codelineno-0-1730"><span class="linenos" data-linenos="1730 "></span></a>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><a href="#__codelineno-0-1731"><span class="linenos" data-linenos="1731 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><a href="#__codelineno-0-1732"><span class="linenos" data-linenos="1732 "></span></a><span class="sd">        feature: Feature to read schema for</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><a href="#__codelineno-0-1733"><span class="linenos" data-linenos="1733 "></span></a>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a><a href="#__codelineno-0-1734"><span class="linenos" data-linenos="1734 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a><a href="#__codelineno-0-1735"><span class="linenos" data-linenos="1735 "></span></a><span class="sd">        Narwhals schema for the feature</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a><a href="#__codelineno-0-1736"><span class="linenos" data-linenos="1736 "></span></a>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a><a href="#__codelineno-0-1737"><span class="linenos" data-linenos="1737 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a><a href="#__codelineno-0-1738"><span class="linenos" data-linenos="1738 "></span></a><span class="sd">        FeatureNotFoundError: If feature not found in the store</span>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a><a href="#__codelineno-0-1739"><span class="linenos" data-linenos="1739 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a><a href="#__codelineno-0-1740"><span class="linenos" data-linenos="1740 "></span></a>    <span class="n">lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a><a href="#__codelineno-0-1741"><span class="linenos" data-linenos="1741 "></span></a>        <span class="n">feature</span><span class="p">,</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a><a href="#__codelineno-0-1742"><span class="linenos" data-linenos="1742 "></span></a>        <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a><a href="#__codelineno-0-1743"><span class="linenos" data-linenos="1743 "></span></a>    <span class="p">)</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><a href="#__codelineno-0-1744"><span class="linenos" data-linenos="1744 "></span></a>    <span class="k">return</span> <span class="n">lazy</span><span class="o">.</span><span class="n">collect_schema</span><span class="p">()</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.has_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.has_feature</span>


<a href="#metaxy.MetadataStore.has_feature" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">has_feature</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if feature exists in store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to check</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>check_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, also check fallback stores</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          ‚Äì
          <div class="doc-md-description">
            <p>True if feature exists, False otherwise</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><a href="#__codelineno-0-1748"><span class="linenos" data-linenos="1748 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">has_feature</span><span class="p">(</span>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><a href="#__codelineno-0-1749"><span class="linenos" data-linenos="1749 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><a href="#__codelineno-0-1750"><span class="linenos" data-linenos="1750 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><a href="#__codelineno-0-1751"><span class="linenos" data-linenos="1751 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><a href="#__codelineno-0-1752"><span class="linenos" data-linenos="1752 "></span></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><a href="#__codelineno-0-1753"><span class="linenos" data-linenos="1753 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><a href="#__codelineno-0-1754"><span class="linenos" data-linenos="1754 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><a href="#__codelineno-0-1755"><span class="linenos" data-linenos="1755 "></span></a><span class="sd">    Check if feature exists in store.</span>
</span><span id="__span-0-1756"><a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><a href="#__codelineno-0-1756"><span class="linenos" data-linenos="1756 "></span></a>
</span><span id="__span-0-1757"><a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><a href="#__codelineno-0-1757"><span class="linenos" data-linenos="1757 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1758"><a id="__codelineno-0-1758" name="__codelineno-0-1758"></a><a href="#__codelineno-0-1758"><span class="linenos" data-linenos="1758 "></span></a><span class="sd">        feature: Feature to check</span>
</span><span id="__span-0-1759"><a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><a href="#__codelineno-0-1759"><span class="linenos" data-linenos="1759 "></span></a><span class="sd">        check_fallback: If True, also check fallback stores</span>
</span><span id="__span-0-1760"><a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><a href="#__codelineno-0-1760"><span class="linenos" data-linenos="1760 "></span></a>
</span><span id="__span-0-1761"><a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><a href="#__codelineno-0-1761"><span class="linenos" data-linenos="1761 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1762"><a id="__codelineno-0-1762" name="__codelineno-0-1762"></a><a href="#__codelineno-0-1762"><span class="linenos" data-linenos="1762 "></span></a><span class="sd">        True if feature exists, False otherwise</span>
</span><span id="__span-0-1763"><a id="__codelineno-0-1763" name="__codelineno-0-1763"></a><a href="#__codelineno-0-1763"><span class="linenos" data-linenos="1763 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1764"><a id="__codelineno-0-1764" name="__codelineno-0-1764"></a><a href="#__codelineno-0-1764"><span class="linenos" data-linenos="1764 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1765"><a id="__codelineno-0-1765" name="__codelineno-0-1765"></a><a href="#__codelineno-0-1765"><span class="linenos" data-linenos="1765 "></span></a>
</span><span id="__span-0-1766"><a id="__codelineno-0-1766" name="__codelineno-0-1766"></a><a href="#__codelineno-0-1766"><span class="linenos" data-linenos="1766 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1767"><a id="__codelineno-0-1767" name="__codelineno-0-1767"></a><a href="#__codelineno-0-1767"><span class="linenos" data-linenos="1767 "></span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-0-1768"><a id="__codelineno-0-1768" name="__codelineno-0-1768"></a><a href="#__codelineno-0-1768"><span class="linenos" data-linenos="1768 "></span></a>
</span><span id="__span-0-1769"><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><a href="#__codelineno-0-1769"><span class="linenos" data-linenos="1769 "></span></a>    <span class="c1"># Check fallback stores</span>
</span><span id="__span-0-1770"><a id="__codelineno-0-1770" name="__codelineno-0-1770"></a><a href="#__codelineno-0-1770"><span class="linenos" data-linenos="1770 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_fallback</span><span class="p">:</span>
</span><span id="__span-0-1771"><a id="__codelineno-0-1771" name="__codelineno-0-1771"></a><a href="#__codelineno-0-1771"><span class="linenos" data-linenos="1771 "></span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_feature_impl</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-1772"><a id="__codelineno-0-1772" name="__codelineno-0-1772"></a><a href="#__codelineno-0-1772"><span class="linenos" data-linenos="1772 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1773"><a id="__codelineno-0-1773" name="__codelineno-0-1773"></a><a href="#__codelineno-0-1773"><span class="linenos" data-linenos="1773 "></span></a>        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-1774"><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a><a href="#__codelineno-0-1774"><span class="linenos" data-linenos="1774 "></span></a>            <span class="k">if</span> <span class="n">store</span><span class="o">.</span><span class="n">has_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">check_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-0-1775"><a id="__codelineno-0-1775" name="__codelineno-0-1775"></a><a href="#__codelineno-0-1775"><span class="linenos" data-linenos="1775 "></span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-0-1776"><a id="__codelineno-0-1776" name="__codelineno-0-1776"></a><a href="#__codelineno-0-1776"><span class="linenos" data-linenos="1776 "></span></a>
</span><span id="__span-0-1777"><a id="__codelineno-0-1777" name="__codelineno-0-1777"></a><a href="#__codelineno-0-1777"><span class="linenos" data-linenos="1777 "></span></a>    <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.display" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.display</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#metaxy.MetadataStore.display" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">display</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a human-readable display string for this store.</p>
<p>Used in warnings, logs, and CLI output to identify the store.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
          ‚Äì
          <div class="doc-md-description">
            <p>Display string (e.g., "DuckDBMetadataStore(database=/path/to/db.duckdb)")</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1791"><a id="__codelineno-0-1791" name="__codelineno-0-1791"></a><a href="#__codelineno-0-1791"><span class="linenos" data-linenos="1791 "></span></a><span class="nd">@abstractmethod</span>
</span><span id="__span-0-1792"><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a><a href="#__codelineno-0-1792"><span class="linenos" data-linenos="1792 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-1793"><a id="__codelineno-0-1793" name="__codelineno-0-1793"></a><a href="#__codelineno-0-1793"><span class="linenos" data-linenos="1793 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a human-readable display string for this store.</span>
</span><span id="__span-0-1794"><a id="__codelineno-0-1794" name="__codelineno-0-1794"></a><a href="#__codelineno-0-1794"><span class="linenos" data-linenos="1794 "></span></a>
</span><span id="__span-0-1795"><a id="__codelineno-0-1795" name="__codelineno-0-1795"></a><a href="#__codelineno-0-1795"><span class="linenos" data-linenos="1795 "></span></a><span class="sd">    Used in warnings, logs, and CLI output to identify the store.</span>
</span><span id="__span-0-1796"><a id="__codelineno-0-1796" name="__codelineno-0-1796"></a><a href="#__codelineno-0-1796"><span class="linenos" data-linenos="1796 "></span></a>
</span><span id="__span-0-1797"><a id="__codelineno-0-1797" name="__codelineno-0-1797"></a><a href="#__codelineno-0-1797"><span class="linenos" data-linenos="1797 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1798"><a id="__codelineno-0-1798" name="__codelineno-0-1798"></a><a href="#__codelineno-0-1798"><span class="linenos" data-linenos="1798 "></span></a><span class="sd">        Display string (e.g., &quot;DuckDBMetadataStore(database=/path/to/db.duckdb)&quot;)</span>
</span><span id="__span-0-1799"><a id="__codelineno-0-1799" name="__codelineno-0-1799"></a><a href="#__codelineno-0-1799"><span class="linenos" data-linenos="1799 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1800"><a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><a href="#__codelineno-0-1800"><span class="linenos" data-linenos="1800 "></span></a>    <span class="k">pass</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.__repr__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.__repr__</span>


<a href="#metaxy.MetadataStore.__repr__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__repr__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the display string with optional name prefix.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1802"><a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><a href="#__codelineno-0-1802"><span class="linenos" data-linenos="1802 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-1803"><a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><a href="#__codelineno-0-1803"><span class="linenos" data-linenos="1803 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the display string with optional name prefix.&quot;&quot;&quot;</span>
</span><span id="__span-0-1804"><a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><a href="#__codelineno-0-1804"><span class="linenos" data-linenos="1804 "></span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_display_with_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">())</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.find_store_for_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.find_store_for_feature</span>


<a href="#metaxy.MetadataStore.find_store_for_feature" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">find_store_for_feature</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a></span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Find the store that contains the given feature.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature_key</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to find</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>check_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to check fallback stores when the feature
is not found in the current store</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a> | None</code>
          ‚Äì
          <div class="doc-md-description">
            <p>The store containing the feature, or None if not found</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1806"><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><a href="#__codelineno-0-1806"><span class="linenos" data-linenos="1806 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_store_for_feature</span><span class="p">(</span>
</span><span id="__span-0-1807"><a id="__codelineno-0-1807" name="__codelineno-0-1807"></a><a href="#__codelineno-0-1807"><span class="linenos" data-linenos="1807 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1808"><a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><a href="#__codelineno-0-1808"><span class="linenos" data-linenos="1808 "></span></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1809"><a id="__codelineno-0-1809" name="__codelineno-0-1809"></a><a href="#__codelineno-0-1809"><span class="linenos" data-linenos="1809 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1810"><a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><a href="#__codelineno-0-1810"><span class="linenos" data-linenos="1810 "></span></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1811"><a id="__codelineno-0-1811" name="__codelineno-0-1811"></a><a href="#__codelineno-0-1811"><span class="linenos" data-linenos="1811 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetadataStore</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1812"><a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><a href="#__codelineno-0-1812"><span class="linenos" data-linenos="1812 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the store that contains the given feature.</span>
</span><span id="__span-0-1813"><a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><a href="#__codelineno-0-1813"><span class="linenos" data-linenos="1813 "></span></a>
</span><span id="__span-0-1814"><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><a href="#__codelineno-0-1814"><span class="linenos" data-linenos="1814 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1815"><a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><a href="#__codelineno-0-1815"><span class="linenos" data-linenos="1815 "></span></a><span class="sd">        feature_key: Feature to find</span>
</span><span id="__span-0-1816"><a id="__codelineno-0-1816" name="__codelineno-0-1816"></a><a href="#__codelineno-0-1816"><span class="linenos" data-linenos="1816 "></span></a><span class="sd">        check_fallback: Whether to check fallback stores when the feature</span>
</span><span id="__span-0-1817"><a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><a href="#__codelineno-0-1817"><span class="linenos" data-linenos="1817 "></span></a><span class="sd">            is not found in the current store</span>
</span><span id="__span-0-1818"><a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><a href="#__codelineno-0-1818"><span class="linenos" data-linenos="1818 "></span></a>
</span><span id="__span-0-1819"><a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><a href="#__codelineno-0-1819"><span class="linenos" data-linenos="1819 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1820"><a id="__codelineno-0-1820" name="__codelineno-0-1820"></a><a href="#__codelineno-0-1820"><span class="linenos" data-linenos="1820 "></span></a><span class="sd">        The store containing the feature, or None if not found</span>
</span><span id="__span-0-1821"><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a><a href="#__codelineno-0-1821"><span class="linenos" data-linenos="1821 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1822"><a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><a href="#__codelineno-0-1822"><span class="linenos" data-linenos="1822 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1823"><a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><a href="#__codelineno-0-1823"><span class="linenos" data-linenos="1823 "></span></a>
</span><span id="__span-0-1824"><a id="__codelineno-0-1824" name="__codelineno-0-1824"></a><a href="#__codelineno-0-1824"><span class="linenos" data-linenos="1824 "></span></a>    <span class="c1"># Check if feature exists in this store</span>
</span><span id="__span-0-1825"><a id="__codelineno-0-1825" name="__codelineno-0-1825"></a><a href="#__codelineno-0-1825"><span class="linenos" data-linenos="1825 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">):</span>
</span><span id="__span-0-1826"><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a><a href="#__codelineno-0-1826"><span class="linenos" data-linenos="1826 "></span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="__span-0-1827"><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><a href="#__codelineno-0-1827"><span class="linenos" data-linenos="1827 "></span></a>
</span><span id="__span-0-1828"><a id="__codelineno-0-1828" name="__codelineno-0-1828"></a><a href="#__codelineno-0-1828"><span class="linenos" data-linenos="1828 "></span></a>    <span class="c1"># Try fallback stores if enabled (opened on demand)</span>
</span><span id="__span-0-1829"><a id="__codelineno-0-1829" name="__codelineno-0-1829"></a><a href="#__codelineno-0-1829"><span class="linenos" data-linenos="1829 "></span></a>    <span class="k">if</span> <span class="n">check_fallback</span><span class="p">:</span>
</span><span id="__span-0-1830"><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><a href="#__codelineno-0-1830"><span class="linenos" data-linenos="1830 "></span></a>        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-1831"><a id="__codelineno-0-1831" name="__codelineno-0-1831"></a><a href="#__codelineno-0-1831"><span class="linenos" data-linenos="1831 "></span></a>            <span class="k">with</span> <span class="n">store</span><span class="p">:</span>
</span><span id="__span-0-1832"><a id="__codelineno-0-1832" name="__codelineno-0-1832"></a><a href="#__codelineno-0-1832"><span class="linenos" data-linenos="1832 "></span></a>                <span class="n">found</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">find_store_for_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">check_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-1833"><a id="__codelineno-0-1833" name="__codelineno-0-1833"></a><a href="#__codelineno-0-1833"><span class="linenos" data-linenos="1833 "></span></a>                <span class="k">if</span> <span class="n">found</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1834"><a id="__codelineno-0-1834" name="__codelineno-0-1834"></a><a href="#__codelineno-0-1834"><span class="linenos" data-linenos="1834 "></span></a>                    <span class="k">return</span> <span class="n">found</span>
</span><span id="__span-0-1835"><a id="__codelineno-0-1835" name="__codelineno-0-1835"></a><a href="#__codelineno-0-1835"><span class="linenos" data-linenos="1835 "></span></a>
</span><span id="__span-0-1836"><a id="__codelineno-0-1836" name="__codelineno-0-1836"></a><a href="#__codelineno-0-1836"><span class="linenos" data-linenos="1836 "></span></a>    <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.get_store_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.get_store_metadata</span>


<a href="#metaxy.MetadataStore.get_store_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_store_metadata</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Arbitrary key-value pairs with useful metadata for logging purposes (like a path in storage).</p>
<p>This method should not expose sensitive information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature_key</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to get metadata for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>check_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Whether to check fallback stores when the feature
is not found in the current store</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>Dictionary with store-specific metadata. Contains:</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li><code>name</code>, <code>display</code>: The queried store (self)</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li><code>resolved_from</code>: Where the feature was actually found (may be a fallback store),
includes <code>name</code>, <code>display</code>, and store-specific fields like <code>table_name</code> or <code>uri</code></li>
</ul>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1838"><a id="__codelineno-0-1838" name="__codelineno-0-1838"></a><a href="#__codelineno-0-1838"><span class="linenos" data-linenos="1838 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_store_metadata</span><span class="p">(</span>
</span><span id="__span-0-1839"><a id="__codelineno-0-1839" name="__codelineno-0-1839"></a><a href="#__codelineno-0-1839"><span class="linenos" data-linenos="1839 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1840"><a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><a href="#__codelineno-0-1840"><span class="linenos" data-linenos="1840 "></span></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1841"><a id="__codelineno-0-1841" name="__codelineno-0-1841"></a><a href="#__codelineno-0-1841"><span class="linenos" data-linenos="1841 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1842"><a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><a href="#__codelineno-0-1842"><span class="linenos" data-linenos="1842 "></span></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1843"><a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><a href="#__codelineno-0-1843"><span class="linenos" data-linenos="1843 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-1844"><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a><a href="#__codelineno-0-1844"><span class="linenos" data-linenos="1844 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Arbitrary key-value pairs with useful metadata for logging purposes (like a path in storage).</span>
</span><span id="__span-0-1845"><a id="__codelineno-0-1845" name="__codelineno-0-1845"></a><a href="#__codelineno-0-1845"><span class="linenos" data-linenos="1845 "></span></a>
</span><span id="__span-0-1846"><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a><a href="#__codelineno-0-1846"><span class="linenos" data-linenos="1846 "></span></a><span class="sd">    This method should not expose sensitive information.</span>
</span><span id="__span-0-1847"><a id="__codelineno-0-1847" name="__codelineno-0-1847"></a><a href="#__codelineno-0-1847"><span class="linenos" data-linenos="1847 "></span></a>
</span><span id="__span-0-1848"><a id="__codelineno-0-1848" name="__codelineno-0-1848"></a><a href="#__codelineno-0-1848"><span class="linenos" data-linenos="1848 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1849"><a id="__codelineno-0-1849" name="__codelineno-0-1849"></a><a href="#__codelineno-0-1849"><span class="linenos" data-linenos="1849 "></span></a><span class="sd">        feature_key: Feature to get metadata for</span>
</span><span id="__span-0-1850"><a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><a href="#__codelineno-0-1850"><span class="linenos" data-linenos="1850 "></span></a><span class="sd">        check_fallback: Whether to check fallback stores when the feature</span>
</span><span id="__span-0-1851"><a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><a href="#__codelineno-0-1851"><span class="linenos" data-linenos="1851 "></span></a><span class="sd">            is not found in the current store</span>
</span><span id="__span-0-1852"><a id="__codelineno-0-1852" name="__codelineno-0-1852"></a><a href="#__codelineno-0-1852"><span class="linenos" data-linenos="1852 "></span></a>
</span><span id="__span-0-1853"><a id="__codelineno-0-1853" name="__codelineno-0-1853"></a><a href="#__codelineno-0-1853"><span class="linenos" data-linenos="1853 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1854"><a id="__codelineno-0-1854" name="__codelineno-0-1854"></a><a href="#__codelineno-0-1854"><span class="linenos" data-linenos="1854 "></span></a><span class="sd">        Dictionary with store-specific metadata. Contains:</span>
</span><span id="__span-0-1855"><a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><a href="#__codelineno-0-1855"><span class="linenos" data-linenos="1855 "></span></a><span class="sd">        - `name`, `display`: The queried store (self)</span>
</span><span id="__span-0-1856"><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a><a href="#__codelineno-0-1856"><span class="linenos" data-linenos="1856 "></span></a><span class="sd">        - `resolved_from`: Where the feature was actually found (may be a fallback store),</span>
</span><span id="__span-0-1857"><a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><a href="#__codelineno-0-1857"><span class="linenos" data-linenos="1857 "></span></a><span class="sd">            includes `name`, `display`, and store-specific fields like `table_name` or `uri`</span>
</span><span id="__span-0-1858"><a id="__codelineno-0-1858" name="__codelineno-0-1858"></a><a href="#__codelineno-0-1858"><span class="linenos" data-linenos="1858 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1859"><a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><a href="#__codelineno-0-1859"><span class="linenos" data-linenos="1859 "></span></a>    <span class="n">resolved_store</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_store_for_feature</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">check_fallback</span><span class="o">=</span><span class="n">check_fallback</span><span class="p">)</span>
</span><span id="__span-0-1860"><a id="__codelineno-0-1860" name="__codelineno-0-1860"></a><a href="#__codelineno-0-1860"><span class="linenos" data-linenos="1860 "></span></a>    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-1861"><a id="__codelineno-0-1861" name="__codelineno-0-1861"></a><a href="#__codelineno-0-1861"><span class="linenos" data-linenos="1861 "></span></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-0-1862"><a id="__codelineno-0-1862" name="__codelineno-0-1862"></a><a href="#__codelineno-0-1862"><span class="linenos" data-linenos="1862 "></span></a>        <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">(),</span>
</span><span id="__span-0-1863"><a id="__codelineno-0-1863" name="__codelineno-0-1863"></a><a href="#__codelineno-0-1863"><span class="linenos" data-linenos="1863 "></span></a>    <span class="p">}</span>
</span><span id="__span-0-1864"><a id="__codelineno-0-1864" name="__codelineno-0-1864"></a><a href="#__codelineno-0-1864"><span class="linenos" data-linenos="1864 "></span></a>    <span class="k">if</span> <span class="n">resolved_store</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1865"><a id="__codelineno-0-1865" name="__codelineno-0-1865"></a><a href="#__codelineno-0-1865"><span class="linenos" data-linenos="1865 "></span></a>        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;resolved_from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved_store</span><span class="o">.</span><span class="n">get_store_info</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-1866"><a id="__codelineno-0-1866" name="__codelineno-0-1866"></a><a href="#__codelineno-0-1866"><span class="linenos" data-linenos="1866 "></span></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.get_store_info" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.get_store_info</span>


<a href="#metaxy.MetadataStore.get_store_info" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_store_info</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Build a dictionary with store identification and feature-specific metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature_key</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Feature to get metadata for</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>Dictionary containing:</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li><code>name</code>: The store name</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li><code>type</code>: The fully qualified class name (module.classname)</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li><code>display</code>: Human-readable store description</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <ul>
<li>Store-specific metadata from <code>_get_store_metadata_impl</code> (e.g., <code>table_name</code>, <code>uri</code>)</li>
</ul>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1881"><a id="__codelineno-0-1881" name="__codelineno-0-1881"></a><a href="#__codelineno-0-1881"><span class="linenos" data-linenos="1881 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_store_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_key</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-1882"><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><a href="#__codelineno-0-1882"><span class="linenos" data-linenos="1882 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a dictionary with store identification and feature-specific metadata.</span>
</span><span id="__span-0-1883"><a id="__codelineno-0-1883" name="__codelineno-0-1883"></a><a href="#__codelineno-0-1883"><span class="linenos" data-linenos="1883 "></span></a>
</span><span id="__span-0-1884"><a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><a href="#__codelineno-0-1884"><span class="linenos" data-linenos="1884 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1885"><a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><a href="#__codelineno-0-1885"><span class="linenos" data-linenos="1885 "></span></a><span class="sd">        feature_key: Feature to get metadata for</span>
</span><span id="__span-0-1886"><a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><a href="#__codelineno-0-1886"><span class="linenos" data-linenos="1886 "></span></a>
</span><span id="__span-0-1887"><a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><a href="#__codelineno-0-1887"><span class="linenos" data-linenos="1887 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1888"><a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><a href="#__codelineno-0-1888"><span class="linenos" data-linenos="1888 "></span></a><span class="sd">        Dictionary containing:</span>
</span><span id="__span-0-1889"><a id="__codelineno-0-1889" name="__codelineno-0-1889"></a><a href="#__codelineno-0-1889"><span class="linenos" data-linenos="1889 "></span></a><span class="sd">        - `name`: The store name</span>
</span><span id="__span-0-1890"><a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><a href="#__codelineno-0-1890"><span class="linenos" data-linenos="1890 "></span></a><span class="sd">        - `type`: The fully qualified class name (module.classname)</span>
</span><span id="__span-0-1891"><a id="__codelineno-0-1891" name="__codelineno-0-1891"></a><a href="#__codelineno-0-1891"><span class="linenos" data-linenos="1891 "></span></a><span class="sd">        - `display`: Human-readable store description</span>
</span><span id="__span-0-1892"><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><a href="#__codelineno-0-1892"><span class="linenos" data-linenos="1892 "></span></a><span class="sd">        - Store-specific metadata from `_get_store_metadata_impl` (e.g., `table_name`, `uri`)</span>
</span><span id="__span-0-1893"><a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><a href="#__codelineno-0-1893"><span class="linenos" data-linenos="1893 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1894"><a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><a href="#__codelineno-0-1894"><span class="linenos" data-linenos="1894 "></span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-1895"><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><a href="#__codelineno-0-1895"><span class="linenos" data-linenos="1895 "></span></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-0-1896"><a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><a href="#__codelineno-0-1896"><span class="linenos" data-linenos="1896 "></span></a>        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualified_class_name</span><span class="p">,</span>
</span><span id="__span-0-1897"><a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><a href="#__codelineno-0-1897"><span class="linenos" data-linenos="1897 "></span></a>        <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">(),</span>
</span><span id="__span-0-1898"><a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><a href="#__codelineno-0-1898"><span class="linenos" data-linenos="1898 "></span></a>        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_store_metadata_impl</span><span class="p">(</span><span class="n">feature_key</span><span class="p">),</span>
</span><span id="__span-0-1899"><a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><a href="#__codelineno-0-1899"><span class="linenos" data-linenos="1899 "></span></a>    <span class="p">}</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.calculate_input_progress" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.calculate_input_progress</span>


<a href="#metaxy.MetadataStore.calculate_input_progress" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_input_progress</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">lazy_increment</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.LazyIncrement&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="../../types/#metaxy.versioning.types.LazyIncrement">LazyIncrement</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate progress percentage from lazy increment.</p>
<p>Uses the <code>input</code> field from LazyIncrement to count total input units
and compares with <code>added</code> to determine how many are missing.</p>
<p>Progress represents the percentage of input units that have been processed
at least once. Stale samples (in <code>changed</code>) are counted as processed since
they have existing metadata, even though they may need re-processing due to
upstream changes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>lazy_increment</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.versioning.types.LazyIncrement&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-dataclass&quot;&gt;&lt;code&gt;dataclass&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt;" href="../../types/#metaxy.versioning.types.LazyIncrement">LazyIncrement</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>The lazy increment containing input and added dataframes.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>feature_key</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>The feature key to look up lineage information.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a> | None</code>
          ‚Äì
          <div class="doc-md-description">
            <p>Progress percentage (0-100), or None if input is not available.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1901"><a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><a href="#__codelineno-0-1901"><span class="linenos" data-linenos="1901 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_input_progress</span><span class="p">(</span>
</span><span id="__span-0-1902"><a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><a href="#__codelineno-0-1902"><span class="linenos" data-linenos="1902 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1903"><a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><a href="#__codelineno-0-1903"><span class="linenos" data-linenos="1903 "></span></a>    <span class="n">lazy_increment</span><span class="p">:</span> <span class="n">LazyIncrement</span><span class="p">,</span>
</span><span id="__span-0-1904"><a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><a href="#__codelineno-0-1904"><span class="linenos" data-linenos="1904 "></span></a>    <span class="n">feature_key</span><span class="p">:</span> <span class="n">CoercibleToFeatureKey</span><span class="p">,</span>
</span><span id="__span-0-1905"><a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><a href="#__codelineno-0-1905"><span class="linenos" data-linenos="1905 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1906"><a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><a href="#__codelineno-0-1906"><span class="linenos" data-linenos="1906 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate progress percentage from lazy increment.</span>
</span><span id="__span-0-1907"><a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><a href="#__codelineno-0-1907"><span class="linenos" data-linenos="1907 "></span></a>
</span><span id="__span-0-1908"><a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><a href="#__codelineno-0-1908"><span class="linenos" data-linenos="1908 "></span></a><span class="sd">    Uses the `input` field from LazyIncrement to count total input units</span>
</span><span id="__span-0-1909"><a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><a href="#__codelineno-0-1909"><span class="linenos" data-linenos="1909 "></span></a><span class="sd">    and compares with `added` to determine how many are missing.</span>
</span><span id="__span-0-1910"><a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><a href="#__codelineno-0-1910"><span class="linenos" data-linenos="1910 "></span></a>
</span><span id="__span-0-1911"><a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><a href="#__codelineno-0-1911"><span class="linenos" data-linenos="1911 "></span></a><span class="sd">    Progress represents the percentage of input units that have been processed</span>
</span><span id="__span-0-1912"><a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><a href="#__codelineno-0-1912"><span class="linenos" data-linenos="1912 "></span></a><span class="sd">    at least once. Stale samples (in `changed`) are counted as processed since</span>
</span><span id="__span-0-1913"><a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><a href="#__codelineno-0-1913"><span class="linenos" data-linenos="1913 "></span></a><span class="sd">    they have existing metadata, even though they may need re-processing due to</span>
</span><span id="__span-0-1914"><a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><a href="#__codelineno-0-1914"><span class="linenos" data-linenos="1914 "></span></a><span class="sd">    upstream changes.</span>
</span><span id="__span-0-1915"><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><a href="#__codelineno-0-1915"><span class="linenos" data-linenos="1915 "></span></a>
</span><span id="__span-0-1916"><a id="__codelineno-0-1916" name="__codelineno-0-1916"></a><a href="#__codelineno-0-1916"><span class="linenos" data-linenos="1916 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1917"><a id="__codelineno-0-1917" name="__codelineno-0-1917"></a><a href="#__codelineno-0-1917"><span class="linenos" data-linenos="1917 "></span></a><span class="sd">        lazy_increment: The lazy increment containing input and added dataframes.</span>
</span><span id="__span-0-1918"><a id="__codelineno-0-1918" name="__codelineno-0-1918"></a><a href="#__codelineno-0-1918"><span class="linenos" data-linenos="1918 "></span></a><span class="sd">        feature_key: The feature key to look up lineage information.</span>
</span><span id="__span-0-1919"><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a><a href="#__codelineno-0-1919"><span class="linenos" data-linenos="1919 "></span></a>
</span><span id="__span-0-1920"><a id="__codelineno-0-1920" name="__codelineno-0-1920"></a><a href="#__codelineno-0-1920"><span class="linenos" data-linenos="1920 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1921"><a id="__codelineno-0-1921" name="__codelineno-0-1921"></a><a href="#__codelineno-0-1921"><span class="linenos" data-linenos="1921 "></span></a><span class="sd">        Progress percentage (0-100), or None if input is not available.</span>
</span><span id="__span-0-1922"><a id="__codelineno-0-1922" name="__codelineno-0-1922"></a><a href="#__codelineno-0-1922"><span class="linenos" data-linenos="1922 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1923"><a id="__codelineno-0-1923" name="__codelineno-0-1923"></a><a href="#__codelineno-0-1923"><span class="linenos" data-linenos="1923 "></span></a>    <span class="k">if</span> <span class="n">lazy_increment</span><span class="o">.</span><span class="n">input</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1924"><a id="__codelineno-0-1924" name="__codelineno-0-1924"></a><a href="#__codelineno-0-1924"><span class="linenos" data-linenos="1924 "></span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1925"><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a><a href="#__codelineno-0-1925"><span class="linenos" data-linenos="1925 "></span></a>
</span><span id="__span-0-1926"><a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><a href="#__codelineno-0-1926"><span class="linenos" data-linenos="1926 "></span></a>    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-1927"><a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><a href="#__codelineno-0-1927"><span class="linenos" data-linenos="1927 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">current_graph</span><span class="p">()</span>
</span><span id="__span-0-1928"><a id="__codelineno-0-1928" name="__codelineno-0-1928"></a><a href="#__codelineno-0-1928"><span class="linenos" data-linenos="1928 "></span></a>    <span class="n">plan</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_feature_plan</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-1929"><a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><a href="#__codelineno-0-1929"><span class="linenos" data-linenos="1929 "></span></a>
</span><span id="__span-0-1930"><a id="__codelineno-0-1930" name="__codelineno-0-1930"></a><a href="#__codelineno-0-1930"><span class="linenos" data-linenos="1930 "></span></a>    <span class="c1"># Get the columns that define input units from the feature plan</span>
</span><span id="__span-0-1931"><a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><a href="#__codelineno-0-1931"><span class="linenos" data-linenos="1931 "></span></a>    <span class="n">input_id_columns</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">input_id_columns</span>
</span><span id="__span-0-1932"><a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><a href="#__codelineno-0-1932"><span class="linenos" data-linenos="1932 "></span></a>
</span><span id="__span-0-1933"><a id="__codelineno-0-1933" name="__codelineno-0-1933"></a><a href="#__codelineno-0-1933"><span class="linenos" data-linenos="1933 "></span></a>    <span class="c1"># Count distinct input units using two separate queries</span>
</span><span id="__span-0-1934"><a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><a href="#__codelineno-0-1934"><span class="linenos" data-linenos="1934 "></span></a>    <span class="c1"># We can&#39;t use concat because input and added may have different schemas</span>
</span><span id="__span-0-1935"><a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><a href="#__codelineno-0-1935"><span class="linenos" data-linenos="1935 "></span></a>    <span class="c1"># (e.g., nullable vs non-nullable columns)</span>
</span><span id="__span-0-1936"><a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><a href="#__codelineno-0-1936"><span class="linenos" data-linenos="1936 "></span></a>    <span class="n">total_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">lazy_increment</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">input_id_columns</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">len</span><span class="p">())</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-1937"><a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><a href="#__codelineno-0-1937"><span class="linenos" data-linenos="1937 "></span></a>
</span><span id="__span-0-1938"><a id="__codelineno-0-1938" name="__codelineno-0-1938"></a><a href="#__codelineno-0-1938"><span class="linenos" data-linenos="1938 "></span></a>    <span class="k">if</span> <span class="n">total_units</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1939"><a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><a href="#__codelineno-0-1939"><span class="linenos" data-linenos="1939 "></span></a>        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No input available from upstream</span>
</span><span id="__span-0-1940"><a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><a href="#__codelineno-0-1940"><span class="linenos" data-linenos="1940 "></span></a>
</span><span id="__span-0-1941"><a id="__codelineno-0-1941" name="__codelineno-0-1941"></a><a href="#__codelineno-0-1941"><span class="linenos" data-linenos="1941 "></span></a>    <span class="n">missing_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">lazy_increment</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">input_id_columns</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">len</span><span class="p">())</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-1942"><a id="__codelineno-0-1942" name="__codelineno-0-1942"></a><a href="#__codelineno-0-1942"><span class="linenos" data-linenos="1942 "></span></a>
</span><span id="__span-0-1943"><a id="__codelineno-0-1943" name="__codelineno-0-1943"></a><a href="#__codelineno-0-1943"><span class="linenos" data-linenos="1943 "></span></a>    <span class="n">processed_units</span> <span class="o">=</span> <span class="n">total_units</span> <span class="o">-</span> <span class="n">missing_units</span>
</span><span id="__span-0-1944"><a id="__codelineno-0-1944" name="__codelineno-0-1944"></a><a href="#__codelineno-0-1944"><span class="linenos" data-linenos="1944 "></span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">processed_units</span> <span class="o">/</span> <span class="n">total_units</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.MetadataStore.copy_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">metaxy.MetadataStore.copy_metadata</span>


<a href="#metaxy.MetadataStore.copy_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">copy_metadata</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">from_store</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a></span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">features</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">global_filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Copy metadata from another store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>from_store</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="#metaxy.MetadataStore">MetadataStore</a></code>)
          ‚Äì
          <div class="doc-md-description">
            <p>Source metadata store to copy from (must be opened for reading)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>features</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-attribute&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-attribute-name&quot;&gt;metaxy.CoercibleToFeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.CoercibleToFeatureKey&lt;/code&gt;)" href="../../types/#metaxy.CoercibleToFeatureKey">CoercibleToFeatureKey</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Features to copy. Can be:</p>
<ul>
<li>
<p><code>None</code>: copies all features from the active graph</p>
</li>
<li>
<p>Sequence of specific features to copy</p>
</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>]] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Dict mapping feature keys (as strings) to sequences of Narwhals filter expressions.
These filters are applied when reading from the source store.
Example: {"feature/key": [nw.col("x") &gt; 10], "other/feature": [...]}</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>global_filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>Sequence of Narwhals filter expressions applied to all features.
These filters are combined with any feature-specific filters from <code>filters</code>.
Example: [nw.col("sample_uid").is_in(["s1", "s2"])]</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_feature_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True (default), include rows from all historical feature versions.
If False, only copy rows with the current feature_version.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>with_sample_history</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          ‚Äì
          <div class="doc-md-description">
            <p>If True, include all historical materializations per sample.
If False (default), deduplicate within <code>id_columns</code> groups by keeping latest.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
          ‚Äì
          <div class="doc-md-description">
            <p>Dict with statistics: {"features_copied": int, "rows_copied": int}</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If source or destination store is not open</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.exceptions.FeatureNotFoundError&lt;/span&gt;" href="../exceptions/#metaxy.metadata_store.exceptions.FeatureNotFoundError">FeatureNotFoundError</a></code>
            ‚Äì
          <div class="doc-md-description">
            <p>If a specified feature doesn't exist in source store</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Examples:</span></p>
    <!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Copy all features</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">with</span> <span class="n">source_store</span><span class="p">,</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span><span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">)</span>
</span></code></pre></div>
<!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Copy specific features</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">with</span> <span class="n">source_store</span><span class="p">,</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">mx</span><span class="o">.</span><span class="n">FeatureKey</span><span class="p">(</span><span class="s2">&quot;my_feature&quot;</span><span class="p">)],</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="p">)</span>
</span></code></pre></div>
<!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Copy with global filters applied to all features</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">with</span> <span class="n">source_store</span><span class="p">,</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="n">global_filters</span><span class="o">=</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">])],</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="p">)</span>
</span></code></pre></div>
<!-- skip next -->
<div class="language-py highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Copy specific features with per-feature filters</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">with</span> <span class="n">source_store</span><span class="p">,</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">):</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="n">features</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>            <span class="n">mx</span><span class="o">.</span><span class="n">FeatureKey</span><span class="p">(</span><span class="s2">&quot;feature_a&quot;</span><span class="p">),</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="n">mx</span><span class="o">.</span><span class="n">FeatureKey</span><span class="p">(</span><span class="s2">&quot;feature_b&quot;</span><span class="p">),</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="p">],</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="n">filters</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>            <span class="s2">&quot;feature_a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;field_a&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">],</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="s2">&quot;feature_b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;field_b&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">],</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="p">},</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="p">)</span>
</span></code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1946"><a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><a href="#__codelineno-0-1946"><span class="linenos" data-linenos="1946 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">copy_metadata</span><span class="p">(</span>
</span><span id="__span-0-1947"><a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><a href="#__codelineno-0-1947"><span class="linenos" data-linenos="1947 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1948"><a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><a href="#__codelineno-0-1948"><span class="linenos" data-linenos="1948 "></span></a>    <span class="n">from_store</span><span class="p">:</span> <span class="n">MetadataStore</span><span class="p">,</span>
</span><span id="__span-0-1949"><a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><a href="#__codelineno-0-1949"><span class="linenos" data-linenos="1949 "></span></a>    <span class="n">features</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">CoercibleToFeatureKey</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1950"><a id="__codelineno-0-1950" name="__codelineno-0-1950"></a><a href="#__codelineno-0-1950"><span class="linenos" data-linenos="1950 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1951"><a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><a href="#__codelineno-0-1951"><span class="linenos" data-linenos="1951 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1952"><a id="__codelineno-0-1952" name="__codelineno-0-1952"></a><a href="#__codelineno-0-1952"><span class="linenos" data-linenos="1952 "></span></a>    <span class="n">global_filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1953"><a id="__codelineno-0-1953" name="__codelineno-0-1953"></a><a href="#__codelineno-0-1953"><span class="linenos" data-linenos="1953 "></span></a>    <span class="n">with_feature_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1954"><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a><a href="#__codelineno-0-1954"><span class="linenos" data-linenos="1954 "></span></a>    <span class="n">with_sample_history</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1955"><a id="__codelineno-0-1955" name="__codelineno-0-1955"></a><a href="#__codelineno-0-1955"><span class="linenos" data-linenos="1955 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-1956"><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><a href="#__codelineno-0-1956"><span class="linenos" data-linenos="1956 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy metadata from another store.</span>
</span><span id="__span-0-1957"><a id="__codelineno-0-1957" name="__codelineno-0-1957"></a><a href="#__codelineno-0-1957"><span class="linenos" data-linenos="1957 "></span></a>
</span><span id="__span-0-1958"><a id="__codelineno-0-1958" name="__codelineno-0-1958"></a><a href="#__codelineno-0-1958"><span class="linenos" data-linenos="1958 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1959"><a id="__codelineno-0-1959" name="__codelineno-0-1959"></a><a href="#__codelineno-0-1959"><span class="linenos" data-linenos="1959 "></span></a><span class="sd">        from_store: Source metadata store to copy from (must be opened for reading)</span>
</span><span id="__span-0-1960"><a id="__codelineno-0-1960" name="__codelineno-0-1960"></a><a href="#__codelineno-0-1960"><span class="linenos" data-linenos="1960 "></span></a><span class="sd">        features: Features to copy. Can be:</span>
</span><span id="__span-0-1961"><a id="__codelineno-0-1961" name="__codelineno-0-1961"></a><a href="#__codelineno-0-1961"><span class="linenos" data-linenos="1961 "></span></a>
</span><span id="__span-0-1962"><a id="__codelineno-0-1962" name="__codelineno-0-1962"></a><a href="#__codelineno-0-1962"><span class="linenos" data-linenos="1962 "></span></a><span class="sd">            - `None`: copies all features from the active graph</span>
</span><span id="__span-0-1963"><a id="__codelineno-0-1963" name="__codelineno-0-1963"></a><a href="#__codelineno-0-1963"><span class="linenos" data-linenos="1963 "></span></a>
</span><span id="__span-0-1964"><a id="__codelineno-0-1964" name="__codelineno-0-1964"></a><a href="#__codelineno-0-1964"><span class="linenos" data-linenos="1964 "></span></a><span class="sd">            - Sequence of specific features to copy</span>
</span><span id="__span-0-1965"><a id="__codelineno-0-1965" name="__codelineno-0-1965"></a><a href="#__codelineno-0-1965"><span class="linenos" data-linenos="1965 "></span></a>
</span><span id="__span-0-1966"><a id="__codelineno-0-1966" name="__codelineno-0-1966"></a><a href="#__codelineno-0-1966"><span class="linenos" data-linenos="1966 "></span></a><span class="sd">        filters: Dict mapping feature keys (as strings) to sequences of Narwhals filter expressions.</span>
</span><span id="__span-0-1967"><a id="__codelineno-0-1967" name="__codelineno-0-1967"></a><a href="#__codelineno-0-1967"><span class="linenos" data-linenos="1967 "></span></a><span class="sd">            These filters are applied when reading from the source store.</span>
</span><span id="__span-0-1968"><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><a href="#__codelineno-0-1968"><span class="linenos" data-linenos="1968 "></span></a><span class="sd">            Example: {&quot;feature/key&quot;: [nw.col(&quot;x&quot;) &gt; 10], &quot;other/feature&quot;: [...]}</span>
</span><span id="__span-0-1969"><a id="__codelineno-0-1969" name="__codelineno-0-1969"></a><a href="#__codelineno-0-1969"><span class="linenos" data-linenos="1969 "></span></a><span class="sd">        global_filters: Sequence of Narwhals filter expressions applied to all features.</span>
</span><span id="__span-0-1970"><a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><a href="#__codelineno-0-1970"><span class="linenos" data-linenos="1970 "></span></a><span class="sd">            These filters are combined with any feature-specific filters from `filters`.</span>
</span><span id="__span-0-1971"><a id="__codelineno-0-1971" name="__codelineno-0-1971"></a><a href="#__codelineno-0-1971"><span class="linenos" data-linenos="1971 "></span></a><span class="sd">            Example: [nw.col(&quot;sample_uid&quot;).is_in([&quot;s1&quot;, &quot;s2&quot;])]</span>
</span><span id="__span-0-1972"><a id="__codelineno-0-1972" name="__codelineno-0-1972"></a><a href="#__codelineno-0-1972"><span class="linenos" data-linenos="1972 "></span></a><span class="sd">        with_feature_history: If True (default), include rows from all historical feature versions.</span>
</span><span id="__span-0-1973"><a id="__codelineno-0-1973" name="__codelineno-0-1973"></a><a href="#__codelineno-0-1973"><span class="linenos" data-linenos="1973 "></span></a><span class="sd">            If False, only copy rows with the current feature_version.</span>
</span><span id="__span-0-1974"><a id="__codelineno-0-1974" name="__codelineno-0-1974"></a><a href="#__codelineno-0-1974"><span class="linenos" data-linenos="1974 "></span></a><span class="sd">        with_sample_history: If True, include all historical materializations per sample.</span>
</span><span id="__span-0-1975"><a id="__codelineno-0-1975" name="__codelineno-0-1975"></a><a href="#__codelineno-0-1975"><span class="linenos" data-linenos="1975 "></span></a><span class="sd">            If False (default), deduplicate within `id_columns` groups by keeping latest.</span>
</span><span id="__span-0-1976"><a id="__codelineno-0-1976" name="__codelineno-0-1976"></a><a href="#__codelineno-0-1976"><span class="linenos" data-linenos="1976 "></span></a>
</span><span id="__span-0-1977"><a id="__codelineno-0-1977" name="__codelineno-0-1977"></a><a href="#__codelineno-0-1977"><span class="linenos" data-linenos="1977 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1978"><a id="__codelineno-0-1978" name="__codelineno-0-1978"></a><a href="#__codelineno-0-1978"><span class="linenos" data-linenos="1978 "></span></a><span class="sd">        Dict with statistics: {&quot;features_copied&quot;: int, &quot;rows_copied&quot;: int}</span>
</span><span id="__span-0-1979"><a id="__codelineno-0-1979" name="__codelineno-0-1979"></a><a href="#__codelineno-0-1979"><span class="linenos" data-linenos="1979 "></span></a>
</span><span id="__span-0-1980"><a id="__codelineno-0-1980" name="__codelineno-0-1980"></a><a href="#__codelineno-0-1980"><span class="linenos" data-linenos="1980 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1981"><a id="__codelineno-0-1981" name="__codelineno-0-1981"></a><a href="#__codelineno-0-1981"><span class="linenos" data-linenos="1981 "></span></a><span class="sd">        ValueError: If source or destination store is not open</span>
</span><span id="__span-0-1982"><a id="__codelineno-0-1982" name="__codelineno-0-1982"></a><a href="#__codelineno-0-1982"><span class="linenos" data-linenos="1982 "></span></a><span class="sd">        FeatureNotFoundError: If a specified feature doesn&#39;t exist in source store</span>
</span><span id="__span-0-1983"><a id="__codelineno-0-1983" name="__codelineno-0-1983"></a><a href="#__codelineno-0-1983"><span class="linenos" data-linenos="1983 "></span></a>
</span><span id="__span-0-1984"><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a><a href="#__codelineno-0-1984"><span class="linenos" data-linenos="1984 "></span></a><span class="sd">    Examples:</span>
</span><span id="__span-0-1985"><a id="__codelineno-0-1985" name="__codelineno-0-1985"></a><a href="#__codelineno-0-1985"><span class="linenos" data-linenos="1985 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-1986"><a id="__codelineno-0-1986" name="__codelineno-0-1986"></a><a href="#__codelineno-0-1986"><span class="linenos" data-linenos="1986 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1987"><a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><a href="#__codelineno-0-1987"><span class="linenos" data-linenos="1987 "></span></a><span class="sd">        # Copy all features</span>
</span><span id="__span-0-1988"><a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><a href="#__codelineno-0-1988"><span class="linenos" data-linenos="1988 "></span></a><span class="sd">        with source_store, dest_store.open(&quot;w&quot;):</span>
</span><span id="__span-0-1989"><a id="__codelineno-0-1989" name="__codelineno-0-1989"></a><a href="#__codelineno-0-1989"><span class="linenos" data-linenos="1989 "></span></a><span class="sd">            stats = dest_store.copy_metadata(from_store=source_store)</span>
</span><span id="__span-0-1990"><a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><a href="#__codelineno-0-1990"><span class="linenos" data-linenos="1990 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1991"><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a><a href="#__codelineno-0-1991"><span class="linenos" data-linenos="1991 "></span></a>
</span><span id="__span-0-1992"><a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><a href="#__codelineno-0-1992"><span class="linenos" data-linenos="1992 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-1993"><a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><a href="#__codelineno-0-1993"><span class="linenos" data-linenos="1993 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1994"><a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><a href="#__codelineno-0-1994"><span class="linenos" data-linenos="1994 "></span></a><span class="sd">        # Copy specific features</span>
</span><span id="__span-0-1995"><a id="__codelineno-0-1995" name="__codelineno-0-1995"></a><a href="#__codelineno-0-1995"><span class="linenos" data-linenos="1995 "></span></a><span class="sd">        with source_store, dest_store.open(&quot;w&quot;):</span>
</span><span id="__span-0-1996"><a id="__codelineno-0-1996" name="__codelineno-0-1996"></a><a href="#__codelineno-0-1996"><span class="linenos" data-linenos="1996 "></span></a><span class="sd">            stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-1997"><a id="__codelineno-0-1997" name="__codelineno-0-1997"></a><a href="#__codelineno-0-1997"><span class="linenos" data-linenos="1997 "></span></a><span class="sd">                from_store=source_store,</span>
</span><span id="__span-0-1998"><a id="__codelineno-0-1998" name="__codelineno-0-1998"></a><a href="#__codelineno-0-1998"><span class="linenos" data-linenos="1998 "></span></a><span class="sd">                features=[mx.FeatureKey(&quot;my_feature&quot;)],</span>
</span><span id="__span-0-1999"><a id="__codelineno-0-1999" name="__codelineno-0-1999"></a><a href="#__codelineno-0-1999"><span class="linenos" data-linenos="1999 "></span></a><span class="sd">            )</span>
</span><span id="__span-0-2000"><a id="__codelineno-0-2000" name="__codelineno-0-2000"></a><a href="#__codelineno-0-2000"><span class="linenos" data-linenos="2000 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-2001"><a id="__codelineno-0-2001" name="__codelineno-0-2001"></a><a href="#__codelineno-0-2001"><span class="linenos" data-linenos="2001 "></span></a>
</span><span id="__span-0-2002"><a id="__codelineno-0-2002" name="__codelineno-0-2002"></a><a href="#__codelineno-0-2002"><span class="linenos" data-linenos="2002 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-2003"><a id="__codelineno-0-2003" name="__codelineno-0-2003"></a><a href="#__codelineno-0-2003"><span class="linenos" data-linenos="2003 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-2004"><a id="__codelineno-0-2004" name="__codelineno-0-2004"></a><a href="#__codelineno-0-2004"><span class="linenos" data-linenos="2004 "></span></a><span class="sd">        # Copy with global filters applied to all features</span>
</span><span id="__span-0-2005"><a id="__codelineno-0-2005" name="__codelineno-0-2005"></a><a href="#__codelineno-0-2005"><span class="linenos" data-linenos="2005 "></span></a><span class="sd">        with source_store, dest_store.open(&quot;w&quot;):</span>
</span><span id="__span-0-2006"><a id="__codelineno-0-2006" name="__codelineno-0-2006"></a><a href="#__codelineno-0-2006"><span class="linenos" data-linenos="2006 "></span></a><span class="sd">            stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-2007"><a id="__codelineno-0-2007" name="__codelineno-0-2007"></a><a href="#__codelineno-0-2007"><span class="linenos" data-linenos="2007 "></span></a><span class="sd">                from_store=source_store,</span>
</span><span id="__span-0-2008"><a id="__codelineno-0-2008" name="__codelineno-0-2008"></a><a href="#__codelineno-0-2008"><span class="linenos" data-linenos="2008 "></span></a><span class="sd">                global_filters=[nw.col(&quot;id&quot;).is_in([&quot;a&quot;, &quot;b&quot;])],</span>
</span><span id="__span-0-2009"><a id="__codelineno-0-2009" name="__codelineno-0-2009"></a><a href="#__codelineno-0-2009"><span class="linenos" data-linenos="2009 "></span></a><span class="sd">            )</span>
</span><span id="__span-0-2010"><a id="__codelineno-0-2010" name="__codelineno-0-2010"></a><a href="#__codelineno-0-2010"><span class="linenos" data-linenos="2010 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-2011"><a id="__codelineno-0-2011" name="__codelineno-0-2011"></a><a href="#__codelineno-0-2011"><span class="linenos" data-linenos="2011 "></span></a>
</span><span id="__span-0-2012"><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a><a href="#__codelineno-0-2012"><span class="linenos" data-linenos="2012 "></span></a><span class="sd">        &lt;!-- skip next --&gt;</span>
</span><span id="__span-0-2013"><a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><a href="#__codelineno-0-2013"><span class="linenos" data-linenos="2013 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-2014"><a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><a href="#__codelineno-0-2014"><span class="linenos" data-linenos="2014 "></span></a><span class="sd">        # Copy specific features with per-feature filters</span>
</span><span id="__span-0-2015"><a id="__codelineno-0-2015" name="__codelineno-0-2015"></a><a href="#__codelineno-0-2015"><span class="linenos" data-linenos="2015 "></span></a><span class="sd">        with source_store, dest_store.open(&quot;w&quot;):</span>
</span><span id="__span-0-2016"><a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><a href="#__codelineno-0-2016"><span class="linenos" data-linenos="2016 "></span></a><span class="sd">            stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-2017"><a id="__codelineno-0-2017" name="__codelineno-0-2017"></a><a href="#__codelineno-0-2017"><span class="linenos" data-linenos="2017 "></span></a><span class="sd">                from_store=source_store,</span>
</span><span id="__span-0-2018"><a id="__codelineno-0-2018" name="__codelineno-0-2018"></a><a href="#__codelineno-0-2018"><span class="linenos" data-linenos="2018 "></span></a><span class="sd">                features=[</span>
</span><span id="__span-0-2019"><a id="__codelineno-0-2019" name="__codelineno-0-2019"></a><a href="#__codelineno-0-2019"><span class="linenos" data-linenos="2019 "></span></a><span class="sd">                    mx.FeatureKey(&quot;feature_a&quot;),</span>
</span><span id="__span-0-2020"><a id="__codelineno-0-2020" name="__codelineno-0-2020"></a><a href="#__codelineno-0-2020"><span class="linenos" data-linenos="2020 "></span></a><span class="sd">                    mx.FeatureKey(&quot;feature_b&quot;),</span>
</span><span id="__span-0-2021"><a id="__codelineno-0-2021" name="__codelineno-0-2021"></a><a href="#__codelineno-0-2021"><span class="linenos" data-linenos="2021 "></span></a><span class="sd">                ],</span>
</span><span id="__span-0-2022"><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a><a href="#__codelineno-0-2022"><span class="linenos" data-linenos="2022 "></span></a><span class="sd">                filters={</span>
</span><span id="__span-0-2023"><a id="__codelineno-0-2023" name="__codelineno-0-2023"></a><a href="#__codelineno-0-2023"><span class="linenos" data-linenos="2023 "></span></a><span class="sd">                    &quot;feature_a&quot;: [nw.col(&quot;field_a&quot;) &gt; 10],</span>
</span><span id="__span-0-2024"><a id="__codelineno-0-2024" name="__codelineno-0-2024"></a><a href="#__codelineno-0-2024"><span class="linenos" data-linenos="2024 "></span></a><span class="sd">                    &quot;feature_b&quot;: [nw.col(&quot;field_b&quot;) &lt; 30],</span>
</span><span id="__span-0-2025"><a id="__codelineno-0-2025" name="__codelineno-0-2025"></a><a href="#__codelineno-0-2025"><span class="linenos" data-linenos="2025 "></span></a><span class="sd">                },</span>
</span><span id="__span-0-2026"><a id="__codelineno-0-2026" name="__codelineno-0-2026"></a><a href="#__codelineno-0-2026"><span class="linenos" data-linenos="2026 "></span></a><span class="sd">            )</span>
</span><span id="__span-0-2027"><a id="__codelineno-0-2027" name="__codelineno-0-2027"></a><a href="#__codelineno-0-2027"><span class="linenos" data-linenos="2027 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-2028"><a id="__codelineno-0-2028" name="__codelineno-0-2028"></a><a href="#__codelineno-0-2028"><span class="linenos" data-linenos="2028 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2029"><a id="__codelineno-0-2029" name="__codelineno-0-2029"></a><a href="#__codelineno-0-2029"><span class="linenos" data-linenos="2029 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-0-2030"><a id="__codelineno-0-2030" name="__codelineno-0-2030"></a><a href="#__codelineno-0-2030"><span class="linenos" data-linenos="2030 "></span></a>
</span><span id="__span-0-2031"><a id="__codelineno-0-2031" name="__codelineno-0-2031"></a><a href="#__codelineno-0-2031"><span class="linenos" data-linenos="2031 "></span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-2032"><a id="__codelineno-0-2032" name="__codelineno-0-2032"></a><a href="#__codelineno-0-2032"><span class="linenos" data-linenos="2032 "></span></a>
</span><span id="__span-0-2033"><a id="__codelineno-0-2033" name="__codelineno-0-2033"></a><a href="#__codelineno-0-2033"><span class="linenos" data-linenos="2033 "></span></a>    <span class="c1"># Validate both stores are open</span>
</span><span id="__span-0-2034"><a id="__codelineno-0-2034" name="__codelineno-0-2034"></a><a href="#__codelineno-0-2034"><span class="linenos" data-linenos="2034 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span><span class="p">:</span>
</span><span id="__span-0-2035"><a id="__codelineno-0-2035" name="__codelineno-0-2035"></a><a href="#__codelineno-0-2035"><span class="linenos" data-linenos="2035 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Destination store must be opened with store.open(&quot;w&quot;) before use&#39;</span><span class="p">)</span>
</span><span id="__span-0-2036"><a id="__codelineno-0-2036" name="__codelineno-0-2036"></a><a href="#__codelineno-0-2036"><span class="linenos" data-linenos="2036 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">from_store</span><span class="o">.</span><span class="n">_is_open</span><span class="p">:</span>
</span><span id="__span-0-2037"><a id="__codelineno-0-2037" name="__codelineno-0-2037"></a><a href="#__codelineno-0-2037"><span class="linenos" data-linenos="2037 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Source store must be opened with store before use&quot;</span><span class="p">)</span>
</span><span id="__span-0-2038"><a id="__codelineno-0-2038" name="__codelineno-0-2038"></a><a href="#__codelineno-0-2038"><span class="linenos" data-linenos="2038 "></span></a>
</span><span id="__span-0-2039"><a id="__codelineno-0-2039" name="__codelineno-0-2039"></a><a href="#__codelineno-0-2039"><span class="linenos" data-linenos="2039 "></span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_metadata_impl</span><span class="p">(</span>
</span><span id="__span-0-2040"><a id="__codelineno-0-2040" name="__codelineno-0-2040"></a><a href="#__codelineno-0-2040"><span class="linenos" data-linenos="2040 "></span></a>        <span class="n">from_store</span><span class="o">=</span><span class="n">from_store</span><span class="p">,</span>
</span><span id="__span-0-2041"><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a><a href="#__codelineno-0-2041"><span class="linenos" data-linenos="2041 "></span></a>        <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-2042"><a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><a href="#__codelineno-0-2042"><span class="linenos" data-linenos="2042 "></span></a>        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
</span><span id="__span-0-2043"><a id="__codelineno-0-2043" name="__codelineno-0-2043"></a><a href="#__codelineno-0-2043"><span class="linenos" data-linenos="2043 "></span></a>        <span class="n">global_filters</span><span class="o">=</span><span class="n">global_filters</span><span class="p">,</span>
</span><span id="__span-0-2044"><a id="__codelineno-0-2044" name="__codelineno-0-2044"></a><a href="#__codelineno-0-2044"><span class="linenos" data-linenos="2044 "></span></a>        <span class="n">with_feature_history</span><span class="o">=</span><span class="n">with_feature_history</span><span class="p">,</span>
</span><span id="__span-0-2045"><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><a href="#__codelineno-0-2045"><span class="linenos" data-linenos="2045 "></span></a>        <span class="n">with_sample_history</span><span class="o">=</span><span class="n">with_sample_history</span><span class="p">,</span>
</span><span id="__span-0-2046"><a id="__codelineno-0-2046" name="__codelineno-0-2046"></a><a href="#__codelineno-0-2046"><span class="linenos" data-linenos="2046 "></span></a>        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
</span><span id="__span-0-2047"><a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><a href="#__codelineno-0-2047"><span class="linenos" data-linenos="2047 "></span></a>    <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="metaxy.metadata_store.types.AccessMode" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metaxy.metadata_store.types.AccessMode</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#metaxy.metadata_store.types.AccessMode" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">AccessMode</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="metaxy.metadata_store.base.VersioningEngineOptions" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">metaxy.metadata_store.base.VersioningEngineOptions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#metaxy.metadata_store.base.VersioningEngineOptions" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">VersioningEngineOptions</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.TypeAlias&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.TypeAlias">TypeAlias</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;native&quot;</span><span class="p">,</span> <span class="s2">&quot;polars&quot;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents first">

    </div>

</div><hr />
<h2 id="base-configuration-class">Base Configuration Class<a class="headerlink" href="#base-configuration-class" title="Permanent link">&para;</a></h2>
<p>The following base configuration class is typically used by child metadata stores:</p>


<div class="doc doc-object doc-class">



<h2 id="metaxy.metadata_store.base.MetadataStoreConfig" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">metaxy.metadata_store.base.MetadataStoreConfig</span>


<a href="#metaxy.metadata_store.base.MetadataStoreConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="&lt;code&gt;pydantic_settings.BaseSettings&lt;/code&gt;" href="https://docs.pydantic.dev/latest/api/pydantic_settings/#pydantic_settings.BaseSettings">BaseSettings</a></code></p>



        <p>Base configuration class for metadata stores.</p>
<p>This class defines common configuration fields shared by all metadata store types.
Store-specific config classes should inherit from this and add their own fields.</p>


<details class="example" open>
  <summary>Example</summary>
  <!-- skip next -->
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.ext.metadata_stores.duckdb</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBMetadataStoreConfig</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">DuckDBMetadataStoreConfig</span><span class="p">(</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;metadata.db&quot;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="n">hash_algorithm</span><span class="o">=</span><span class="n">HashAlgorithm</span><span class="o">.</span><span class="n">MD5</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">store</span> <span class="o">=</span> <span class="n">DuckDBMetadataStore</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></code></pre></div>
</details>










<div class="doc doc-children">












  </div>

    </div>

</div><hr />
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The base <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;metaxy.metadata_store.base.MetadataStoreConfig&lt;/span&gt;" href="#metaxy.metadata_store.base.MetadataStoreConfig"><code>MetadataStoreConfig</code></a> class injects the following configuration options:</p>
<h3 id="fallback_stores"><code>fallback_stores</code><a class="headerlink" href="#fallback_stores" title="Permanent link">&para;</a></h3>
<p>List of fallback store names to search when features are not found in the current store.</p>
<p><strong>Type:</strong> <code>list[str]</code></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="fallback_stores-metaxytoml" name="__tabbed_1" type="radio" /><input id="fallback_stores-pyprojecttoml" name="__tabbed_1" type="radio" /><input id="fallback_stores-environment-variable" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="fallback_stores-metaxytoml">metaxy.toml</label><label for="fallback_stores-pyprojecttoml">pyproject.toml</label><label for="fallback_stores-environment-variable">Environment Variable</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">[stores.dev.config]</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="c1"># Optional</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1"># fallback_stores = []</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">[tool.metaxy.stores.dev.config]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># Optional</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># fallback_stores = []</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">METAXY_STORES__DEV__CONFIG__FALLBACK_STORES</span><span class="o">=</span>...
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="hash_algorithm"><code>hash_algorithm</code><a class="headerlink" href="#hash_algorithm" title="Permanent link">&para;</a></h3>
<p>Hash algorithm for versioning. If None, uses store's default.</p>
<p><strong>Type:</strong> <code>metaxy.versioning.types.HashAlgorithm | None</code></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="hash_algorithm-metaxytoml" name="__tabbed_2" type="radio" /><input id="hash_algorithm-pyprojecttoml" name="__tabbed_2" type="radio" /><input id="hash_algorithm-environment-variable" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="hash_algorithm-metaxytoml">metaxy.toml</label><label for="hash_algorithm-pyprojecttoml">pyproject.toml</label><label for="hash_algorithm-environment-variable">Environment Variable</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">[stores.dev.config]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># Optional</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># hash_algorithm = null</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">[tool.metaxy.stores.dev.config]</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># Optional</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># hash_algorithm = null</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">METAXY_STORES__DEV__CONFIG__HASH_ALGORITHM</span><span class="o">=</span>...
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h3 id="versioning_engine"><code>versioning_engine</code><a class="headerlink" href="#versioning_engine" title="Permanent link">&para;</a></h3>
<p>Which versioning engine to use: 'auto' (prefer native), 'native', or 'polars'.</p>
<p><strong>Type:</strong> <code>Literal['auto', 'native', 'polars']</code> | <strong>Default:</strong> <code>"auto"</code></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="versioning_engine-metaxytoml" name="__tabbed_3" type="radio" /><input id="versioning_engine-pyprojecttoml" name="__tabbed_3" type="radio" /><input id="versioning_engine-environment-variable" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="versioning_engine-metaxytoml">metaxy.toml</label><label for="versioning_engine-pyprojecttoml">pyproject.toml</label><label for="versioning_engine-environment-variable">Environment Variable</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">[stores.dev.config]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">versioning_engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;auto&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-toml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">[tool.metaxy.stores.dev.config]</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">versioning_engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;auto&quot;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">METAXY_STORES__DEV__CONFIG__VERSIONING_ENGINE</span><span class="o">=</span>auto
</span></code></pre></div>
</div>
</div>
</div>
<hr />







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/anam-org/metaxy" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../../../javascripts/telemetry.js"></script>
      
        <script src="../../../../javascripts/glossary-tooltips.js"></script>
      
    
  </body>
</html>