
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Metadata layer for multi-modal ML pipelines">
      
      
      
        <link rel="canonical" href="https://anam-org.github.io/metaxy/main/reference/api/metadata-stores/memory/">
      
      
        <link rel="prev" href="../ibis/clickhouse/">
      
      
        <link rel="next" href="../../config/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Memory - Metaxy</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/code_select.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#base-metadata-store" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Metaxy" class="md-header__button md-logo" aria-label="Metaxy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metaxy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Memory
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/anam-org/metaxy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anam-org/metaxy
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../learn/metadata-stores/" class="md-tabs__link">
          
  
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../examples/one-to-many/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  API

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../configuration/" class="md-tabs__link">
        
  
  
    
  
  Configuration

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Metaxy" class="md-nav__button md-logo" aria-label="Metaxy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Metaxy
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/anam-org/metaxy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anam-org/metaxy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/metadata-stores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadata Stores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/feature-definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/data-versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Versioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/feature-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/syntactic-sugar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Syntactic Sugar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/relationship/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lineage Relationship
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/system-columns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Columns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../learn/integrations/sqlmodel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SQLModel
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/one-to-many/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    One To Many
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../definitions/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Definitions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/feature-spec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Spec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/field/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Field
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/fields-mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fields Mapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/relationship/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lineage Relationship
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../definitions/graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graph
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Metadata Stores
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Metadata Stores
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../ibis/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Databases
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            Databases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ibis/duckdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DuckDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ibis/clickhouse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClickHouse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Memory
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Memory
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;InMemoryMetadataStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" InMemoryMetadataStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.validate_hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate_hash_algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.allow_cross_project_writes" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;allow_cross_project_writes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.write_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.drop_feature_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;drop_feature_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.record_feature_graph_snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;record_feature_graph_snapshot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.has_feature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;has_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_graph_snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_graph_snapshots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_features" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.copy_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;copy_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_upstream_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_upstream_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.resolve_update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.native_implementation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;native_implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_metadata_in_store" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_metadata_in_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.clear" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.open" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.close" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.display" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;display
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constants
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;InMemoryMetadataStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" InMemoryMetadataStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__enter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__exit__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.validate_hash_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;validate_hash_algorithm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.allow_cross_project_writes" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;allow_cross_project_writes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.write_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;write_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.drop_feature_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;drop_feature_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.record_feature_graph_snapshot" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;record_feature_graph_snapshot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.has_feature" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;has_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_graph_snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_graph_snapshots
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_features" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.copy_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;copy_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_upstream_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_upstream_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.resolve_update" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;resolve_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.native_implementation" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;native_implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.read_metadata_in_store" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_metadata_in_store
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.clear" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.open" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.close" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metaxy.InMemoryMetadataStore.display" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;display
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="base-metadata-store">Base Metadata Store<a class="headerlink" href="#base-metadata-store" title="Permanent link">&para;</a></h1>
<p>This one is mostly useful for testing.</p>


<div class="doc doc-object doc-class">



<h2 id="metaxy.InMemoryMetadataStore" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">InMemoryMetadataStore</span>


<a href="#metaxy.InMemoryMetadataStore" class="headerlink" title="Permanent link">&para;</a></h2>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">InMemoryMetadataStore</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="../#metaxy.MetadataStore">MetadataStore</a></code></p>


        <p>In-memory metadata store using dict-based storage.</p>
<p>Features:
- Simple dict storage: {FeatureKey: pl.DataFrame}
- Fast for testing and prototyping
- No persistence (data lost when process exits)
- Schema validation on write
- Uses Polars components for all operations</p>
<p>Limitations:
- Not suitable for production
- Data lost on process exit
- No concurrency support across processes
- Memory-bound (all data in RAM)</p>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Uses Narwhals LazyFrames (nw.LazyFrame) for all operations</p>
</details>

<details class="components" open>
  <summary>Components</summary>
  <p>Components are created on-demand in resolve_update().
Uses Polars internally but exposes Narwhals interface.
Only supports Polars components (no native backend).</p>
</details>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>**kwargs</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Passed to MetadataStore.<strong>init</strong> (e.g., fallback_stores, hash_algorithm)</p>
          </div>
        </li>
    </ul>








                  <details class="quote">
                    <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
                    <div class="language-python highlight"><pre><span></span><code><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><a href="#__codelineno-0-46"><span class="linenos" data-linenos="46 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><a href="#__codelineno-0-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><a href="#__codelineno-0-48"><span class="linenos" data-linenos="48 "></span></a><span class="sd">    Initialize in-memory store.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><a href="#__codelineno-0-49"><span class="linenos" data-linenos="49 "></span></a>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><a href="#__codelineno-0-50"><span class="linenos" data-linenos="50 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><a href="#__codelineno-0-51"><span class="linenos" data-linenos="51 "></span></a><span class="sd">        **kwargs: Passed to MetadataStore.__init__ (e.g., fallback_stores, hash_algorithm)</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><a href="#__codelineno-0-52"><span class="linenos" data-linenos="52 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><a href="#__codelineno-0-53"><span class="linenos" data-linenos="53 "></span></a>    <span class="c1"># Use tuple as key (hashable) instead of string to avoid parsing issues</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><a href="#__codelineno-0-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><a href="#__codelineno-0-55"><span class="linenos" data-linenos="55 "></span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></code></pre></div>
                  </details>



  <div class="doc doc-children">








<h3 id="metaxy.InMemoryMetadataStore-functions">Functions<a href="#metaxy.InMemoryMetadataStore-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.__enter__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__enter__</span>


<a href="#metaxy.InMemoryMetadataStore.__enter__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__enter__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="typing_extensions.Self">Self</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Enter context manager.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><a href="#__codelineno-0-218"><span class="linenos" data-linenos="218 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><a href="#__codelineno-0-219"><span class="linenos" data-linenos="219 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Enter context manager.&quot;&quot;&quot;</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><a href="#__codelineno-0-220"><span class="linenos" data-linenos="220 "></span></a>    <span class="c1"># Track nesting depth</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><a href="#__codelineno-0-221"><span class="linenos" data-linenos="221 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_context_depth</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><a href="#__codelineno-0-222"><span class="linenos" data-linenos="222 "></span></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><a href="#__codelineno-0-223"><span class="linenos" data-linenos="223 "></span></a>    <span class="c1"># Only open on first enter</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><a href="#__codelineno-0-224"><span class="linenos" data-linenos="224 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_depth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a><a href="#__codelineno-0-225"><span class="linenos" data-linenos="225 "></span></a>        <span class="c1"># Warn if auto_create_tables is enabled (and store wants warnings)</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><a href="#__codelineno-0-226"><span class="linenos" data-linenos="226 "></span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_create_tables</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_warn_auto_create_tables</span><span class="p">:</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><a href="#__codelineno-0-227"><span class="linenos" data-linenos="227 "></span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><a href="#__codelineno-0-228"><span class="linenos" data-linenos="228 "></span></a>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a><a href="#__codelineno-0-229"><span class="linenos" data-linenos="229 "></span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><a href="#__codelineno-0-230"><span class="linenos" data-linenos="230 "></span></a>                <span class="sa">f</span><span class="s2">&quot;AUTO_CREATE_TABLES is enabled for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><a href="#__codelineno-0-231"><span class="linenos" data-linenos="231 "></span></a>                <span class="s2">&quot;do not use in production! &quot;</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><a href="#__codelineno-0-232"><span class="linenos" data-linenos="232 "></span></a>                <span class="s2">&quot;Use proper database migration tools like Alembic for production deployments.&quot;</span><span class="p">,</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><a href="#__codelineno-0-233"><span class="linenos" data-linenos="233 "></span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><a href="#__codelineno-0-234"><span class="linenos" data-linenos="234 "></span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># stacklevel=3 to point to user&#39;s &#39;with store:&#39; line</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><a href="#__codelineno-0-235"><span class="linenos" data-linenos="235 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><a href="#__codelineno-0-236"><span class="linenos" data-linenos="236 "></span></a>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><a href="#__codelineno-0-237"><span class="linenos" data-linenos="237 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><a href="#__codelineno-0-238"><span class="linenos" data-linenos="238 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><a href="#__codelineno-0-239"><span class="linenos" data-linenos="239 "></span></a>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><a href="#__codelineno-0-240"><span class="linenos" data-linenos="240 "></span></a>        <span class="c1"># Validate after opening (when all components are ready)</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><a href="#__codelineno-0-241"><span class="linenos" data-linenos="241 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_after_open</span><span class="p">()</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><a href="#__codelineno-0-242"><span class="linenos" data-linenos="242 "></span></a>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><a href="#__codelineno-0-243"><span class="linenos" data-linenos="243 "></span></a>    <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.__exit__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__exit__</span>


<a href="#metaxy.InMemoryMetadataStore.__exit__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Exit context manager.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a><a href="#__codelineno-0-273"><span class="linenos" data-linenos="273 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a><a href="#__codelineno-0-274"><span class="linenos" data-linenos="274 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit context manager.&quot;&quot;&quot;</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a><a href="#__codelineno-0-275"><span class="linenos" data-linenos="275 "></span></a>    <span class="c1"># Decrement depth</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a><a href="#__codelineno-0-276"><span class="linenos" data-linenos="276 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_context_depth</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><a href="#__codelineno-0-277"><span class="linenos" data-linenos="277 "></span></a>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a><a href="#__codelineno-0-278"><span class="linenos" data-linenos="278 "></span></a>    <span class="c1"># Only close when fully exited</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><a href="#__codelineno-0-279"><span class="linenos" data-linenos="279 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><a href="#__codelineno-0-280"><span class="linenos" data-linenos="280 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><a href="#__codelineno-0-281"><span class="linenos" data-linenos="281 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.validate_hash_algorithm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">validate_hash_algorithm</span>


<a href="#metaxy.InMemoryMetadataStore.validate_hash_algorithm" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate_hash_algorithm</span><span class="p">(</span><span class="n">check_fallback_stores</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate that hash algorithm is supported by this store's components.</p>
<p>Public method - can be called to verify hash compatibility.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>check_fallback_stores</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True, also validate hash is supported by
fallback stores (ensures compatibility for future cross-store operations)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If hash algorithm not supported by components or fallback stores</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><a href="#__codelineno-0-297"><span class="linenos" data-linenos="297 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_hash_algorithm</span><span class="p">(</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><a href="#__codelineno-0-298"><span class="linenos" data-linenos="298 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><a href="#__codelineno-0-299"><span class="linenos" data-linenos="299 "></span></a>    <span class="n">check_fallback_stores</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><a href="#__codelineno-0-300"><span class="linenos" data-linenos="300 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><a href="#__codelineno-0-301"><span class="linenos" data-linenos="301 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that hash algorithm is supported by this store&#39;s components.</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><a href="#__codelineno-0-302"><span class="linenos" data-linenos="302 "></span></a>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a><a href="#__codelineno-0-303"><span class="linenos" data-linenos="303 "></span></a><span class="sd">    Public method - can be called to verify hash compatibility.</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><a href="#__codelineno-0-304"><span class="linenos" data-linenos="304 "></span></a>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><a href="#__codelineno-0-305"><span class="linenos" data-linenos="305 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><a href="#__codelineno-0-306"><span class="linenos" data-linenos="306 "></span></a><span class="sd">        check_fallback_stores: If True, also validate hash is supported by</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><a href="#__codelineno-0-307"><span class="linenos" data-linenos="307 "></span></a><span class="sd">            fallback stores (ensures compatibility for future cross-store operations)</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><a href="#__codelineno-0-308"><span class="linenos" data-linenos="308 "></span></a>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a><a href="#__codelineno-0-309"><span class="linenos" data-linenos="309 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><a href="#__codelineno-0-310"><span class="linenos" data-linenos="310 "></span></a><span class="sd">        ValueError: If hash algorithm not supported by components or fallback stores</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><a href="#__codelineno-0-311"><span class="linenos" data-linenos="311 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><a href="#__codelineno-0-312"><span class="linenos" data-linenos="312 "></span></a>    <span class="c1"># Validate hash algorithm support without creating a full tracker</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><a href="#__codelineno-0-313"><span class="linenos" data-linenos="313 "></span></a>    <span class="c1"># (tracker creation requires a graph which isn&#39;t available during store init)</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><a href="#__codelineno-0-314"><span class="linenos" data-linenos="314 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_hash_algorithm_support</span><span class="p">()</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a><a href="#__codelineno-0-315"><span class="linenos" data-linenos="315 "></span></a>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a><a href="#__codelineno-0-316"><span class="linenos" data-linenos="316 "></span></a>    <span class="c1"># Check fallback stores</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a><a href="#__codelineno-0-317"><span class="linenos" data-linenos="317 "></span></a>    <span class="k">if</span> <span class="n">check_fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a><a href="#__codelineno-0-318"><span class="linenos" data-linenos="318 "></span></a>        <span class="k">for</span> <span class="n">fallback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a><a href="#__codelineno-0-319"><span class="linenos" data-linenos="319 "></span></a>            <span class="n">fallback</span><span class="o">.</span><span class="n">validate_hash_algorithm</span><span class="p">(</span><span class="n">check_fallback_stores</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.allow_cross_project_writes" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">allow_cross_project_writes</span>


<a href="#metaxy.InMemoryMetadataStore.allow_cross_project_writes" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">allow_cross_project_writes</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Iterator&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator">Iterator</a></span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager to temporarily allow cross-project writes.</p>
<p>This is an escape hatch for legitimate cross-project operations like migrations,
where metadata needs to be written to features from different projects.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># During migration, allow writing to features from different projects</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">with</span> <span class="n">store</span><span class="o">.</span><span class="n">allow_cross_project_writes</span><span class="p">():</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">store</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">feature_from_project_a</span><span class="p">,</span> <span class="n">metadata_a</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">store</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">feature_from_project_b</span><span class="p">,</span> <span class="n">metadata_b</span><span class="p">)</span>
</span></code></pre></div>
</details>

<p><span class="doc-section-title">Yields:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>None</code></b> (              <code>None</code>
)          –
          <div class="doc-md-description">
            <p>The context manager temporarily disables project validation</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><a href="#__codelineno-0-361"><span class="linenos" data-linenos="361 "></span></a><span class="nd">@contextmanager</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><a href="#__codelineno-0-362"><span class="linenos" data-linenos="362 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">allow_cross_project_writes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><a href="#__codelineno-0-363"><span class="linenos" data-linenos="363 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager to temporarily allow cross-project writes.</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><a href="#__codelineno-0-364"><span class="linenos" data-linenos="364 "></span></a>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><a href="#__codelineno-0-365"><span class="linenos" data-linenos="365 "></span></a><span class="sd">    This is an escape hatch for legitimate cross-project operations like migrations,</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><a href="#__codelineno-0-366"><span class="linenos" data-linenos="366 "></span></a><span class="sd">    where metadata needs to be written to features from different projects.</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a><a href="#__codelineno-0-367"><span class="linenos" data-linenos="367 "></span></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a><a href="#__codelineno-0-368"><span class="linenos" data-linenos="368 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a><a href="#__codelineno-0-369"><span class="linenos" data-linenos="369 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a><a href="#__codelineno-0-370"><span class="linenos" data-linenos="370 "></span></a><span class="sd">        # During migration, allow writing to features from different projects</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a><a href="#__codelineno-0-371"><span class="linenos" data-linenos="371 "></span></a><span class="sd">        with store.allow_cross_project_writes():</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a><a href="#__codelineno-0-372"><span class="linenos" data-linenos="372 "></span></a><span class="sd">            store.write_metadata(feature_from_project_a, metadata_a)</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a><a href="#__codelineno-0-373"><span class="linenos" data-linenos="373 "></span></a><span class="sd">            store.write_metadata(feature_from_project_b, metadata_b)</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a><a href="#__codelineno-0-374"><span class="linenos" data-linenos="374 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a><a href="#__codelineno-0-375"><span class="linenos" data-linenos="375 "></span></a>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a><a href="#__codelineno-0-376"><span class="linenos" data-linenos="376 "></span></a><span class="sd">    Yields:</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a><a href="#__codelineno-0-377"><span class="linenos" data-linenos="377 "></span></a><span class="sd">        None: The context manager temporarily disables project validation</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a><a href="#__codelineno-0-378"><span class="linenos" data-linenos="378 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a><a href="#__codelineno-0-379"><span class="linenos" data-linenos="379 "></span></a>    <span class="n">previous_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_cross_project_writes</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a><a href="#__codelineno-0-380"><span class="linenos" data-linenos="380 "></span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a><a href="#__codelineno-0-381"><span class="linenos" data-linenos="381 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_cross_project_writes</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a><a href="#__codelineno-0-382"><span class="linenos" data-linenos="382 "></span></a>        <span class="k">yield</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a><a href="#__codelineno-0-383"><span class="linenos" data-linenos="383 "></span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><a href="#__codelineno-0-384"><span class="linenos" data-linenos="384 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_cross_project_writes</span> <span class="o">=</span> <span class="n">previous_value</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.write_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">write_metadata</span>


<a href="#metaxy.InMemoryMetadataStore.write_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">write_metadata</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="n">df</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="polars.DataFrame">DataFrame</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Write metadata for a feature (immutable, append-only).</p>
<p>Automatically adds the canonical system columns (<code>metaxy_feature_version</code>,
<code>metaxy_snapshot_version</code>) unless they already exist in the DataFrame
(useful for migrations).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature to write metadata for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>df</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>] | <span title="polars.DataFrame">DataFrame</span></code>)
          –
          <div class="doc-md-description">
            <p>Narwhals DataFrame or Polars DataFrame containing metadata.
Must have <code>metaxy_provenance_by_field</code> column of type Struct with fields matching feature's fields.
May optionally contain <code>metaxy_feature_version</code> and <code>metaxy_snapshot_version</code> (for migrations).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.MetadataSchemaError">MetadataSchemaError</span></code>
            –
          <div class="doc-md-description">
            <p>If DataFrame schema is invalid</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</span></code>
            –
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If writing to a feature from a different project than expected</p>
          </div>
        </li>
    </ul>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Always writes to current store, never to fallback stores.</li>
<li>If df already contains the metaxy-managed columns, they will be used
  as-is (no replacement). This allows migrations to write historical
  versions. A warning is issued unless suppressed via context manager.</li>
<li>Project validation is performed unless disabled via allow_cross_project_writes()</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><a href="#__codelineno-0-445"><span class="linenos" data-linenos="445 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">write_metadata</span><span class="p">(</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a><a href="#__codelineno-0-446"><span class="linenos" data-linenos="446 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><a href="#__codelineno-0-447"><span class="linenos" data-linenos="447 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a><a href="#__codelineno-0-448"><span class="linenos" data-linenos="448 "></span></a>    <span class="n">df</span><span class="p">:</span> <span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><a href="#__codelineno-0-449"><span class="linenos" data-linenos="449 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a><a href="#__codelineno-0-450"><span class="linenos" data-linenos="450 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><a href="#__codelineno-0-451"><span class="linenos" data-linenos="451 "></span></a><span class="sd">    Write metadata for a feature (immutable, append-only).</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a><a href="#__codelineno-0-452"><span class="linenos" data-linenos="452 "></span></a>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><a href="#__codelineno-0-453"><span class="linenos" data-linenos="453 "></span></a><span class="sd">    Automatically adds the canonical system columns (`metaxy_feature_version`,</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><a href="#__codelineno-0-454"><span class="linenos" data-linenos="454 "></span></a><span class="sd">    `metaxy_snapshot_version`) unless they already exist in the DataFrame</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><a href="#__codelineno-0-455"><span class="linenos" data-linenos="455 "></span></a><span class="sd">    (useful for migrations).</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a><a href="#__codelineno-0-456"><span class="linenos" data-linenos="456 "></span></a>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a><a href="#__codelineno-0-457"><span class="linenos" data-linenos="457 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a><a href="#__codelineno-0-458"><span class="linenos" data-linenos="458 "></span></a><span class="sd">        feature: Feature to write metadata for</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a><a href="#__codelineno-0-459"><span class="linenos" data-linenos="459 "></span></a><span class="sd">        df: Narwhals DataFrame or Polars DataFrame containing metadata.</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a><a href="#__codelineno-0-460"><span class="linenos" data-linenos="460 "></span></a><span class="sd">            Must have `metaxy_provenance_by_field` column of type Struct with fields matching feature&#39;s fields.</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a><a href="#__codelineno-0-461"><span class="linenos" data-linenos="461 "></span></a><span class="sd">            May optionally contain `metaxy_feature_version` and `metaxy_snapshot_version` (for migrations).</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a><a href="#__codelineno-0-462"><span class="linenos" data-linenos="462 "></span></a>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a><a href="#__codelineno-0-463"><span class="linenos" data-linenos="463 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a><a href="#__codelineno-0-464"><span class="linenos" data-linenos="464 "></span></a><span class="sd">        MetadataSchemaError: If DataFrame schema is invalid</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a><a href="#__codelineno-0-465"><span class="linenos" data-linenos="465 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a><a href="#__codelineno-0-466"><span class="linenos" data-linenos="466 "></span></a><span class="sd">        ValueError: If writing to a feature from a different project than expected</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a><a href="#__codelineno-0-467"><span class="linenos" data-linenos="467 "></span></a>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a><a href="#__codelineno-0-468"><span class="linenos" data-linenos="468 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a><a href="#__codelineno-0-469"><span class="linenos" data-linenos="469 "></span></a><span class="sd">        - Always writes to current store, never to fallback stores.</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a><a href="#__codelineno-0-470"><span class="linenos" data-linenos="470 "></span></a><span class="sd">        - If df already contains the metaxy-managed columns, they will be used</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a><a href="#__codelineno-0-471"><span class="linenos" data-linenos="471 "></span></a><span class="sd">          as-is (no replacement). This allows migrations to write historical</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a><a href="#__codelineno-0-472"><span class="linenos" data-linenos="472 "></span></a><span class="sd">          versions. A warning is issued unless suppressed via context manager.</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a><a href="#__codelineno-0-473"><span class="linenos" data-linenos="473 "></span></a><span class="sd">        - Project validation is performed unless disabled via allow_cross_project_writes()</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a><a href="#__codelineno-0-474"><span class="linenos" data-linenos="474 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><a href="#__codelineno-0-475"><span class="linenos" data-linenos="475 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><a href="#__codelineno-0-476"><span class="linenos" data-linenos="476 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a><a href="#__codelineno-0-477"><span class="linenos" data-linenos="477 "></span></a>    <span class="n">is_system_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a><a href="#__codelineno-0-478"><span class="linenos" data-linenos="478 "></span></a>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><a href="#__codelineno-0-479"><span class="linenos" data-linenos="479 "></span></a>    <span class="c1"># Validate project for non-system tables</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><a href="#__codelineno-0-480"><span class="linenos" data-linenos="480 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><a href="#__codelineno-0-481"><span class="linenos" data-linenos="481 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_project_write</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><a href="#__codelineno-0-482"><span class="linenos" data-linenos="482 "></span></a>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a><a href="#__codelineno-0-483"><span class="linenos" data-linenos="483 "></span></a>    <span class="c1"># Convert Narwhals to Polars if needed</span>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><a href="#__codelineno-0-484"><span class="linenos" data-linenos="484 "></span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><a href="#__codelineno-0-485"><span class="linenos" data-linenos="485 "></span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><a href="#__codelineno-0-486"><span class="linenos" data-linenos="486 "></span></a>    <span class="c1"># nw.DataFrame also matches as DataFrame in some contexts, ensure it&#39;s Polars</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><a href="#__codelineno-0-487"><span class="linenos" data-linenos="487 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><a href="#__codelineno-0-488"><span class="linenos" data-linenos="488 "></span></a>        <span class="c1"># Must be some other type - shouldn&#39;t happen but handle defensively</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a><a href="#__codelineno-0-489"><span class="linenos" data-linenos="489 "></span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;to_polars&quot;</span><span class="p">):</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><a href="#__codelineno-0-490"><span class="linenos" data-linenos="490 "></span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><a href="#__codelineno-0-491"><span class="linenos" data-linenos="491 "></span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;to_pandas&quot;</span><span class="p">):</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><a href="#__codelineno-0-492"><span class="linenos" data-linenos="492 "></span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a><a href="#__codelineno-0-493"><span class="linenos" data-linenos="493 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a><a href="#__codelineno-0-494"><span class="linenos" data-linenos="494 "></span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot convert </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> to Polars DataFrame&quot;</span><span class="p">)</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a><a href="#__codelineno-0-495"><span class="linenos" data-linenos="495 "></span></a>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a><a href="#__codelineno-0-496"><span class="linenos" data-linenos="496 "></span></a>    <span class="c1"># For system tables, write directly without feature_version tracking</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a><a href="#__codelineno-0-497"><span class="linenos" data-linenos="497 "></span></a>    <span class="k">if</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a><a href="#__codelineno-0-498"><span class="linenos" data-linenos="498 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_schema_system_table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a><a href="#__codelineno-0-499"><span class="linenos" data-linenos="499 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_metadata_impl</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a><a href="#__codelineno-0-500"><span class="linenos" data-linenos="500 "></span></a>        <span class="k">return</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a><a href="#__codelineno-0-501"><span class="linenos" data-linenos="501 "></span></a>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a><a href="#__codelineno-0-502"><span class="linenos" data-linenos="502 "></span></a>    <span class="c1"># For regular features: add feature_version and snapshot_version, validate, and write</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a><a href="#__codelineno-0-503"><span class="linenos" data-linenos="503 "></span></a>    <span class="c1"># Check if feature_version and snapshot_version already exist in DataFrame</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a><a href="#__codelineno-0-504"><span class="linenos" data-linenos="504 "></span></a>    <span class="k">if</span> <span class="n">FEATURE_VERSION_COL</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">SNAPSHOT_VERSION_COL</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a><a href="#__codelineno-0-505"><span class="linenos" data-linenos="505 "></span></a>        <span class="c1"># DataFrame already has feature_version and snapshot_version - use as-is</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a><a href="#__codelineno-0-506"><span class="linenos" data-linenos="506 "></span></a>        <span class="c1"># This is intended for migrations writing historical versions</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a><a href="#__codelineno-0-507"><span class="linenos" data-linenos="507 "></span></a>        <span class="c1"># Issue a warning unless we&#39;re in a suppression context</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a><a href="#__codelineno-0-508"><span class="linenos" data-linenos="508 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_suppress_feature_version_warning</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a><a href="#__codelineno-0-509"><span class="linenos" data-linenos="509 "></span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a><a href="#__codelineno-0-510"><span class="linenos" data-linenos="510 "></span></a>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><a href="#__codelineno-0-511"><span class="linenos" data-linenos="511 "></span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a><a href="#__codelineno-0-512"><span class="linenos" data-linenos="512 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Writing metadata for </span><span class="si">{</span><span class="n">feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2"> with existing &quot;</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><a href="#__codelineno-0-513"><span class="linenos" data-linenos="513 "></span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">FEATURE_VERSION_COL</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="si">}</span><span class="s2"> columns. This is intended for migrations only. &quot;</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><a href="#__codelineno-0-514"><span class="linenos" data-linenos="514 "></span></a>                <span class="s2">&quot;Normal code should let write_metadata() add the current versions automatically.&quot;</span><span class="p">,</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><a href="#__codelineno-0-515"><span class="linenos" data-linenos="515 "></span></a>                <span class="ne">UserWarning</span><span class="p">,</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><a href="#__codelineno-0-516"><span class="linenos" data-linenos="516 "></span></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><a href="#__codelineno-0-517"><span class="linenos" data-linenos="517 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a><a href="#__codelineno-0-518"><span class="linenos" data-linenos="518 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><a href="#__codelineno-0-519"><span class="linenos" data-linenos="519 "></span></a>        <span class="c1"># Get current feature version and snapshot_version from code and add them</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><a href="#__codelineno-0-520"><span class="linenos" data-linenos="520 "></span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">BaseFeature</span><span class="p">):</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a><a href="#__codelineno-0-521"><span class="linenos" data-linenos="521 "></span></a>            <span class="n">current_feature_version</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><a href="#__codelineno-0-522"><span class="linenos" data-linenos="522 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><a href="#__codelineno-0-523"><span class="linenos" data-linenos="523 "></span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.models.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureGraph</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a><a href="#__codelineno-0-524"><span class="linenos" data-linenos="524 "></span></a>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a><a href="#__codelineno-0-525"><span class="linenos" data-linenos="525 "></span></a>            <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a><a href="#__codelineno-0-526"><span class="linenos" data-linenos="526 "></span></a>            <span class="n">feature_cls</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="p">[</span><span class="n">feature_key</span><span class="p">]</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a><a href="#__codelineno-0-527"><span class="linenos" data-linenos="527 "></span></a>            <span class="n">current_feature_version</span> <span class="o">=</span> <span class="n">feature_cls</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><a href="#__codelineno-0-528"><span class="linenos" data-linenos="528 "></span></a>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a><a href="#__codelineno-0-529"><span class="linenos" data-linenos="529 "></span></a>        <span class="c1"># Get snapshot_version from active graph</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a><a href="#__codelineno-0-530"><span class="linenos" data-linenos="530 "></span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.models.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureGraph</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a><a href="#__codelineno-0-531"><span class="linenos" data-linenos="531 "></span></a>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a><a href="#__codelineno-0-532"><span class="linenos" data-linenos="532 "></span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a><a href="#__codelineno-0-533"><span class="linenos" data-linenos="533 "></span></a>        <span class="n">current_snapshot_version</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">snapshot_version</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a><a href="#__codelineno-0-534"><span class="linenos" data-linenos="534 "></span></a>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a><a href="#__codelineno-0-535"><span class="linenos" data-linenos="535 "></span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a><a href="#__codelineno-0-536"><span class="linenos" data-linenos="536 "></span></a>            <span class="p">[</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a><a href="#__codelineno-0-537"><span class="linenos" data-linenos="537 "></span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_feature_version</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">FEATURE_VERSION_COL</span><span class="p">),</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a><a href="#__codelineno-0-538"><span class="linenos" data-linenos="538 "></span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">current_snapshot_version</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">),</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a><a href="#__codelineno-0-539"><span class="linenos" data-linenos="539 "></span></a>            <span class="p">]</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a><a href="#__codelineno-0-540"><span class="linenos" data-linenos="540 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a><a href="#__codelineno-0-541"><span class="linenos" data-linenos="541 "></span></a>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a><a href="#__codelineno-0-542"><span class="linenos" data-linenos="542 "></span></a>    <span class="c1"># Validate schema first (must have metaxy_provenance_by_field)</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a><a href="#__codelineno-0-543"><span class="linenos" data-linenos="543 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><a href="#__codelineno-0-544"><span class="linenos" data-linenos="544 "></span></a>    <span class="c1"># Write metadata</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a><a href="#__codelineno-0-545"><span class="linenos" data-linenos="545 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_write_metadata_impl</span><span class="p">(</span><span class="n">feature_key</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.drop_feature_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">drop_feature_metadata</span>


<a href="#metaxy.InMemoryMetadataStore.drop_feature_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">drop_feature_metadata</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Drop all metadata for a feature.</p>
<p>This removes all stored metadata for the specified feature from the store.
Useful for cleanup in tests or when re-computing feature metadata from scratch.</p>


<details class="warning" open>
  <summary>Warning</summary>
  <p>This operation is irreversible and will <strong>permanently delete all metadata</strong> for the specified feature.</p>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature class or key to drop metadata for</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">store</span><span class="o">.</span><span class="n">drop_feature_metadata</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">assert</span> <span class="ow">not</span> <span class="n">store</span><span class="o">.</span><span class="n">has_feature</span><span class="p">(</span><span class="n">MyFeature</span><span class="p">)</span>
</span></code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a><a href="#__codelineno-0-602"><span class="linenos" data-linenos="602 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">drop_feature_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><a href="#__codelineno-0-603"><span class="linenos" data-linenos="603 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Drop all metadata for a feature.</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a><a href="#__codelineno-0-604"><span class="linenos" data-linenos="604 "></span></a>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><a href="#__codelineno-0-605"><span class="linenos" data-linenos="605 "></span></a><span class="sd">    This removes all stored metadata for the specified feature from the store.</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><a href="#__codelineno-0-606"><span class="linenos" data-linenos="606 "></span></a><span class="sd">    Useful for cleanup in tests or when re-computing feature metadata from scratch.</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><a href="#__codelineno-0-607"><span class="linenos" data-linenos="607 "></span></a>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a><a href="#__codelineno-0-608"><span class="linenos" data-linenos="608 "></span></a><span class="sd">    Warning:</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a><a href="#__codelineno-0-609"><span class="linenos" data-linenos="609 "></span></a><span class="sd">        This operation is irreversible and will **permanently delete all metadata** for the specified feature.</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a><a href="#__codelineno-0-610"><span class="linenos" data-linenos="610 "></span></a>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a><a href="#__codelineno-0-611"><span class="linenos" data-linenos="611 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a><a href="#__codelineno-0-612"><span class="linenos" data-linenos="612 "></span></a><span class="sd">        feature: Feature class or key to drop metadata for</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a><a href="#__codelineno-0-613"><span class="linenos" data-linenos="613 "></span></a>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a><a href="#__codelineno-0-614"><span class="linenos" data-linenos="614 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a><a href="#__codelineno-0-615"><span class="linenos" data-linenos="615 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><a href="#__codelineno-0-616"><span class="linenos" data-linenos="616 "></span></a><span class="sd">        store.drop_feature_metadata(MyFeature)</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><a href="#__codelineno-0-617"><span class="linenos" data-linenos="617 "></span></a><span class="sd">        assert not store.has_feature(MyFeature)</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a><a href="#__codelineno-0-618"><span class="linenos" data-linenos="618 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><a href="#__codelineno-0-619"><span class="linenos" data-linenos="619 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a><a href="#__codelineno-0-620"><span class="linenos" data-linenos="620 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a><a href="#__codelineno-0-621"><span class="linenos" data-linenos="621 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a><a href="#__codelineno-0-622"><span class="linenos" data-linenos="622 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_drop_feature_metadata_impl</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.record_feature_graph_snapshot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">record_feature_graph_snapshot</span>


<a href="#metaxy.InMemoryMetadataStore.record_feature_graph_snapshot" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">record_feature_graph_snapshot</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;SnapshotPushResult&lt;/span&gt; (&lt;code&gt;metaxy.models.types.SnapshotPushResult&lt;/code&gt;)" href="../../types/#metaxy.models.types.SnapshotPushResult">SnapshotPushResult</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Record all features in graph with a graph snapshot version.</p>
<p>This should be called during CD (Continuous Deployment) to record what
feature versions are being deployed. Typically invoked via <code>metaxy graph push</code>.</p>
<p>Records all features in the graph with the same snapshot_version, representing
a consistent state of the entire feature graph based on code definitions.</p>
<p>The snapshot_version is a deterministic hash of all feature_version hashes
in the graph, making it idempotent - calling multiple times with the
same feature definitions produces the same snapshot_version.</p>
<p>This method detects three scenarios:
1. New snapshot (computational changes): No existing rows with this snapshot_version
2. Metadata-only changes: Snapshot exists but some features have different feature_spec_version
3. No changes: Snapshot exists with identical feature_spec_versions for all features</p>
<p>Returns: SnapshotPushResult</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a><a href="#__codelineno-0-624"><span class="linenos" data-linenos="624 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">record_feature_graph_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SnapshotPushResult</span><span class="p">:</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a><a href="#__codelineno-0-625"><span class="linenos" data-linenos="625 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Record all features in graph with a graph snapshot version.</span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a><a href="#__codelineno-0-626"><span class="linenos" data-linenos="626 "></span></a>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a><a href="#__codelineno-0-627"><span class="linenos" data-linenos="627 "></span></a><span class="sd">    This should be called during CD (Continuous Deployment) to record what</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a><a href="#__codelineno-0-628"><span class="linenos" data-linenos="628 "></span></a><span class="sd">    feature versions are being deployed. Typically invoked via `metaxy graph push`.</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a><a href="#__codelineno-0-629"><span class="linenos" data-linenos="629 "></span></a>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a><a href="#__codelineno-0-630"><span class="linenos" data-linenos="630 "></span></a><span class="sd">    Records all features in the graph with the same snapshot_version, representing</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a><a href="#__codelineno-0-631"><span class="linenos" data-linenos="631 "></span></a><span class="sd">    a consistent state of the entire feature graph based on code definitions.</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a><a href="#__codelineno-0-632"><span class="linenos" data-linenos="632 "></span></a>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a><a href="#__codelineno-0-633"><span class="linenos" data-linenos="633 "></span></a><span class="sd">    The snapshot_version is a deterministic hash of all feature_version hashes</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><a href="#__codelineno-0-634"><span class="linenos" data-linenos="634 "></span></a><span class="sd">    in the graph, making it idempotent - calling multiple times with the</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><a href="#__codelineno-0-635"><span class="linenos" data-linenos="635 "></span></a><span class="sd">    same feature definitions produces the same snapshot_version.</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a><a href="#__codelineno-0-636"><span class="linenos" data-linenos="636 "></span></a>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a><a href="#__codelineno-0-637"><span class="linenos" data-linenos="637 "></span></a><span class="sd">    This method detects three scenarios:</span>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a><a href="#__codelineno-0-638"><span class="linenos" data-linenos="638 "></span></a><span class="sd">    1. New snapshot (computational changes): No existing rows with this snapshot_version</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a><a href="#__codelineno-0-639"><span class="linenos" data-linenos="639 "></span></a><span class="sd">    2. Metadata-only changes: Snapshot exists but some features have different feature_spec_version</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a><a href="#__codelineno-0-640"><span class="linenos" data-linenos="640 "></span></a><span class="sd">    3. No changes: Snapshot exists with identical feature_spec_versions for all features</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><a href="#__codelineno-0-641"><span class="linenos" data-linenos="641 "></span></a>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a><a href="#__codelineno-0-642"><span class="linenos" data-linenos="642 "></span></a><span class="sd">    Returns: SnapshotPushResult</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><a href="#__codelineno-0-643"><span class="linenos" data-linenos="643 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><a href="#__codelineno-0-644"><span class="linenos" data-linenos="644 "></span></a>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><a href="#__codelineno-0-645"><span class="linenos" data-linenos="645 "></span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.models.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureGraph</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><a href="#__codelineno-0-646"><span class="linenos" data-linenos="646 "></span></a>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a><a href="#__codelineno-0-647"><span class="linenos" data-linenos="647 "></span></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a><a href="#__codelineno-0-648"><span class="linenos" data-linenos="648 "></span></a>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a><a href="#__codelineno-0-649"><span class="linenos" data-linenos="649 "></span></a>    <span class="c1"># Use to_snapshot() to get the snapshot dict</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a><a href="#__codelineno-0-650"><span class="linenos" data-linenos="650 "></span></a>    <span class="n">snapshot_dict</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">to_snapshot</span><span class="p">()</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a><a href="#__codelineno-0-651"><span class="linenos" data-linenos="651 "></span></a>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a><a href="#__codelineno-0-652"><span class="linenos" data-linenos="652 "></span></a>    <span class="c1"># Generate deterministic snapshot_version from graph</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a><a href="#__codelineno-0-653"><span class="linenos" data-linenos="653 "></span></a>    <span class="n">snapshot_version</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">snapshot_version</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a><a href="#__codelineno-0-654"><span class="linenos" data-linenos="654 "></span></a>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a><a href="#__codelineno-0-655"><span class="linenos" data-linenos="655 "></span></a>    <span class="c1"># Read existing feature versions once</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a><a href="#__codelineno-0-656"><span class="linenos" data-linenos="656 "></span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a><a href="#__codelineno-0-657"><span class="linenos" data-linenos="657 "></span></a>        <span class="n">existing_versions_lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span><span class="n">FEATURE_VERSIONS_KEY</span><span class="p">)</span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a><a href="#__codelineno-0-658"><span class="linenos" data-linenos="658 "></span></a>        <span class="c1"># Materialize to Polars for iteration</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a><a href="#__codelineno-0-659"><span class="linenos" data-linenos="659 "></span></a>        <span class="n">existing_versions</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a><a href="#__codelineno-0-660"><span class="linenos" data-linenos="660 "></span></a>            <span class="n">existing_versions_lazy</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a><a href="#__codelineno-0-661"><span class="linenos" data-linenos="661 "></span></a>            <span class="k">if</span> <span class="n">existing_versions_lazy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a><a href="#__codelineno-0-662"><span class="linenos" data-linenos="662 "></span></a>            <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a><a href="#__codelineno-0-663"><span class="linenos" data-linenos="663 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a><a href="#__codelineno-0-664"><span class="linenos" data-linenos="664 "></span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a><a href="#__codelineno-0-665"><span class="linenos" data-linenos="665 "></span></a>        <span class="c1"># Table doesn&#39;t exist yet</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a><a href="#__codelineno-0-666"><span class="linenos" data-linenos="666 "></span></a>        <span class="n">existing_versions</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a><a href="#__codelineno-0-667"><span class="linenos" data-linenos="667 "></span></a>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a><a href="#__codelineno-0-668"><span class="linenos" data-linenos="668 "></span></a>    <span class="c1"># Get project from any feature in the graph (all should have the same project)</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a><a href="#__codelineno-0-669"><span class="linenos" data-linenos="669 "></span></a>    <span class="c1"># Default to empty string if no features in graph</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a><a href="#__codelineno-0-670"><span class="linenos" data-linenos="670 "></span></a>    <span class="k">if</span> <span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="p">:</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a><a href="#__codelineno-0-671"><span class="linenos" data-linenos="671 "></span></a>        <span class="c1"># Get first feature&#39;s project</span>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a><a href="#__codelineno-0-672"><span class="linenos" data-linenos="672 "></span></a>        <span class="n">first_feature</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a><a href="#__codelineno-0-673"><span class="linenos" data-linenos="673 "></span></a>        <span class="n">project_name</span> <span class="o">=</span> <span class="n">first_feature</span><span class="o">.</span><span class="n">project</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a><a href="#__codelineno-0-674"><span class="linenos" data-linenos="674 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a><a href="#__codelineno-0-675"><span class="linenos" data-linenos="675 "></span></a>        <span class="n">project_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a><a href="#__codelineno-0-676"><span class="linenos" data-linenos="676 "></span></a>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a><a href="#__codelineno-0-677"><span class="linenos" data-linenos="677 "></span></a>    <span class="c1"># Check if this exact snapshot already exists for this project</span>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a><a href="#__codelineno-0-678"><span class="linenos" data-linenos="678 "></span></a>    <span class="n">snapshot_already_exists</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a><a href="#__codelineno-0-679"><span class="linenos" data-linenos="679 "></span></a>    <span class="n">existing_spec_versions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a><a href="#__codelineno-0-680"><span class="linenos" data-linenos="680 "></span></a>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a><a href="#__codelineno-0-681"><span class="linenos" data-linenos="681 "></span></a>    <span class="k">if</span> <span class="n">existing_versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a><a href="#__codelineno-0-682"><span class="linenos" data-linenos="682 "></span></a>        <span class="c1"># Check if project column exists (it may not in old tables)</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a><a href="#__codelineno-0-683"><span class="linenos" data-linenos="683 "></span></a>        <span class="k">if</span> <span class="s2">&quot;project&quot;</span> <span class="ow">in</span> <span class="n">existing_versions</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a><a href="#__codelineno-0-684"><span class="linenos" data-linenos="684 "></span></a>            <span class="n">snapshot_rows</span> <span class="o">=</span> <span class="n">existing_versions</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-0-685"><a id="__codelineno-0-685" name="__codelineno-0-685"></a><a href="#__codelineno-0-685"><span class="linenos" data-linenos="685 "></span></a>                <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">)</span> <span class="o">==</span> <span class="n">snapshot_version</span><span class="p">)</span>
</span><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a><a href="#__codelineno-0-686"><span class="linenos" data-linenos="686 "></span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">project_name</span><span class="p">)</span>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a><a href="#__codelineno-0-687"><span class="linenos" data-linenos="687 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a><a href="#__codelineno-0-688"><span class="linenos" data-linenos="688 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a><a href="#__codelineno-0-689"><span class="linenos" data-linenos="689 "></span></a>            <span class="c1"># Old table without project column - just check snapshot_version</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a><a href="#__codelineno-0-690"><span class="linenos" data-linenos="690 "></span></a>            <span class="n">snapshot_rows</span> <span class="o">=</span> <span class="n">existing_versions</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><a href="#__codelineno-0-691"><span class="linenos" data-linenos="691 "></span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">)</span> <span class="o">==</span> <span class="n">snapshot_version</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><a href="#__codelineno-0-692"><span class="linenos" data-linenos="692 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><a href="#__codelineno-0-693"><span class="linenos" data-linenos="693 "></span></a>        <span class="n">snapshot_already_exists</span> <span class="o">=</span> <span class="n">snapshot_rows</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><a href="#__codelineno-0-694"><span class="linenos" data-linenos="694 "></span></a>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a><a href="#__codelineno-0-695"><span class="linenos" data-linenos="695 "></span></a>        <span class="k">if</span> <span class="n">snapshot_already_exists</span><span class="p">:</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a><a href="#__codelineno-0-696"><span class="linenos" data-linenos="696 "></span></a>            <span class="c1"># Check if feature_spec_version column exists (backward compatibility)</span>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a><a href="#__codelineno-0-697"><span class="linenos" data-linenos="697 "></span></a>            <span class="c1"># Old records (before issue #77) won&#39;t have this column</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a><a href="#__codelineno-0-698"><span class="linenos" data-linenos="698 "></span></a>            <span class="n">has_spec_version</span> <span class="o">=</span> <span class="n">FEATURE_SPEC_VERSION_COL</span> <span class="ow">in</span> <span class="n">snapshot_rows</span><span class="o">.</span><span class="n">columns</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a><a href="#__codelineno-0-699"><span class="linenos" data-linenos="699 "></span></a>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a><a href="#__codelineno-0-700"><span class="linenos" data-linenos="700 "></span></a>            <span class="k">if</span> <span class="n">has_spec_version</span><span class="p">:</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><a href="#__codelineno-0-701"><span class="linenos" data-linenos="701 "></span></a>                <span class="c1"># Build dict of existing feature_key -&gt; feature_spec_version</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a><a href="#__codelineno-0-702"><span class="linenos" data-linenos="702 "></span></a>                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">snapshot_rows</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">named</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a><a href="#__codelineno-0-703"><span class="linenos" data-linenos="703 "></span></a>                    <span class="n">existing_spec_versions</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;feature_key&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a><a href="#__codelineno-0-704"><span class="linenos" data-linenos="704 "></span></a>                        <span class="n">FEATURE_SPEC_VERSION_COL</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a><a href="#__codelineno-0-705"><span class="linenos" data-linenos="705 "></span></a>                    <span class="p">]</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a><a href="#__codelineno-0-706"><span class="linenos" data-linenos="706 "></span></a>            <span class="c1"># If no spec_version column, existing_spec_versions remains empty</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a><a href="#__codelineno-0-707"><span class="linenos" data-linenos="707 "></span></a>            <span class="c1"># This means we&#39;ll treat it as &quot;no metadata changes&quot; (conservative approach)</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a><a href="#__codelineno-0-708"><span class="linenos" data-linenos="708 "></span></a>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a><a href="#__codelineno-0-709"><span class="linenos" data-linenos="709 "></span></a>    <span class="c1"># Scenario 1: New snapshot (no existing rows)</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a><a href="#__codelineno-0-710"><span class="linenos" data-linenos="710 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">snapshot_already_exists</span><span class="p">:</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a><a href="#__codelineno-0-711"><span class="linenos" data-linenos="711 "></span></a>        <span class="c1"># Build records from snapshot_dict</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a><a href="#__codelineno-0-712"><span class="linenos" data-linenos="712 "></span></a>        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a><a href="#__codelineno-0-713"><span class="linenos" data-linenos="713 "></span></a>        <span class="k">for</span> <span class="n">feature_key_str</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">snapshot_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a><a href="#__codelineno-0-714"><span class="linenos" data-linenos="714 "></span></a>            <span class="n">feature_data</span> <span class="o">=</span> <span class="n">snapshot_dict</span><span class="p">[</span><span class="n">feature_key_str</span><span class="p">]</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a><a href="#__codelineno-0-715"><span class="linenos" data-linenos="715 "></span></a>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a><a href="#__codelineno-0-716"><span class="linenos" data-linenos="716 "></span></a>            <span class="c1"># Serialize complete FeatureSpec</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a><a href="#__codelineno-0-717"><span class="linenos" data-linenos="717 "></span></a>            <span class="n">feature_spec_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">feature_data</span><span class="p">[</span><span class="s2">&quot;feature_spec&quot;</span><span class="p">])</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a><a href="#__codelineno-0-718"><span class="linenos" data-linenos="718 "></span></a>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a><a href="#__codelineno-0-719"><span class="linenos" data-linenos="719 "></span></a>            <span class="c1"># Always record all features for this snapshot (don&#39;t skip based on feature_version alone)</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a><a href="#__codelineno-0-720"><span class="linenos" data-linenos="720 "></span></a>            <span class="c1"># Each snapshot must be complete to support migration detection</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a><a href="#__codelineno-0-721"><span class="linenos" data-linenos="721 "></span></a>            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722"></a><a href="#__codelineno-0-722"><span class="linenos" data-linenos="722 "></span></a>                <span class="p">{</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723"></a><a href="#__codelineno-0-723"><span class="linenos" data-linenos="723 "></span></a>                    <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">,</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724"></a><a href="#__codelineno-0-724"><span class="linenos" data-linenos="724 "></span></a>                    <span class="s2">&quot;feature_key&quot;</span><span class="p">:</span> <span class="n">feature_key_str</span><span class="p">,</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725"></a><a href="#__codelineno-0-725"><span class="linenos" data-linenos="725 "></span></a>                    <span class="n">FEATURE_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span><span class="n">FEATURE_VERSION_COL</span><span class="p">],</span>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726"></a><a href="#__codelineno-0-726"><span class="linenos" data-linenos="726 "></span></a>                    <span class="n">FEATURE_SPEC_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727"></a><a href="#__codelineno-0-727"><span class="linenos" data-linenos="727 "></span></a>                        <span class="n">FEATURE_SPEC_VERSION_COL</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728"></a><a href="#__codelineno-0-728"><span class="linenos" data-linenos="728 "></span></a>                    <span class="p">],</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729"></a><a href="#__codelineno-0-729"><span class="linenos" data-linenos="729 "></span></a>                    <span class="n">FEATURE_TRACKING_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730"></a><a href="#__codelineno-0-730"><span class="linenos" data-linenos="730 "></span></a>                        <span class="n">FEATURE_TRACKING_VERSION_COL</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731"></a><a href="#__codelineno-0-731"><span class="linenos" data-linenos="731 "></span></a>                    <span class="p">],</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732"></a><a href="#__codelineno-0-732"><span class="linenos" data-linenos="732 "></span></a>                    <span class="s2">&quot;recorded_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733"></a><a href="#__codelineno-0-733"><span class="linenos" data-linenos="733 "></span></a>                    <span class="s2">&quot;feature_spec&quot;</span><span class="p">:</span> <span class="n">feature_spec_json</span><span class="p">,</span>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734"></a><a href="#__codelineno-0-734"><span class="linenos" data-linenos="734 "></span></a>                    <span class="s2">&quot;feature_class_path&quot;</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span><span class="s2">&quot;feature_class_path&quot;</span><span class="p">],</span>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735"></a><a href="#__codelineno-0-735"><span class="linenos" data-linenos="735 "></span></a>                    <span class="n">SNAPSHOT_VERSION_COL</span><span class="p">:</span> <span class="n">snapshot_version</span><span class="p">,</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736"></a><a href="#__codelineno-0-736"><span class="linenos" data-linenos="736 "></span></a>                <span class="p">}</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737"></a><a href="#__codelineno-0-737"><span class="linenos" data-linenos="737 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738"></a><a href="#__codelineno-0-738"><span class="linenos" data-linenos="738 "></span></a>
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739"></a><a href="#__codelineno-0-739"><span class="linenos" data-linenos="739 "></span></a>        <span class="c1"># Bulk write all new records at once</span>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740"></a><a href="#__codelineno-0-740"><span class="linenos" data-linenos="740 "></span></a>        <span class="k">if</span> <span class="n">records</span><span class="p">:</span>
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741"></a><a href="#__codelineno-0-741"><span class="linenos" data-linenos="741 "></span></a>            <span class="n">version_records</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742"></a><a href="#__codelineno-0-742"><span class="linenos" data-linenos="742 "></span></a>                <span class="n">records</span><span class="p">,</span>
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743"></a><a href="#__codelineno-0-743"><span class="linenos" data-linenos="743 "></span></a>                <span class="n">schema</span><span class="o">=</span><span class="n">FEATURE_VERSIONS_SCHEMA</span><span class="p">,</span>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744"></a><a href="#__codelineno-0-744"><span class="linenos" data-linenos="744 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745"></a><a href="#__codelineno-0-745"><span class="linenos" data-linenos="745 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_metadata_impl</span><span class="p">(</span><span class="n">FEATURE_VERSIONS_KEY</span><span class="p">,</span> <span class="n">version_records</span><span class="p">)</span>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746"></a><a href="#__codelineno-0-746"><span class="linenos" data-linenos="746 "></span></a>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747"></a><a href="#__codelineno-0-747"><span class="linenos" data-linenos="747 "></span></a>        <span class="k">return</span> <span class="n">SnapshotPushResult</span><span class="p">(</span>
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748"></a><a href="#__codelineno-0-748"><span class="linenos" data-linenos="748 "></span></a>            <span class="n">snapshot_version</span><span class="o">=</span><span class="n">snapshot_version</span><span class="p">,</span>
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749"></a><a href="#__codelineno-0-749"><span class="linenos" data-linenos="749 "></span></a>            <span class="n">already_recorded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-750"><a id="__codelineno-0-750" name="__codelineno-0-750"></a><a href="#__codelineno-0-750"><span class="linenos" data-linenos="750 "></span></a>            <span class="n">metadata_changed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-751"><a id="__codelineno-0-751" name="__codelineno-0-751"></a><a href="#__codelineno-0-751"><span class="linenos" data-linenos="751 "></span></a>            <span class="n">features_with_spec_changes</span><span class="o">=</span><span class="p">[],</span>
</span><span id="__span-0-752"><a id="__codelineno-0-752" name="__codelineno-0-752"></a><a href="#__codelineno-0-752"><span class="linenos" data-linenos="752 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-753"><a id="__codelineno-0-753" name="__codelineno-0-753"></a><a href="#__codelineno-0-753"><span class="linenos" data-linenos="753 "></span></a>
</span><span id="__span-0-754"><a id="__codelineno-0-754" name="__codelineno-0-754"></a><a href="#__codelineno-0-754"><span class="linenos" data-linenos="754 "></span></a>    <span class="c1"># Scenario 2 &amp; 3: Snapshot exists - check for metadata changes</span>
</span><span id="__span-0-755"><a id="__codelineno-0-755" name="__codelineno-0-755"></a><a href="#__codelineno-0-755"><span class="linenos" data-linenos="755 "></span></a>    <span class="n">features_with_spec_changes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-756"><a id="__codelineno-0-756" name="__codelineno-0-756"></a><a href="#__codelineno-0-756"><span class="linenos" data-linenos="756 "></span></a>
</span><span id="__span-0-757"><a id="__codelineno-0-757" name="__codelineno-0-757"></a><a href="#__codelineno-0-757"><span class="linenos" data-linenos="757 "></span></a>    <span class="k">for</span> <span class="n">feature_key_str</span><span class="p">,</span> <span class="n">feature_data</span> <span class="ow">in</span> <span class="n">snapshot_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-758"><a id="__codelineno-0-758" name="__codelineno-0-758"></a><a href="#__codelineno-0-758"><span class="linenos" data-linenos="758 "></span></a>        <span class="n">current_spec_version</span> <span class="o">=</span> <span class="n">feature_data</span><span class="p">[</span><span class="n">FEATURE_SPEC_VERSION_COL</span><span class="p">]</span>
</span><span id="__span-0-759"><a id="__codelineno-0-759" name="__codelineno-0-759"></a><a href="#__codelineno-0-759"><span class="linenos" data-linenos="759 "></span></a>        <span class="n">existing_spec_version</span> <span class="o">=</span> <span class="n">existing_spec_versions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feature_key_str</span><span class="p">)</span>
</span><span id="__span-0-760"><a id="__codelineno-0-760" name="__codelineno-0-760"></a><a href="#__codelineno-0-760"><span class="linenos" data-linenos="760 "></span></a>
</span><span id="__span-0-761"><a id="__codelineno-0-761" name="__codelineno-0-761"></a><a href="#__codelineno-0-761"><span class="linenos" data-linenos="761 "></span></a>        <span class="k">if</span> <span class="n">existing_spec_version</span> <span class="o">!=</span> <span class="n">current_spec_version</span><span class="p">:</span>
</span><span id="__span-0-762"><a id="__codelineno-0-762" name="__codelineno-0-762"></a><a href="#__codelineno-0-762"><span class="linenos" data-linenos="762 "></span></a>            <span class="n">features_with_spec_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_key_str</span><span class="p">)</span>
</span><span id="__span-0-763"><a id="__codelineno-0-763" name="__codelineno-0-763"></a><a href="#__codelineno-0-763"><span class="linenos" data-linenos="763 "></span></a>
</span><span id="__span-0-764"><a id="__codelineno-0-764" name="__codelineno-0-764"></a><a href="#__codelineno-0-764"><span class="linenos" data-linenos="764 "></span></a>    <span class="c1"># If metadata changed, append new rows for affected features</span>
</span><span id="__span-0-765"><a id="__codelineno-0-765" name="__codelineno-0-765"></a><a href="#__codelineno-0-765"><span class="linenos" data-linenos="765 "></span></a>    <span class="k">if</span> <span class="n">features_with_spec_changes</span><span class="p">:</span>
</span><span id="__span-0-766"><a id="__codelineno-0-766" name="__codelineno-0-766"></a><a href="#__codelineno-0-766"><span class="linenos" data-linenos="766 "></span></a>        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-767"><a id="__codelineno-0-767" name="__codelineno-0-767"></a><a href="#__codelineno-0-767"><span class="linenos" data-linenos="767 "></span></a>        <span class="k">for</span> <span class="n">feature_key_str</span> <span class="ow">in</span> <span class="n">features_with_spec_changes</span><span class="p">:</span>
</span><span id="__span-0-768"><a id="__codelineno-0-768" name="__codelineno-0-768"></a><a href="#__codelineno-0-768"><span class="linenos" data-linenos="768 "></span></a>            <span class="n">feature_data</span> <span class="o">=</span> <span class="n">snapshot_dict</span><span class="p">[</span><span class="n">feature_key_str</span><span class="p">]</span>
</span><span id="__span-0-769"><a id="__codelineno-0-769" name="__codelineno-0-769"></a><a href="#__codelineno-0-769"><span class="linenos" data-linenos="769 "></span></a>
</span><span id="__span-0-770"><a id="__codelineno-0-770" name="__codelineno-0-770"></a><a href="#__codelineno-0-770"><span class="linenos" data-linenos="770 "></span></a>            <span class="c1"># Serialize complete FeatureSpec</span>
</span><span id="__span-0-771"><a id="__codelineno-0-771" name="__codelineno-0-771"></a><a href="#__codelineno-0-771"><span class="linenos" data-linenos="771 "></span></a>            <span class="n">feature_spec_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">feature_data</span><span class="p">[</span><span class="s2">&quot;feature_spec&quot;</span><span class="p">])</span>
</span><span id="__span-0-772"><a id="__codelineno-0-772" name="__codelineno-0-772"></a><a href="#__codelineno-0-772"><span class="linenos" data-linenos="772 "></span></a>
</span><span id="__span-0-773"><a id="__codelineno-0-773" name="__codelineno-0-773"></a><a href="#__codelineno-0-773"><span class="linenos" data-linenos="773 "></span></a>            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-0-774"><a id="__codelineno-0-774" name="__codelineno-0-774"></a><a href="#__codelineno-0-774"><span class="linenos" data-linenos="774 "></span></a>                <span class="p">{</span>
</span><span id="__span-0-775"><a id="__codelineno-0-775" name="__codelineno-0-775"></a><a href="#__codelineno-0-775"><span class="linenos" data-linenos="775 "></span></a>                    <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">,</span>
</span><span id="__span-0-776"><a id="__codelineno-0-776" name="__codelineno-0-776"></a><a href="#__codelineno-0-776"><span class="linenos" data-linenos="776 "></span></a>                    <span class="s2">&quot;feature_key&quot;</span><span class="p">:</span> <span class="n">feature_key_str</span><span class="p">,</span>
</span><span id="__span-0-777"><a id="__codelineno-0-777" name="__codelineno-0-777"></a><a href="#__codelineno-0-777"><span class="linenos" data-linenos="777 "></span></a>                    <span class="n">FEATURE_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span><span class="n">FEATURE_VERSION_COL</span><span class="p">],</span>
</span><span id="__span-0-778"><a id="__codelineno-0-778" name="__codelineno-0-778"></a><a href="#__codelineno-0-778"><span class="linenos" data-linenos="778 "></span></a>                    <span class="n">FEATURE_SPEC_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span>
</span><span id="__span-0-779"><a id="__codelineno-0-779" name="__codelineno-0-779"></a><a href="#__codelineno-0-779"><span class="linenos" data-linenos="779 "></span></a>                        <span class="n">FEATURE_SPEC_VERSION_COL</span>
</span><span id="__span-0-780"><a id="__codelineno-0-780" name="__codelineno-0-780"></a><a href="#__codelineno-0-780"><span class="linenos" data-linenos="780 "></span></a>                    <span class="p">],</span>
</span><span id="__span-0-781"><a id="__codelineno-0-781" name="__codelineno-0-781"></a><a href="#__codelineno-0-781"><span class="linenos" data-linenos="781 "></span></a>                    <span class="n">FEATURE_TRACKING_VERSION_COL</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span>
</span><span id="__span-0-782"><a id="__codelineno-0-782" name="__codelineno-0-782"></a><a href="#__codelineno-0-782"><span class="linenos" data-linenos="782 "></span></a>                        <span class="n">FEATURE_TRACKING_VERSION_COL</span>
</span><span id="__span-0-783"><a id="__codelineno-0-783" name="__codelineno-0-783"></a><a href="#__codelineno-0-783"><span class="linenos" data-linenos="783 "></span></a>                    <span class="p">],</span>
</span><span id="__span-0-784"><a id="__codelineno-0-784" name="__codelineno-0-784"></a><a href="#__codelineno-0-784"><span class="linenos" data-linenos="784 "></span></a>                    <span class="s2">&quot;recorded_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span id="__span-0-785"><a id="__codelineno-0-785" name="__codelineno-0-785"></a><a href="#__codelineno-0-785"><span class="linenos" data-linenos="785 "></span></a>                    <span class="s2">&quot;feature_spec&quot;</span><span class="p">:</span> <span class="n">feature_spec_json</span><span class="p">,</span>
</span><span id="__span-0-786"><a id="__codelineno-0-786" name="__codelineno-0-786"></a><a href="#__codelineno-0-786"><span class="linenos" data-linenos="786 "></span></a>                    <span class="s2">&quot;feature_class_path&quot;</span><span class="p">:</span> <span class="n">feature_data</span><span class="p">[</span><span class="s2">&quot;feature_class_path&quot;</span><span class="p">],</span>
</span><span id="__span-0-787"><a id="__codelineno-0-787" name="__codelineno-0-787"></a><a href="#__codelineno-0-787"><span class="linenos" data-linenos="787 "></span></a>                    <span class="n">SNAPSHOT_VERSION_COL</span><span class="p">:</span> <span class="n">snapshot_version</span><span class="p">,</span>
</span><span id="__span-0-788"><a id="__codelineno-0-788" name="__codelineno-0-788"></a><a href="#__codelineno-0-788"><span class="linenos" data-linenos="788 "></span></a>                <span class="p">}</span>
</span><span id="__span-0-789"><a id="__codelineno-0-789" name="__codelineno-0-789"></a><a href="#__codelineno-0-789"><span class="linenos" data-linenos="789 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-790"><a id="__codelineno-0-790" name="__codelineno-0-790"></a><a href="#__codelineno-0-790"><span class="linenos" data-linenos="790 "></span></a>
</span><span id="__span-0-791"><a id="__codelineno-0-791" name="__codelineno-0-791"></a><a href="#__codelineno-0-791"><span class="linenos" data-linenos="791 "></span></a>        <span class="c1"># Bulk write updated records (append-only)</span>
</span><span id="__span-0-792"><a id="__codelineno-0-792" name="__codelineno-0-792"></a><a href="#__codelineno-0-792"><span class="linenos" data-linenos="792 "></span></a>        <span class="k">if</span> <span class="n">records</span><span class="p">:</span>
</span><span id="__span-0-793"><a id="__codelineno-0-793" name="__codelineno-0-793"></a><a href="#__codelineno-0-793"><span class="linenos" data-linenos="793 "></span></a>            <span class="n">version_records</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-794"><a id="__codelineno-0-794" name="__codelineno-0-794"></a><a href="#__codelineno-0-794"><span class="linenos" data-linenos="794 "></span></a>                <span class="n">records</span><span class="p">,</span>
</span><span id="__span-0-795"><a id="__codelineno-0-795" name="__codelineno-0-795"></a><a href="#__codelineno-0-795"><span class="linenos" data-linenos="795 "></span></a>                <span class="n">schema</span><span class="o">=</span><span class="n">FEATURE_VERSIONS_SCHEMA</span><span class="p">,</span>
</span><span id="__span-0-796"><a id="__codelineno-0-796" name="__codelineno-0-796"></a><a href="#__codelineno-0-796"><span class="linenos" data-linenos="796 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-797"><a id="__codelineno-0-797" name="__codelineno-0-797"></a><a href="#__codelineno-0-797"><span class="linenos" data-linenos="797 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_metadata_impl</span><span class="p">(</span><span class="n">FEATURE_VERSIONS_KEY</span><span class="p">,</span> <span class="n">version_records</span><span class="p">)</span>
</span><span id="__span-0-798"><a id="__codelineno-0-798" name="__codelineno-0-798"></a><a href="#__codelineno-0-798"><span class="linenos" data-linenos="798 "></span></a>
</span><span id="__span-0-799"><a id="__codelineno-0-799" name="__codelineno-0-799"></a><a href="#__codelineno-0-799"><span class="linenos" data-linenos="799 "></span></a>        <span class="k">return</span> <span class="n">SnapshotPushResult</span><span class="p">(</span>
</span><span id="__span-0-800"><a id="__codelineno-0-800" name="__codelineno-0-800"></a><a href="#__codelineno-0-800"><span class="linenos" data-linenos="800 "></span></a>            <span class="n">snapshot_version</span><span class="o">=</span><span class="n">snapshot_version</span><span class="p">,</span>
</span><span id="__span-0-801"><a id="__codelineno-0-801" name="__codelineno-0-801"></a><a href="#__codelineno-0-801"><span class="linenos" data-linenos="801 "></span></a>            <span class="n">already_recorded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-802"><a id="__codelineno-0-802" name="__codelineno-0-802"></a><a href="#__codelineno-0-802"><span class="linenos" data-linenos="802 "></span></a>            <span class="n">metadata_changed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-803"><a id="__codelineno-0-803" name="__codelineno-0-803"></a><a href="#__codelineno-0-803"><span class="linenos" data-linenos="803 "></span></a>            <span class="n">features_with_spec_changes</span><span class="o">=</span><span class="n">features_with_spec_changes</span><span class="p">,</span>
</span><span id="__span-0-804"><a id="__codelineno-0-804" name="__codelineno-0-804"></a><a href="#__codelineno-0-804"><span class="linenos" data-linenos="804 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-805"><a id="__codelineno-0-805" name="__codelineno-0-805"></a><a href="#__codelineno-0-805"><span class="linenos" data-linenos="805 "></span></a>
</span><span id="__span-0-806"><a id="__codelineno-0-806" name="__codelineno-0-806"></a><a href="#__codelineno-0-806"><span class="linenos" data-linenos="806 "></span></a>    <span class="c1"># Scenario 3: No changes at all</span>
</span><span id="__span-0-807"><a id="__codelineno-0-807" name="__codelineno-0-807"></a><a href="#__codelineno-0-807"><span class="linenos" data-linenos="807 "></span></a>    <span class="k">return</span> <span class="n">SnapshotPushResult</span><span class="p">(</span>
</span><span id="__span-0-808"><a id="__codelineno-0-808" name="__codelineno-0-808"></a><a href="#__codelineno-0-808"><span class="linenos" data-linenos="808 "></span></a>        <span class="n">snapshot_version</span><span class="o">=</span><span class="n">snapshot_version</span><span class="p">,</span>
</span><span id="__span-0-809"><a id="__codelineno-0-809" name="__codelineno-0-809"></a><a href="#__codelineno-0-809"><span class="linenos" data-linenos="809 "></span></a>        <span class="n">already_recorded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-810"><a id="__codelineno-0-810" name="__codelineno-0-810"></a><a href="#__codelineno-0-810"><span class="linenos" data-linenos="810 "></span></a>        <span class="n">metadata_changed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-811"><a id="__codelineno-0-811" name="__codelineno-0-811"></a><a href="#__codelineno-0-811"><span class="linenos" data-linenos="811 "></span></a>        <span class="n">features_with_spec_changes</span><span class="o">=</span><span class="p">[],</span>
</span><span id="__span-0-812"><a id="__codelineno-0-812" name="__codelineno-0-812"></a><a href="#__codelineno-0-812"><span class="linenos" data-linenos="812 "></span></a>    <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.read_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read_metadata</span>


<a href="#metaxy.InMemoryMetadataStore.read_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_metadata</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">feature_version</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">allow_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">current_only</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read metadata with optional fallback to upstream stores.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature to read metadata for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>feature_version</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Explicit feature_version to filter by (mutually exclusive with current_only=True)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Sequence of Narwhals filter expressions to apply to this feature.
Example: [nw.col("x") &gt; 10, nw.col("y") &lt; 5]</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>columns</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Subset of columns to return</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>allow_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True, check fallback stores on local miss</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>current_only</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True, only return rows with current feature_version
(default: True for safety)</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>
          –
          <div class="doc-md-description">
            <p>Narwhals LazyFrame with metadata</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.FeatureNotFoundError">FeatureNotFoundError</span></code>
            –
          <div class="doc-md-description">
            <p>If feature not found in any store</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If both feature_version and current_only=True are provided</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-837"><a id="__codelineno-0-837" name="__codelineno-0-837"></a><a href="#__codelineno-0-837"><span class="linenos" data-linenos="837 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_metadata</span><span class="p">(</span>
</span><span id="__span-0-838"><a id="__codelineno-0-838" name="__codelineno-0-838"></a><a href="#__codelineno-0-838"><span class="linenos" data-linenos="838 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-839"><a id="__codelineno-0-839" name="__codelineno-0-839"></a><a href="#__codelineno-0-839"><span class="linenos" data-linenos="839 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-840"><a id="__codelineno-0-840" name="__codelineno-0-840"></a><a href="#__codelineno-0-840"><span class="linenos" data-linenos="840 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-841"><a id="__codelineno-0-841" name="__codelineno-0-841"></a><a href="#__codelineno-0-841"><span class="linenos" data-linenos="841 "></span></a>    <span class="n">feature_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-842"><a id="__codelineno-0-842" name="__codelineno-0-842"></a><a href="#__codelineno-0-842"><span class="linenos" data-linenos="842 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-843"><a id="__codelineno-0-843" name="__codelineno-0-843"></a><a href="#__codelineno-0-843"><span class="linenos" data-linenos="843 "></span></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-844"><a id="__codelineno-0-844" name="__codelineno-0-844"></a><a href="#__codelineno-0-844"><span class="linenos" data-linenos="844 "></span></a>    <span class="n">allow_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-845"><a id="__codelineno-0-845" name="__codelineno-0-845"></a><a href="#__codelineno-0-845"><span class="linenos" data-linenos="845 "></span></a>    <span class="n">current_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-846"><a id="__codelineno-0-846" name="__codelineno-0-846"></a><a href="#__codelineno-0-846"><span class="linenos" data-linenos="846 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-847"><a id="__codelineno-0-847" name="__codelineno-0-847"></a><a href="#__codelineno-0-847"><span class="linenos" data-linenos="847 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-848"><a id="__codelineno-0-848" name="__codelineno-0-848"></a><a href="#__codelineno-0-848"><span class="linenos" data-linenos="848 "></span></a><span class="sd">    Read metadata with optional fallback to upstream stores.</span>
</span><span id="__span-0-849"><a id="__codelineno-0-849" name="__codelineno-0-849"></a><a href="#__codelineno-0-849"><span class="linenos" data-linenos="849 "></span></a>
</span><span id="__span-0-850"><a id="__codelineno-0-850" name="__codelineno-0-850"></a><a href="#__codelineno-0-850"><span class="linenos" data-linenos="850 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-851"><a id="__codelineno-0-851" name="__codelineno-0-851"></a><a href="#__codelineno-0-851"><span class="linenos" data-linenos="851 "></span></a><span class="sd">        feature: Feature to read metadata for</span>
</span><span id="__span-0-852"><a id="__codelineno-0-852" name="__codelineno-0-852"></a><a href="#__codelineno-0-852"><span class="linenos" data-linenos="852 "></span></a><span class="sd">        feature_version: Explicit feature_version to filter by (mutually exclusive with current_only=True)</span>
</span><span id="__span-0-853"><a id="__codelineno-0-853" name="__codelineno-0-853"></a><a href="#__codelineno-0-853"><span class="linenos" data-linenos="853 "></span></a><span class="sd">        filters: Sequence of Narwhals filter expressions to apply to this feature.</span>
</span><span id="__span-0-854"><a id="__codelineno-0-854" name="__codelineno-0-854"></a><a href="#__codelineno-0-854"><span class="linenos" data-linenos="854 "></span></a><span class="sd">            Example: [nw.col(&quot;x&quot;) &gt; 10, nw.col(&quot;y&quot;) &lt; 5]</span>
</span><span id="__span-0-855"><a id="__codelineno-0-855" name="__codelineno-0-855"></a><a href="#__codelineno-0-855"><span class="linenos" data-linenos="855 "></span></a><span class="sd">        columns: Subset of columns to return</span>
</span><span id="__span-0-856"><a id="__codelineno-0-856" name="__codelineno-0-856"></a><a href="#__codelineno-0-856"><span class="linenos" data-linenos="856 "></span></a><span class="sd">        allow_fallback: If True, check fallback stores on local miss</span>
</span><span id="__span-0-857"><a id="__codelineno-0-857" name="__codelineno-0-857"></a><a href="#__codelineno-0-857"><span class="linenos" data-linenos="857 "></span></a><span class="sd">        current_only: If True, only return rows with current feature_version</span>
</span><span id="__span-0-858"><a id="__codelineno-0-858" name="__codelineno-0-858"></a><a href="#__codelineno-0-858"><span class="linenos" data-linenos="858 "></span></a><span class="sd">            (default: True for safety)</span>
</span><span id="__span-0-859"><a id="__codelineno-0-859" name="__codelineno-0-859"></a><a href="#__codelineno-0-859"><span class="linenos" data-linenos="859 "></span></a>
</span><span id="__span-0-860"><a id="__codelineno-0-860" name="__codelineno-0-860"></a><a href="#__codelineno-0-860"><span class="linenos" data-linenos="860 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-861"><a id="__codelineno-0-861" name="__codelineno-0-861"></a><a href="#__codelineno-0-861"><span class="linenos" data-linenos="861 "></span></a><span class="sd">        Narwhals LazyFrame with metadata</span>
</span><span id="__span-0-862"><a id="__codelineno-0-862" name="__codelineno-0-862"></a><a href="#__codelineno-0-862"><span class="linenos" data-linenos="862 "></span></a>
</span><span id="__span-0-863"><a id="__codelineno-0-863" name="__codelineno-0-863"></a><a href="#__codelineno-0-863"><span class="linenos" data-linenos="863 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-864"><a id="__codelineno-0-864" name="__codelineno-0-864"></a><a href="#__codelineno-0-864"><span class="linenos" data-linenos="864 "></span></a><span class="sd">        FeatureNotFoundError: If feature not found in any store</span>
</span><span id="__span-0-865"><a id="__codelineno-0-865" name="__codelineno-0-865"></a><a href="#__codelineno-0-865"><span class="linenos" data-linenos="865 "></span></a><span class="sd">        ValueError: If both feature_version and current_only=True are provided</span>
</span><span id="__span-0-866"><a id="__codelineno-0-866" name="__codelineno-0-866"></a><a href="#__codelineno-0-866"><span class="linenos" data-linenos="866 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-867"><a id="__codelineno-0-867" name="__codelineno-0-867"></a><a href="#__codelineno-0-867"><span class="linenos" data-linenos="867 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-868"><a id="__codelineno-0-868" name="__codelineno-0-868"></a><a href="#__codelineno-0-868"><span class="linenos" data-linenos="868 "></span></a>    <span class="n">is_system_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_system_table</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-869"><a id="__codelineno-0-869" name="__codelineno-0-869"></a><a href="#__codelineno-0-869"><span class="linenos" data-linenos="869 "></span></a>
</span><span id="__span-0-870"><a id="__codelineno-0-870" name="__codelineno-0-870"></a><a href="#__codelineno-0-870"><span class="linenos" data-linenos="870 "></span></a>    <span class="c1"># Validate mutually exclusive parameters</span>
</span><span id="__span-0-871"><a id="__codelineno-0-871" name="__codelineno-0-871"></a><a href="#__codelineno-0-871"><span class="linenos" data-linenos="871 "></span></a>    <span class="k">if</span> <span class="n">feature_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_only</span><span class="p">:</span>
</span><span id="__span-0-872"><a id="__codelineno-0-872" name="__codelineno-0-872"></a><a href="#__codelineno-0-872"><span class="linenos" data-linenos="872 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-873"><a id="__codelineno-0-873" name="__codelineno-0-873"></a><a href="#__codelineno-0-873"><span class="linenos" data-linenos="873 "></span></a>            <span class="s2">&quot;Cannot specify both feature_version and current_only=True. &quot;</span>
</span><span id="__span-0-874"><a id="__codelineno-0-874" name="__codelineno-0-874"></a><a href="#__codelineno-0-874"><span class="linenos" data-linenos="874 "></span></a>            <span class="s2">&quot;Use current_only=False with feature_version parameter.&quot;</span>
</span><span id="__span-0-875"><a id="__codelineno-0-875" name="__codelineno-0-875"></a><a href="#__codelineno-0-875"><span class="linenos" data-linenos="875 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-876"><a id="__codelineno-0-876" name="__codelineno-0-876"></a><a href="#__codelineno-0-876"><span class="linenos" data-linenos="876 "></span></a>
</span><span id="__span-0-877"><a id="__codelineno-0-877" name="__codelineno-0-877"></a><a href="#__codelineno-0-877"><span class="linenos" data-linenos="877 "></span></a>    <span class="c1"># Determine which feature_version to use</span>
</span><span id="__span-0-878"><a id="__codelineno-0-878" name="__codelineno-0-878"></a><a href="#__codelineno-0-878"><span class="linenos" data-linenos="878 "></span></a>    <span class="n">feature_version_filter</span> <span class="o">=</span> <span class="n">feature_version</span>
</span><span id="__span-0-879"><a id="__codelineno-0-879" name="__codelineno-0-879"></a><a href="#__codelineno-0-879"><span class="linenos" data-linenos="879 "></span></a>    <span class="k">if</span> <span class="n">current_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_system_table</span><span class="p">:</span>
</span><span id="__span-0-880"><a id="__codelineno-0-880" name="__codelineno-0-880"></a><a href="#__codelineno-0-880"><span class="linenos" data-linenos="880 "></span></a>        <span class="c1"># Get current feature_version</span>
</span><span id="__span-0-881"><a id="__codelineno-0-881" name="__codelineno-0-881"></a><a href="#__codelineno-0-881"><span class="linenos" data-linenos="881 "></span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">BaseFeature</span><span class="p">):</span>
</span><span id="__span-0-882"><a id="__codelineno-0-882" name="__codelineno-0-882"></a><a href="#__codelineno-0-882"><span class="linenos" data-linenos="882 "></span></a>            <span class="n">feature_version_filter</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-883"><a id="__codelineno-0-883" name="__codelineno-0-883"></a><a href="#__codelineno-0-883"><span class="linenos" data-linenos="883 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-884"><a id="__codelineno-0-884" name="__codelineno-0-884"></a><a href="#__codelineno-0-884"><span class="linenos" data-linenos="884 "></span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.models.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureGraph</span>
</span><span id="__span-0-885"><a id="__codelineno-0-885" name="__codelineno-0-885"></a><a href="#__codelineno-0-885"><span class="linenos" data-linenos="885 "></span></a>
</span><span id="__span-0-886"><a id="__codelineno-0-886" name="__codelineno-0-886"></a><a href="#__codelineno-0-886"><span class="linenos" data-linenos="886 "></span></a>            <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-887"><a id="__codelineno-0-887" name="__codelineno-0-887"></a><a href="#__codelineno-0-887"><span class="linenos" data-linenos="887 "></span></a>            <span class="c1"># Only try to get from graph if feature_key exists in graph</span>
</span><span id="__span-0-888"><a id="__codelineno-0-888" name="__codelineno-0-888"></a><a href="#__codelineno-0-888"><span class="linenos" data-linenos="888 "></span></a>            <span class="c1"># This allows reading system tables or external features not in current graph</span>
</span><span id="__span-0-889"><a id="__codelineno-0-889" name="__codelineno-0-889"></a><a href="#__codelineno-0-889"><span class="linenos" data-linenos="889 "></span></a>            <span class="k">if</span> <span class="n">feature_key</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="p">:</span>
</span><span id="__span-0-890"><a id="__codelineno-0-890" name="__codelineno-0-890"></a><a href="#__codelineno-0-890"><span class="linenos" data-linenos="890 "></span></a>                <span class="n">feature_cls</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="p">[</span><span class="n">feature_key</span><span class="p">]</span>
</span><span id="__span-0-891"><a id="__codelineno-0-891" name="__codelineno-0-891"></a><a href="#__codelineno-0-891"><span class="linenos" data-linenos="891 "></span></a>                <span class="n">feature_version_filter</span> <span class="o">=</span> <span class="n">feature_cls</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="__span-0-892"><a id="__codelineno-0-892" name="__codelineno-0-892"></a><a href="#__codelineno-0-892"><span class="linenos" data-linenos="892 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-893"><a id="__codelineno-0-893" name="__codelineno-0-893"></a><a href="#__codelineno-0-893"><span class="linenos" data-linenos="893 "></span></a>                <span class="c1"># Feature not in graph - skip feature_version filtering</span>
</span><span id="__span-0-894"><a id="__codelineno-0-894" name="__codelineno-0-894"></a><a href="#__codelineno-0-894"><span class="linenos" data-linenos="894 "></span></a>                <span class="n">feature_version_filter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-895"><a id="__codelineno-0-895" name="__codelineno-0-895"></a><a href="#__codelineno-0-895"><span class="linenos" data-linenos="895 "></span></a>
</span><span id="__span-0-896"><a id="__codelineno-0-896" name="__codelineno-0-896"></a><a href="#__codelineno-0-896"><span class="linenos" data-linenos="896 "></span></a>    <span class="c1"># Try local first with filters</span>
</span><span id="__span-0-897"><a id="__codelineno-0-897" name="__codelineno-0-897"></a><a href="#__codelineno-0-897"><span class="linenos" data-linenos="897 "></span></a>    <span class="n">lazy_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-898"><a id="__codelineno-0-898" name="__codelineno-0-898"></a><a href="#__codelineno-0-898"><span class="linenos" data-linenos="898 "></span></a>        <span class="n">feature</span><span class="p">,</span>
</span><span id="__span-0-899"><a id="__codelineno-0-899" name="__codelineno-0-899"></a><a href="#__codelineno-0-899"><span class="linenos" data-linenos="899 "></span></a>        <span class="n">feature_version</span><span class="o">=</span><span class="n">feature_version_filter</span><span class="p">,</span>
</span><span id="__span-0-900"><a id="__codelineno-0-900" name="__codelineno-0-900"></a><a href="#__codelineno-0-900"><span class="linenos" data-linenos="900 "></span></a>        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>  <span class="c1"># Pass filters directly</span>
</span><span id="__span-0-901"><a id="__codelineno-0-901" name="__codelineno-0-901"></a><a href="#__codelineno-0-901"><span class="linenos" data-linenos="901 "></span></a>        <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
</span><span id="__span-0-902"><a id="__codelineno-0-902" name="__codelineno-0-902"></a><a href="#__codelineno-0-902"><span class="linenos" data-linenos="902 "></span></a>    <span class="p">)</span>
</span><span id="__span-0-903"><a id="__codelineno-0-903" name="__codelineno-0-903"></a><a href="#__codelineno-0-903"><span class="linenos" data-linenos="903 "></span></a>
</span><span id="__span-0-904"><a id="__codelineno-0-904" name="__codelineno-0-904"></a><a href="#__codelineno-0-904"><span class="linenos" data-linenos="904 "></span></a>    <span class="k">if</span> <span class="n">lazy_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-905"><a id="__codelineno-0-905" name="__codelineno-0-905"></a><a href="#__codelineno-0-905"><span class="linenos" data-linenos="905 "></span></a>        <span class="k">return</span> <span class="n">lazy_frame</span>
</span><span id="__span-0-906"><a id="__codelineno-0-906" name="__codelineno-0-906"></a><a href="#__codelineno-0-906"><span class="linenos" data-linenos="906 "></span></a>
</span><span id="__span-0-907"><a id="__codelineno-0-907" name="__codelineno-0-907"></a><a href="#__codelineno-0-907"><span class="linenos" data-linenos="907 "></span></a>    <span class="c1"># Try fallback stores</span>
</span><span id="__span-0-908"><a id="__codelineno-0-908" name="__codelineno-0-908"></a><a href="#__codelineno-0-908"><span class="linenos" data-linenos="908 "></span></a>    <span class="k">if</span> <span class="n">allow_fallback</span><span class="p">:</span>
</span><span id="__span-0-909"><a id="__codelineno-0-909" name="__codelineno-0-909"></a><a href="#__codelineno-0-909"><span class="linenos" data-linenos="909 "></span></a>        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-910"><a id="__codelineno-0-910" name="__codelineno-0-910"></a><a href="#__codelineno-0-910"><span class="linenos" data-linenos="910 "></span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-911"><a id="__codelineno-0-911" name="__codelineno-0-911"></a><a href="#__codelineno-0-911"><span class="linenos" data-linenos="911 "></span></a>                <span class="c1"># Use full read_metadata to handle nested fallback chains</span>
</span><span id="__span-0-912"><a id="__codelineno-0-912" name="__codelineno-0-912"></a><a href="#__codelineno-0-912"><span class="linenos" data-linenos="912 "></span></a>                <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span>
</span><span id="__span-0-913"><a id="__codelineno-0-913" name="__codelineno-0-913"></a><a href="#__codelineno-0-913"><span class="linenos" data-linenos="913 "></span></a>                    <span class="n">feature</span><span class="p">,</span>
</span><span id="__span-0-914"><a id="__codelineno-0-914" name="__codelineno-0-914"></a><a href="#__codelineno-0-914"><span class="linenos" data-linenos="914 "></span></a>                    <span class="n">feature_version</span><span class="o">=</span><span class="n">feature_version</span><span class="p">,</span>
</span><span id="__span-0-915"><a id="__codelineno-0-915" name="__codelineno-0-915"></a><a href="#__codelineno-0-915"><span class="linenos" data-linenos="915 "></span></a>                    <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>  <span class="c1"># Pass through filters directly</span>
</span><span id="__span-0-916"><a id="__codelineno-0-916" name="__codelineno-0-916"></a><a href="#__codelineno-0-916"><span class="linenos" data-linenos="916 "></span></a>                    <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
</span><span id="__span-0-917"><a id="__codelineno-0-917" name="__codelineno-0-917"></a><a href="#__codelineno-0-917"><span class="linenos" data-linenos="917 "></span></a>                    <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-918"><a id="__codelineno-0-918" name="__codelineno-0-918"></a><a href="#__codelineno-0-918"><span class="linenos" data-linenos="918 "></span></a>                    <span class="n">current_only</span><span class="o">=</span><span class="n">current_only</span><span class="p">,</span>  <span class="c1"># Pass through current_only</span>
</span><span id="__span-0-919"><a id="__codelineno-0-919" name="__codelineno-0-919"></a><a href="#__codelineno-0-919"><span class="linenos" data-linenos="919 "></span></a>                <span class="p">)</span>
</span><span id="__span-0-920"><a id="__codelineno-0-920" name="__codelineno-0-920"></a><a href="#__codelineno-0-920"><span class="linenos" data-linenos="920 "></span></a>            <span class="k">except</span> <span class="n">FeatureNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-921"><a id="__codelineno-0-921" name="__codelineno-0-921"></a><a href="#__codelineno-0-921"><span class="linenos" data-linenos="921 "></span></a>                <span class="c1"># Try next fallback store</span>
</span><span id="__span-0-922"><a id="__codelineno-0-922" name="__codelineno-0-922"></a><a href="#__codelineno-0-922"><span class="linenos" data-linenos="922 "></span></a>                <span class="k">continue</span>
</span><span id="__span-0-923"><a id="__codelineno-0-923" name="__codelineno-0-923"></a><a href="#__codelineno-0-923"><span class="linenos" data-linenos="923 "></span></a>
</span><span id="__span-0-924"><a id="__codelineno-0-924" name="__codelineno-0-924"></a><a href="#__codelineno-0-924"><span class="linenos" data-linenos="924 "></span></a>    <span class="c1"># Not found anywhere</span>
</span><span id="__span-0-925"><a id="__codelineno-0-925" name="__codelineno-0-925"></a><a href="#__codelineno-0-925"><span class="linenos" data-linenos="925 "></span></a>    <span class="k">raise</span> <span class="n">FeatureNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-926"><a id="__codelineno-0-926" name="__codelineno-0-926"></a><a href="#__codelineno-0-926"><span class="linenos" data-linenos="926 "></span></a>        <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2"> not found in store&quot;</span>
</span><span id="__span-0-927"><a id="__codelineno-0-927" name="__codelineno-0-927"></a><a href="#__codelineno-0-927"><span class="linenos" data-linenos="927 "></span></a>        <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; or fallback stores&quot;</span> <span class="k">if</span> <span class="n">allow_fallback</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a><a href="#__codelineno-0-928"><span class="linenos" data-linenos="928 "></span></a>    <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.has_feature" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">has_feature</span>


<a href="#metaxy.InMemoryMetadataStore.has_feature" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">has_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">check_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if feature exists in store.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature to check</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>check_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>If True, also check fallback stores</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
          –
          <div class="doc-md-description">
            <p>True if feature exists, False otherwise</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a><a href="#__codelineno-0-932"><span class="linenos" data-linenos="932 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">has_feature</span><span class="p">(</span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a><a href="#__codelineno-0-933"><span class="linenos" data-linenos="933 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a><a href="#__codelineno-0-934"><span class="linenos" data-linenos="934 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a><a href="#__codelineno-0-935"><span class="linenos" data-linenos="935 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a><a href="#__codelineno-0-936"><span class="linenos" data-linenos="936 "></span></a>    <span class="n">check_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a><a href="#__codelineno-0-937"><span class="linenos" data-linenos="937 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a><a href="#__codelineno-0-938"><span class="linenos" data-linenos="938 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a><a href="#__codelineno-0-939"><span class="linenos" data-linenos="939 "></span></a><span class="sd">    Check if feature exists in store.</span>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a><a href="#__codelineno-0-940"><span class="linenos" data-linenos="940 "></span></a>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a><a href="#__codelineno-0-941"><span class="linenos" data-linenos="941 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a><a href="#__codelineno-0-942"><span class="linenos" data-linenos="942 "></span></a><span class="sd">        feature: Feature to check</span>
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a><a href="#__codelineno-0-943"><span class="linenos" data-linenos="943 "></span></a><span class="sd">        check_fallback: If True, also check fallback stores</span>
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a><a href="#__codelineno-0-944"><span class="linenos" data-linenos="944 "></span></a>
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a><a href="#__codelineno-0-945"><span class="linenos" data-linenos="945 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a><a href="#__codelineno-0-946"><span class="linenos" data-linenos="946 "></span></a><span class="sd">        True if feature exists, False otherwise</span>
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a><a href="#__codelineno-0-947"><span class="linenos" data-linenos="947 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a><a href="#__codelineno-0-948"><span class="linenos" data-linenos="948 "></span></a>    <span class="c1"># Check local</span>
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a><a href="#__codelineno-0-949"><span class="linenos" data-linenos="949 "></span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a><a href="#__codelineno-0-950"><span class="linenos" data-linenos="950 "></span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a><a href="#__codelineno-0-951"><span class="linenos" data-linenos="951 "></span></a>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a><a href="#__codelineno-0-952"><span class="linenos" data-linenos="952 "></span></a>    <span class="c1"># Check fallback stores</span>
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a><a href="#__codelineno-0-953"><span class="linenos" data-linenos="953 "></span></a>    <span class="k">if</span> <span class="n">check_fallback</span><span class="p">:</span>
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a><a href="#__codelineno-0-954"><span class="linenos" data-linenos="954 "></span></a>        <span class="k">for</span> <span class="n">store</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">:</span>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a><a href="#__codelineno-0-955"><span class="linenos" data-linenos="955 "></span></a>            <span class="k">if</span> <span class="n">store</span><span class="o">.</span><span class="n">has_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">check_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a><a href="#__codelineno-0-956"><span class="linenos" data-linenos="956 "></span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a><a href="#__codelineno-0-957"><span class="linenos" data-linenos="957 "></span></a>
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a><a href="#__codelineno-0-958"><span class="linenos" data-linenos="958 "></span></a>    <span class="k">return</span> <span class="kc">False</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.read_graph_snapshots" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read_graph_snapshots</span>


<a href="#metaxy.InMemoryMetadataStore.read_graph_snapshots" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_graph_snapshots</span><span class="p">(</span><span class="n">project</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="polars.DataFrame">DataFrame</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read recorded graph snapshots from the feature_versions system table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>project</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Project name to filter by. If None, returns snapshots from all projects.</p>
          </div>
        </li>
    </ul>
        <p>Returns a DataFrame with columns:
- snapshot_version: Unique identifier for each graph snapshot
- recorded_at: Timestamp when the snapshot was recorded
- feature_count: Number of features in this snapshot</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <p>Polars DataFrame with snapshot information, sorted by recorded_at descending</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</span></code>
            –
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="k">with</span> <span class="n">store</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="c1"># Get snapshots for a specific project</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">snapshots</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read_graph_snapshots</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;my_project&quot;</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">latest_snapshot</span> <span class="o">=</span> <span class="n">snapshots</span><span class="p">[</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latest snapshot: </span><span class="si">{</span><span class="n">latest_snapshot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos="7 "></span></a>    <span class="c1"># Get snapshots across all projects</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos="8 "></span></a>    <span class="n">all_snapshots</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read_graph_snapshots</span><span class="p">()</span>
</span></code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a><a href="#__codelineno-0-971"><span class="linenos" data-linenos=" 971 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_graph_snapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a><a href="#__codelineno-0-972"><span class="linenos" data-linenos=" 972 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read recorded graph snapshots from the feature_versions system table.</span>
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a><a href="#__codelineno-0-973"><span class="linenos" data-linenos=" 973 "></span></a>
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a><a href="#__codelineno-0-974"><span class="linenos" data-linenos=" 974 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a><a href="#__codelineno-0-975"><span class="linenos" data-linenos=" 975 "></span></a><span class="sd">        project: Project name to filter by. If None, returns snapshots from all projects.</span>
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a><a href="#__codelineno-0-976"><span class="linenos" data-linenos=" 976 "></span></a>
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a><a href="#__codelineno-0-977"><span class="linenos" data-linenos=" 977 "></span></a><span class="sd">    Returns a DataFrame with columns:</span>
</span><span id="__span-0-978"><a id="__codelineno-0-978" name="__codelineno-0-978"></a><a href="#__codelineno-0-978"><span class="linenos" data-linenos=" 978 "></span></a><span class="sd">    - snapshot_version: Unique identifier for each graph snapshot</span>
</span><span id="__span-0-979"><a id="__codelineno-0-979" name="__codelineno-0-979"></a><a href="#__codelineno-0-979"><span class="linenos" data-linenos=" 979 "></span></a><span class="sd">    - recorded_at: Timestamp when the snapshot was recorded</span>
</span><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a><a href="#__codelineno-0-980"><span class="linenos" data-linenos=" 980 "></span></a><span class="sd">    - feature_count: Number of features in this snapshot</span>
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a><a href="#__codelineno-0-981"><span class="linenos" data-linenos=" 981 "></span></a>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a><a href="#__codelineno-0-982"><span class="linenos" data-linenos=" 982 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-983"><a id="__codelineno-0-983" name="__codelineno-0-983"></a><a href="#__codelineno-0-983"><span class="linenos" data-linenos=" 983 "></span></a><span class="sd">        Polars DataFrame with snapshot information, sorted by recorded_at descending</span>
</span><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a><a href="#__codelineno-0-984"><span class="linenos" data-linenos=" 984 "></span></a>
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a><a href="#__codelineno-0-985"><span class="linenos" data-linenos=" 985 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a><a href="#__codelineno-0-986"><span class="linenos" data-linenos=" 986 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a><a href="#__codelineno-0-987"><span class="linenos" data-linenos=" 987 "></span></a>
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a><a href="#__codelineno-0-988"><span class="linenos" data-linenos=" 988 "></span></a><span class="sd">    Example:</span>
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a><a href="#__codelineno-0-989"><span class="linenos" data-linenos=" 989 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a><a href="#__codelineno-0-990"><span class="linenos" data-linenos=" 990 "></span></a><span class="sd">        with store:</span>
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a><a href="#__codelineno-0-991"><span class="linenos" data-linenos=" 991 "></span></a><span class="sd">            # Get snapshots for a specific project</span>
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a><a href="#__codelineno-0-992"><span class="linenos" data-linenos=" 992 "></span></a><span class="sd">            snapshots = store.read_graph_snapshots(project=&quot;my_project&quot;)</span>
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a><a href="#__codelineno-0-993"><span class="linenos" data-linenos=" 993 "></span></a><span class="sd">            latest_snapshot = snapshots[SNAPSHOT_VERSION_COL][0]</span>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a><a href="#__codelineno-0-994"><span class="linenos" data-linenos=" 994 "></span></a><span class="sd">            print(f&quot;Latest snapshot: {latest_snapshot}&quot;)</span>
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a><a href="#__codelineno-0-995"><span class="linenos" data-linenos=" 995 "></span></a>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a><a href="#__codelineno-0-996"><span class="linenos" data-linenos=" 996 "></span></a><span class="sd">            # Get snapshots across all projects</span>
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a><a href="#__codelineno-0-997"><span class="linenos" data-linenos=" 997 "></span></a><span class="sd">            all_snapshots = store.read_graph_snapshots()</span>
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a><a href="#__codelineno-0-998"><span class="linenos" data-linenos=" 998 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a><a href="#__codelineno-0-999"><span class="linenos" data-linenos=" 999 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><a href="#__codelineno-0-1000"><span class="linenos" data-linenos="1000 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><a href="#__codelineno-0-1001"><span class="linenos" data-linenos="1001 "></span></a>
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><a href="#__codelineno-0-1002"><span class="linenos" data-linenos="1002 "></span></a>    <span class="c1"># Build filters based on project parameter</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><a href="#__codelineno-0-1003"><span class="linenos" data-linenos="1003 "></span></a>    <span class="n">filters</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><a href="#__codelineno-0-1004"><span class="linenos" data-linenos="1004 "></span></a>    <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><a href="#__codelineno-0-1005"><span class="linenos" data-linenos="1005 "></span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">narwhals</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nw</span>
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><a href="#__codelineno-0-1006"><span class="linenos" data-linenos="1006 "></span></a>
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><a href="#__codelineno-0-1007"><span class="linenos" data-linenos="1007 "></span></a>        <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">project</span><span class="p">]</span>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a><a href="#__codelineno-0-1008"><span class="linenos" data-linenos="1008 "></span></a>
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a><a href="#__codelineno-0-1009"><span class="linenos" data-linenos="1009 "></span></a>    <span class="n">versions_lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-1010"><a id="__codelineno-0-1010" name="__codelineno-0-1010"></a><a href="#__codelineno-0-1010"><span class="linenos" data-linenos="1010 "></span></a>        <span class="n">FEATURE_VERSIONS_KEY</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span>
</span><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><a href="#__codelineno-0-1011"><span class="linenos" data-linenos="1011 "></span></a>    <span class="p">)</span>
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><a href="#__codelineno-0-1012"><span class="linenos" data-linenos="1012 "></span></a>    <span class="k">if</span> <span class="n">versions_lazy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><a href="#__codelineno-0-1013"><span class="linenos" data-linenos="1013 "></span></a>        <span class="c1"># No snapshots recorded yet</span>
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><a href="#__codelineno-0-1014"><span class="linenos" data-linenos="1014 "></span></a>        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><a href="#__codelineno-0-1015"><span class="linenos" data-linenos="1015 "></span></a>            <span class="n">schema</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><a href="#__codelineno-0-1016"><span class="linenos" data-linenos="1016 "></span></a>                <span class="n">SNAPSHOT_VERSION_COL</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><a href="#__codelineno-0-1017"><span class="linenos" data-linenos="1017 "></span></a>                <span class="s2">&quot;recorded_at&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="s2">&quot;us&quot;</span><span class="p">),</span>
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><a href="#__codelineno-0-1018"><span class="linenos" data-linenos="1018 "></span></a>                <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">UInt32</span><span class="p">,</span>
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><a href="#__codelineno-0-1019"><span class="linenos" data-linenos="1019 "></span></a>            <span class="p">}</span>
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><a href="#__codelineno-0-1020"><span class="linenos" data-linenos="1020 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><a href="#__codelineno-0-1021"><span class="linenos" data-linenos="1021 "></span></a>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><a href="#__codelineno-0-1022"><span class="linenos" data-linenos="1022 "></span></a>    <span class="n">versions_df</span> <span class="o">=</span> <span class="n">versions_lazy</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><a href="#__codelineno-0-1023"><span class="linenos" data-linenos="1023 "></span></a>
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><a href="#__codelineno-0-1024"><span class="linenos" data-linenos="1024 "></span></a>    <span class="c1"># Group by snapshot_version and get earliest recorded_at and count</span>
</span><span id="__span-0-1025"><a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><a href="#__codelineno-0-1025"><span class="linenos" data-linenos="1025 "></span></a>    <span class="n">snapshots</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a><a href="#__codelineno-0-1026"><span class="linenos" data-linenos="1026 "></span></a>        <span class="n">versions_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">)</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><a href="#__codelineno-0-1027"><span class="linenos" data-linenos="1027 "></span></a>        <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><a href="#__codelineno-0-1028"><span class="linenos" data-linenos="1028 "></span></a>            <span class="p">[</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><a href="#__codelineno-0-1029"><span class="linenos" data-linenos="1029 "></span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;recorded_at&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;recorded_at&quot;</span><span class="p">),</span>
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><a href="#__codelineno-0-1030"><span class="linenos" data-linenos="1030 "></span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;feature_key&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;feature_count&quot;</span><span class="p">),</span>
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><a href="#__codelineno-0-1031"><span class="linenos" data-linenos="1031 "></span></a>            <span class="p">]</span>
</span><span id="__span-0-1032"><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><a href="#__codelineno-0-1032"><span class="linenos" data-linenos="1032 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><a href="#__codelineno-0-1033"><span class="linenos" data-linenos="1033 "></span></a>        <span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;recorded_at&quot;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><a href="#__codelineno-0-1034"><span class="linenos" data-linenos="1034 "></span></a>    <span class="p">)</span>
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><a href="#__codelineno-0-1035"><span class="linenos" data-linenos="1035 "></span></a>
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><a href="#__codelineno-0-1036"><span class="linenos" data-linenos="1036 "></span></a>    <span class="k">return</span> <span class="n">snapshots</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.read_features" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read_features</span>


<a href="#metaxy.InMemoryMetadataStore.read_features" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_features</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">current</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">snapshot_version</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="polars.DataFrame">DataFrame</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read feature version information from the feature_versions system table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>current</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True, only return features from the current code snapshot.
     If False, must provide snapshot_version.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>snapshot_version</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Specific snapshot version to filter by. Required if current=False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>project</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Project name to filter by. Defaults to None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <p>Polars DataFrame with columns from FEATURE_VERSIONS_SCHEMA:</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>feature_key: Feature identifier</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>feature_version: Version hash of the feature</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>recorded_at: When this version was recorded</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>feature_spec: JSON serialized feature specification</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>feature_class_path: Python import path to the feature class</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="polars.DataFrame">DataFrame</span></code>
          –
          <div class="doc-md-description">
            <ul>
<li>snapshot_version: Graph snapshot this feature belongs to</li>
</ul>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</span></code>
            –
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If current=False but no snapshot_version provided</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Get features from current code</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">with</span> <span class="n">store</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read_features</span><span class="p">(</span><span class="n">current</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current graph has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2"> features&quot;</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Get features from a specific snapshot</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="k">with</span> <span class="n">store</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">features</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read_features</span><span class="p">(</span><span class="n">current</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">snapshot_version</span><span class="o">=</span><span class="s2">&quot;abc123&quot;</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">named</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;feature_key&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;metaxy_feature_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><a href="#__codelineno-0-1038"><span class="linenos" data-linenos="1038 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_features</span><span class="p">(</span>
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><a href="#__codelineno-0-1039"><span class="linenos" data-linenos="1039 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><a href="#__codelineno-0-1040"><span class="linenos" data-linenos="1040 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><a href="#__codelineno-0-1041"><span class="linenos" data-linenos="1041 "></span></a>    <span class="n">current</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1042"><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><a href="#__codelineno-0-1042"><span class="linenos" data-linenos="1042 "></span></a>    <span class="n">snapshot_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><a href="#__codelineno-0-1043"><span class="linenos" data-linenos="1043 "></span></a>    <span class="n">project</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><a href="#__codelineno-0-1044"><span class="linenos" data-linenos="1044 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-1045"><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><a href="#__codelineno-0-1045"><span class="linenos" data-linenos="1045 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read feature version information from the feature_versions system table.</span>
</span><span id="__span-0-1046"><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><a href="#__codelineno-0-1046"><span class="linenos" data-linenos="1046 "></span></a>
</span><span id="__span-0-1047"><a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><a href="#__codelineno-0-1047"><span class="linenos" data-linenos="1047 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1048"><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><a href="#__codelineno-0-1048"><span class="linenos" data-linenos="1048 "></span></a><span class="sd">        current: If True, only return features from the current code snapshot.</span>
</span><span id="__span-0-1049"><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><a href="#__codelineno-0-1049"><span class="linenos" data-linenos="1049 "></span></a><span class="sd">                 If False, must provide snapshot_version.</span>
</span><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><a href="#__codelineno-0-1050"><span class="linenos" data-linenos="1050 "></span></a><span class="sd">        snapshot_version: Specific snapshot version to filter by. Required if current=False.</span>
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><a href="#__codelineno-0-1051"><span class="linenos" data-linenos="1051 "></span></a><span class="sd">        project: Project name to filter by. Defaults to None.</span>
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><a href="#__codelineno-0-1052"><span class="linenos" data-linenos="1052 "></span></a>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><a href="#__codelineno-0-1053"><span class="linenos" data-linenos="1053 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><a href="#__codelineno-0-1054"><span class="linenos" data-linenos="1054 "></span></a><span class="sd">        Polars DataFrame with columns from FEATURE_VERSIONS_SCHEMA:</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><a href="#__codelineno-0-1055"><span class="linenos" data-linenos="1055 "></span></a><span class="sd">        - feature_key: Feature identifier</span>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><a href="#__codelineno-0-1056"><span class="linenos" data-linenos="1056 "></span></a><span class="sd">        - feature_version: Version hash of the feature</span>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><a href="#__codelineno-0-1057"><span class="linenos" data-linenos="1057 "></span></a><span class="sd">        - recorded_at: When this version was recorded</span>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><a href="#__codelineno-0-1058"><span class="linenos" data-linenos="1058 "></span></a><span class="sd">        - feature_spec: JSON serialized feature specification</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><a href="#__codelineno-0-1059"><span class="linenos" data-linenos="1059 "></span></a><span class="sd">        - feature_class_path: Python import path to the feature class</span>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><a href="#__codelineno-0-1060"><span class="linenos" data-linenos="1060 "></span></a><span class="sd">        - snapshot_version: Graph snapshot this feature belongs to</span>
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><a href="#__codelineno-0-1061"><span class="linenos" data-linenos="1061 "></span></a>
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><a href="#__codelineno-0-1062"><span class="linenos" data-linenos="1062 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a><a href="#__codelineno-0-1063"><span class="linenos" data-linenos="1063 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><a href="#__codelineno-0-1064"><span class="linenos" data-linenos="1064 "></span></a><span class="sd">        ValueError: If current=False but no snapshot_version provided</span>
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><a href="#__codelineno-0-1065"><span class="linenos" data-linenos="1065 "></span></a>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><a href="#__codelineno-0-1066"><span class="linenos" data-linenos="1066 "></span></a><span class="sd">    Examples:</span>
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><a href="#__codelineno-0-1067"><span class="linenos" data-linenos="1067 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><a href="#__codelineno-0-1068"><span class="linenos" data-linenos="1068 "></span></a><span class="sd">        # Get features from current code</span>
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><a href="#__codelineno-0-1069"><span class="linenos" data-linenos="1069 "></span></a><span class="sd">        with store:</span>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><a href="#__codelineno-0-1070"><span class="linenos" data-linenos="1070 "></span></a><span class="sd">            features = store.read_features(current=True)</span>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><a href="#__codelineno-0-1071"><span class="linenos" data-linenos="1071 "></span></a><span class="sd">            print(f&quot;Current graph has {len(features)} features&quot;)</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><a href="#__codelineno-0-1072"><span class="linenos" data-linenos="1072 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><a href="#__codelineno-0-1073"><span class="linenos" data-linenos="1073 "></span></a>
</span><span id="__span-0-1074"><a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><a href="#__codelineno-0-1074"><span class="linenos" data-linenos="1074 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><a href="#__codelineno-0-1075"><span class="linenos" data-linenos="1075 "></span></a><span class="sd">        # Get features from a specific snapshot</span>
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><a href="#__codelineno-0-1076"><span class="linenos" data-linenos="1076 "></span></a><span class="sd">        with store:</span>
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><a href="#__codelineno-0-1077"><span class="linenos" data-linenos="1077 "></span></a><span class="sd">            features = store.read_features(current=False, snapshot_version=&quot;abc123&quot;)</span>
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><a href="#__codelineno-0-1078"><span class="linenos" data-linenos="1078 "></span></a><span class="sd">            for row in features.iter_rows(named=True):</span>
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><a href="#__codelineno-0-1079"><span class="linenos" data-linenos="1079 "></span></a><span class="sd">                print(f&quot;{row[&#39;feature_key&#39;]}: {row[&#39;metaxy_feature_version&#39;]}&quot;)</span>
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><a href="#__codelineno-0-1080"><span class="linenos" data-linenos="1080 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><a href="#__codelineno-0-1081"><span class="linenos" data-linenos="1081 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><a href="#__codelineno-0-1082"><span class="linenos" data-linenos="1082 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><a href="#__codelineno-0-1083"><span class="linenos" data-linenos="1083 "></span></a>
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><a href="#__codelineno-0-1084"><span class="linenos" data-linenos="1084 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="ow">and</span> <span class="n">snapshot_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1085"><a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><a href="#__codelineno-0-1085"><span class="linenos" data-linenos="1085 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide snapshot_version when current=False&quot;</span><span class="p">)</span>
</span><span id="__span-0-1086"><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><a href="#__codelineno-0-1086"><span class="linenos" data-linenos="1086 "></span></a>
</span><span id="__span-0-1087"><a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><a href="#__codelineno-0-1087"><span class="linenos" data-linenos="1087 "></span></a>    <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
</span><span id="__span-0-1088"><a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><a href="#__codelineno-0-1088"><span class="linenos" data-linenos="1088 "></span></a>        <span class="c1"># Get current snapshot from active graph</span>
</span><span id="__span-0-1089"><a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><a href="#__codelineno-0-1089"><span class="linenos" data-linenos="1089 "></span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-1090"><a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><a href="#__codelineno-0-1090"><span class="linenos" data-linenos="1090 "></span></a>        <span class="n">snapshot_version</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">snapshot_version</span>
</span><span id="__span-0-1091"><a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><a href="#__codelineno-0-1091"><span class="linenos" data-linenos="1091 "></span></a>
</span><span id="__span-0-1092"><a id="__codelineno-0-1092" name="__codelineno-0-1092"></a><a href="#__codelineno-0-1092"><span class="linenos" data-linenos="1092 "></span></a>    <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">SNAPSHOT_VERSION_COL</span><span class="p">)</span> <span class="o">==</span> <span class="n">snapshot_version</span><span class="p">]</span>
</span><span id="__span-0-1093"><a id="__codelineno-0-1093" name="__codelineno-0-1093"></a><a href="#__codelineno-0-1093"><span class="linenos" data-linenos="1093 "></span></a>    <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1094"><a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><a href="#__codelineno-0-1094"><span class="linenos" data-linenos="1094 "></span></a>        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">project</span><span class="p">)</span>
</span><span id="__span-0-1095"><a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><a href="#__codelineno-0-1095"><span class="linenos" data-linenos="1095 "></span></a>
</span><span id="__span-0-1096"><a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><a href="#__codelineno-0-1096"><span class="linenos" data-linenos="1096 "></span></a>    <span class="n">versions_lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-1097"><a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><a href="#__codelineno-0-1097"><span class="linenos" data-linenos="1097 "></span></a>        <span class="n">FEATURE_VERSIONS_KEY</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span>
</span><span id="__span-0-1098"><a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><a href="#__codelineno-0-1098"><span class="linenos" data-linenos="1098 "></span></a>    <span class="p">)</span>
</span><span id="__span-0-1099"><a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><a href="#__codelineno-0-1099"><span class="linenos" data-linenos="1099 "></span></a>    <span class="k">if</span> <span class="n">versions_lazy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1100"><a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><a href="#__codelineno-0-1100"><span class="linenos" data-linenos="1100 "></span></a>        <span class="c1"># No features recorded yet</span>
</span><span id="__span-0-1101"><a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><a href="#__codelineno-0-1101"><span class="linenos" data-linenos="1101 "></span></a>        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">FEATURE_VERSIONS_SCHEMA</span><span class="p">)</span>
</span><span id="__span-0-1102"><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><a href="#__codelineno-0-1102"><span class="linenos" data-linenos="1102 "></span></a>
</span><span id="__span-0-1103"><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><a href="#__codelineno-0-1103"><span class="linenos" data-linenos="1103 "></span></a>    <span class="c1"># Filter by snapshot_version</span>
</span><span id="__span-0-1104"><a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><a href="#__codelineno-0-1104"><span class="linenos" data-linenos="1104 "></span></a>    <span class="n">versions_df</span> <span class="o">=</span> <span class="n">versions_lazy</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
</span><span id="__span-0-1105"><a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><a href="#__codelineno-0-1105"><span class="linenos" data-linenos="1105 "></span></a>
</span><span id="__span-0-1106"><a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><a href="#__codelineno-0-1106"><span class="linenos" data-linenos="1106 "></span></a>    <span class="k">return</span> <span class="n">versions_df</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.copy_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">copy_metadata</span>


<a href="#metaxy.InMemoryMetadataStore.copy_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">copy_metadata</span><span class="p">(</span><span class="n">from_store</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="../#metaxy.MetadataStore">MetadataStore</a></span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">from_snapshot</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">incremental</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Copy metadata from another store with fine-grained filtering.</p>
<p>This is a reusable method that can be called programmatically or from CLI/migrations.
Copies metadata for specified features, preserving the original snapshot_version.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>from_store</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MetadataStore&lt;/span&gt; (&lt;code&gt;metaxy.metadata_store.base.MetadataStore&lt;/code&gt;)" href="../#metaxy.MetadataStore">MetadataStore</a></code>)
          –
          <div class="doc-md-description">
            <p>Source metadata store to copy from (must be opened)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>features</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>List of features to copy. Can be:
- None: copies all features from source store
- List of FeatureKey or Feature classes: copies specified features</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>from_snapshot</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Snapshot version to filter source data by. If None, uses latest snapshot
from source store. Only rows with this snapshot_version will be copied.
The snapshot_version is preserved in the destination store.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>]] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Dict mapping feature keys (as strings) to sequences of Narwhals filter expressions.
These filters are applied when reading from the source store.
Example: {"feature/key": [nw.col("x") &gt; 10], "other/feature": [...]}</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>incremental</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True (default), filter out rows that already exist in the destination
store by performing an anti-join on sample_uid for the same snapshot_version.</p>
<p>The implementation uses an anti-join: source LEFT ANTI JOIN destination ON sample_uid
filtered by snapshot_version.</p>
<p>Disabling incremental (incremental=False) may improve performance when:
- You know the destination is empty or has no overlap with source
- The destination store uses deduplication</p>
<p>When incremental=False, it's the user's responsibility to avoid duplicates or
configure deduplication at the storage layer.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
          –
          <div class="doc-md-description">
            <p>Dict with statistics: {"features_copied": int, "rows_copied": int}</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If from_store or self (destination) is not open</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.FeatureNotFoundError">FeatureNotFoundError</span></code>
            –
          <div class="doc-md-description">
            <p>If a specified feature doesn't exist in source store</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Simple: copy all features from latest snapshot</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span><span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Copy specific features from a specific snapshot</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">FeatureKey</span><span class="p">([</span><span class="s2">&quot;my_feature&quot;</span><span class="p">])],</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="n">from_snapshot</span><span class="o">=</span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">)</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Copy with filters</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my/feature&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;sample_uid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="s2">&quot;s2&quot;</span><span class="p">])]},</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">)</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1"># Copy specific features with filters</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">stats</span> <span class="o">=</span> <span class="n">dest_store</span><span class="o">.</span><span class="n">copy_metadata</span><span class="p">(</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">from_store</span><span class="o">=</span><span class="n">source_store</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">features</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="n">FeatureKey</span><span class="p">([</span><span class="s2">&quot;feature_a&quot;</span><span class="p">]),</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="n">FeatureKey</span><span class="p">([</span><span class="s2">&quot;feature_b&quot;</span><span class="p">]),</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="p">],</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">filters</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="s2">&quot;feature_a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;field_a&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;sample_uid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">([</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="s2">&quot;s2&quot;</span><span class="p">])],</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="s2">&quot;feature_b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;field_b&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">],</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="p">},</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="p">)</span>
</span></code></pre></div>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1108"><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><a href="#__codelineno-0-1108"><span class="linenos" data-linenos="1108 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">copy_metadata</span><span class="p">(</span>
</span><span id="__span-0-1109"><a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><a href="#__codelineno-0-1109"><span class="linenos" data-linenos="1109 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1110"><a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><a href="#__codelineno-0-1110"><span class="linenos" data-linenos="1110 "></span></a>    <span class="n">from_store</span><span class="p">:</span> <span class="n">MetadataStore</span><span class="p">,</span>
</span><span id="__span-0-1111"><a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><a href="#__codelineno-0-1111"><span class="linenos" data-linenos="1111 "></span></a>    <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1112"><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><a href="#__codelineno-0-1112"><span class="linenos" data-linenos="1112 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1113"><a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><a href="#__codelineno-0-1113"><span class="linenos" data-linenos="1113 "></span></a>    <span class="n">from_snapshot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1114"><a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><a href="#__codelineno-0-1114"><span class="linenos" data-linenos="1114 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1115"><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><a href="#__codelineno-0-1115"><span class="linenos" data-linenos="1115 "></span></a>    <span class="n">incremental</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1116"><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><a href="#__codelineno-0-1116"><span class="linenos" data-linenos="1116 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-1117"><a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><a href="#__codelineno-0-1117"><span class="linenos" data-linenos="1117 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy metadata from another store with fine-grained filtering.</span>
</span><span id="__span-0-1118"><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><a href="#__codelineno-0-1118"><span class="linenos" data-linenos="1118 "></span></a>
</span><span id="__span-0-1119"><a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><a href="#__codelineno-0-1119"><span class="linenos" data-linenos="1119 "></span></a><span class="sd">    This is a reusable method that can be called programmatically or from CLI/migrations.</span>
</span><span id="__span-0-1120"><a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><a href="#__codelineno-0-1120"><span class="linenos" data-linenos="1120 "></span></a><span class="sd">    Copies metadata for specified features, preserving the original snapshot_version.</span>
</span><span id="__span-0-1121"><a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><a href="#__codelineno-0-1121"><span class="linenos" data-linenos="1121 "></span></a>
</span><span id="__span-0-1122"><a id="__codelineno-0-1122" name="__codelineno-0-1122"></a><a href="#__codelineno-0-1122"><span class="linenos" data-linenos="1122 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1123"><a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><a href="#__codelineno-0-1123"><span class="linenos" data-linenos="1123 "></span></a><span class="sd">        from_store: Source metadata store to copy from (must be opened)</span>
</span><span id="__span-0-1124"><a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><a href="#__codelineno-0-1124"><span class="linenos" data-linenos="1124 "></span></a><span class="sd">        features: List of features to copy. Can be:</span>
</span><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><a href="#__codelineno-0-1125"><span class="linenos" data-linenos="1125 "></span></a><span class="sd">            - None: copies all features from source store</span>
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><a href="#__codelineno-0-1126"><span class="linenos" data-linenos="1126 "></span></a><span class="sd">            - List of FeatureKey or Feature classes: copies specified features</span>
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><a href="#__codelineno-0-1127"><span class="linenos" data-linenos="1127 "></span></a><span class="sd">        from_snapshot: Snapshot version to filter source data by. If None, uses latest snapshot</span>
</span><span id="__span-0-1128"><a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><a href="#__codelineno-0-1128"><span class="linenos" data-linenos="1128 "></span></a><span class="sd">            from source store. Only rows with this snapshot_version will be copied.</span>
</span><span id="__span-0-1129"><a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><a href="#__codelineno-0-1129"><span class="linenos" data-linenos="1129 "></span></a><span class="sd">            The snapshot_version is preserved in the destination store.</span>
</span><span id="__span-0-1130"><a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><a href="#__codelineno-0-1130"><span class="linenos" data-linenos="1130 "></span></a><span class="sd">        filters: Dict mapping feature keys (as strings) to sequences of Narwhals filter expressions.</span>
</span><span id="__span-0-1131"><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><a href="#__codelineno-0-1131"><span class="linenos" data-linenos="1131 "></span></a><span class="sd">            These filters are applied when reading from the source store.</span>
</span><span id="__span-0-1132"><a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><a href="#__codelineno-0-1132"><span class="linenos" data-linenos="1132 "></span></a><span class="sd">            Example: {&quot;feature/key&quot;: [nw.col(&quot;x&quot;) &gt; 10], &quot;other/feature&quot;: [...]}</span>
</span><span id="__span-0-1133"><a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><a href="#__codelineno-0-1133"><span class="linenos" data-linenos="1133 "></span></a><span class="sd">        incremental: If True (default), filter out rows that already exist in the destination</span>
</span><span id="__span-0-1134"><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><a href="#__codelineno-0-1134"><span class="linenos" data-linenos="1134 "></span></a><span class="sd">            store by performing an anti-join on sample_uid for the same snapshot_version.</span>
</span><span id="__span-0-1135"><a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><a href="#__codelineno-0-1135"><span class="linenos" data-linenos="1135 "></span></a>
</span><span id="__span-0-1136"><a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><a href="#__codelineno-0-1136"><span class="linenos" data-linenos="1136 "></span></a><span class="sd">            The implementation uses an anti-join: source LEFT ANTI JOIN destination ON sample_uid</span>
</span><span id="__span-0-1137"><a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><a href="#__codelineno-0-1137"><span class="linenos" data-linenos="1137 "></span></a><span class="sd">            filtered by snapshot_version.</span>
</span><span id="__span-0-1138"><a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><a href="#__codelineno-0-1138"><span class="linenos" data-linenos="1138 "></span></a>
</span><span id="__span-0-1139"><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><a href="#__codelineno-0-1139"><span class="linenos" data-linenos="1139 "></span></a><span class="sd">            Disabling incremental (incremental=False) may improve performance when:</span>
</span><span id="__span-0-1140"><a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><a href="#__codelineno-0-1140"><span class="linenos" data-linenos="1140 "></span></a><span class="sd">            - You know the destination is empty or has no overlap with source</span>
</span><span id="__span-0-1141"><a id="__codelineno-0-1141" name="__codelineno-0-1141"></a><a href="#__codelineno-0-1141"><span class="linenos" data-linenos="1141 "></span></a><span class="sd">            - The destination store uses deduplication</span>
</span><span id="__span-0-1142"><a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><a href="#__codelineno-0-1142"><span class="linenos" data-linenos="1142 "></span></a>
</span><span id="__span-0-1143"><a id="__codelineno-0-1143" name="__codelineno-0-1143"></a><a href="#__codelineno-0-1143"><span class="linenos" data-linenos="1143 "></span></a><span class="sd">            When incremental=False, it&#39;s the user&#39;s responsibility to avoid duplicates or</span>
</span><span id="__span-0-1144"><a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><a href="#__codelineno-0-1144"><span class="linenos" data-linenos="1144 "></span></a><span class="sd">            configure deduplication at the storage layer.</span>
</span><span id="__span-0-1145"><a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><a href="#__codelineno-0-1145"><span class="linenos" data-linenos="1145 "></span></a>
</span><span id="__span-0-1146"><a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><a href="#__codelineno-0-1146"><span class="linenos" data-linenos="1146 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1147"><a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><a href="#__codelineno-0-1147"><span class="linenos" data-linenos="1147 "></span></a><span class="sd">        Dict with statistics: {&quot;features_copied&quot;: int, &quot;rows_copied&quot;: int}</span>
</span><span id="__span-0-1148"><a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><a href="#__codelineno-0-1148"><span class="linenos" data-linenos="1148 "></span></a>
</span><span id="__span-0-1149"><a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><a href="#__codelineno-0-1149"><span class="linenos" data-linenos="1149 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1150"><a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><a href="#__codelineno-0-1150"><span class="linenos" data-linenos="1150 "></span></a><span class="sd">        ValueError: If from_store or self (destination) is not open</span>
</span><span id="__span-0-1151"><a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><a href="#__codelineno-0-1151"><span class="linenos" data-linenos="1151 "></span></a><span class="sd">        FeatureNotFoundError: If a specified feature doesn&#39;t exist in source store</span>
</span><span id="__span-0-1152"><a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><a href="#__codelineno-0-1152"><span class="linenos" data-linenos="1152 "></span></a>
</span><span id="__span-0-1153"><a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><a href="#__codelineno-0-1153"><span class="linenos" data-linenos="1153 "></span></a><span class="sd">    Examples:</span>
</span><span id="__span-0-1154"><a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><a href="#__codelineno-0-1154"><span class="linenos" data-linenos="1154 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1155"><a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><a href="#__codelineno-0-1155"><span class="linenos" data-linenos="1155 "></span></a><span class="sd">        # Simple: copy all features from latest snapshot</span>
</span><span id="__span-0-1156"><a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><a href="#__codelineno-0-1156"><span class="linenos" data-linenos="1156 "></span></a><span class="sd">        stats = dest_store.copy_metadata(from_store=source_store)</span>
</span><span id="__span-0-1157"><a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><a href="#__codelineno-0-1157"><span class="linenos" data-linenos="1157 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1158"><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><a href="#__codelineno-0-1158"><span class="linenos" data-linenos="1158 "></span></a>
</span><span id="__span-0-1159"><a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><a href="#__codelineno-0-1159"><span class="linenos" data-linenos="1159 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1160"><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><a href="#__codelineno-0-1160"><span class="linenos" data-linenos="1160 "></span></a><span class="sd">        # Copy specific features from a specific snapshot</span>
</span><span id="__span-0-1161"><a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><a href="#__codelineno-0-1161"><span class="linenos" data-linenos="1161 "></span></a><span class="sd">        stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-1162"><a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><a href="#__codelineno-0-1162"><span class="linenos" data-linenos="1162 "></span></a><span class="sd">            from_store=source_store,</span>
</span><span id="__span-0-1163"><a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><a href="#__codelineno-0-1163"><span class="linenos" data-linenos="1163 "></span></a><span class="sd">            features=[FeatureKey([&quot;my_feature&quot;])],</span>
</span><span id="__span-0-1164"><a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><a href="#__codelineno-0-1164"><span class="linenos" data-linenos="1164 "></span></a><span class="sd">            from_snapshot=&quot;abc123&quot;,</span>
</span><span id="__span-0-1165"><a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><a href="#__codelineno-0-1165"><span class="linenos" data-linenos="1165 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-1166"><a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><a href="#__codelineno-0-1166"><span class="linenos" data-linenos="1166 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1167"><a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><a href="#__codelineno-0-1167"><span class="linenos" data-linenos="1167 "></span></a>
</span><span id="__span-0-1168"><a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><a href="#__codelineno-0-1168"><span class="linenos" data-linenos="1168 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1169"><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><a href="#__codelineno-0-1169"><span class="linenos" data-linenos="1169 "></span></a><span class="sd">        # Copy with filters</span>
</span><span id="__span-0-1170"><a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><a href="#__codelineno-0-1170"><span class="linenos" data-linenos="1170 "></span></a><span class="sd">        stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-1171"><a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><a href="#__codelineno-0-1171"><span class="linenos" data-linenos="1171 "></span></a><span class="sd">            from_store=source_store,</span>
</span><span id="__span-0-1172"><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><a href="#__codelineno-0-1172"><span class="linenos" data-linenos="1172 "></span></a><span class="sd">            filters={&quot;my/feature&quot;: [nw.col(&quot;sample_uid&quot;).is_in([&quot;s1&quot;, &quot;s2&quot;])]},</span>
</span><span id="__span-0-1173"><a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><a href="#__codelineno-0-1173"><span class="linenos" data-linenos="1173 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-1174"><a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><a href="#__codelineno-0-1174"><span class="linenos" data-linenos="1174 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1175"><a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><a href="#__codelineno-0-1175"><span class="linenos" data-linenos="1175 "></span></a>
</span><span id="__span-0-1176"><a id="__codelineno-0-1176" name="__codelineno-0-1176"></a><a href="#__codelineno-0-1176"><span class="linenos" data-linenos="1176 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1177"><a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><a href="#__codelineno-0-1177"><span class="linenos" data-linenos="1177 "></span></a><span class="sd">        # Copy specific features with filters</span>
</span><span id="__span-0-1178"><a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><a href="#__codelineno-0-1178"><span class="linenos" data-linenos="1178 "></span></a><span class="sd">        stats = dest_store.copy_metadata(</span>
</span><span id="__span-0-1179"><a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><a href="#__codelineno-0-1179"><span class="linenos" data-linenos="1179 "></span></a><span class="sd">            from_store=source_store,</span>
</span><span id="__span-0-1180"><a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><a href="#__codelineno-0-1180"><span class="linenos" data-linenos="1180 "></span></a><span class="sd">            features=[</span>
</span><span id="__span-0-1181"><a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><a href="#__codelineno-0-1181"><span class="linenos" data-linenos="1181 "></span></a><span class="sd">                FeatureKey([&quot;feature_a&quot;]),</span>
</span><span id="__span-0-1182"><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><a href="#__codelineno-0-1182"><span class="linenos" data-linenos="1182 "></span></a><span class="sd">                FeatureKey([&quot;feature_b&quot;]),</span>
</span><span id="__span-0-1183"><a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><a href="#__codelineno-0-1183"><span class="linenos" data-linenos="1183 "></span></a><span class="sd">            ],</span>
</span><span id="__span-0-1184"><a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><a href="#__codelineno-0-1184"><span class="linenos" data-linenos="1184 "></span></a><span class="sd">            filters={</span>
</span><span id="__span-0-1185"><a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><a href="#__codelineno-0-1185"><span class="linenos" data-linenos="1185 "></span></a><span class="sd">                &quot;feature_a&quot;: [nw.col(&quot;field_a&quot;) &gt; 10, nw.col(&quot;sample_uid&quot;).is_in([&quot;s1&quot;, &quot;s2&quot;])],</span>
</span><span id="__span-0-1186"><a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><a href="#__codelineno-0-1186"><span class="linenos" data-linenos="1186 "></span></a><span class="sd">                &quot;feature_b&quot;: [nw.col(&quot;field_b&quot;) &lt; 30],</span>
</span><span id="__span-0-1187"><a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><a href="#__codelineno-0-1187"><span class="linenos" data-linenos="1187 "></span></a><span class="sd">            },</span>
</span><span id="__span-0-1188"><a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><a href="#__codelineno-0-1188"><span class="linenos" data-linenos="1188 "></span></a><span class="sd">        )</span>
</span><span id="__span-0-1189"><a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><a href="#__codelineno-0-1189"><span class="linenos" data-linenos="1189 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1190"><a id="__codelineno-0-1190" name="__codelineno-0-1190"></a><a href="#__codelineno-0-1190"><span class="linenos" data-linenos="1190 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1191"><a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><a href="#__codelineno-0-1191"><span class="linenos" data-linenos="1191 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-0-1192"><a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><a href="#__codelineno-0-1192"><span class="linenos" data-linenos="1192 "></span></a>
</span><span id="__span-0-1193"><a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><a href="#__codelineno-0-1193"><span class="linenos" data-linenos="1193 "></span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-1194"><a id="__codelineno-0-1194" name="__codelineno-0-1194"></a><a href="#__codelineno-0-1194"><span class="linenos" data-linenos="1194 "></span></a>
</span><span id="__span-0-1195"><a id="__codelineno-0-1195" name="__codelineno-0-1195"></a><a href="#__codelineno-0-1195"><span class="linenos" data-linenos="1195 "></span></a>    <span class="c1"># Validate destination store is open</span>
</span><span id="__span-0-1196"><a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><a href="#__codelineno-0-1196"><span class="linenos" data-linenos="1196 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span><span class="p">:</span>
</span><span id="__span-0-1197"><a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><a href="#__codelineno-0-1197"><span class="linenos" data-linenos="1197 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Destination store must be opened (use context manager)&quot;</span><span class="p">)</span>
</span><span id="__span-0-1198"><a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><a href="#__codelineno-0-1198"><span class="linenos" data-linenos="1198 "></span></a>
</span><span id="__span-0-1199"><a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><a href="#__codelineno-0-1199"><span class="linenos" data-linenos="1199 "></span></a>    <span class="c1"># Automatically handle source store context manager</span>
</span><span id="__span-0-1200"><a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><a href="#__codelineno-0-1200"><span class="linenos" data-linenos="1200 "></span></a>    <span class="n">should_close_source</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">from_store</span><span class="o">.</span><span class="n">_is_open</span>
</span><span id="__span-0-1201"><a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><a href="#__codelineno-0-1201"><span class="linenos" data-linenos="1201 "></span></a>    <span class="k">if</span> <span class="n">should_close_source</span><span class="p">:</span>
</span><span id="__span-0-1202"><a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><a href="#__codelineno-0-1202"><span class="linenos" data-linenos="1202 "></span></a>        <span class="n">from_store</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
</span><span id="__span-0-1203"><a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><a href="#__codelineno-0-1203"><span class="linenos" data-linenos="1203 "></span></a>
</span><span id="__span-0-1204"><a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><a href="#__codelineno-0-1204"><span class="linenos" data-linenos="1204 "></span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1205"><a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><a href="#__codelineno-0-1205"><span class="linenos" data-linenos="1205 "></span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_metadata_impl</span><span class="p">(</span>
</span><span id="__span-0-1206"><a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><a href="#__codelineno-0-1206"><span class="linenos" data-linenos="1206 "></span></a>            <span class="n">from_store</span><span class="o">=</span><span class="n">from_store</span><span class="p">,</span>
</span><span id="__span-0-1207"><a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><a href="#__codelineno-0-1207"><span class="linenos" data-linenos="1207 "></span></a>            <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
</span><span id="__span-0-1208"><a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><a href="#__codelineno-0-1208"><span class="linenos" data-linenos="1208 "></span></a>            <span class="n">from_snapshot</span><span class="o">=</span><span class="n">from_snapshot</span><span class="p">,</span>
</span><span id="__span-0-1209"><a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><a href="#__codelineno-0-1209"><span class="linenos" data-linenos="1209 "></span></a>            <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
</span><span id="__span-0-1210"><a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><a href="#__codelineno-0-1210"><span class="linenos" data-linenos="1210 "></span></a>            <span class="n">incremental</span><span class="o">=</span><span class="n">incremental</span><span class="p">,</span>
</span><span id="__span-0-1211"><a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><a href="#__codelineno-0-1211"><span class="linenos" data-linenos="1211 "></span></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
</span><span id="__span-0-1212"><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><a href="#__codelineno-0-1212"><span class="linenos" data-linenos="1212 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-1213"><a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><a href="#__codelineno-0-1213"><span class="linenos" data-linenos="1213 "></span></a>    <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-1214"><a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><a href="#__codelineno-0-1214"><span class="linenos" data-linenos="1214 "></span></a>        <span class="k">if</span> <span class="n">should_close_source</span><span class="p">:</span>
</span><span id="__span-0-1215"><a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><a href="#__codelineno-0-1215"><span class="linenos" data-linenos="1215 "></span></a>            <span class="n">from_store</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.read_upstream_metadata" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read_upstream_metadata</span>


<a href="#metaxy.InMemoryMetadataStore.read_upstream_metadata" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_upstream_metadata</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="n">field</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FieldKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FieldKey&lt;/code&gt;)" href="../../definitions/field/#metaxy.FieldKey">FieldKey</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">allow_fallback</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">current_only</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read all upstream dependencies for a feature/field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature whose dependencies to load</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>field</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FieldKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FieldKey&lt;/code&gt;)" href="../../definitions/field/#metaxy.FieldKey">FieldKey</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Specific field (if None, loads all deps for feature)</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>]] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Dict mapping feature keys (as strings) to lists of Narwhals filter expressions.
Example: {"upstream/feature1": [nw.col("x") &gt; 10], "upstream/feature2": [...]}</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>allow_fallback</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>Whether to check fallback stores</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>current_only</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>If True, only read current feature_version for upstream</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code>
          –
          <div class="doc-md-description">
            <p>Dict mapping upstream feature keys (as strings) to Narwhals LazyFrames.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code>
          –
          <div class="doc-md-description">
            <p>Each LazyFrame has a 'metaxy_provenance_by_field' column (Struct).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.DependencyError">DependencyError</span></code>
            –
          <div class="doc-md-description">
            <p>If required upstream feature is missing</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1427"><a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><a href="#__codelineno-0-1427"><span class="linenos" data-linenos="1427 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_upstream_metadata</span><span class="p">(</span>
</span><span id="__span-0-1428"><a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><a href="#__codelineno-0-1428"><span class="linenos" data-linenos="1428 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1429"><a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><a href="#__codelineno-0-1429"><span class="linenos" data-linenos="1429 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-1430"><a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><a href="#__codelineno-0-1430"><span class="linenos" data-linenos="1430 "></span></a>    <span class="n">field</span><span class="p">:</span> <span class="n">FieldKey</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1431"><a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><a href="#__codelineno-0-1431"><span class="linenos" data-linenos="1431 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1432"><a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><a href="#__codelineno-0-1432"><span class="linenos" data-linenos="1432 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1433"><a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><a href="#__codelineno-0-1433"><span class="linenos" data-linenos="1433 "></span></a>    <span class="n">allow_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1434"><a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><a href="#__codelineno-0-1434"><span class="linenos" data-linenos="1434 "></span></a>    <span class="n">current_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-1435"><a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><a href="#__codelineno-0-1435"><span class="linenos" data-linenos="1435 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span id="__span-0-1436"><a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><a href="#__codelineno-0-1436"><span class="linenos" data-linenos="1436 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1437"><a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><a href="#__codelineno-0-1437"><span class="linenos" data-linenos="1437 "></span></a><span class="sd">    Read all upstream dependencies for a feature/field.</span>
</span><span id="__span-0-1438"><a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><a href="#__codelineno-0-1438"><span class="linenos" data-linenos="1438 "></span></a>
</span><span id="__span-0-1439"><a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><a href="#__codelineno-0-1439"><span class="linenos" data-linenos="1439 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1440"><a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><a href="#__codelineno-0-1440"><span class="linenos" data-linenos="1440 "></span></a><span class="sd">        feature: Feature whose dependencies to load</span>
</span><span id="__span-0-1441"><a id="__codelineno-0-1441" name="__codelineno-0-1441"></a><a href="#__codelineno-0-1441"><span class="linenos" data-linenos="1441 "></span></a><span class="sd">        field: Specific field (if None, loads all deps for feature)</span>
</span><span id="__span-0-1442"><a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><a href="#__codelineno-0-1442"><span class="linenos" data-linenos="1442 "></span></a><span class="sd">        filters: Dict mapping feature keys (as strings) to lists of Narwhals filter expressions.</span>
</span><span id="__span-0-1443"><a id="__codelineno-0-1443" name="__codelineno-0-1443"></a><a href="#__codelineno-0-1443"><span class="linenos" data-linenos="1443 "></span></a><span class="sd">            Example: {&quot;upstream/feature1&quot;: [nw.col(&quot;x&quot;) &gt; 10], &quot;upstream/feature2&quot;: [...]}</span>
</span><span id="__span-0-1444"><a id="__codelineno-0-1444" name="__codelineno-0-1444"></a><a href="#__codelineno-0-1444"><span class="linenos" data-linenos="1444 "></span></a><span class="sd">        allow_fallback: Whether to check fallback stores</span>
</span><span id="__span-0-1445"><a id="__codelineno-0-1445" name="__codelineno-0-1445"></a><a href="#__codelineno-0-1445"><span class="linenos" data-linenos="1445 "></span></a><span class="sd">        current_only: If True, only read current feature_version for upstream</span>
</span><span id="__span-0-1446"><a id="__codelineno-0-1446" name="__codelineno-0-1446"></a><a href="#__codelineno-0-1446"><span class="linenos" data-linenos="1446 "></span></a>
</span><span id="__span-0-1447"><a id="__codelineno-0-1447" name="__codelineno-0-1447"></a><a href="#__codelineno-0-1447"><span class="linenos" data-linenos="1447 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1448"><a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><a href="#__codelineno-0-1448"><span class="linenos" data-linenos="1448 "></span></a><span class="sd">        Dict mapping upstream feature keys (as strings) to Narwhals LazyFrames.</span>
</span><span id="__span-0-1449"><a id="__codelineno-0-1449" name="__codelineno-0-1449"></a><a href="#__codelineno-0-1449"><span class="linenos" data-linenos="1449 "></span></a><span class="sd">        Each LazyFrame has a &#39;metaxy_provenance_by_field&#39; column (Struct).</span>
</span><span id="__span-0-1450"><a id="__codelineno-0-1450" name="__codelineno-0-1450"></a><a href="#__codelineno-0-1450"><span class="linenos" data-linenos="1450 "></span></a>
</span><span id="__span-0-1451"><a id="__codelineno-0-1451" name="__codelineno-0-1451"></a><a href="#__codelineno-0-1451"><span class="linenos" data-linenos="1451 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1452"><a id="__codelineno-0-1452" name="__codelineno-0-1452"></a><a href="#__codelineno-0-1452"><span class="linenos" data-linenos="1452 "></span></a><span class="sd">        DependencyError: If required upstream feature is missing</span>
</span><span id="__span-0-1453"><a id="__codelineno-0-1453" name="__codelineno-0-1453"></a><a href="#__codelineno-0-1453"><span class="linenos" data-linenos="1453 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1454"><a id="__codelineno-0-1454" name="__codelineno-0-1454"></a><a href="#__codelineno-0-1454"><span class="linenos" data-linenos="1454 "></span></a>    <span class="n">plan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_plan</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-1455"><a id="__codelineno-0-1455" name="__codelineno-0-1455"></a><a href="#__codelineno-0-1455"><span class="linenos" data-linenos="1455 "></span></a>
</span><span id="__span-0-1456"><a id="__codelineno-0-1456" name="__codelineno-0-1456"></a><a href="#__codelineno-0-1456"><span class="linenos" data-linenos="1456 "></span></a>    <span class="c1"># Get all upstream features we need</span>
</span><span id="__span-0-1457"><a id="__codelineno-0-1457" name="__codelineno-0-1457"></a><a href="#__codelineno-0-1457"><span class="linenos" data-linenos="1457 "></span></a>    <span class="n">upstream_features</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-0-1458"><a id="__codelineno-0-1458" name="__codelineno-0-1458"></a><a href="#__codelineno-0-1458"><span class="linenos" data-linenos="1458 "></span></a>
</span><span id="__span-0-1459"><a id="__codelineno-0-1459" name="__codelineno-0-1459"></a><a href="#__codelineno-0-1459"><span class="linenos" data-linenos="1459 "></span></a>    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1460"><a id="__codelineno-0-1460" name="__codelineno-0-1460"></a><a href="#__codelineno-0-1460"><span class="linenos" data-linenos="1460 "></span></a>        <span class="c1"># All fields&#39; dependencies</span>
</span><span id="__span-0-1461"><a id="__codelineno-0-1461" name="__codelineno-0-1461"></a><a href="#__codelineno-0-1461"><span class="linenos" data-linenos="1461 "></span></a>        <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">plan</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="__span-0-1462"><a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><a href="#__codelineno-0-1462"><span class="linenos" data-linenos="1462 "></span></a>            <span class="n">upstream_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_field_dependencies</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="n">cont</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
</span><span id="__span-0-1463"><a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><a href="#__codelineno-0-1463"><span class="linenos" data-linenos="1463 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1464"><a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><a href="#__codelineno-0-1464"><span class="linenos" data-linenos="1464 "></span></a>        <span class="c1"># Specific field&#39;s dependencies</span>
</span><span id="__span-0-1465"><a id="__codelineno-0-1465" name="__codelineno-0-1465"></a><a href="#__codelineno-0-1465"><span class="linenos" data-linenos="1465 "></span></a>        <span class="n">upstream_features</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_field_dependencies</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="n">field</span><span class="p">))</span>
</span><span id="__span-0-1466"><a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><a href="#__codelineno-0-1466"><span class="linenos" data-linenos="1466 "></span></a>
</span><span id="__span-0-1467"><a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><a href="#__codelineno-0-1467"><span class="linenos" data-linenos="1467 "></span></a>    <span class="c1"># Load metadata for each upstream feature</span>
</span><span id="__span-0-1468"><a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><a href="#__codelineno-0-1468"><span class="linenos" data-linenos="1468 "></span></a>    <span class="c1"># Use the feature&#39;s graph to look up upstream feature classes</span>
</span><span id="__span-0-1469"><a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><a href="#__codelineno-0-1469"><span class="linenos" data-linenos="1469 "></span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">FeatureKey</span><span class="p">):</span>
</span><span id="__span-0-1470"><a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><a href="#__codelineno-0-1470"><span class="linenos" data-linenos="1470 "></span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.models.feature</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureGraph</span>
</span><span id="__span-0-1471"><a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><a href="#__codelineno-0-1471"><span class="linenos" data-linenos="1471 "></span></a>
</span><span id="__span-0-1472"><a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><a href="#__codelineno-0-1472"><span class="linenos" data-linenos="1472 "></span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">FeatureGraph</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
</span><span id="__span-0-1473"><a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><a href="#__codelineno-0-1473"><span class="linenos" data-linenos="1473 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1474"><a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><a href="#__codelineno-0-1474"><span class="linenos" data-linenos="1474 "></span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">graph</span>
</span><span id="__span-0-1475"><a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><a href="#__codelineno-0-1475"><span class="linenos" data-linenos="1475 "></span></a>
</span><span id="__span-0-1476"><a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><a href="#__codelineno-0-1476"><span class="linenos" data-linenos="1476 "></span></a>    <span class="n">upstream_metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1477"><a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><a href="#__codelineno-0-1477"><span class="linenos" data-linenos="1477 "></span></a>    <span class="k">for</span> <span class="n">upstream_fq_key</span> <span class="ow">in</span> <span class="n">upstream_features</span><span class="p">:</span>
</span><span id="__span-0-1478"><a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><a href="#__codelineno-0-1478"><span class="linenos" data-linenos="1478 "></span></a>        <span class="n">upstream_feature_key</span> <span class="o">=</span> <span class="n">upstream_fq_key</span><span class="o">.</span><span class="n">feature</span>
</span><span id="__span-0-1479"><a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><a href="#__codelineno-0-1479"><span class="linenos" data-linenos="1479 "></span></a>
</span><span id="__span-0-1480"><a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><a href="#__codelineno-0-1480"><span class="linenos" data-linenos="1480 "></span></a>        <span class="c1"># Extract filters for this specific upstream feature</span>
</span><span id="__span-0-1481"><a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><a href="#__codelineno-0-1481"><span class="linenos" data-linenos="1481 "></span></a>        <span class="n">upstream_filters</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-1482"><a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><a href="#__codelineno-0-1482"><span class="linenos" data-linenos="1482 "></span></a>        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="__span-0-1483"><a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><a href="#__codelineno-0-1483"><span class="linenos" data-linenos="1483 "></span></a>            <span class="n">upstream_key_str</span> <span class="o">=</span> <span class="n">upstream_feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</span><span id="__span-0-1484"><a id="__codelineno-0-1484" name="__codelineno-0-1484"></a><a href="#__codelineno-0-1484"><span class="linenos" data-linenos="1484 "></span></a>            <span class="k">if</span> <span class="n">upstream_key_str</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="__span-0-1485"><a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><a href="#__codelineno-0-1485"><span class="linenos" data-linenos="1485 "></span></a>                <span class="n">upstream_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="n">upstream_key_str</span><span class="p">]</span>
</span><span id="__span-0-1486"><a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><a href="#__codelineno-0-1486"><span class="linenos" data-linenos="1486 "></span></a>
</span><span id="__span-0-1487"><a id="__codelineno-0-1487" name="__codelineno-0-1487"></a><a href="#__codelineno-0-1487"><span class="linenos" data-linenos="1487 "></span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1488"><a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><a href="#__codelineno-0-1488"><span class="linenos" data-linenos="1488 "></span></a>            <span class="c1"># Look up the Feature class from the graph and pass it to read_metadata</span>
</span><span id="__span-0-1489"><a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><a href="#__codelineno-0-1489"><span class="linenos" data-linenos="1489 "></span></a>            <span class="c1"># This way we use the bound graph instead of relying on active context</span>
</span><span id="__span-0-1490"><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a><a href="#__codelineno-0-1490"><span class="linenos" data-linenos="1490 "></span></a>            <span class="n">upstream_feature_cls</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">features_by_key</span><span class="p">[</span><span class="n">upstream_feature_key</span><span class="p">]</span>
</span><span id="__span-0-1491"><a id="__codelineno-0-1491" name="__codelineno-0-1491"></a><a href="#__codelineno-0-1491"><span class="linenos" data-linenos="1491 "></span></a>            <span class="n">lazy_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata</span><span class="p">(</span>
</span><span id="__span-0-1492"><a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><a href="#__codelineno-0-1492"><span class="linenos" data-linenos="1492 "></span></a>                <span class="n">upstream_feature_cls</span><span class="p">,</span>
</span><span id="__span-0-1493"><a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><a href="#__codelineno-0-1493"><span class="linenos" data-linenos="1493 "></span></a>                <span class="n">filters</span><span class="o">=</span><span class="n">upstream_filters</span><span class="p">,</span>  <span class="c1"># Pass extracted filters (Sequence or None)</span>
</span><span id="__span-0-1494"><a id="__codelineno-0-1494" name="__codelineno-0-1494"></a><a href="#__codelineno-0-1494"><span class="linenos" data-linenos="1494 "></span></a>                <span class="n">allow_fallback</span><span class="o">=</span><span class="n">allow_fallback</span><span class="p">,</span>
</span><span id="__span-0-1495"><a id="__codelineno-0-1495" name="__codelineno-0-1495"></a><a href="#__codelineno-0-1495"><span class="linenos" data-linenos="1495 "></span></a>                <span class="n">current_only</span><span class="o">=</span><span class="n">current_only</span><span class="p">,</span>  <span class="c1"># Pass through current_only</span>
</span><span id="__span-0-1496"><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><a href="#__codelineno-0-1496"><span class="linenos" data-linenos="1496 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1497"><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><a href="#__codelineno-0-1497"><span class="linenos" data-linenos="1497 "></span></a>            <span class="c1"># Use string key for dict</span>
</span><span id="__span-0-1498"><a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><a href="#__codelineno-0-1498"><span class="linenos" data-linenos="1498 "></span></a>            <span class="n">upstream_metadata</span><span class="p">[</span><span class="n">upstream_feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()]</span> <span class="o">=</span> <span class="n">lazy_frame</span>
</span><span id="__span-0-1499"><a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><a href="#__codelineno-0-1499"><span class="linenos" data-linenos="1499 "></span></a>        <span class="k">except</span> <span class="n">FeatureNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-1500"><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><a href="#__codelineno-0-1500"><span class="linenos" data-linenos="1500 "></span></a>            <span class="k">raise</span> <span class="n">DependencyError</span><span class="p">(</span>
</span><span id="__span-0-1501"><a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><a href="#__codelineno-0-1501"><span class="linenos" data-linenos="1501 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Missing upstream feature </span><span class="si">{</span><span class="n">upstream_feature_key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="__span-0-1502"><a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><a href="#__codelineno-0-1502"><span class="linenos" data-linenos="1502 "></span></a>                <span class="sa">f</span><span class="s2">&quot;required by </span><span class="si">{</span><span class="n">plan</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-1503"><a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><a href="#__codelineno-0-1503"><span class="linenos" data-linenos="1503 "></span></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="__span-0-1504"><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><a href="#__codelineno-0-1504"><span class="linenos" data-linenos="1504 "></span></a>
</span><span id="__span-0-1505"><a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><a href="#__codelineno-0-1505"><span class="linenos" data-linenos="1505 "></span></a>    <span class="k">return</span> <span class="n">upstream_metadata</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.resolve_update" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">resolve_update</span>


<a href="#metaxy.InMemoryMetadataStore.resolve_update" class="headerlink" title="Permanent link">&para;</a></h4>
          <div class="doc-overloads">
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">resolve_update</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lazy</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Increment&lt;/span&gt; (&lt;code&gt;metaxy.provenance.types.Increment&lt;/code&gt;)" href="../../types/#metaxy.provenance.types.Increment">Increment</a></span>
</span></code></pre></div><div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">resolve_update</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lazy</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Literal&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span><span class="kc">True</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;LazyIncrement&lt;/span&gt; (&lt;code&gt;metaxy.provenance.types.LazyIncrement&lt;/code&gt;)" href="../../types/#metaxy.provenance.types.LazyIncrement">LazyIncrement</a></span>
</span></code></pre></div>          </div>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">resolve_update</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lazy</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Increment&lt;/span&gt; (&lt;code&gt;metaxy.provenance.types.Increment&lt;/code&gt;)" href="../../types/#metaxy.provenance.types.Increment">Increment</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;LazyIncrement&lt;/span&gt; (&lt;code&gt;metaxy.provenance.types.LazyIncrement&lt;/code&gt;)" href="../../types/#metaxy.provenance.types.LazyIncrement">LazyIncrement</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate an incremental update for a feature.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature class to resolve updates for</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>samples</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.DataFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/dataframe/#narwhals.dataframe.DataFrame">DataFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>] | <a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Pre-computed DataFrame with ID columns
and <code>PROVENANCE_BY_FIELD_COL</code> column. When provided, <code>MetadataStore</code> skips upstream loading, joining,
and field provenance calculation.</p>
<p><strong>Required for root features</strong> (features with no upstream dependencies).
Root features don't have upstream to calculate <code>PROVENANCE_BY_FIELD_COL</code> from, so users
must provide samples with manually computed <code>PROVENANCE_BY_FIELD_COL</code> column.</p>
<p>For non-root features, use this when you
want to bypass the automatic upstream loading and field provenance calculation.</p>
<p>Examples:</p>
<ul>
<li>
<p>Loading upstream from custom sources</p>
</li>
<li>
<p>Pre-computing field provenances with custom logic</p>
</li>
<li>
<p>Testing specific scenarios</p>
</li>
</ul>
<p>Setting this parameter during normal operations is not required.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Mapping&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping">Mapping</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>]] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Dict mapping feature keys (as strings) to lists of Narwhals filter expressions.
Applied when reading upstream metadata to filter samples at the source.
Example: {"upstream/feature": [nw.col("x") &gt; 10], ...}</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>lazy</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>If <code>True</code>, return <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;LazyIncrement&lt;/span&gt;" href="../../types/#metaxy.provenance.types.LazyIncrement">metaxy.provenance.types.LazyIncrement</a> with lazy Narwhals LazyFrames.
If <code>False</code>, return <a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Increment&lt;/span&gt;" href="../../types/#metaxy.provenance.types.Increment">metaxy.provenance.types.Increment</a> with eager Narwhals DataFrames.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>**kwargs</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Backend-specific parameters</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If no <code>samples</code> DataFrame has been provided when resolving an update for a root feature.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Root feature - samples required</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">samples</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>    <span class="s2">&quot;sample_uid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="n">PROVENANCE_BY_FIELD_COL</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;h1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;h2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;h3&quot;</span><span class="p">}],</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">})</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a><span class="n">result</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">resolve_update</span><span class="p">(</span><span class="n">RootFeature</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Non-root feature - automatic (normal usage)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">result</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">resolve_update</span><span class="p">(</span><span class="n">DownstreamFeature</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-py highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="c1"># Non-root feature - with escape hatch (advanced)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">custom_samples</span> <span class="o">=</span> <span class="n">compute_custom_field_provenance</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">result</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">resolve_update</span><span class="p">(</span><span class="n">DownstreamFeature</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">custom_samples</span><span class="p">)</span>
</span></code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Users can then process only added/changed and call write_metadata().</p>
</details>

            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/base.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1565"><a id="__codelineno-0-1565" name="__codelineno-0-1565"></a><a href="#__codelineno-0-1565"><span class="linenos" data-linenos="1565 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">resolve_update</span><span class="p">(</span>
</span><span id="__span-0-1566"><a id="__codelineno-0-1566" name="__codelineno-0-1566"></a><a href="#__codelineno-0-1566"><span class="linenos" data-linenos="1566 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1567"><a id="__codelineno-0-1567" name="__codelineno-0-1567"></a><a href="#__codelineno-0-1567"><span class="linenos" data-linenos="1567 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-1568"><a id="__codelineno-0-1568" name="__codelineno-0-1568"></a><a href="#__codelineno-0-1568"><span class="linenos" data-linenos="1568 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-1569"><a id="__codelineno-0-1569" name="__codelineno-0-1569"></a><a href="#__codelineno-0-1569"><span class="linenos" data-linenos="1569 "></span></a>    <span class="n">samples</span><span class="p">:</span> <span class="n">nw</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1570"><a id="__codelineno-0-1570" name="__codelineno-0-1570"></a><a href="#__codelineno-0-1570"><span class="linenos" data-linenos="1570 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1571"><a id="__codelineno-0-1571" name="__codelineno-0-1571"></a><a href="#__codelineno-0-1571"><span class="linenos" data-linenos="1571 "></span></a>    <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1572"><a id="__codelineno-0-1572" name="__codelineno-0-1572"></a><a href="#__codelineno-0-1572"><span class="linenos" data-linenos="1572 "></span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="__span-0-1573"><a id="__codelineno-0-1573" name="__codelineno-0-1573"></a><a href="#__codelineno-0-1573"><span class="linenos" data-linenos="1573 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Increment</span> <span class="o">|</span> <span class="n">LazyIncrement</span><span class="p">:</span>
</span><span id="__span-0-1574"><a id="__codelineno-0-1574" name="__codelineno-0-1574"></a><a href="#__codelineno-0-1574"><span class="linenos" data-linenos="1574 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate an incremental update for a feature.</span>
</span><span id="__span-0-1575"><a id="__codelineno-0-1575" name="__codelineno-0-1575"></a><a href="#__codelineno-0-1575"><span class="linenos" data-linenos="1575 "></span></a>
</span><span id="__span-0-1576"><a id="__codelineno-0-1576" name="__codelineno-0-1576"></a><a href="#__codelineno-0-1576"><span class="linenos" data-linenos="1576 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-1577"><a id="__codelineno-0-1577" name="__codelineno-0-1577"></a><a href="#__codelineno-0-1577"><span class="linenos" data-linenos="1577 "></span></a><span class="sd">        feature: Feature class to resolve updates for</span>
</span><span id="__span-0-1578"><a id="__codelineno-0-1578" name="__codelineno-0-1578"></a><a href="#__codelineno-0-1578"><span class="linenos" data-linenos="1578 "></span></a><span class="sd">        samples: Pre-computed DataFrame with ID columns</span>
</span><span id="__span-0-1579"><a id="__codelineno-0-1579" name="__codelineno-0-1579"></a><a href="#__codelineno-0-1579"><span class="linenos" data-linenos="1579 "></span></a><span class="sd">            and `PROVENANCE_BY_FIELD_COL` column. When provided, `MetadataStore` skips upstream loading, joining,</span>
</span><span id="__span-0-1580"><a id="__codelineno-0-1580" name="__codelineno-0-1580"></a><a href="#__codelineno-0-1580"><span class="linenos" data-linenos="1580 "></span></a><span class="sd">            and field provenance calculation.</span>
</span><span id="__span-0-1581"><a id="__codelineno-0-1581" name="__codelineno-0-1581"></a><a href="#__codelineno-0-1581"><span class="linenos" data-linenos="1581 "></span></a>
</span><span id="__span-0-1582"><a id="__codelineno-0-1582" name="__codelineno-0-1582"></a><a href="#__codelineno-0-1582"><span class="linenos" data-linenos="1582 "></span></a><span class="sd">            **Required for root features** (features with no upstream dependencies).</span>
</span><span id="__span-0-1583"><a id="__codelineno-0-1583" name="__codelineno-0-1583"></a><a href="#__codelineno-0-1583"><span class="linenos" data-linenos="1583 "></span></a><span class="sd">            Root features don&#39;t have upstream to calculate `PROVENANCE_BY_FIELD_COL` from, so users</span>
</span><span id="__span-0-1584"><a id="__codelineno-0-1584" name="__codelineno-0-1584"></a><a href="#__codelineno-0-1584"><span class="linenos" data-linenos="1584 "></span></a><span class="sd">            must provide samples with manually computed `PROVENANCE_BY_FIELD_COL` column.</span>
</span><span id="__span-0-1585"><a id="__codelineno-0-1585" name="__codelineno-0-1585"></a><a href="#__codelineno-0-1585"><span class="linenos" data-linenos="1585 "></span></a>
</span><span id="__span-0-1586"><a id="__codelineno-0-1586" name="__codelineno-0-1586"></a><a href="#__codelineno-0-1586"><span class="linenos" data-linenos="1586 "></span></a><span class="sd">            For non-root features, use this when you</span>
</span><span id="__span-0-1587"><a id="__codelineno-0-1587" name="__codelineno-0-1587"></a><a href="#__codelineno-0-1587"><span class="linenos" data-linenos="1587 "></span></a><span class="sd">            want to bypass the automatic upstream loading and field provenance calculation.</span>
</span><span id="__span-0-1588"><a id="__codelineno-0-1588" name="__codelineno-0-1588"></a><a href="#__codelineno-0-1588"><span class="linenos" data-linenos="1588 "></span></a>
</span><span id="__span-0-1589"><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a><a href="#__codelineno-0-1589"><span class="linenos" data-linenos="1589 "></span></a><span class="sd">            Examples:</span>
</span><span id="__span-0-1590"><a id="__codelineno-0-1590" name="__codelineno-0-1590"></a><a href="#__codelineno-0-1590"><span class="linenos" data-linenos="1590 "></span></a>
</span><span id="__span-0-1591"><a id="__codelineno-0-1591" name="__codelineno-0-1591"></a><a href="#__codelineno-0-1591"><span class="linenos" data-linenos="1591 "></span></a><span class="sd">            - Loading upstream from custom sources</span>
</span><span id="__span-0-1592"><a id="__codelineno-0-1592" name="__codelineno-0-1592"></a><a href="#__codelineno-0-1592"><span class="linenos" data-linenos="1592 "></span></a>
</span><span id="__span-0-1593"><a id="__codelineno-0-1593" name="__codelineno-0-1593"></a><a href="#__codelineno-0-1593"><span class="linenos" data-linenos="1593 "></span></a><span class="sd">            - Pre-computing field provenances with custom logic</span>
</span><span id="__span-0-1594"><a id="__codelineno-0-1594" name="__codelineno-0-1594"></a><a href="#__codelineno-0-1594"><span class="linenos" data-linenos="1594 "></span></a>
</span><span id="__span-0-1595"><a id="__codelineno-0-1595" name="__codelineno-0-1595"></a><a href="#__codelineno-0-1595"><span class="linenos" data-linenos="1595 "></span></a><span class="sd">            - Testing specific scenarios</span>
</span><span id="__span-0-1596"><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><a href="#__codelineno-0-1596"><span class="linenos" data-linenos="1596 "></span></a>
</span><span id="__span-0-1597"><a id="__codelineno-0-1597" name="__codelineno-0-1597"></a><a href="#__codelineno-0-1597"><span class="linenos" data-linenos="1597 "></span></a><span class="sd">            Setting this parameter during normal operations is not required.</span>
</span><span id="__span-0-1598"><a id="__codelineno-0-1598" name="__codelineno-0-1598"></a><a href="#__codelineno-0-1598"><span class="linenos" data-linenos="1598 "></span></a>
</span><span id="__span-0-1599"><a id="__codelineno-0-1599" name="__codelineno-0-1599"></a><a href="#__codelineno-0-1599"><span class="linenos" data-linenos="1599 "></span></a><span class="sd">        filters: Dict mapping feature keys (as strings) to lists of Narwhals filter expressions.</span>
</span><span id="__span-0-1600"><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a><a href="#__codelineno-0-1600"><span class="linenos" data-linenos="1600 "></span></a><span class="sd">            Applied when reading upstream metadata to filter samples at the source.</span>
</span><span id="__span-0-1601"><a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><a href="#__codelineno-0-1601"><span class="linenos" data-linenos="1601 "></span></a><span class="sd">            Example: {&quot;upstream/feature&quot;: [nw.col(&quot;x&quot;) &gt; 10], ...}</span>
</span><span id="__span-0-1602"><a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><a href="#__codelineno-0-1602"><span class="linenos" data-linenos="1602 "></span></a><span class="sd">        lazy: If `True`, return [metaxy.provenance.types.LazyIncrement][] with lazy Narwhals LazyFrames.</span>
</span><span id="__span-0-1603"><a id="__codelineno-0-1603" name="__codelineno-0-1603"></a><a href="#__codelineno-0-1603"><span class="linenos" data-linenos="1603 "></span></a><span class="sd">            If `False`, return [metaxy.provenance.types.Increment][] with eager Narwhals DataFrames.</span>
</span><span id="__span-0-1604"><a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><a href="#__codelineno-0-1604"><span class="linenos" data-linenos="1604 "></span></a><span class="sd">        **kwargs: Backend-specific parameters</span>
</span><span id="__span-0-1605"><a id="__codelineno-0-1605" name="__codelineno-0-1605"></a><a href="#__codelineno-0-1605"><span class="linenos" data-linenos="1605 "></span></a>
</span><span id="__span-0-1606"><a id="__codelineno-0-1606" name="__codelineno-0-1606"></a><a href="#__codelineno-0-1606"><span class="linenos" data-linenos="1606 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-1607"><a id="__codelineno-0-1607" name="__codelineno-0-1607"></a><a href="#__codelineno-0-1607"><span class="linenos" data-linenos="1607 "></span></a><span class="sd">        ValueError: If no `samples` DataFrame has been provided when resolving an update for a root feature.</span>
</span><span id="__span-0-1608"><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a><a href="#__codelineno-0-1608"><span class="linenos" data-linenos="1608 "></span></a>
</span><span id="__span-0-1609"><a id="__codelineno-0-1609" name="__codelineno-0-1609"></a><a href="#__codelineno-0-1609"><span class="linenos" data-linenos="1609 "></span></a><span class="sd">    Examples:</span>
</span><span id="__span-0-1610"><a id="__codelineno-0-1610" name="__codelineno-0-1610"></a><a href="#__codelineno-0-1610"><span class="linenos" data-linenos="1610 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1611"><a id="__codelineno-0-1611" name="__codelineno-0-1611"></a><a href="#__codelineno-0-1611"><span class="linenos" data-linenos="1611 "></span></a><span class="sd">        # Root feature - samples required</span>
</span><span id="__span-0-1612"><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a><a href="#__codelineno-0-1612"><span class="linenos" data-linenos="1612 "></span></a><span class="sd">        samples = pl.DataFrame({</span>
</span><span id="__span-0-1613"><a id="__codelineno-0-1613" name="__codelineno-0-1613"></a><a href="#__codelineno-0-1613"><span class="linenos" data-linenos="1613 "></span></a><span class="sd">            &quot;sample_uid&quot;: [1, 2, 3],</span>
</span><span id="__span-0-1614"><a id="__codelineno-0-1614" name="__codelineno-0-1614"></a><a href="#__codelineno-0-1614"><span class="linenos" data-linenos="1614 "></span></a><span class="sd">            PROVENANCE_BY_FIELD_COL: [{&quot;field&quot;: &quot;h1&quot;}, {&quot;field&quot;: &quot;h2&quot;}, {&quot;field&quot;: &quot;h3&quot;}],</span>
</span><span id="__span-0-1615"><a id="__codelineno-0-1615" name="__codelineno-0-1615"></a><a href="#__codelineno-0-1615"><span class="linenos" data-linenos="1615 "></span></a><span class="sd">        })</span>
</span><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a><a href="#__codelineno-0-1616"><span class="linenos" data-linenos="1616 "></span></a><span class="sd">        result = store.resolve_update(RootFeature, samples=nw.from_native(samples))</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a><a href="#__codelineno-0-1617"><span class="linenos" data-linenos="1617 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a><a href="#__codelineno-0-1618"><span class="linenos" data-linenos="1618 "></span></a>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a><a href="#__codelineno-0-1619"><span class="linenos" data-linenos="1619 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a><a href="#__codelineno-0-1620"><span class="linenos" data-linenos="1620 "></span></a><span class="sd">        # Non-root feature - automatic (normal usage)</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a><a href="#__codelineno-0-1621"><span class="linenos" data-linenos="1621 "></span></a><span class="sd">        result = store.resolve_update(DownstreamFeature)</span>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a><a href="#__codelineno-0-1622"><span class="linenos" data-linenos="1622 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a><a href="#__codelineno-0-1623"><span class="linenos" data-linenos="1623 "></span></a>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a><a href="#__codelineno-0-1624"><span class="linenos" data-linenos="1624 "></span></a><span class="sd">        ```py</span>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a><a href="#__codelineno-0-1625"><span class="linenos" data-linenos="1625 "></span></a><span class="sd">        # Non-root feature - with escape hatch (advanced)</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a><a href="#__codelineno-0-1626"><span class="linenos" data-linenos="1626 "></span></a><span class="sd">        custom_samples = compute_custom_field_provenance(...)</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a><a href="#__codelineno-0-1627"><span class="linenos" data-linenos="1627 "></span></a><span class="sd">        result = store.resolve_update(DownstreamFeature, samples=custom_samples)</span>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a><a href="#__codelineno-0-1628"><span class="linenos" data-linenos="1628 "></span></a><span class="sd">        ```</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a><a href="#__codelineno-0-1629"><span class="linenos" data-linenos="1629 "></span></a>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a><a href="#__codelineno-0-1630"><span class="linenos" data-linenos="1630 "></span></a><span class="sd">    Note:</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a><a href="#__codelineno-0-1631"><span class="linenos" data-linenos="1631 "></span></a><span class="sd">        Users can then process only added/changed and call write_metadata().</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a><a href="#__codelineno-0-1632"><span class="linenos" data-linenos="1632 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><a href="#__codelineno-0-1633"><span class="linenos" data-linenos="1633 "></span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">narwhals</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nw</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a><a href="#__codelineno-0-1634"><span class="linenos" data-linenos="1634 "></span></a>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><a href="#__codelineno-0-1635"><span class="linenos" data-linenos="1635 "></span></a>    <span class="n">plan</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_feature_plan</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">spec</span><span class="p">()</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a><a href="#__codelineno-0-1636"><span class="linenos" data-linenos="1636 "></span></a>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a><a href="#__codelineno-0-1637"><span class="linenos" data-linenos="1637 "></span></a>    <span class="c1"># Escape hatch: if samples provided, use them directly (skip join/calculation)</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a><a href="#__codelineno-0-1638"><span class="linenos" data-linenos="1638 "></span></a>    <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a><a href="#__codelineno-0-1639"><span class="linenos" data-linenos="1639 "></span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-0-1640"><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a><a href="#__codelineno-0-1640"><span class="linenos" data-linenos="1640 "></span></a>
</span><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a><a href="#__codelineno-0-1641"><span class="linenos" data-linenos="1641 "></span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a><a href="#__codelineno-0-1642"><span class="linenos" data-linenos="1642 "></span></a>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a><a href="#__codelineno-0-1643"><span class="linenos" data-linenos="1643 "></span></a>        <span class="c1"># Check if samples are Polars-backed</span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a><a href="#__codelineno-0-1644"><span class="linenos" data-linenos="1644 "></span></a>        <span class="n">is_polars_samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">implementation</span> <span class="o">==</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a><a href="#__codelineno-0-1645"><span class="linenos" data-linenos="1645 "></span></a>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a><a href="#__codelineno-0-1646"><span class="linenos" data-linenos="1646 "></span></a>        <span class="c1"># Determine which tracker to use</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a><a href="#__codelineno-0-1647"><span class="linenos" data-linenos="1647 "></span></a>        <span class="n">use_polars_tracker</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a><a href="#__codelineno-0-1648"><span class="linenos" data-linenos="1648 "></span></a>        <span class="k">if</span> <span class="n">is_polars_samples</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supports_native_components</span><span class="p">():</span>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a><a href="#__codelineno-0-1649"><span class="linenos" data-linenos="1649 "></span></a>            <span class="c1"># User provided Polars samples but store uses native (SQL) backend</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a><a href="#__codelineno-0-1650"><span class="linenos" data-linenos="1650 "></span></a>            <span class="c1"># Need to materialize current metadata to Polars for compatibility</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a><a href="#__codelineno-0-1651"><span class="linenos" data-linenos="1651 "></span></a>            <span class="c1"># and use Polars tracker</span>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a><a href="#__codelineno-0-1652"><span class="linenos" data-linenos="1652 "></span></a>            <span class="n">use_polars_tracker</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a><a href="#__codelineno-0-1653"><span class="linenos" data-linenos="1653 "></span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><a href="#__codelineno-0-1654"><span class="linenos" data-linenos="1654 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature</span><span class="o">.</span><span class="n">spec</span><span class="p">()</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">: samples parameter is Polars-backed but store uses native SQL backend. &quot;</span>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a><a href="#__codelineno-0-1655"><span class="linenos" data-linenos="1655 "></span></a>                <span class="sa">f</span><span class="s2">&quot;Materializing current metadata to Polars for diff comparison. &quot;</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a><a href="#__codelineno-0-1656"><span class="linenos" data-linenos="1656 "></span></a>                <span class="sa">f</span><span class="s2">&quot;For better performance, consider using samples with backend matching the store&#39;s backend.&quot;</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><a href="#__codelineno-0-1657"><span class="linenos" data-linenos="1657 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a><a href="#__codelineno-0-1658"><span class="linenos" data-linenos="1658 "></span></a>            <span class="c1"># Get current metadata and materialize to Polars</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><a href="#__codelineno-0-1659"><span class="linenos" data-linenos="1659 "></span></a>            <span class="n">current_lazy_native</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><a href="#__codelineno-0-1660"><span class="linenos" data-linenos="1660 "></span></a>                <span class="n">feature</span><span class="p">,</span> <span class="n">feature_version</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><a href="#__codelineno-0-1661"><span class="linenos" data-linenos="1661 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><a href="#__codelineno-0-1662"><span class="linenos" data-linenos="1662 "></span></a>            <span class="k">if</span> <span class="n">current_lazy_native</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><a href="#__codelineno-0-1663"><span class="linenos" data-linenos="1663 "></span></a>                <span class="c1"># Convert to Polars using Narwhals&#39; built-in method</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><a href="#__codelineno-0-1664"><span class="linenos" data-linenos="1664 "></span></a>                <span class="n">current_lazy</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><a href="#__codelineno-0-1665"><span class="linenos" data-linenos="1665 "></span></a>                    <span class="n">current_lazy_native</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><a href="#__codelineno-0-1666"><span class="linenos" data-linenos="1666 "></span></a>                <span class="p">)</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><a href="#__codelineno-0-1667"><span class="linenos" data-linenos="1667 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><a href="#__codelineno-0-1668"><span class="linenos" data-linenos="1668 "></span></a>                <span class="n">current_lazy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><a href="#__codelineno-0-1669"><span class="linenos" data-linenos="1669 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><a href="#__codelineno-0-1670"><span class="linenos" data-linenos="1670 "></span></a>            <span class="c1"># Same backend or no conversion needed - direct read</span>
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><a href="#__codelineno-0-1671"><span class="linenos" data-linenos="1671 "></span></a>            <span class="n">current_lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><a href="#__codelineno-0-1672"><span class="linenos" data-linenos="1672 "></span></a>                <span class="n">feature</span><span class="p">,</span> <span class="n">feature_version</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_version</span><span class="p">()</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><a href="#__codelineno-0-1673"><span class="linenos" data-linenos="1673 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><a href="#__codelineno-0-1674"><span class="linenos" data-linenos="1674 "></span></a>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><a href="#__codelineno-0-1675"><span class="linenos" data-linenos="1675 "></span></a>        <span class="c1"># Use ProvenanceTracker to compare samples with current metadata</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><a href="#__codelineno-0-1676"><span class="linenos" data-linenos="1676 "></span></a>        <span class="c1"># For root features (or when samples are explicitly provided), we pass the samples</span>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a><a href="#__codelineno-0-1677"><span class="linenos" data-linenos="1677 "></span></a>        <span class="c1"># to the tracker which will validate and diff them</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><a href="#__codelineno-0-1678"><span class="linenos" data-linenos="1678 "></span></a>        <span class="c1"># Use Polars tracker if samples are Polars-backed and we converted current to Polars</span>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a><a href="#__codelineno-0-1679"><span class="linenos" data-linenos="1679 "></span></a>        <span class="k">if</span> <span class="n">use_polars_tracker</span><span class="p">:</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a><a href="#__codelineno-0-1680"><span class="linenos" data-linenos="1680 "></span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">metaxy.provenance.polars</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolarsProvenanceTracker</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><a href="#__codelineno-0-1681"><span class="linenos" data-linenos="1681 "></span></a>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><a href="#__codelineno-0-1682"><span class="linenos" data-linenos="1682 "></span></a>            <span class="c1"># Polars tracker doesn&#39;t need context manager - direct instantiation</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><a href="#__codelineno-0-1683"><span class="linenos" data-linenos="1683 "></span></a>            <span class="n">tracker</span> <span class="o">=</span> <span class="n">PolarsProvenanceTracker</span><span class="p">(</span><span class="n">plan</span><span class="o">=</span><span class="n">plan</span><span class="p">)</span>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><a href="#__codelineno-0-1684"><span class="linenos" data-linenos="1684 "></span></a>            <span class="n">tracker_cm</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><a href="#__codelineno-0-1685"><span class="linenos" data-linenos="1685 "></span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a><a href="#__codelineno-0-1686"><span class="linenos" data-linenos="1686 "></span></a>            <span class="c1"># Native tracker needs context manager</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a><a href="#__codelineno-0-1687"><span class="linenos" data-linenos="1687 "></span></a>            <span class="n">tracker_cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_provenance_tracker</span><span class="p">(</span><span class="n">plan</span><span class="p">)</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a><a href="#__codelineno-0-1688"><span class="linenos" data-linenos="1688 "></span></a>            <span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker_cm</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a><a href="#__codelineno-0-1689"><span class="linenos" data-linenos="1689 "></span></a>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a><a href="#__codelineno-0-1690"><span class="linenos" data-linenos="1690 "></span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1691"><a id="__codelineno-0-1691" name="__codelineno-0-1691"></a><a href="#__codelineno-0-1691"><span class="linenos" data-linenos="1691 "></span></a>            <span class="n">samples</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">add_provenance_column</span><span class="p">(</span>
</span><span id="__span-0-1692"><a id="__codelineno-0-1692" name="__codelineno-0-1692"></a><a href="#__codelineno-0-1692"><span class="linenos" data-linenos="1692 "></span></a>                <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">samples</span><span class="p">),</span> <span class="n">hash_algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span>
</span><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><a href="#__codelineno-0-1693"><span class="linenos" data-linenos="1693 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a><a href="#__codelineno-0-1694"><span class="linenos" data-linenos="1694 "></span></a>            <span class="n">added</span><span class="p">,</span> <span class="n">changed</span><span class="p">,</span> <span class="n">removed</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">resolve_increment_with_provenance</span><span class="p">(</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a><a href="#__codelineno-0-1695"><span class="linenos" data-linenos="1695 "></span></a>                <span class="n">current</span><span class="o">=</span><span class="n">current_lazy</span><span class="p">,</span>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><a href="#__codelineno-0-1696"><span class="linenos" data-linenos="1696 "></span></a>                <span class="n">upstream</span><span class="o">=</span><span class="p">{},</span>  <span class="c1"># Empty upstream - samples already have provenance_by_field computed</span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a><a href="#__codelineno-0-1697"><span class="linenos" data-linenos="1697 "></span></a>                <span class="n">hash_algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm</span><span class="p">,</span>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><a href="#__codelineno-0-1698"><span class="linenos" data-linenos="1698 "></span></a>                <span class="n">filters</span><span class="o">=</span><span class="p">{},</span>  <span class="c1"># No additional filters - samples define the target state</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><a href="#__codelineno-0-1699"><span class="linenos" data-linenos="1699 "></span></a>                <span class="n">sample</span><span class="o">=</span><span class="n">samples</span><span class="o">.</span><span class="n">lazy</span><span class="p">(),</span>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><a href="#__codelineno-0-1700"><span class="linenos" data-linenos="1700 "></span></a>            <span class="p">)</span>
</span><span id="__span-0-1701"><a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><a href="#__codelineno-0-1701"><span class="linenos" data-linenos="1701 "></span></a>
</span><span id="__span-0-1702"><a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><a href="#__codelineno-0-1702"><span class="linenos" data-linenos="1702 "></span></a>            <span class="c1"># Convert None to empty DataFrames</span>
</span><span id="__span-0-1703"><a id="__codelineno-0-1703" name="__codelineno-0-1703"></a><a href="#__codelineno-0-1703"><span class="linenos" data-linenos="1703 "></span></a>            <span class="k">if</span> <span class="n">changed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1704"><a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><a href="#__codelineno-0-1704"><span class="linenos" data-linenos="1704 "></span></a>                <span class="n">changed</span> <span class="o">=</span> <span class="n">empty_frame_like</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
</span><span id="__span-0-1705"><a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><a href="#__codelineno-0-1705"><span class="linenos" data-linenos="1705 "></span></a>            <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1706"><a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><a href="#__codelineno-0-1706"><span class="linenos" data-linenos="1706 "></span></a>                <span class="n">removed</span> <span class="o">=</span> <span class="n">empty_frame_like</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
</span><span id="__span-0-1707"><a id="__codelineno-0-1707" name="__codelineno-0-1707"></a><a href="#__codelineno-0-1707"><span class="linenos" data-linenos="1707 "></span></a>
</span><span id="__span-0-1708"><a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><a href="#__codelineno-0-1708"><span class="linenos" data-linenos="1708 "></span></a>            <span class="c1"># Return as LazyIncrement or materialize to Increment</span>
</span><span id="__span-0-1709"><a id="__codelineno-0-1709" name="__codelineno-0-1709"></a><a href="#__codelineno-0-1709"><span class="linenos" data-linenos="1709 "></span></a>            <span class="k">if</span> <span class="n">lazy</span><span class="p">:</span>
</span><span id="__span-0-1710"><a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><a href="#__codelineno-0-1710"><span class="linenos" data-linenos="1710 "></span></a>                <span class="k">return</span> <span class="n">LazyIncrement</span><span class="p">(</span>
</span><span id="__span-0-1711"><a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><a href="#__codelineno-0-1711"><span class="linenos" data-linenos="1711 "></span></a>                    <span class="n">added</span><span class="o">=</span><span class="n">added</span>
</span><span id="__span-0-1712"><a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><a href="#__codelineno-0-1712"><span class="linenos" data-linenos="1712 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1713"><a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><a href="#__codelineno-0-1713"><span class="linenos" data-linenos="1713 "></span></a>                    <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">added</span><span class="p">),</span>
</span><span id="__span-0-1714"><a id="__codelineno-0-1714" name="__codelineno-0-1714"></a><a href="#__codelineno-0-1714"><span class="linenos" data-linenos="1714 "></span></a>                    <span class="n">changed</span><span class="o">=</span><span class="n">changed</span>
</span><span id="__span-0-1715"><a id="__codelineno-0-1715" name="__codelineno-0-1715"></a><a href="#__codelineno-0-1715"><span class="linenos" data-linenos="1715 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">changed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1716"><a id="__codelineno-0-1716" name="__codelineno-0-1716"></a><a href="#__codelineno-0-1716"><span class="linenos" data-linenos="1716 "></span></a>                    <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">changed</span><span class="p">),</span>
</span><span id="__span-0-1717"><a id="__codelineno-0-1717" name="__codelineno-0-1717"></a><a href="#__codelineno-0-1717"><span class="linenos" data-linenos="1717 "></span></a>                    <span class="n">removed</span><span class="o">=</span><span class="n">removed</span>
</span><span id="__span-0-1718"><a id="__codelineno-0-1718" name="__codelineno-0-1718"></a><a href="#__codelineno-0-1718"><span class="linenos" data-linenos="1718 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1719"><a id="__codelineno-0-1719" name="__codelineno-0-1719"></a><a href="#__codelineno-0-1719"><span class="linenos" data-linenos="1719 "></span></a>                    <span class="k">else</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">removed</span><span class="p">),</span>
</span><span id="__span-0-1720"><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a><a href="#__codelineno-0-1720"><span class="linenos" data-linenos="1720 "></span></a>                <span class="p">)</span>
</span><span id="__span-0-1721"><a id="__codelineno-0-1721" name="__codelineno-0-1721"></a><a href="#__codelineno-0-1721"><span class="linenos" data-linenos="1721 "></span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1722"><a id="__codelineno-0-1722" name="__codelineno-0-1722"></a><a href="#__codelineno-0-1722"><span class="linenos" data-linenos="1722 "></span></a>                <span class="k">return</span> <span class="n">Increment</span><span class="p">(</span>
</span><span id="__span-0-1723"><a id="__codelineno-0-1723" name="__codelineno-0-1723"></a><a href="#__codelineno-0-1723"><span class="linenos" data-linenos="1723 "></span></a>                    <span class="n">added</span><span class="o">=</span><span class="n">added</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-0-1724"><a id="__codelineno-0-1724" name="__codelineno-0-1724"></a><a href="#__codelineno-0-1724"><span class="linenos" data-linenos="1724 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">added</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a><a href="#__codelineno-0-1725"><span class="linenos" data-linenos="1725 "></span></a>                    <span class="k">else</span> <span class="n">added</span><span class="p">,</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><a href="#__codelineno-0-1726"><span class="linenos" data-linenos="1726 "></span></a>                    <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><a href="#__codelineno-0-1727"><span class="linenos" data-linenos="1727 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">changed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a><a href="#__codelineno-0-1728"><span class="linenos" data-linenos="1728 "></span></a>                    <span class="k">else</span> <span class="n">changed</span><span class="p">,</span>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><a href="#__codelineno-0-1729"><span class="linenos" data-linenos="1729 "></span></a>                    <span class="n">removed</span><span class="o">=</span><span class="n">removed</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><a href="#__codelineno-0-1730"><span class="linenos" data-linenos="1730 "></span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">removed</span><span class="p">,</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><a href="#__codelineno-0-1731"><span class="linenos" data-linenos="1731 "></span></a>                    <span class="k">else</span> <span class="n">removed</span><span class="p">,</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><a href="#__codelineno-0-1732"><span class="linenos" data-linenos="1732 "></span></a>                <span class="p">)</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><a href="#__codelineno-0-1733"><span class="linenos" data-linenos="1733 "></span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a><a href="#__codelineno-0-1734"><span class="linenos" data-linenos="1734 "></span></a>            <span class="c1"># Clean up tracker if it was created via context manager</span>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a><a href="#__codelineno-0-1735"><span class="linenos" data-linenos="1735 "></span></a>            <span class="k">if</span> <span class="n">tracker_cm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a><a href="#__codelineno-0-1736"><span class="linenos" data-linenos="1736 "></span></a>                <span class="n">tracker_cm</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a><a href="#__codelineno-0-1737"><span class="linenos" data-linenos="1737 "></span></a>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a><a href="#__codelineno-0-1738"><span class="linenos" data-linenos="1738 "></span></a>    <span class="c1"># Root features without samples: error (samples required)</span>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a><a href="#__codelineno-0-1739"><span class="linenos" data-linenos="1739 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">plan</span><span class="o">.</span><span class="n">deps</span><span class="p">:</span>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a><a href="#__codelineno-0-1740"><span class="linenos" data-linenos="1740 "></span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a><a href="#__codelineno-0-1741"><span class="linenos" data-linenos="1741 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">feature</span><span class="o">.</span><span class="n">spec</span><span class="p">()</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> has no upstream dependencies (root feature). &quot;</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a><a href="#__codelineno-0-1742"><span class="linenos" data-linenos="1742 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Must provide &#39;samples&#39; parameter with sample_uid and </span><span class="si">{</span><span class="n">PROVENANCE_BY_FIELD_COL</span><span class="si">}</span><span class="s2"> columns. &quot;</span>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a><a href="#__codelineno-0-1743"><span class="linenos" data-linenos="1743 "></span></a>            <span class="sa">f</span><span class="s2">&quot;Root features require manual </span><span class="si">{</span><span class="n">PROVENANCE_BY_FIELD_COL</span><span class="si">}</span><span class="s2"> computation.&quot;</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><a href="#__codelineno-0-1744"><span class="linenos" data-linenos="1744 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-1745"><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a><a href="#__codelineno-0-1745"><span class="linenos" data-linenos="1745 "></span></a>
</span><span id="__span-0-1746"><a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><a href="#__codelineno-0-1746"><span class="linenos" data-linenos="1746 "></span></a>    <span class="c1"># Non-root features without samples: automatic upstream loading</span>
</span><span id="__span-0-1747"><a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><a href="#__codelineno-0-1747"><span class="linenos" data-linenos="1747 "></span></a>    <span class="c1"># Check where upstream data lives</span>
</span><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><a href="#__codelineno-0-1748"><span class="linenos" data-linenos="1748 "></span></a>    <span class="n">upstream_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_upstream_location</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><a href="#__codelineno-0-1749"><span class="linenos" data-linenos="1749 "></span></a>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><a href="#__codelineno-0-1750"><span class="linenos" data-linenos="1750 "></span></a>    <span class="k">if</span> <span class="n">upstream_location</span> <span class="o">==</span> <span class="s2">&quot;all_local&quot;</span><span class="p">:</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><a href="#__codelineno-0-1751"><span class="linenos" data-linenos="1751 "></span></a>        <span class="c1"># All upstream in this store - use native field provenance calculations</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><a href="#__codelineno-0-1752"><span class="linenos" data-linenos="1752 "></span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_update_native</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">)</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><a href="#__codelineno-0-1753"><span class="linenos" data-linenos="1753 "></span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><a href="#__codelineno-0-1754"><span class="linenos" data-linenos="1754 "></span></a>        <span class="c1"># Some upstream in fallback stores - use Polars components</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><a href="#__codelineno-0-1755"><span class="linenos" data-linenos="1755 "></span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_update_polars</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.native_implementation" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">native_implementation</span>


<a href="#metaxy.InMemoryMetadataStore.native_implementation" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">native_implementation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Implementation&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/implementation/#narwhals.Implementation">Implementation</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Get native implementation for in-memory store.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><a href="#__codelineno-0-68"><span class="linenos" data-linenos="68 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">native_implementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="p">:</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><a href="#__codelineno-0-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get native implementation for in-memory store.&quot;&quot;&quot;</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><a href="#__codelineno-0-70"><span class="linenos" data-linenos="70 "></span></a>    <span class="k">return</span> <span class="n">nw</span><span class="o">.</span><span class="n">Implementation</span><span class="o">.</span><span class="n">POLARS</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.read_metadata_in_store" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">read_metadata_in_store</span>


<a href="#metaxy.InMemoryMetadataStore.read_metadata_in_store" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">read_metadata_in_store</span><span class="p">(</span><span class="n">feature</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a></span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">feature_version</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Read metadata from this store only (no fallback).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>feature</code></b>
              (<code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;FeatureKey&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.types.FeatureKey&lt;/code&gt;)" href="../../definitions/feature/#metaxy.FeatureKey">FeatureKey</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-heading doc-symbol-class&quot;&gt;&lt;/code&gt;            &lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;BaseFeature&lt;/span&gt;


  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-pydantic-model&quot;&gt;&lt;code&gt;pydantic-model&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;metaxy.models.feature.BaseFeature&lt;/code&gt;)" href="../../definitions/feature/#metaxy.BaseFeature">BaseFeature</a>]</code>)
          –
          <div class="doc-md-description">
            <p>Feature to read</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>feature_version</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Filter by specific feature_version</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.Expr&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/expr/#narwhals.Expr">Expr</a>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>List of Narwhals filter expressions</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>columns</code></b>
              (<code><a class="autorefs autorefs-external" title="&lt;code&gt;collections.abc.Sequence&lt;/code&gt;" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence">Sequence</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Optional list of columns to select</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="&lt;code&gt;narwhals.LazyFrame&lt;/code&gt;" href="https://narwhals-dev.github.io/narwhals/api-reference/lazyframe/#narwhals.dataframe.LazyFrame">LazyFrame</a>[<a class="autorefs autorefs-external" title="&lt;code&gt;typing.Any&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>] | None</code>
          –
          <div class="doc-md-description">
            <p>Narwhals LazyFrame with metadata, or None if not found</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="metaxy.metadata_store.exceptions.StoreNotOpenError">StoreNotOpenError</span></code>
            –
          <div class="doc-md-description">
            <p>If store is not open</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><a href="#__codelineno-0-156"><span class="linenos" data-linenos="156 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">read_metadata_in_store</span><span class="p">(</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><a href="#__codelineno-0-157"><span class="linenos" data-linenos="157 "></span></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><a href="#__codelineno-0-158"><span class="linenos" data-linenos="158 "></span></a>    <span class="n">feature</span><span class="p">:</span> <span class="n">FeatureKey</span> <span class="o">|</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseFeature</span><span class="p">],</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><a href="#__codelineno-0-159"><span class="linenos" data-linenos="159 "></span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><a href="#__codelineno-0-160"><span class="linenos" data-linenos="160 "></span></a>    <span class="n">feature_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><a href="#__codelineno-0-161"><span class="linenos" data-linenos="161 "></span></a>    <span class="n">filters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">nw</span><span class="o">.</span><span class="n">Expr</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><a href="#__codelineno-0-162"><span class="linenos" data-linenos="162 "></span></a>    <span class="n">columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><a href="#__codelineno-0-163"><span class="linenos" data-linenos="163 "></span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nw</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><a href="#__codelineno-0-164"><span class="linenos" data-linenos="164 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><a href="#__codelineno-0-165"><span class="linenos" data-linenos="165 "></span></a><span class="sd">    Read metadata from this store only (no fallback).</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><a href="#__codelineno-0-166"><span class="linenos" data-linenos="166 "></span></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><a href="#__codelineno-0-167"><span class="linenos" data-linenos="167 "></span></a><span class="sd">    Args:</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><a href="#__codelineno-0-168"><span class="linenos" data-linenos="168 "></span></a><span class="sd">        feature: Feature to read</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><a href="#__codelineno-0-169"><span class="linenos" data-linenos="169 "></span></a><span class="sd">        feature_version: Filter by specific feature_version</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a><a href="#__codelineno-0-170"><span class="linenos" data-linenos="170 "></span></a><span class="sd">        filters: List of Narwhals filter expressions</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a><a href="#__codelineno-0-171"><span class="linenos" data-linenos="171 "></span></a><span class="sd">        columns: Optional list of columns to select</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a><a href="#__codelineno-0-172"><span class="linenos" data-linenos="172 "></span></a>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><a href="#__codelineno-0-173"><span class="linenos" data-linenos="173 "></span></a><span class="sd">    Returns:</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><a href="#__codelineno-0-174"><span class="linenos" data-linenos="174 "></span></a><span class="sd">        Narwhals LazyFrame with metadata, or None if not found</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><a href="#__codelineno-0-175"><span class="linenos" data-linenos="175 "></span></a>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><a href="#__codelineno-0-176"><span class="linenos" data-linenos="176 "></span></a><span class="sd">    Raises:</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><a href="#__codelineno-0-177"><span class="linenos" data-linenos="177 "></span></a><span class="sd">        StoreNotOpenError: If store is not open</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><a href="#__codelineno-0-178"><span class="linenos" data-linenos="178 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><a href="#__codelineno-0-179"><span class="linenos" data-linenos="179 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_check_open</span><span class="p">()</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><a href="#__codelineno-0-180"><span class="linenos" data-linenos="180 "></span></a>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><a href="#__codelineno-0-181"><span class="linenos" data-linenos="181 "></span></a>    <span class="n">feature_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_feature_key</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><a href="#__codelineno-0-182"><span class="linenos" data-linenos="182 "></span></a>    <span class="n">storage_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_storage_key</span><span class="p">(</span><span class="n">feature_key</span><span class="p">)</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><a href="#__codelineno-0-183"><span class="linenos" data-linenos="183 "></span></a>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><a href="#__codelineno-0-184"><span class="linenos" data-linenos="184 "></span></a>    <span class="k">if</span> <span class="n">storage_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">:</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><a href="#__codelineno-0-185"><span class="linenos" data-linenos="185 "></span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><a href="#__codelineno-0-186"><span class="linenos" data-linenos="186 "></span></a>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><a href="#__codelineno-0-187"><span class="linenos" data-linenos="187 "></span></a>    <span class="c1"># Start with lazy Polars DataFrame, wrap with Narwhals</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><a href="#__codelineno-0-188"><span class="linenos" data-linenos="188 "></span></a>    <span class="n">df_lazy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="n">storage_key</span><span class="p">]</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><a href="#__codelineno-0-189"><span class="linenos" data-linenos="189 "></span></a>    <span class="n">nw_lazy</span> <span class="o">=</span> <span class="n">nw</span><span class="o">.</span><span class="n">from_native</span><span class="p">(</span><span class="n">df_lazy</span><span class="p">)</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><a href="#__codelineno-0-190"><span class="linenos" data-linenos="190 "></span></a>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><a href="#__codelineno-0-191"><span class="linenos" data-linenos="191 "></span></a>    <span class="c1"># Apply feature_version filter</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><a href="#__codelineno-0-192"><span class="linenos" data-linenos="192 "></span></a>    <span class="k">if</span> <span class="n">feature_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><a href="#__codelineno-0-193"><span class="linenos" data-linenos="193 "></span></a>        <span class="n">nw_lazy</span> <span class="o">=</span> <span class="n">nw_lazy</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><a href="#__codelineno-0-194"><span class="linenos" data-linenos="194 "></span></a>            <span class="n">nw</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;metaxy_feature_version&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">feature_version</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><a href="#__codelineno-0-195"><span class="linenos" data-linenos="195 "></span></a>        <span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><a href="#__codelineno-0-196"><span class="linenos" data-linenos="196 "></span></a>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><a href="#__codelineno-0-197"><span class="linenos" data-linenos="197 "></span></a>    <span class="c1"># Apply generic Narwhals filters</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><a href="#__codelineno-0-198"><span class="linenos" data-linenos="198 "></span></a>    <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><a href="#__codelineno-0-199"><span class="linenos" data-linenos="199 "></span></a>        <span class="k">for</span> <span class="n">filter_expr</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><a href="#__codelineno-0-200"><span class="linenos" data-linenos="200 "></span></a>            <span class="n">nw_lazy</span> <span class="o">=</span> <span class="n">nw_lazy</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filter_expr</span><span class="p">)</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><a href="#__codelineno-0-201"><span class="linenos" data-linenos="201 "></span></a>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><a href="#__codelineno-0-202"><span class="linenos" data-linenos="202 "></span></a>    <span class="c1"># Select columns</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><a href="#__codelineno-0-203"><span class="linenos" data-linenos="203 "></span></a>    <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><a href="#__codelineno-0-204"><span class="linenos" data-linenos="204 "></span></a>        <span class="n">nw_lazy</span> <span class="o">=</span> <span class="n">nw_lazy</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><a href="#__codelineno-0-205"><span class="linenos" data-linenos="205 "></span></a>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><a href="#__codelineno-0-206"><span class="linenos" data-linenos="206 "></span></a>    <span class="c1"># Check if result would be empty (we need to check the underlying frame)</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><a href="#__codelineno-0-207"><span class="linenos" data-linenos="207 "></span></a>    <span class="c1"># For now, return the lazy frame - emptiness check happens when materializing</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><a href="#__codelineno-0-208"><span class="linenos" data-linenos="208 "></span></a>    <span class="k">return</span> <span class="n">nw_lazy</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.clear" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">clear</span>


<a href="#metaxy.InMemoryMetadataStore.clear" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">clear</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Clear all metadata from store.</p>
<p>Useful for testing.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><a href="#__codelineno-0-210"><span class="linenos" data-linenos="210 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><a href="#__codelineno-0-211"><span class="linenos" data-linenos="211 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><a href="#__codelineno-0-212"><span class="linenos" data-linenos="212 "></span></a><span class="sd">    Clear all metadata from store.</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><a href="#__codelineno-0-213"><span class="linenos" data-linenos="213 "></span></a>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><a href="#__codelineno-0-214"><span class="linenos" data-linenos="214 "></span></a><span class="sd">    Useful for testing.</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><a href="#__codelineno-0-215"><span class="linenos" data-linenos="215 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><a href="#__codelineno-0-216"><span class="linenos" data-linenos="216 "></span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.open" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">open</span>


<a href="#metaxy.InMemoryMetadataStore.open" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">open</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Open the in-memory store.</p>
<p>For InMemoryMetadataStore, this is a no-op since no external
resources need initialization. The auto_create_tables setting
has no effect for in-memory stores (no tables to create).</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><a href="#__codelineno-0-220"><span class="linenos" data-linenos="220 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><a href="#__codelineno-0-221"><span class="linenos" data-linenos="221 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open the in-memory store.</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><a href="#__codelineno-0-222"><span class="linenos" data-linenos="222 "></span></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><a href="#__codelineno-0-223"><span class="linenos" data-linenos="223 "></span></a><span class="sd">    For InMemoryMetadataStore, this is a no-op since no external</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a><a href="#__codelineno-0-224"><span class="linenos" data-linenos="224 "></span></a><span class="sd">    resources need initialization. The auto_create_tables setting</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a><a href="#__codelineno-0-225"><span class="linenos" data-linenos="225 "></span></a><span class="sd">    has no effect for in-memory stores (no tables to create).</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a><a href="#__codelineno-0-226"><span class="linenos" data-linenos="226 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a><a href="#__codelineno-0-227"><span class="linenos" data-linenos="227 "></span></a>    <span class="c1"># No resources to initialize for in-memory storage</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a><a href="#__codelineno-0-228"><span class="linenos" data-linenos="228 "></span></a>    <span class="k">pass</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.close" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">close</span>


<a href="#metaxy.InMemoryMetadataStore.close" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">close</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Close the in-memory store.</p>
<p>For InMemoryMetadataStore, this is a no-op since no external
resources need cleanup.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a><a href="#__codelineno-0-230"><span class="linenos" data-linenos="230 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a><a href="#__codelineno-0-231"><span class="linenos" data-linenos="231 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Close the in-memory store.</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a><a href="#__codelineno-0-232"><span class="linenos" data-linenos="232 "></span></a>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a><a href="#__codelineno-0-233"><span class="linenos" data-linenos="233 "></span></a><span class="sd">    For InMemoryMetadataStore, this is a no-op since no external</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a><a href="#__codelineno-0-234"><span class="linenos" data-linenos="234 "></span></a><span class="sd">    resources need cleanup.</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><a href="#__codelineno-0-235"><span class="linenos" data-linenos="235 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><a href="#__codelineno-0-236"><span class="linenos" data-linenos="236 "></span></a>    <span class="k">pass</span>  <span class="c1"># No resources to cleanup for in-memory storage</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.__repr__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__repr__</span>


<a href="#metaxy.InMemoryMetadataStore.__repr__" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">__repr__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>String representation.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a><a href="#__codelineno-0-238"><span class="linenos" data-linenos="238 "></span></a><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><a href="#__codelineno-0-239"><span class="linenos" data-linenos="239 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;String representation.&quot;&quot;&quot;</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><a href="#__codelineno-0-240"><span class="linenos" data-linenos="240 "></span></a>    <span class="n">num_fallbacks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fallback_stores</span><span class="p">)</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><a href="#__codelineno-0-241"><span class="linenos" data-linenos="241 "></span></a>    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="k">else</span> <span class="s2">&quot;closed&quot;</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><a href="#__codelineno-0-242"><span class="linenos" data-linenos="242 "></span></a>    <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><a href="#__codelineno-0-243"><span class="linenos" data-linenos="243 "></span></a>        <span class="sa">f</span><span class="s2">&quot;InMemoryMetadataStore(status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">, fallback_stores=</span><span class="si">{</span><span class="n">num_fallbacks</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><a href="#__codelineno-0-244"><span class="linenos" data-linenos="244 "></span></a>    <span class="p">)</span>
</span></code></pre></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="metaxy.InMemoryMetadataStore.display" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">display</span>


<a href="#metaxy.InMemoryMetadataStore.display" class="headerlink" title="Permanent link">&para;</a></h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">display</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Display string for this store.</p>


            <details class="quote">
              <summary>Source code in <code>src/metaxy/metadata_store/memory.py</code></summary>
              <div class="language-python highlight"><pre><span></span><code><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><a href="#__codelineno-0-246"><span class="linenos" data-linenos="246 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a><a href="#__codelineno-0-247"><span class="linenos" data-linenos="247 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Display string for this store.&quot;&quot;&quot;</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a><a href="#__codelineno-0-248"><span class="linenos" data-linenos="248 "></span></a>    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_open</span> <span class="k">else</span> <span class="s2">&quot;closed&quot;</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><a href="#__codelineno-0-249"><span class="linenos" data-linenos="249 "></span></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;InMemoryMetadataStore(status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">)&quot;</span>
</span></code></pre></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/anam-org/metaxy" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../javascripts/scarf.js"></script>
      
    
  </body>
</html>